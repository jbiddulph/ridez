const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Cr9T9vnx.js","./Cjv9p6sY.js","./CA4ePKKh.js","./CatA3LoI.js","./TCo5-zK6.js","./index.D5kBh39w.css","./dkBrcp1I.js","./trips.D3LNqpV4.css","./CcvJkp3n.js","./_id_.ZomHwVlT.css","./DXz-Cb5v.js","./reports.CPHUYPVa.css","./-5dIiHNc.js","./settings.CU2ahhRi.css","./B1nwnt7I.js","./B5KKkQnh.js","./default.hF0Zyx5o.css","./DyvCn2DQ.js","./DK0nvN6D.js","./error-404.4oxyXxx0.css","./DIo9Vbrw.js","./error-500.CZqNkBuR.css"])))=>i.map(i=>d[i]);
var rR=Object.defineProperty;var nR=(a,c,m)=>c in a?rR(a,c,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[c]=m;var nc=(a,c,m)=>nR(a,typeof c!="symbol"?c+"":c,m);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))y(T);new MutationObserver(T=>{for(const S of T)if(S.type==="childList")for(const M of S.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function m(T){const S={};return T.integrity&&(S.integrity=T.integrity),T.referrerPolicy&&(S.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?S.credentials="include":T.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function y(T){if(T.ep)return;T.ep=!0;const S=m(T);fetch(T.href,S)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ox(a){const c=Object.create(null);for(const m of a.split(","))c[m]=1;return m=>m in c}const dn={},Sd=[],Ea=()=>{},sR=()=>!1,mm=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),Fx=a=>a.startsWith("onUpdate:"),ds=Object.assign,Bx=(a,c)=>{const m=a.indexOf(c);m>-1&&a.splice(m,1)},oR=Object.prototype.hasOwnProperty,sn=(a,c)=>oR.call(a,c),qi=Array.isArray,Ed=a=>Ud(a)==="[object Map]",ly=a=>Ud(a)==="[object Set]",lS=a=>Ud(a)==="[object Date]",aR=a=>Ud(a)==="[object RegExp]",er=a=>typeof a=="function",An=a=>typeof a=="string",Zo=a=>typeof a=="symbol",cn=a=>a!==null&&typeof a=="object",a2=a=>(cn(a)||er(a))&&er(a.then)&&er(a.catch),l2=Object.prototype.toString,Ud=a=>l2.call(a),lR=a=>Ud(a).slice(8,-1),c2=a=>Ud(a)==="[object Object]",Nx=a=>An(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,Ad=Ox(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cy=a=>{const c=Object.create(null);return m=>c[m]||(c[m]=a(m))},cR=/-(\w)/g,Io=cy(a=>a.replace(cR,(c,m)=>m?m.toUpperCase():"")),uR=/\B([A-Z])/g,xc=cy(a=>a.replace(uR,"-$1").toLowerCase()),uy=cy(a=>a.charAt(0).toUpperCase()+a.slice(1)),T0=cy(a=>a?`on${uy(a)}`:""),gc=(a,c)=>!Object.is(a,c),Id=(a,...c)=>{for(let m=0;m<a.length;m++)a[m](...c)},u2=(a,c,m,y=!1)=>{Object.defineProperty(a,c,{configurable:!0,enumerable:!1,writable:y,value:m})},$g=a=>{const c=parseFloat(a);return isNaN(c)?a:c},h2=a=>{const c=An(a)?Number(a):NaN;return isNaN(c)?a:c};let cS;const hy=()=>cS||(cS=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function dy(a){if(qi(a)){const c={};for(let m=0;m<a.length;m++){const y=a[m],T=An(y)?pR(y):dy(y);if(T)for(const S in T)c[S]=T[S]}return c}else if(An(a)||cn(a))return a}const hR=/;(?![^(]*\))/g,dR=/:([^]+)/,fR=/\/\*[^]*?\*\//g;function pR(a){const c={};return a.replace(fR,"").split(hR).forEach(m=>{if(m){const y=m.split(dR);y.length>1&&(c[y[0].trim()]=y[1].trim())}}),c}function fy(a){let c="";if(An(a))c=a;else if(qi(a))for(let m=0;m<a.length;m++){const y=fy(a[m]);y&&(c+=y+" ")}else if(cn(a))for(const m in a)a[m]&&(c+=m+" ");return c.trim()}function mR(a){if(!a)return null;let{class:c,style:m}=a;return c&&!An(c)&&(a.class=fy(c)),m&&(a.style=dy(m)),a}const _R="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",gR=Ox(_R);function d2(a){return!!a||a===""}function yR(a,c){if(a.length!==c.length)return!1;let m=!0;for(let y=0;m&&y<a.length;y++)m=Dd(a[y],c[y]);return m}function Dd(a,c){if(a===c)return!0;let m=lS(a),y=lS(c);if(m||y)return m&&y?a.getTime()===c.getTime():!1;if(m=Zo(a),y=Zo(c),m||y)return a===c;if(m=qi(a),y=qi(c),m||y)return m&&y?yR(a,c):!1;if(m=cn(a),y=cn(c),m||y){if(!m||!y)return!1;const T=Object.keys(a).length,S=Object.keys(c).length;if(T!==S)return!1;for(const M in a){const n=a.hasOwnProperty(M),F=c.hasOwnProperty(M);if(n&&!F||!n&&F||!Dd(a[M],c[M]))return!1}}return String(a)===String(c)}function vR(a,c){return a.findIndex(m=>Dd(m,c))}const f2=a=>!!(a&&a.__v_isRef===!0),xR=a=>An(a)?a:a==null?"":qi(a)||cn(a)&&(a.toString===l2||!er(a.toString))?f2(a)?xR(a.value):JSON.stringify(a,p2,2):String(a),p2=(a,c)=>f2(c)?p2(a,c.value):Ed(c)?{[`Map(${c.size})`]:[...c.entries()].reduce((m,[y,T],S)=>(m[S0(y,S)+" =>"]=T,m),{})}:ly(c)?{[`Set(${c.size})`]:[...c.values()].map(m=>S0(m))}:Zo(c)?S0(c):cn(c)&&!qi(c)&&!c2(c)?String(c):c,S0=(a,c="")=>{var m;return Zo(a)?`Symbol(${(m=a.description)!=null?m:c})`:a};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let co;class m2{constructor(c=!1){this.detached=c,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=co,!c&&co&&(this.index=(co.scopes||(co.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let c,m;if(this.scopes)for(c=0,m=this.scopes.length;c<m;c++)this.scopes[c].pause();for(c=0,m=this.effects.length;c<m;c++)this.effects[c].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let c,m;if(this.scopes)for(c=0,m=this.scopes.length;c<m;c++)this.scopes[c].resume();for(c=0,m=this.effects.length;c<m;c++)this.effects[c].resume()}}run(c){if(this._active){const m=co;try{return co=this,c()}finally{co=m}}}on(){co=this}off(){co=this.parent}stop(c){if(this._active){this._active=!1;let m,y;for(m=0,y=this.effects.length;m<y;m++)this.effects[m].stop();for(this.effects.length=0,m=0,y=this.cleanups.length;m<y;m++)this.cleanups[m]();if(this.cleanups.length=0,this.scopes){for(m=0,y=this.scopes.length;m<y;m++)this.scopes[m].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!c){const T=this.parent.scopes.pop();T&&T!==this&&(this.parent.scopes[this.index]=T,T.index=this.index)}this.parent=void 0}}}function bR(a){return new m2(a)}function _2(){return co}let yn;const E0=new WeakSet;class g2{constructor(c){this.fn=c,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,co&&co.active&&co.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,E0.has(this)&&(E0.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||v2(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,uS(this),x2(this);const c=yn,m=Wo;yn=this,Wo=!0;try{return this.fn()}finally{b2(this),yn=c,Wo=m,this.flags&=-3}}stop(){if(this.flags&1){for(let c=this.deps;c;c=c.nextDep)jx(c);this.deps=this.depsTail=void 0,uS(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?E0.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){J0(this)&&this.run()}get dirty(){return J0(this)}}let y2=0,Gp,Hp;function v2(a,c=!1){if(a.flags|=8,c){a.next=Hp,Hp=a;return}a.next=Gp,Gp=a}function Ux(){y2++}function Vx(){if(--y2>0)return;if(Hp){let c=Hp;for(Hp=void 0;c;){const m=c.next;c.next=void 0,c.flags&=-9,c=m}}let a;for(;Gp;){let c=Gp;for(Gp=void 0;c;){const m=c.next;if(c.next=void 0,c.flags&=-9,c.flags&1)try{c.trigger()}catch(y){a||(a=y)}c=m}}if(a)throw a}function x2(a){for(let c=a.deps;c;c=c.nextDep)c.version=-1,c.prevActiveLink=c.dep.activeLink,c.dep.activeLink=c}function b2(a){let c,m=a.depsTail,y=m;for(;y;){const T=y.prevDep;y.version===-1?(y===m&&(m=T),jx(y),wR(y)):c=y,y.dep.activeLink=y.prevActiveLink,y.prevActiveLink=void 0,y=T}a.deps=c,a.depsTail=m}function J0(a){for(let c=a.deps;c;c=c.nextDep)if(c.dep.version!==c.version||c.dep.computed&&(w2(c.dep.computed)||c.dep.version!==c.version))return!0;return!!a._dirty}function w2(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===rm))return;a.globalVersion=rm;const c=a.dep;if(a.flags|=2,c.version>0&&!a.isSSR&&a.deps&&!J0(a)){a.flags&=-3;return}const m=yn,y=Wo;yn=a,Wo=!0;try{x2(a);const T=a.fn(a._value);(c.version===0||gc(T,a._value))&&(a._value=T,c.version++)}catch(T){throw c.version++,T}finally{yn=m,Wo=y,b2(a),a.flags&=-3}}function jx(a,c=!1){const{dep:m,prevSub:y,nextSub:T}=a;if(y&&(y.nextSub=T,a.prevSub=void 0),T&&(T.prevSub=y,a.nextSub=void 0),m.subs===a&&(m.subs=y,!y&&m.computed)){m.computed.flags&=-5;for(let S=m.computed.deps;S;S=S.nextDep)jx(S,!0)}!c&&!--m.sc&&m.map&&m.map.delete(m.key)}function wR(a){const{prevDep:c,nextDep:m}=a;c&&(c.nextDep=m,a.prevDep=void 0),m&&(m.prevDep=c,a.nextDep=void 0)}let Wo=!0;const T2=[];function bc(){T2.push(Wo),Wo=!1}function wc(){const a=T2.pop();Wo=a===void 0?!0:a}function uS(a){const{cleanup:c}=a;if(a.cleanup=void 0,c){const m=yn;yn=void 0;try{c()}finally{yn=m}}}let rm=0;class TR{constructor(c,m){this.sub=c,this.dep=m,this.version=m.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class $x{constructor(c){this.computed=c,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(c){if(!yn||!Wo||yn===this.computed)return;let m=this.activeLink;if(m===void 0||m.sub!==yn)m=this.activeLink=new TR(yn,this),yn.deps?(m.prevDep=yn.depsTail,yn.depsTail.nextDep=m,yn.depsTail=m):yn.deps=yn.depsTail=m,S2(m);else if(m.version===-1&&(m.version=this.version,m.nextDep)){const y=m.nextDep;y.prevDep=m.prevDep,m.prevDep&&(m.prevDep.nextDep=y),m.prevDep=yn.depsTail,m.nextDep=void 0,yn.depsTail.nextDep=m,yn.depsTail=m,yn.deps===m&&(yn.deps=y)}return m}trigger(c){this.version++,rm++,this.notify(c)}notify(c){Ux();try{for(let m=this.subs;m;m=m.prevSub)m.sub.notify()&&m.sub.dep.notify()}finally{Vx()}}}function S2(a){if(a.dep.sc++,a.sub.flags&4){const c=a.dep.computed;if(c&&!a.dep.subs){c.flags|=20;for(let y=c.deps;y;y=y.nextDep)S2(y)}const m=a.dep.subs;m!==a&&(a.prevSub=m,m&&(m.nextSub=a)),a.dep.subs=a}}const Gg=new WeakMap,zu=Symbol(""),Q0=Symbol(""),nm=Symbol("");function As(a,c,m){if(Wo&&yn){let y=Gg.get(a);y||Gg.set(a,y=new Map);let T=y.get(m);T||(y.set(m,T=new $x),T.map=y,T.key=m),T.track()}}function al(a,c,m,y,T,S){const M=Gg.get(a);if(!M){rm++;return}const n=F=>{F&&F.trigger()};if(Ux(),c==="clear")M.forEach(n);else{const F=qi(a),W=F&&Nx(m);if(F&&m==="length"){const N=Number(y);M.forEach((Y,le)=>{(le==="length"||le===nm||!Zo(le)&&le>=N)&&n(Y)})}else switch((m!==void 0||M.has(void 0))&&n(M.get(m)),W&&n(M.get(nm)),c){case"add":F?W&&n(M.get("length")):(n(M.get(zu)),Ed(a)&&n(M.get(Q0)));break;case"delete":F||(n(M.get(zu)),Ed(a)&&n(M.get(Q0)));break;case"set":Ed(a)&&n(M.get(zu));break}}Vx()}function SR(a,c){const m=Gg.get(a);return m&&m.get(c)}function ud(a){const c=tn(a);return c===a?c:(As(c,"iterate",nm),Ao(a)?c:c.map(Is))}function py(a){return As(a=tn(a),"iterate",nm),a}const ER={__proto__:null,[Symbol.iterator](){return A0(this,Symbol.iterator,Is)},concat(...a){return ud(this).concat(...a.map(c=>qi(c)?ud(c):c))},entries(){return A0(this,"entries",a=>(a[1]=Is(a[1]),a))},every(a,c){return il(this,"every",a,c,void 0,arguments)},filter(a,c){return il(this,"filter",a,c,m=>m.map(Is),arguments)},find(a,c){return il(this,"find",a,c,Is,arguments)},findIndex(a,c){return il(this,"findIndex",a,c,void 0,arguments)},findLast(a,c){return il(this,"findLast",a,c,Is,arguments)},findLastIndex(a,c){return il(this,"findLastIndex",a,c,void 0,arguments)},forEach(a,c){return il(this,"forEach",a,c,void 0,arguments)},includes(...a){return I0(this,"includes",a)},indexOf(...a){return I0(this,"indexOf",a)},join(a){return ud(this).join(a)},lastIndexOf(...a){return I0(this,"lastIndexOf",a)},map(a,c){return il(this,"map",a,c,void 0,arguments)},pop(){return Lp(this,"pop")},push(...a){return Lp(this,"push",a)},reduce(a,...c){return hS(this,"reduce",a,c)},reduceRight(a,...c){return hS(this,"reduceRight",a,c)},shift(){return Lp(this,"shift")},some(a,c){return il(this,"some",a,c,void 0,arguments)},splice(...a){return Lp(this,"splice",a)},toReversed(){return ud(this).toReversed()},toSorted(a){return ud(this).toSorted(a)},toSpliced(...a){return ud(this).toSpliced(...a)},unshift(...a){return Lp(this,"unshift",a)},values(){return A0(this,"values",Is)}};function A0(a,c,m){const y=py(a),T=y[c]();return y!==a&&!Ao(a)&&(T._next=T.next,T.next=()=>{const S=T._next();return S.value&&(S.value=m(S.value)),S}),T}const AR=Array.prototype;function il(a,c,m,y,T,S){const M=py(a),n=M!==a&&!Ao(a),F=M[c];if(F!==AR[c]){const Y=F.apply(a,S);return n?Is(Y):Y}let W=m;M!==a&&(n?W=function(Y,le){return m.call(this,Is(Y),le,a)}:m.length>2&&(W=function(Y,le){return m.call(this,Y,le,a)}));const N=F.call(M,W,y);return n&&T?T(N):N}function hS(a,c,m,y){const T=py(a);let S=m;return T!==a&&(Ao(a)?m.length>3&&(S=function(M,n,F){return m.call(this,M,n,F,a)}):S=function(M,n,F){return m.call(this,M,Is(n),F,a)}),T[c](S,...y)}function I0(a,c,m){const y=tn(a);As(y,"iterate",nm);const T=y[c](...m);return(T===-1||T===!1)&&qx(m[0])?(m[0]=tn(m[0]),y[c](...m)):T}function Lp(a,c,m=[]){bc(),Ux();const y=tn(a)[c].apply(a,m);return Vx(),wc(),y}const IR=Ox("__proto__,__v_isRef,__isVue"),E2=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(Zo));function CR(a){Zo(a)||(a=String(a));const c=tn(this);return As(c,"has",a),c.hasOwnProperty(a)}class A2{constructor(c=!1,m=!1){this._isReadonly=c,this._isShallow=m}get(c,m,y){if(m==="__v_skip")return c.__v_skip;const T=this._isReadonly,S=this._isShallow;if(m==="__v_isReactive")return!T;if(m==="__v_isReadonly")return T;if(m==="__v_isShallow")return S;if(m==="__v_raw")return y===(T?S?BR:M2:S?P2:C2).get(c)||Object.getPrototypeOf(c)===Object.getPrototypeOf(y)?c:void 0;const M=qi(c);if(!T){let F;if(M&&(F=ER[m]))return F;if(m==="hasOwnProperty")return CR}const n=Reflect.get(c,m,Hn(c)?c:y);return(Zo(m)?E2.has(m):IR(m))||(T||As(c,"get",m),S)?n:Hn(n)?M&&Nx(m)?n:n.value:cn(n)?T?R2(n):Tc(n):n}}class I2 extends A2{constructor(c=!1){super(!1,c)}set(c,m,y,T){let S=c[m];if(!this._isShallow){const F=vc(S);if(!Ao(y)&&!vc(y)&&(S=tn(S),y=tn(y)),!qi(c)&&Hn(S)&&!Hn(y))return F?!1:(S.value=y,!0)}const M=qi(c)&&Nx(m)?Number(m)<c.length:sn(c,m),n=Reflect.set(c,m,y,Hn(c)?c:T);return c===tn(T)&&(M?gc(y,S)&&al(c,"set",m,y):al(c,"add",m,y)),n}deleteProperty(c,m){const y=sn(c,m);c[m];const T=Reflect.deleteProperty(c,m);return T&&y&&al(c,"delete",m,void 0),T}has(c,m){const y=Reflect.has(c,m);return(!Zo(m)||!E2.has(m))&&As(c,"has",m),y}ownKeys(c){return As(c,"iterate",qi(c)?"length":zu),Reflect.ownKeys(c)}}class PR extends A2{constructor(c=!1){super(!0,c)}set(c,m){return!0}deleteProperty(c,m){return!0}}const MR=new I2,RR=new PR,DR=new I2(!0);const ex=a=>a,bg=a=>Reflect.getPrototypeOf(a);function kR(a,c,m){return function(...y){const T=this.__v_raw,S=tn(T),M=Ed(S),n=a==="entries"||a===Symbol.iterator&&M,F=a==="keys"&&M,W=T[a](...y),N=m?ex:c?tx:Is;return!c&&As(S,"iterate",F?Q0:zu),{next(){const{value:Y,done:le}=W.next();return le?{value:Y,done:le}:{value:n?[N(Y[0]),N(Y[1])]:N(Y),done:le}},[Symbol.iterator](){return this}}}}function wg(a){return function(...c){return a==="delete"?!1:a==="clear"?void 0:this}}function LR(a,c){const m={get(T){const S=this.__v_raw,M=tn(S),n=tn(T);a||(gc(T,n)&&As(M,"get",T),As(M,"get",n));const{has:F}=bg(M),W=c?ex:a?tx:Is;if(F.call(M,T))return W(S.get(T));if(F.call(M,n))return W(S.get(n));S!==M&&S.get(T)},get size(){const T=this.__v_raw;return!a&&As(tn(T),"iterate",zu),Reflect.get(T,"size",T)},has(T){const S=this.__v_raw,M=tn(S),n=tn(T);return a||(gc(T,n)&&As(M,"has",T),As(M,"has",n)),T===n?S.has(T):S.has(T)||S.has(n)},forEach(T,S){const M=this,n=M.__v_raw,F=tn(n),W=c?ex:a?tx:Is;return!a&&As(F,"iterate",zu),n.forEach((N,Y)=>T.call(S,W(N),W(Y),M))}};return ds(m,a?{add:wg("add"),set:wg("set"),delete:wg("delete"),clear:wg("clear")}:{add(T){!c&&!Ao(T)&&!vc(T)&&(T=tn(T));const S=tn(this);return bg(S).has.call(S,T)||(S.add(T),al(S,"add",T,T)),this},set(T,S){!c&&!Ao(S)&&!vc(S)&&(S=tn(S));const M=tn(this),{has:n,get:F}=bg(M);let W=n.call(M,T);W||(T=tn(T),W=n.call(M,T));const N=F.call(M,T);return M.set(T,S),W?gc(S,N)&&al(M,"set",T,S):al(M,"add",T,S),this},delete(T){const S=tn(this),{has:M,get:n}=bg(S);let F=M.call(S,T);F||(T=tn(T),F=M.call(S,T)),n&&n.call(S,T);const W=S.delete(T);return F&&al(S,"delete",T,void 0),W},clear(){const T=tn(this),S=T.size!==0,M=T.clear();return S&&al(T,"clear",void 0,void 0),M}}),["keys","values","entries",Symbol.iterator].forEach(T=>{m[T]=kR(T,a,c)}),m}function Gx(a,c){const m=LR(a,c);return(y,T,S)=>T==="__v_isReactive"?!a:T==="__v_isReadonly"?a:T==="__v_raw"?y:Reflect.get(sn(m,T)&&T in y?m:y,T,S)}const zR={get:Gx(!1,!1)},OR={get:Gx(!1,!0)},FR={get:Gx(!0,!1)};const C2=new WeakMap,P2=new WeakMap,M2=new WeakMap,BR=new WeakMap;function NR(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function UR(a){return a.__v_skip||!Object.isExtensible(a)?0:NR(lR(a))}function Tc(a){return vc(a)?a:Hx(a,!1,MR,zR,C2)}function cl(a){return Hx(a,!1,DR,OR,P2)}function R2(a){return Hx(a,!0,RR,FR,M2)}function Hx(a,c,m,y,T){if(!cn(a)||a.__v_raw&&!(c&&a.__v_isReactive))return a;const S=T.get(a);if(S)return S;const M=UR(a);if(M===0)return a;const n=new Proxy(a,M===2?y:m);return T.set(a,n),n}function Ou(a){return vc(a)?Ou(a.__v_raw):!!(a&&a.__v_isReactive)}function vc(a){return!!(a&&a.__v_isReadonly)}function Ao(a){return!!(a&&a.__v_isShallow)}function qx(a){return a?!!a.__v_raw:!1}function tn(a){const c=a&&a.__v_raw;return c?tn(c):a}function VR(a){return!sn(a,"__v_skip")&&Object.isExtensible(a)&&u2(a,"__v_skip",!0),a}const Is=a=>cn(a)?Tc(a):a,tx=a=>cn(a)?R2(a):a;function Hn(a){return a?a.__v_isRef===!0:!1}function Aa(a){return D2(a,!1)}function sm(a){return D2(a,!0)}function D2(a,c){return Hn(a)?a:new jR(a,c)}class jR{constructor(c,m){this.dep=new $x,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=m?c:tn(c),this._value=m?c:Is(c),this.__v_isShallow=m}get value(){return this.dep.track(),this._value}set value(c){const m=this._rawValue,y=this.__v_isShallow||Ao(c)||vc(c);c=y?c:tn(c),gc(c,m)&&(this._rawValue=c,this._value=y?c:Is(c),this.dep.trigger())}}function wn(a){return Hn(a)?a.value:a}function $R(a){return er(a)?a():wn(a)}const GR={get:(a,c,m)=>c==="__v_raw"?a:wn(Reflect.get(a,c,m)),set:(a,c,m,y)=>{const T=a[c];return Hn(T)&&!Hn(m)?(T.value=m,!0):Reflect.set(a,c,m,y)}};function k2(a){return Ou(a)?a:new Proxy(a,GR)}class HR{constructor(c,m,y){this._object=c,this._key=m,this._defaultValue=y,this.__v_isRef=!0,this._value=void 0}get value(){const c=this._object[this._key];return this._value=c===void 0?this._defaultValue:c}set value(c){this._object[this._key]=c}get dep(){return SR(tn(this._object),this._key)}}class qR{constructor(c){this._getter=c,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function L2(a,c,m){return Hn(a)?a:er(a)?new qR(a):cn(a)&&arguments.length>1?WR(a,c,m):Aa(a)}function WR(a,c,m){const y=a[c];return Hn(y)?y:new HR(a,c,m)}class ZR{constructor(c,m,y){this.fn=c,this.setter=m,this._value=void 0,this.dep=new $x(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=rm-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!m,this.isSSR=y}notify(){if(this.flags|=16,!(this.flags&8)&&yn!==this)return v2(this,!0),!0}get value(){const c=this.dep.track();return w2(this),c&&(c.version=this.dep.version),this._value}set value(c){this.setter&&this.setter(c)}}function XR(a,c,m=!1){let y,T;return er(a)?y=a:(y=a.get,T=a.set),new ZR(y,T,m)}const Tg={},Hg=new WeakMap;let Ru;function KR(a,c=!1,m=Ru){if(m){let y=Hg.get(m);y||Hg.set(m,y=[]),y.push(a)}}function YR(a,c,m=dn){const{immediate:y,deep:T,once:S,scheduler:M,augmentJob:n,call:F}=m,W=ke=>T?ke:Ao(ke)||T===!1||T===0?ll(ke,1):ll(ke);let N,Y,le,de,Te=!1,pe=!1;if(Hn(a)?(Y=()=>a.value,Te=Ao(a)):Ou(a)?(Y=()=>W(a),Te=!0):qi(a)?(pe=!0,Te=a.some(ke=>Ou(ke)||Ao(ke)),Y=()=>a.map(ke=>{if(Hn(ke))return ke.value;if(Ou(ke))return W(ke);if(er(ke))return F?F(ke,2):ke()})):er(a)?c?Y=F?()=>F(a,2):a:Y=()=>{if(le){bc();try{le()}finally{wc()}}const ke=Ru;Ru=N;try{return F?F(a,3,[de]):a(de)}finally{Ru=ke}}:Y=Ea,c&&T){const ke=Y,Ke=T===!0?1/0:T;Y=()=>ll(ke(),Ke)}const qe=_2(),$e=()=>{N.stop(),qe&&qe.active&&Bx(qe.effects,N)};if(S&&c){const ke=c;c=(...Ke)=>{ke(...Ke),$e()}}let ze=pe?new Array(a.length).fill(Tg):Tg;const be=ke=>{if(!(!(N.flags&1)||!N.dirty&&!ke))if(c){const Ke=N.run();if(T||Te||(pe?Ke.some((St,kt)=>gc(St,ze[kt])):gc(Ke,ze))){le&&le();const St=Ru;Ru=N;try{const kt=[Ke,ze===Tg?void 0:pe&&ze[0]===Tg?[]:ze,de];F?F(c,3,kt):c(...kt),ze=Ke}finally{Ru=St}}}else N.run()};return n&&n(be),N=new g2(Y),N.scheduler=M?()=>M(be,!1):be,de=ke=>KR(ke,!1,N),le=N.onStop=()=>{const ke=Hg.get(N);if(ke){if(F)F(ke,4);else for(const Ke of ke)Ke();Hg.delete(N)}},c?y?be(!0):ze=N.run():M?M(be.bind(null,!0),!0):N.run(),$e.pause=N.pause.bind(N),$e.resume=N.resume.bind(N),$e.stop=$e,$e}function ll(a,c=1/0,m){if(c<=0||!cn(a)||a.__v_skip||(m=m||new Set,m.has(a)))return a;if(m.add(a),c--,Hn(a))ll(a.value,c,m);else if(qi(a))for(let y=0;y<a.length;y++)ll(a[y],c,m);else if(ly(a)||Ed(a))a.forEach(y=>{ll(y,c,m)});else if(c2(a)){for(const y in a)ll(a[y],c,m);for(const y of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,y)&&ll(a[y],c,m)}return a}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function _m(a,c,m,y){try{return y?a(...y):a()}catch(T){Vd(T,c,m)}}function Xo(a,c,m,y){if(er(a)){const T=_m(a,c,m,y);return T&&a2(T)&&T.catch(S=>{Vd(S,c,m)}),T}if(qi(a)){const T=[];for(let S=0;S<a.length;S++)T.push(Xo(a[S],c,m,y));return T}}function Vd(a,c,m,y=!0){const T=c?c.vnode:null,{errorHandler:S,throwUnhandledErrorInProduction:M}=c&&c.appContext.config||dn;if(c){let n=c.parent;const F=c.proxy,W=`https://vuejs.org/error-reference/#runtime-${m}`;for(;n;){const N=n.ec;if(N){for(let Y=0;Y<N.length;Y++)if(N[Y](a,F,W)===!1)return}n=n.parent}if(S){bc(),_m(S,null,10,[a,F,W]),wc();return}}JR(a,m,T,y,M)}function JR(a,c,m,y=!0,T=!1){if(T)throw a;console.error(a)}const Os=[];let wa=-1;const Cd=[];let lc=null,xd=0;const z2=Promise.resolve();let qg=null;function ju(a){const c=qg||z2;return a?c.then(this?a.bind(this):a):c}function QR(a){let c=wa+1,m=Os.length;for(;c<m;){const y=c+m>>>1,T=Os[y],S=om(T);S<a||S===a&&T.flags&2?c=y+1:m=y}return c}function Wx(a){if(!(a.flags&1)){const c=om(a),m=Os[Os.length-1];!m||!(a.flags&2)&&c>=om(m)?Os.push(a):Os.splice(QR(c),0,a),a.flags|=1,O2()}}function O2(){qg||(qg=z2.then(F2))}function ix(a){qi(a)?Cd.push(...a):lc&&a.id===-1?lc.splice(xd+1,0,a):a.flags&1||(Cd.push(a),a.flags|=1),O2()}function dS(a,c,m=wa+1){for(;m<Os.length;m++){const y=Os[m];if(y&&y.flags&2){if(a&&y.id!==a.uid)continue;Os.splice(m,1),m--,y.flags&4&&(y.flags&=-2),y(),y.flags&4||(y.flags&=-2)}}}function Wg(a){if(Cd.length){const c=[...new Set(Cd)].sort((m,y)=>om(m)-om(y));if(Cd.length=0,lc){lc.push(...c);return}for(lc=c,xd=0;xd<lc.length;xd++){const m=lc[xd];m.flags&4&&(m.flags&=-2),m.flags&8||m(),m.flags&=-2}lc=null,xd=0}}const om=a=>a.id==null?a.flags&2?-1:1/0:a.id;function F2(a){try{for(wa=0;wa<Os.length;wa++){const c=Os[wa];c&&!(c.flags&8)&&(c.flags&4&&(c.flags&=-2),_m(c,c.i,c.i?15:14),c.flags&4||(c.flags&=-2))}}finally{for(;wa<Os.length;wa++){const c=Os[wa];c&&(c.flags&=-2)}wa=-1,Os.length=0,Wg(),qg=null,(Os.length||Cd.length)&&F2()}}let Qn=null,B2=null;function Zg(a){const c=Qn;return Qn=a,B2=a&&a.type.__scopeId||null,c}function Zx(a,c=Qn,m){if(!c||a._n)return a;const y=(...T)=>{y._d&&SS(-1);const S=Zg(c);let M;try{M=a(...T)}finally{Zg(S),y._d&&SS(1)}return M};return y._n=!0,y._c=!0,y._d=!0,y}function AN(a,c){if(Qn===null)return a;const m=vy(Qn),y=a.dirs||(a.dirs=[]);for(let T=0;T<c.length;T++){let[S,M,n,F=dn]=c[T];S&&(er(S)&&(S={mounted:S,updated:S}),S.deep&&ll(M),y.push({dir:S,instance:m,value:M,oldValue:void 0,arg:n,modifiers:F}))}return a}function Ta(a,c,m,y){const T=a.dirs,S=c&&c.dirs;for(let M=0;M<T.length;M++){const n=T[M];S&&(n.oldValue=S[M].value);let F=n.dir[y];F&&(bc(),Xo(F,m,8,[a.el,n,a,c]),wc())}}const eD=Symbol("_vte"),N2=a=>a.__isTeleport,cc=Symbol("_leaveCb"),Sg=Symbol("_enterCb");function tD(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Kx(()=>{a.isMounted=!0}),ym(()=>{a.isUnmounting=!0}),a}const wo=[Function,Array],U2={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:wo,onEnter:wo,onAfterEnter:wo,onEnterCancelled:wo,onBeforeLeave:wo,onLeave:wo,onAfterLeave:wo,onLeaveCancelled:wo,onBeforeAppear:wo,onAppear:wo,onAfterAppear:wo,onAppearCancelled:wo},V2=a=>{const c=a.subTree;return c.component?V2(c.component):c},iD={name:"BaseTransition",props:U2,setup(a,{slots:c}){const m=yy(),y=tD();return()=>{const T=c.default&&G2(c.default(),!0);if(!T||!T.length)return;const S=j2(T),M=tn(a),{mode:n}=M;if(y.isLeaving)return C0(S);const F=fS(S);if(!F)return C0(S);let W=rx(F,M,y,m,Y=>W=Y);F.type!==Yn&&kd(F,W);let N=m.subTree&&fS(m.subTree);if(N&&N.type!==Yn&&!qo(F,N)&&V2(m).type!==Yn){let Y=rx(N,M,y,m);if(kd(N,Y),n==="out-in"&&F.type!==Yn)return y.isLeaving=!0,Y.afterLeave=()=>{y.isLeaving=!1,m.job.flags&8||m.update(),delete Y.afterLeave,N=void 0},C0(S);n==="in-out"&&F.type!==Yn?Y.delayLeave=(le,de,Te)=>{const pe=$2(y,N);pe[String(N.key)]=N,le[cc]=()=>{de(),le[cc]=void 0,delete W.delayedLeave,N=void 0},W.delayedLeave=()=>{Te(),delete W.delayedLeave,N=void 0}}:N=void 0}else N&&(N=void 0);return S}}};function j2(a){let c=a[0];if(a.length>1){for(const m of a)if(m.type!==Yn){c=m;break}}return c}const rD=iD;function $2(a,c){const{leavingVNodes:m}=a;let y=m.get(c.type);return y||(y=Object.create(null),m.set(c.type,y)),y}function rx(a,c,m,y,T){const{appear:S,mode:M,persisted:n=!1,onBeforeEnter:F,onEnter:W,onAfterEnter:N,onEnterCancelled:Y,onBeforeLeave:le,onLeave:de,onAfterLeave:Te,onLeaveCancelled:pe,onBeforeAppear:qe,onAppear:$e,onAfterAppear:ze,onAppearCancelled:be}=c,ke=String(a.key),Ke=$2(m,a),St=(Wt,Zt)=>{Wt&&Xo(Wt,y,9,Zt)},kt=(Wt,Zt)=>{const ni=Zt[1];St(Wt,Zt),qi(Wt)?Wt.every(qt=>qt.length<=1)&&ni():Wt.length<=1&&ni()},hi={mode:M,persisted:n,beforeEnter(Wt){let Zt=F;if(!m.isMounted)if(S)Zt=qe||F;else return;Wt[cc]&&Wt[cc](!0);const ni=Ke[ke];ni&&qo(a,ni)&&ni.el[cc]&&ni.el[cc](),St(Zt,[Wt])},enter(Wt){let Zt=W,ni=N,qt=Y;if(!m.isMounted)if(S)Zt=$e||W,ni=ze||N,qt=be||Y;else return;let di=!1;const vi=Wt[Sg]=Ni=>{di||(di=!0,Ni?St(qt,[Wt]):St(ni,[Wt]),hi.delayedLeave&&hi.delayedLeave(),Wt[Sg]=void 0)};Zt?kt(Zt,[Wt,vi]):vi()},leave(Wt,Zt){const ni=String(a.key);if(Wt[Sg]&&Wt[Sg](!0),m.isUnmounting)return Zt();St(le,[Wt]);let qt=!1;const di=Wt[cc]=vi=>{qt||(qt=!0,Zt(),vi?St(pe,[Wt]):St(Te,[Wt]),Wt[cc]=void 0,Ke[ni]===a&&delete Ke[ni])};Ke[ni]=a,de?kt(de,[Wt,di]):di()},clone(Wt){const Zt=rx(Wt,c,m,y,T);return T&&T(Zt),Zt}};return hi}function C0(a){if(gm(a))return a=hl(a),a.children=null,a}function fS(a){if(!gm(a))return N2(a.type)&&a.children?j2(a.children):a;const{shapeFlag:c,children:m}=a;if(m){if(c&16)return m[0];if(c&32&&er(m.default))return m.default()}}function kd(a,c){a.shapeFlag&6&&a.component?(a.transition=c,kd(a.component.subTree,c)):a.shapeFlag&128?(a.ssContent.transition=c.clone(a.ssContent),a.ssFallback.transition=c.clone(a.ssFallback)):a.transition=c}function G2(a,c=!1,m){let y=[],T=0;for(let S=0;S<a.length;S++){let M=a[S];const n=m==null?M.key:String(m)+String(M.key!=null?M.key:S);M.type===Cs?(M.patchFlag&128&&T++,y=y.concat(G2(M.children,c,n))):(c||M.type!==Yn)&&y.push(n!=null?hl(M,{key:n}):M)}if(T>1)for(let S=0;S<y.length;S++)y[S].patchFlag=-2;return y}/*! #__NO_SIDE_EFFECTS__ */function Sc(a,c){return er(a)?ds({name:a.name},c,{setup:a}):a}function Xx(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function am(a,c,m,y,T=!1){if(qi(a)){a.forEach((Te,pe)=>am(Te,c&&(qi(c)?c[pe]:c),m,y,T));return}if(yc(y)&&!T){y.shapeFlag&512&&y.type.__asyncResolved&&y.component.subTree.component&&am(a,c,m,y.component.subTree);return}const S=y.shapeFlag&4?vy(y.component):y.el,M=T?null:S,{i:n,r:F}=a,W=c&&c.r,N=n.refs===dn?n.refs={}:n.refs,Y=n.setupState,le=tn(Y),de=Y===dn?()=>!1:Te=>sn(le,Te);if(W!=null&&W!==F&&(An(W)?(N[W]=null,de(W)&&(Y[W]=null)):Hn(W)&&(W.value=null)),er(F))_m(F,n,12,[M,N]);else{const Te=An(F),pe=Hn(F);if(Te||pe){const qe=()=>{if(a.f){const $e=Te?de(F)?Y[F]:N[F]:F.value;T?qi($e)&&Bx($e,S):qi($e)?$e.includes(S)||$e.push(S):Te?(N[F]=[S],de(F)&&(Y[F]=N[F])):(F.value=[S],a.k&&(N[a.k]=F.value))}else Te?(N[F]=M,de(F)&&(Y[F]=M)):pe&&(F.value=M,a.k&&(N[a.k]=M))};M?(qe.id=-1,gs(qe,m)):qe()}}}let pS=!1;const hd=()=>{pS||(console.error("Hydration completed but contains mismatches."),pS=!0)},nD=a=>a.namespaceURI.includes("svg")&&a.tagName!=="foreignObject",sD=a=>a.namespaceURI.includes("MathML"),Eg=a=>{if(a.nodeType===1){if(nD(a))return"svg";if(sD(a))return"mathml"}},Td=a=>a.nodeType===8;function oD(a){const{mt:c,p:m,o:{patchProp:y,createText:T,nextSibling:S,parentNode:M,remove:n,insert:F,createComment:W}}=a,N=(be,ke)=>{if(!ke.hasChildNodes()){m(null,be,ke),Wg(),ke._vnode=be;return}Y(ke.firstChild,be,null,null,null),Wg(),ke._vnode=be},Y=(be,ke,Ke,St,kt,hi=!1)=>{hi=hi||!!ke.dynamicChildren;const Wt=Td(be)&&be.data==="[",Zt=()=>pe(be,ke,Ke,St,kt,Wt),{type:ni,ref:qt,shapeFlag:di,patchFlag:vi}=ke;let Ni=be.nodeType;ke.el=be,vi===-2&&(hi=!1,ke.dynamicChildren=null);let si=null;switch(ni){case Nu:Ni!==3?ke.children===""?(F(ke.el=T(""),M(be),be),si=be):si=Zt():(be.data!==ke.children&&(hd(),be.data=ke.children),si=S(be));break;case Yn:ze(be)?(si=S(be),$e(ke.el=be.content.firstChild,be,Ke)):Ni!==8||Wt?si=Zt():si=S(be);break;case Wp:if(Wt&&(be=S(be),Ni=be.nodeType),Ni===1||Ni===3){si=be;const Ui=!ke.children.length;for(let mi=0;mi<ke.staticCount;mi++)Ui&&(ke.children+=si.nodeType===1?si.outerHTML:si.data),mi===ke.staticCount-1&&(ke.anchor=si),si=S(si);return Wt?S(si):si}else Zt();break;case Cs:Wt?si=Te(be,ke,Ke,St,kt,hi):si=Zt();break;default:if(di&1)(Ni!==1||ke.type.toLowerCase()!==be.tagName.toLowerCase())&&!ze(be)?si=Zt():si=le(be,ke,Ke,St,kt,hi);else if(di&6){ke.slotScopeIds=kt;const Ui=M(be);if(Wt?si=qe(be):Td(be)&&be.data==="teleport start"?si=qe(be,be.data,"teleport end"):si=S(be),c(ke,Ui,null,Ke,St,Eg(Ui),hi),yc(ke)&&!ke.type.__asyncResolved){let mi;Wt?(mi=kn(Cs),mi.anchor=si?si.previousSibling:Ui.lastChild):mi=be.nodeType===3?AA(""):kn("div"),mi.el=be,ke.component.subTree=mi}}else di&64?Ni!==8?si=Zt():si=ke.type.hydrate(be,ke,Ke,St,kt,hi,a,de):di&128&&(si=ke.type.hydrate(be,ke,Ke,St,Eg(M(be)),kt,hi,a,Y))}return qt!=null&&am(qt,null,St,ke),si},le=(be,ke,Ke,St,kt,hi)=>{hi=hi||!!ke.dynamicChildren;const{type:Wt,props:Zt,patchFlag:ni,shapeFlag:qt,dirs:di,transition:vi}=ke,Ni=Wt==="input"||Wt==="option";if(Ni||ni!==-1){di&&Ta(ke,null,Ke,"created");let si=!1;if(ze(be)){si=pA(null,vi)&&Ke&&Ke.vnode.props&&Ke.vnode.props.appear;const mi=be.content.firstChild;si&&vi.beforeEnter(mi),$e(mi,be,Ke),ke.el=be=mi}if(qt&16&&!(Zt&&(Zt.innerHTML||Zt.textContent))){let mi=de(be.firstChild,ke,be,Ke,St,kt,hi);for(;mi;){Ag(be,1)||hd();const Yr=mi;mi=mi.nextSibling,n(Yr)}}else if(qt&8){let mi=ke.children;mi[0]===`
`&&(be.tagName==="PRE"||be.tagName==="TEXTAREA")&&(mi=mi.slice(1)),be.textContent!==mi&&(Ag(be,0)||hd(),be.textContent=ke.children)}if(Zt){if(Ni||!hi||ni&48){const mi=be.tagName.includes("-");for(const Yr in Zt)(Ni&&(Yr.endsWith("value")||Yr==="indeterminate")||mm(Yr)&&!Ad(Yr)||Yr[0]==="."||mi)&&y(be,Yr,null,Zt[Yr],void 0,Ke)}else if(Zt.onClick)y(be,"onClick",null,Zt.onClick,void 0,Ke);else if(ni&4&&Ou(Zt.style))for(const mi in Zt.style)Zt.style[mi]}let Ui;(Ui=Zt&&Zt.onVnodeBeforeMount)&&Zs(Ui,Ke,ke),di&&Ta(ke,null,Ke,"beforeMount"),((Ui=Zt&&Zt.onVnodeMounted)||di||si)&&xA(()=>{Ui&&Zs(Ui,Ke,ke),si&&vi.enter(be),di&&Ta(ke,null,Ke,"mounted")},St)}return be.nextSibling},de=(be,ke,Ke,St,kt,hi,Wt)=>{Wt=Wt||!!ke.dynamicChildren;const Zt=ke.children,ni=Zt.length;for(let qt=0;qt<ni;qt++){const di=Wt?Zt[qt]:Zt[qt]=uo(Zt[qt]),vi=di.type===Nu;be?(vi&&!Wt&&qt+1<ni&&uo(Zt[qt+1]).type===Nu&&(F(T(be.data.slice(di.children.length)),Ke,S(be)),be.data=di.children),be=Y(be,di,St,kt,hi,Wt)):vi&&!di.children?F(di.el=T(""),Ke):(Ag(Ke,1)||hd(),m(null,di,Ke,null,St,kt,Eg(Ke),hi))}return be},Te=(be,ke,Ke,St,kt,hi)=>{const{slotScopeIds:Wt}=ke;Wt&&(kt=kt?kt.concat(Wt):Wt);const Zt=M(be),ni=de(S(be),ke,Zt,Ke,St,kt,hi);return ni&&Td(ni)&&ni.data==="]"?S(ke.anchor=ni):(hd(),F(ke.anchor=W("]"),Zt,ni),ni)},pe=(be,ke,Ke,St,kt,hi)=>{if(Ag(be.parentElement,1)||hd(),ke.el=null,hi){const ni=qe(be);for(;;){const qt=S(be);if(qt&&qt!==ni)n(qt);else break}}const Wt=S(be),Zt=M(be);return n(be),m(null,ke,Zt,Wt,Ke,St,Eg(Zt),kt),Ke&&(Ke.vnode.el=ke.el,gy(Ke,ke.el)),Wt},qe=(be,ke="[",Ke="]")=>{let St=0;for(;be;)if(be=S(be),be&&Td(be)&&(be.data===ke&&St++,be.data===Ke)){if(St===0)return S(be);St--}return be},$e=(be,ke,Ke)=>{const St=ke.parentNode;St&&St.replaceChild(be,ke);let kt=Ke;for(;kt;)kt.vnode.el===ke&&(kt.vnode.el=kt.subTree.el=be),kt=kt.parent},ze=be=>be.nodeType===1&&be.tagName==="TEMPLATE";return[N,Y]}const mS="data-allow-mismatch",aD={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function Ag(a,c){if(c===0||c===1)for(;a&&!a.hasAttribute(mS);)a=a.parentElement;const m=a&&a.getAttribute(mS);if(m==null)return!1;if(m==="")return!0;{const y=m.split(",");return c===0&&y.includes("children")?!0:m.split(",").includes(aD[c])}}hy().requestIdleCallback;hy().cancelIdleCallback;function lD(a,c){if(Td(a)&&a.data==="["){let m=1,y=a.nextSibling;for(;y;){if(y.nodeType===1){if(c(y)===!1)break}else if(Td(y))if(y.data==="]"){if(--m===0)break}else y.data==="["&&m++;y=y.nextSibling}}else c(a)}const yc=a=>!!a.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function nx(a){er(a)&&(a={loader:a});const{loader:c,loadingComponent:m,errorComponent:y,delay:T=200,hydrate:S,timeout:M,suspensible:n=!0,onError:F}=a;let W=null,N,Y=0;const le=()=>(Y++,W=null,de()),de=()=>{let Te;return W||(Te=W=c().catch(pe=>{if(pe=pe instanceof Error?pe:new Error(String(pe)),F)return new Promise((qe,$e)=>{F(pe,()=>qe(le()),()=>$e(pe),Y+1)});throw pe}).then(pe=>Te!==W&&W?W:(pe&&(pe.__esModule||pe[Symbol.toStringTag]==="Module")&&(pe=pe.default),N=pe,pe)))};return Sc({name:"AsyncComponentWrapper",__asyncLoader:de,__asyncHydrate(Te,pe,qe){const $e=S?()=>{const ze=S(qe,be=>lD(Te,be));ze&&(pe.bum||(pe.bum=[])).push(ze)}:qe;N?$e():de().then(()=>!pe.isUnmounted&&$e())},get __asyncResolved(){return N},setup(){const Te=Jn;if(Xx(Te),N)return()=>P0(N,Te);const pe=be=>{W=null,Vd(be,Te,13,!y)};if(n&&Te.suspense||zd)return de().then(be=>()=>P0(be,Te)).catch(be=>(pe(be),()=>y?kn(y,{error:be}):null));const qe=Aa(!1),$e=Aa(),ze=Aa(!!T);return T&&setTimeout(()=>{ze.value=!1},T),M!=null&&setTimeout(()=>{if(!qe.value&&!$e.value){const be=new Error(`Async component timed out after ${M}ms.`);pe(be),$e.value=be}},M),de().then(()=>{qe.value=!0,Te.parent&&gm(Te.parent.vnode)&&Te.parent.update()}).catch(be=>{pe(be),$e.value=be}),()=>{if(qe.value&&N)return P0(N,Te);if($e.value&&y)return kn(y,{error:$e.value});if(m&&!ze.value)return kn(m)}}})}function P0(a,c){const{ref:m,props:y,children:T,ce:S}=c.vnode,M=kn(a,y,T);return M.ref=m,M.ce=S,delete c.vnode.ce,M}const gm=a=>a.type.__isKeepAlive,cD={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(a,{slots:c}){const m=yy(),y=m.ctx;if(!y.renderer)return()=>{const ze=c.default&&c.default();return ze&&ze.length===1?ze[0]:ze};const T=new Map,S=new Set;let M=null;const n=m.suspense,{renderer:{p:F,m:W,um:N,o:{createElement:Y}}}=y,le=Y("div");y.activate=(ze,be,ke,Ke,St)=>{const kt=ze.component;W(ze,be,ke,0,n),F(kt.vnode,ze,be,ke,kt,n,Ke,ze.slotScopeIds,St),gs(()=>{kt.isDeactivated=!1,kt.a&&Id(kt.a);const hi=ze.props&&ze.props.onVnodeMounted;hi&&Zs(hi,kt.parent,ze)},n)},y.deactivate=ze=>{const be=ze.component;Kg(be.m),Kg(be.a),W(ze,le,null,1,n),gs(()=>{be.da&&Id(be.da);const ke=ze.props&&ze.props.onVnodeUnmounted;ke&&Zs(ke,be.parent,ze),be.isDeactivated=!0},n)};function de(ze){M0(ze),N(ze,m,n,!0)}function Te(ze){T.forEach((be,ke)=>{const Ke=dx(be.type);Ke&&!ze(Ke)&&pe(ke)})}function pe(ze){const be=T.get(ze);be&&(!M||!qo(be,M))?de(be):M&&M0(M),T.delete(ze),S.delete(ze)}Pd(()=>[a.include,a.exclude],([ze,be])=>{ze&&Te(ke=>Vp(ze,ke)),be&&Te(ke=>!Vp(be,ke))},{flush:"post",deep:!0});let qe=null;const $e=()=>{qe!=null&&(Yg(m.subTree.type)?gs(()=>{T.set(qe,Ig(m.subTree))},m.subTree.suspense):T.set(qe,Ig(m.subTree)))};return Kx($e),Z2($e),ym(()=>{T.forEach(ze=>{const{subTree:be,suspense:ke}=m,Ke=Ig(be);if(ze.type===Ke.type&&ze.key===Ke.key){M0(Ke);const St=Ke.component.da;St&&gs(St,ke);return}de(ze)})}),()=>{if(qe=null,!c.default)return M=null;const ze=c.default(),be=ze[0];if(ze.length>1)return M=null,ze;if(!$u(be)||!(be.shapeFlag&4)&&!(be.shapeFlag&128))return M=null,be;let ke=Ig(be);if(ke.type===Yn)return M=null,ke;const Ke=ke.type,St=dx(yc(ke)?ke.type.__asyncResolved||{}:Ke),{include:kt,exclude:hi,max:Wt}=a;if(kt&&(!St||!Vp(kt,St))||hi&&St&&Vp(hi,St))return ke.shapeFlag&=-257,M=ke,be;const Zt=ke.key==null?Ke:ke.key,ni=T.get(Zt);return ke.el&&(ke=hl(ke),be.shapeFlag&128&&(be.ssContent=ke)),qe=Zt,ni?(ke.el=ni.el,ke.component=ni.component,ke.transition&&kd(ke,ke.transition),ke.shapeFlag|=512,S.delete(Zt),S.add(Zt)):(S.add(Zt),Wt&&S.size>parseInt(Wt,10)&&pe(S.values().next().value)),ke.shapeFlag|=256,M=ke,Yg(be.type)?be:ke}}},uD=cD;function Vp(a,c){return qi(a)?a.some(m=>Vp(m,c)):An(a)?a.split(",").includes(c):aR(a)?(a.lastIndex=0,a.test(c)):!1}function H2(a,c){W2(a,"a",c)}function q2(a,c){W2(a,"da",c)}function W2(a,c,m=Jn){const y=a.__wdc||(a.__wdc=()=>{let T=m;for(;T;){if(T.isDeactivated)return;T=T.parent}return a()});if(my(c,y,m),m){let T=m.parent;for(;T&&T.parent;)gm(T.parent.vnode)&&hD(y,c,m,T),T=T.parent}}function hD(a,c,m,y){const T=my(c,a,y,!0);X2(()=>{Bx(y[c],T)},m)}function M0(a){a.shapeFlag&=-257,a.shapeFlag&=-513}function Ig(a){return a.shapeFlag&128?a.ssContent:a}function my(a,c,m=Jn,y=!1){if(m){const T=m[a]||(m[a]=[]),S=c.__weh||(c.__weh=(...M)=>{bc();const n=vm(m),F=Xo(c,m,a,M);return n(),wc(),F});return y?T.unshift(S):T.push(S),S}}const dl=a=>(c,m=Jn)=>{(!zd||a==="sp")&&my(a,(...y)=>c(...y),m)},dD=dl("bm"),Kx=dl("m"),fD=dl("bu"),Z2=dl("u"),ym=dl("bum"),X2=dl("um"),pD=dl("sp"),mD=dl("rtg"),_D=dl("rtc");function K2(a,c=Jn){my("ec",a,c)}const Y2="components";function IN(a,c){return Q2(Y2,a,!0,c)||a}const J2=Symbol.for("v-ndc");function gD(a){return An(a)?Q2(Y2,a,!1)||a:a||J2}function Q2(a,c,m=!0,y=!1){const T=Qn||Jn;if(T){const S=T.type;{const n=dx(S,!1);if(n&&(n===c||n===Io(c)||n===uy(Io(c))))return S}const M=_S(T[a]||S[a],c)||_S(T.appContext[a],c);return!M&&y?S:M}}function _S(a,c){return a&&(a[c]||a[Io(c)]||a[uy(Io(c))])}function CN(a,c,m,y){let T;const S=m,M=qi(a);if(M||An(a)){const n=M&&Ou(a);let F=!1;n&&(F=!Ao(a),a=py(a)),T=new Array(a.length);for(let W=0,N=a.length;W<N;W++)T[W]=c(F?Is(a[W]):a[W],W,void 0,S)}else if(typeof a=="number"){T=new Array(a);for(let n=0;n<a;n++)T[n]=c(n+1,n,void 0,S)}else if(cn(a))if(a[Symbol.iterator])T=Array.from(a,(n,F)=>c(n,F,void 0,S));else{const n=Object.keys(a);T=new Array(n.length);for(let F=0,W=n.length;F<W;F++){const N=n[F];T[F]=c(a[N],N,F,S)}}else T=[];return T}function PN(a,c,m={},y,T){if(Qn.ce||Qn.parent&&yc(Qn.parent)&&Qn.parent.ce)return So(),Sa(Cs,null,[kn("slot",m,y)],64);let S=a[c];S&&S._c&&(S._d=!1),So();const M=S&&eA(S(m)),n=m.key||M&&M.key,F=Sa(Cs,{key:(n&&!Zo(n)?n:`_${c}`)+""},M||[],M&&a._===1?64:-2);return F.scopeId&&(F.slotScopeIds=[F.scopeId+"-s"]),S&&S._c&&(S._d=!0),F}function eA(a){return a.some(c=>$u(c)?!(c.type===Yn||c.type===Cs&&!eA(c.children)):!0)?a:null}const sx=a=>a?CA(a)?vy(a):sx(a.parent):null,qp=ds(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>sx(a.parent),$root:a=>sx(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>iA(a),$forceUpdate:a=>a.f||(a.f=()=>{Wx(a.update)}),$nextTick:a=>a.n||(a.n=ju.bind(a.proxy)),$watch:a=>BD.bind(a)}),R0=(a,c)=>a!==dn&&!a.__isScriptSetup&&sn(a,c),yD={get({_:a},c){if(c==="__v_skip")return!0;const{ctx:m,setupState:y,data:T,props:S,accessCache:M,type:n,appContext:F}=a;let W;if(c[0]!=="$"){const de=M[c];if(de!==void 0)switch(de){case 1:return y[c];case 2:return T[c];case 4:return m[c];case 3:return S[c]}else{if(R0(y,c))return M[c]=1,y[c];if(T!==dn&&sn(T,c))return M[c]=2,T[c];if((W=a.propsOptions[0])&&sn(W,c))return M[c]=3,S[c];if(m!==dn&&sn(m,c))return M[c]=4,m[c];ox&&(M[c]=0)}}const N=qp[c];let Y,le;if(N)return c==="$attrs"&&As(a.attrs,"get",""),N(a);if((Y=n.__cssModules)&&(Y=Y[c]))return Y;if(m!==dn&&sn(m,c))return M[c]=4,m[c];if(le=F.config.globalProperties,sn(le,c))return le[c]},set({_:a},c,m){const{data:y,setupState:T,ctx:S}=a;return R0(T,c)?(T[c]=m,!0):y!==dn&&sn(y,c)?(y[c]=m,!0):sn(a.props,c)||c[0]==="$"&&c.slice(1)in a?!1:(S[c]=m,!0)},has({_:{data:a,setupState:c,accessCache:m,ctx:y,appContext:T,propsOptions:S}},M){let n;return!!m[M]||a!==dn&&sn(a,M)||R0(c,M)||(n=S[0])&&sn(n,M)||sn(y,M)||sn(qp,M)||sn(T.config.globalProperties,M)},defineProperty(a,c,m){return m.get!=null?a._.accessCache[c]=0:sn(m,"value")&&this.set(a,c,m.value,null),Reflect.defineProperty(a,c,m)}};function gS(a){return qi(a)?a.reduce((c,m)=>(c[m]=null,c),{}):a}let ox=!0;function vD(a){const c=iA(a),m=a.proxy,y=a.ctx;ox=!1,c.beforeCreate&&yS(c.beforeCreate,a,"bc");const{data:T,computed:S,methods:M,watch:n,provide:F,inject:W,created:N,beforeMount:Y,mounted:le,beforeUpdate:de,updated:Te,activated:pe,deactivated:qe,beforeDestroy:$e,beforeUnmount:ze,destroyed:be,unmounted:ke,render:Ke,renderTracked:St,renderTriggered:kt,errorCaptured:hi,serverPrefetch:Wt,expose:Zt,inheritAttrs:ni,components:qt,directives:di,filters:vi}=c;if(W&&xD(W,y,null),M)for(const Ui in M){const mi=M[Ui];er(mi)&&(y[Ui]=mi.bind(m))}if(T){const Ui=T.call(m,m);cn(Ui)&&(a.data=Tc(Ui))}if(ox=!0,S)for(const Ui in S){const mi=S[Ui],Yr=er(mi)?mi.bind(m,m):er(mi.get)?mi.get.bind(m,m):Ea,Yi=!er(mi)&&er(mi.set)?mi.set.bind(m):Ea,vn=Eo({get:Yr,set:Yi});Object.defineProperty(y,Ui,{enumerable:!0,configurable:!0,get:()=>vn.value,set:In=>vn.value=In})}if(n)for(const Ui in n)tA(n[Ui],y,m,Ui);if(F){const Ui=er(F)?F.call(m):F;Reflect.ownKeys(Ui).forEach(mi=>{Bu(mi,Ui[mi])})}N&&yS(N,a,"c");function si(Ui,mi){qi(mi)?mi.forEach(Yr=>Ui(Yr.bind(m))):mi&&Ui(mi.bind(m))}if(si(dD,Y),si(Kx,le),si(fD,de),si(Z2,Te),si(H2,pe),si(q2,qe),si(K2,hi),si(_D,St),si(mD,kt),si(ym,ze),si(X2,ke),si(pD,Wt),qi(Zt))if(Zt.length){const Ui=a.exposed||(a.exposed={});Zt.forEach(mi=>{Object.defineProperty(Ui,mi,{get:()=>m[mi],set:Yr=>m[mi]=Yr})})}else a.exposed||(a.exposed={});Ke&&a.render===Ea&&(a.render=Ke),ni!=null&&(a.inheritAttrs=ni),qt&&(a.components=qt),di&&(a.directives=di),Wt&&Xx(a)}function xD(a,c,m=Ea){qi(a)&&(a=ax(a));for(const y in a){const T=a[y];let S;cn(T)?"default"in T?S=Ms(T.from||y,T.default,!0):S=Ms(T.from||y):S=Ms(T),Hn(S)?Object.defineProperty(c,y,{enumerable:!0,configurable:!0,get:()=>S.value,set:M=>S.value=M}):c[y]=S}}function yS(a,c,m){Xo(qi(a)?a.map(y=>y.bind(c.proxy)):a.bind(c.proxy),c,m)}function tA(a,c,m,y){let T=y.includes(".")?gA(m,y):()=>m[y];if(An(a)){const S=c[a];er(S)&&Pd(T,S)}else if(er(a))Pd(T,a.bind(m));else if(cn(a))if(qi(a))a.forEach(S=>tA(S,c,m,y));else{const S=er(a.handler)?a.handler.bind(m):c[a.handler];er(S)&&Pd(T,S,a)}}function iA(a){const c=a.type,{mixins:m,extends:y}=c,{mixins:T,optionsCache:S,config:{optionMergeStrategies:M}}=a.appContext,n=S.get(c);let F;return n?F=n:!T.length&&!m&&!y?F=c:(F={},T.length&&T.forEach(W=>Xg(F,W,M,!0)),Xg(F,c,M)),cn(c)&&S.set(c,F),F}function Xg(a,c,m,y=!1){const{mixins:T,extends:S}=c;S&&Xg(a,S,m,!0),T&&T.forEach(M=>Xg(a,M,m,!0));for(const M in c)if(!(y&&M==="expose")){const n=bD[M]||m&&m[M];a[M]=n?n(a[M],c[M]):c[M]}return a}const bD={data:vS,props:xS,emits:xS,methods:jp,computed:jp,beforeCreate:zs,created:zs,beforeMount:zs,mounted:zs,beforeUpdate:zs,updated:zs,beforeDestroy:zs,beforeUnmount:zs,destroyed:zs,unmounted:zs,activated:zs,deactivated:zs,errorCaptured:zs,serverPrefetch:zs,components:jp,directives:jp,watch:TD,provide:vS,inject:wD};function vS(a,c){return c?a?function(){return ds(er(a)?a.call(this,this):a,er(c)?c.call(this,this):c)}:c:a}function wD(a,c){return jp(ax(a),ax(c))}function ax(a){if(qi(a)){const c={};for(let m=0;m<a.length;m++)c[a[m]]=a[m];return c}return a}function zs(a,c){return a?[...new Set([].concat(a,c))]:c}function jp(a,c){return a?ds(Object.create(null),a,c):c}function xS(a,c){return a?qi(a)&&qi(c)?[...new Set([...a,...c])]:ds(Object.create(null),gS(a),gS(c??{})):c}function TD(a,c){if(!a)return c;if(!c)return a;const m=ds(Object.create(null),a);for(const y in c)m[y]=zs(a[y],c[y]);return m}function rA(){return{app:null,config:{isNativeTag:sR,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let SD=0;function ED(a,c){return function(y,T=null){er(y)||(y=ds({},y)),T!=null&&!cn(T)&&(T=null);const S=rA(),M=new WeakSet,n=[];let F=!1;const W=S.app={_uid:SD++,_component:y,_props:T,_container:null,_context:S,_instance:null,version:ak,get config(){return S.config},set config(N){},use(N,...Y){return M.has(N)||(N&&er(N.install)?(M.add(N),N.install(W,...Y)):er(N)&&(M.add(N),N(W,...Y))),W},mixin(N){return S.mixins.includes(N)||S.mixins.push(N),W},component(N,Y){return Y?(S.components[N]=Y,W):S.components[N]},directive(N,Y){return Y?(S.directives[N]=Y,W):S.directives[N]},mount(N,Y,le){if(!F){const de=W._ceVNode||kn(y,T);return de.appContext=S,le===!0?le="svg":le===!1&&(le=void 0),Y&&c?c(de,N):a(de,N,le),F=!0,W._container=N,N.__vue_app__=W,vy(de.component)}},onUnmount(N){n.push(N)},unmount(){F&&(Xo(n,W._instance,16),a(null,W._container),delete W._container.__vue_app__)},provide(N,Y){return S.provides[N]=Y,W},runWithContext(N){const Y=Fu;Fu=W;try{return N()}finally{Fu=Y}}};return W}}let Fu=null;function Bu(a,c){if(Jn){let m=Jn.provides;const y=Jn.parent&&Jn.parent.provides;y===m&&(m=Jn.provides=Object.create(y)),m[a]=c}}function Ms(a,c,m=!1){const y=Jn||Qn;if(y||Fu){const T=Fu?Fu._context.provides:y?y.parent==null?y.vnode.appContext&&y.vnode.appContext.provides:y.parent.provides:void 0;if(T&&a in T)return T[a];if(arguments.length>1)return m&&er(c)?c.call(y&&y.proxy):c}}function Yx(){return!!(Jn||Qn||Fu)}const nA={},sA=()=>Object.create(nA),oA=a=>Object.getPrototypeOf(a)===nA;function AD(a,c,m,y=!1){const T={},S=sA();a.propsDefaults=Object.create(null),aA(a,c,T,S);for(const M in a.propsOptions[0])M in T||(T[M]=void 0);m?a.props=y?T:cl(T):a.type.props?a.props=T:a.props=S,a.attrs=S}function ID(a,c,m,y){const{props:T,attrs:S,vnode:{patchFlag:M}}=a,n=tn(T),[F]=a.propsOptions;let W=!1;if((y||M>0)&&!(M&16)){if(M&8){const N=a.vnode.dynamicProps;for(let Y=0;Y<N.length;Y++){let le=N[Y];if(_y(a.emitsOptions,le))continue;const de=c[le];if(F)if(sn(S,le))de!==S[le]&&(S[le]=de,W=!0);else{const Te=Io(le);T[Te]=lx(F,n,Te,de,a,!1)}else de!==S[le]&&(S[le]=de,W=!0)}}}else{aA(a,c,T,S)&&(W=!0);let N;for(const Y in n)(!c||!sn(c,Y)&&((N=xc(Y))===Y||!sn(c,N)))&&(F?m&&(m[Y]!==void 0||m[N]!==void 0)&&(T[Y]=lx(F,n,Y,void 0,a,!0)):delete T[Y]);if(S!==n)for(const Y in S)(!c||!sn(c,Y))&&(delete S[Y],W=!0)}W&&al(a.attrs,"set","")}function aA(a,c,m,y){const[T,S]=a.propsOptions;let M=!1,n;if(c)for(let F in c){if(Ad(F))continue;const W=c[F];let N;T&&sn(T,N=Io(F))?!S||!S.includes(N)?m[N]=W:(n||(n={}))[N]=W:_y(a.emitsOptions,F)||(!(F in y)||W!==y[F])&&(y[F]=W,M=!0)}if(S){const F=tn(m),W=n||dn;for(let N=0;N<S.length;N++){const Y=S[N];m[Y]=lx(T,F,Y,W[Y],a,!sn(W,Y))}}return M}function lx(a,c,m,y,T,S){const M=a[m];if(M!=null){const n=sn(M,"default");if(n&&y===void 0){const F=M.default;if(M.type!==Function&&!M.skipFactory&&er(F)){const{propsDefaults:W}=T;if(m in W)y=W[m];else{const N=vm(T);y=W[m]=F.call(null,c),N()}}else y=F;T.ce&&T.ce._setProp(m,y)}M[0]&&(S&&!n?y=!1:M[1]&&(y===""||y===xc(m))&&(y=!0))}return y}const CD=new WeakMap;function lA(a,c,m=!1){const y=m?CD:c.propsCache,T=y.get(a);if(T)return T;const S=a.props,M={},n=[];let F=!1;if(!er(a)){const N=Y=>{F=!0;const[le,de]=lA(Y,c,!0);ds(M,le),de&&n.push(...de)};!m&&c.mixins.length&&c.mixins.forEach(N),a.extends&&N(a.extends),a.mixins&&a.mixins.forEach(N)}if(!S&&!F)return cn(a)&&y.set(a,Sd),Sd;if(qi(S))for(let N=0;N<S.length;N++){const Y=Io(S[N]);bS(Y)&&(M[Y]=dn)}else if(S)for(const N in S){const Y=Io(N);if(bS(Y)){const le=S[N],de=M[Y]=qi(le)||er(le)?{type:le}:ds({},le),Te=de.type;let pe=!1,qe=!0;if(qi(Te))for(let $e=0;$e<Te.length;++$e){const ze=Te[$e],be=er(ze)&&ze.name;if(be==="Boolean"){pe=!0;break}else be==="String"&&(qe=!1)}else pe=er(Te)&&Te.name==="Boolean";de[0]=pe,de[1]=qe,(pe||sn(de,"default"))&&n.push(Y)}}const W=[M,n];return cn(a)&&y.set(a,W),W}function bS(a){return a[0]!=="$"&&!Ad(a)}const cA=a=>a[0]==="_"||a==="$stable",Jx=a=>qi(a)?a.map(uo):[uo(a)],PD=(a,c,m)=>{if(c._n)return c;const y=Zx((...T)=>Jx(c(...T)),m);return y._c=!1,y},uA=(a,c,m)=>{const y=a._ctx;for(const T in a){if(cA(T))continue;const S=a[T];if(er(S))c[T]=PD(T,S,y);else if(S!=null){const M=Jx(S);c[T]=()=>M}}},hA=(a,c)=>{const m=Jx(c);a.slots.default=()=>m},dA=(a,c,m)=>{for(const y in c)(m||y!=="_")&&(a[y]=c[y])},MD=(a,c,m)=>{const y=a.slots=sA();if(a.vnode.shapeFlag&32){const T=c._;T?(dA(y,c,m),m&&u2(y,"_",T,!0)):uA(c,y)}else c&&hA(a,c)},RD=(a,c,m)=>{const{vnode:y,slots:T}=a;let S=!0,M=dn;if(y.shapeFlag&32){const n=c._;n?m&&n===1?S=!1:dA(T,c,m):(S=!c.$stable,uA(c,T)),M=c}else c&&(hA(a,c),M={default:1});if(S)for(const n in T)!cA(n)&&M[n]==null&&delete T[n]},gs=xA;function DD(a){return fA(a)}function kD(a){return fA(a,oD)}function fA(a,c){const m=hy();m.__VUE__=!0;const{insert:y,remove:T,patchProp:S,createElement:M,createText:n,createComment:F,setText:W,setElementText:N,parentNode:Y,nextSibling:le,setScopeId:de=Ea,insertStaticContent:Te}=a,pe=(we,Le,ht,Pt=null,Tt=null,jt=null,Jt=void 0,Xt=null,Yt=!!Le.dynamicChildren)=>{if(we===Le)return;we&&!qo(we,Le)&&(Pt=_t(we),In(we,Tt,jt,!0),we=null),Le.patchFlag===-2&&(Yt=!1,Le.dynamicChildren=null);const{type:Gt,ref:Bi,shapeFlag:ti}=Le;switch(Gt){case Nu:qe(we,Le,ht,Pt);break;case Yn:$e(we,Le,ht,Pt);break;case Wp:we==null&&ze(Le,ht,Pt,Jt);break;case Cs:qt(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt);break;default:ti&1?Ke(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt):ti&6?di(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt):(ti&64||ti&128)&&Gt.process(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt,Ei)}Bi!=null&&Tt&&am(Bi,we&&we.ref,jt,Le||we,!Le)},qe=(we,Le,ht,Pt)=>{if(we==null)y(Le.el=n(Le.children),ht,Pt);else{const Tt=Le.el=we.el;Le.children!==we.children&&W(Tt,Le.children)}},$e=(we,Le,ht,Pt)=>{we==null?y(Le.el=F(Le.children||""),ht,Pt):Le.el=we.el},ze=(we,Le,ht,Pt)=>{[we.el,we.anchor]=Te(we.children,Le,ht,Pt,we.el,we.anchor)},be=({el:we,anchor:Le},ht,Pt)=>{let Tt;for(;we&&we!==Le;)Tt=le(we),y(we,ht,Pt),we=Tt;y(Le,ht,Pt)},ke=({el:we,anchor:Le})=>{let ht;for(;we&&we!==Le;)ht=le(we),T(we),we=ht;T(Le)},Ke=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt)=>{Le.type==="svg"?Jt="svg":Le.type==="math"&&(Jt="mathml"),we==null?St(Le,ht,Pt,Tt,jt,Jt,Xt,Yt):Wt(we,Le,Tt,jt,Jt,Xt,Yt)},St=(we,Le,ht,Pt,Tt,jt,Jt,Xt)=>{let Yt,Gt;const{props:Bi,shapeFlag:ti,transition:_i,dirs:Gi}=we;if(Yt=we.el=M(we.type,jt,Bi&&Bi.is,Bi),ti&8?N(Yt,we.children):ti&16&&hi(we.children,Yt,null,Pt,Tt,D0(we,jt),Jt,Xt),Gi&&Ta(we,null,Pt,"created"),kt(Yt,we,we.scopeId,Jt,Pt),Bi){for(const jr in Bi)jr!=="value"&&!Ad(jr)&&S(Yt,jr,null,Bi[jr],jt,Pt);"value"in Bi&&S(Yt,"value",null,Bi.value,jt),(Gt=Bi.onVnodeBeforeMount)&&Zs(Gt,Pt,we)}Gi&&Ta(we,null,Pt,"beforeMount");const lr=pA(Tt,_i);lr&&_i.beforeEnter(Yt),y(Yt,Le,ht),((Gt=Bi&&Bi.onVnodeMounted)||lr||Gi)&&gs(()=>{Gt&&Zs(Gt,Pt,we),lr&&_i.enter(Yt),Gi&&Ta(we,null,Pt,"mounted")},Tt)},kt=(we,Le,ht,Pt,Tt)=>{if(ht&&de(we,ht),Pt)for(let jt=0;jt<Pt.length;jt++)de(we,Pt[jt]);if(Tt){let jt=Tt.subTree;if(Le===jt||Yg(jt.type)&&(jt.ssContent===Le||jt.ssFallback===Le)){const Jt=Tt.vnode;kt(we,Jt,Jt.scopeId,Jt.slotScopeIds,Tt.parent)}}},hi=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt=0)=>{for(let Gt=Yt;Gt<we.length;Gt++){const Bi=we[Gt]=Xt?uc(we[Gt]):uo(we[Gt]);pe(null,Bi,Le,ht,Pt,Tt,jt,Jt,Xt)}},Wt=(we,Le,ht,Pt,Tt,jt,Jt)=>{const Xt=Le.el=we.el;let{patchFlag:Yt,dynamicChildren:Gt,dirs:Bi}=Le;Yt|=we.patchFlag&16;const ti=we.props||dn,_i=Le.props||dn;let Gi;if(ht&&Au(ht,!1),(Gi=_i.onVnodeBeforeUpdate)&&Zs(Gi,ht,Le,we),Bi&&Ta(Le,we,ht,"beforeUpdate"),ht&&Au(ht,!0),(ti.innerHTML&&_i.innerHTML==null||ti.textContent&&_i.textContent==null)&&N(Xt,""),Gt?Zt(we.dynamicChildren,Gt,Xt,ht,Pt,D0(Le,Tt),jt):Jt||mi(we,Le,Xt,null,ht,Pt,D0(Le,Tt),jt,!1),Yt>0){if(Yt&16)ni(Xt,ti,_i,ht,Tt);else if(Yt&2&&ti.class!==_i.class&&S(Xt,"class",null,_i.class,Tt),Yt&4&&S(Xt,"style",ti.style,_i.style,Tt),Yt&8){const lr=Le.dynamicProps;for(let jr=0;jr<lr.length;jr++){const _r=lr[jr],xn=ti[_r],qr=_i[_r];(qr!==xn||_r==="value")&&S(Xt,_r,xn,qr,Tt,ht)}}Yt&1&&we.children!==Le.children&&N(Xt,Le.children)}else!Jt&&Gt==null&&ni(Xt,ti,_i,ht,Tt);((Gi=_i.onVnodeUpdated)||Bi)&&gs(()=>{Gi&&Zs(Gi,ht,Le,we),Bi&&Ta(Le,we,ht,"updated")},Pt)},Zt=(we,Le,ht,Pt,Tt,jt,Jt)=>{for(let Xt=0;Xt<Le.length;Xt++){const Yt=we[Xt],Gt=Le[Xt],Bi=Yt.el&&(Yt.type===Cs||!qo(Yt,Gt)||Yt.shapeFlag&70)?Y(Yt.el):ht;pe(Yt,Gt,Bi,null,Pt,Tt,jt,Jt,!0)}},ni=(we,Le,ht,Pt,Tt)=>{if(Le!==ht){if(Le!==dn)for(const jt in Le)!Ad(jt)&&!(jt in ht)&&S(we,jt,Le[jt],null,Tt,Pt);for(const jt in ht){if(Ad(jt))continue;const Jt=ht[jt],Xt=Le[jt];Jt!==Xt&&jt!=="value"&&S(we,jt,Xt,Jt,Tt,Pt)}"value"in ht&&S(we,"value",Le.value,ht.value,Tt)}},qt=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt)=>{const Gt=Le.el=we?we.el:n(""),Bi=Le.anchor=we?we.anchor:n("");let{patchFlag:ti,dynamicChildren:_i,slotScopeIds:Gi}=Le;Gi&&(Xt=Xt?Xt.concat(Gi):Gi),we==null?(y(Gt,ht,Pt),y(Bi,ht,Pt),hi(Le.children||[],ht,Bi,Tt,jt,Jt,Xt,Yt)):ti>0&&ti&64&&_i&&we.dynamicChildren?(Zt(we.dynamicChildren,_i,ht,Tt,jt,Jt,Xt),(Le.key!=null||Tt&&Le===Tt.subTree)&&mA(we,Le,!0)):mi(we,Le,ht,Bi,Tt,jt,Jt,Xt,Yt)},di=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt)=>{Le.slotScopeIds=Xt,we==null?Le.shapeFlag&512?Tt.ctx.activate(Le,ht,Pt,Jt,Yt):vi(Le,ht,Pt,Tt,jt,Jt,Yt):Ni(we,Le,Yt)},vi=(we,Le,ht,Pt,Tt,jt,Jt)=>{const Xt=we.component=tk(we,Pt,Tt);if(gm(we)&&(Xt.ctx.renderer=Ei),ik(Xt,!1,Jt),Xt.asyncDep){if(Tt&&Tt.registerDep(Xt,si,Jt),!we.el){const Yt=Xt.subTree=kn(Yn);$e(null,Yt,Le,ht)}}else si(Xt,we,Le,ht,Tt,jt,Jt)},Ni=(we,Le,ht)=>{const Pt=Le.component=we.component;if(GD(we,Le,ht))if(Pt.asyncDep&&!Pt.asyncResolved){Ui(Pt,Le,ht);return}else Pt.next=Le,Pt.update();else Le.el=we.el,Pt.vnode=Le},si=(we,Le,ht,Pt,Tt,jt,Jt)=>{const Xt=()=>{if(we.isMounted){let{next:ti,bu:_i,u:Gi,parent:lr,vnode:jr}=we;{const Tn=_A(we);if(Tn){ti&&(ti.el=jr.el,Ui(we,ti,Jt)),Tn.asyncDep.then(()=>{we.isUnmounted||Xt()});return}}let _r=ti,xn;Au(we,!1),ti?(ti.el=jr.el,Ui(we,ti,Jt)):ti=jr,_i&&Id(_i),(xn=ti.props&&ti.props.onVnodeBeforeUpdate)&&Zs(xn,lr,ti,jr),Au(we,!0);const qr=k0(we),Fn=we.subTree;we.subTree=qr,pe(Fn,qr,Y(Fn.el),_t(Fn),we,Tt,jt),ti.el=qr.el,_r===null&&gy(we,qr.el),Gi&&gs(Gi,Tt),(xn=ti.props&&ti.props.onVnodeUpdated)&&gs(()=>Zs(xn,lr,ti,jr),Tt)}else{let ti;const{el:_i,props:Gi}=Le,{bm:lr,m:jr,parent:_r,root:xn,type:qr}=we,Fn=yc(Le);if(Au(we,!1),lr&&Id(lr),!Fn&&(ti=Gi&&Gi.onVnodeBeforeMount)&&Zs(ti,_r,Le),Au(we,!0),_i&&Sr){const Tn=()=>{we.subTree=k0(we),Sr(_i,we.subTree,we,Tt,null)};Fn&&qr.__asyncHydrate?qr.__asyncHydrate(_i,we,Tn):Tn()}else{xn.ce&&xn.ce._injectChildStyle(qr);const Tn=we.subTree=k0(we);pe(null,Tn,ht,Pt,we,Tt,jt),Le.el=Tn.el}if(jr&&gs(jr,Tt),!Fn&&(ti=Gi&&Gi.onVnodeMounted)){const Tn=Le;gs(()=>Zs(ti,_r,Tn),Tt)}(Le.shapeFlag&256||_r&&yc(_r.vnode)&&_r.vnode.shapeFlag&256)&&we.a&&gs(we.a,Tt),we.isMounted=!0,Le=ht=Pt=null}};we.scope.on();const Yt=we.effect=new g2(Xt);we.scope.off();const Gt=we.update=Yt.run.bind(Yt),Bi=we.job=Yt.runIfDirty.bind(Yt);Bi.i=we,Bi.id=we.uid,Yt.scheduler=()=>Wx(Bi),Au(we,!0),Gt()},Ui=(we,Le,ht)=>{Le.component=we;const Pt=we.vnode.props;we.vnode=Le,we.next=null,ID(we,Le.props,Pt,ht),RD(we,Le.children,ht),bc(),dS(we),wc()},mi=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt=!1)=>{const Gt=we&&we.children,Bi=we?we.shapeFlag:0,ti=Le.children,{patchFlag:_i,shapeFlag:Gi}=Le;if(_i>0){if(_i&128){Yi(Gt,ti,ht,Pt,Tt,jt,Jt,Xt,Yt);return}else if(_i&256){Yr(Gt,ti,ht,Pt,Tt,jt,Jt,Xt,Yt);return}}Gi&8?(Bi&16&&tr(Gt,Tt,jt),ti!==Gt&&N(ht,ti)):Bi&16?Gi&16?Yi(Gt,ti,ht,Pt,Tt,jt,Jt,Xt,Yt):tr(Gt,Tt,jt,!0):(Bi&8&&N(ht,""),Gi&16&&hi(ti,ht,Pt,Tt,jt,Jt,Xt,Yt))},Yr=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt)=>{we=we||Sd,Le=Le||Sd;const Gt=we.length,Bi=Le.length,ti=Math.min(Gt,Bi);let _i;for(_i=0;_i<ti;_i++){const Gi=Le[_i]=Yt?uc(Le[_i]):uo(Le[_i]);pe(we[_i],Gi,ht,null,Tt,jt,Jt,Xt,Yt)}Gt>Bi?tr(we,Tt,jt,!0,!1,ti):hi(Le,ht,Pt,Tt,jt,Jt,Xt,Yt,ti)},Yi=(we,Le,ht,Pt,Tt,jt,Jt,Xt,Yt)=>{let Gt=0;const Bi=Le.length;let ti=we.length-1,_i=Bi-1;for(;Gt<=ti&&Gt<=_i;){const Gi=we[Gt],lr=Le[Gt]=Yt?uc(Le[Gt]):uo(Le[Gt]);if(qo(Gi,lr))pe(Gi,lr,ht,null,Tt,jt,Jt,Xt,Yt);else break;Gt++}for(;Gt<=ti&&Gt<=_i;){const Gi=we[ti],lr=Le[_i]=Yt?uc(Le[_i]):uo(Le[_i]);if(qo(Gi,lr))pe(Gi,lr,ht,null,Tt,jt,Jt,Xt,Yt);else break;ti--,_i--}if(Gt>ti){if(Gt<=_i){const Gi=_i+1,lr=Gi<Bi?Le[Gi].el:Pt;for(;Gt<=_i;)pe(null,Le[Gt]=Yt?uc(Le[Gt]):uo(Le[Gt]),ht,lr,Tt,jt,Jt,Xt,Yt),Gt++}}else if(Gt>_i)for(;Gt<=ti;)In(we[Gt],Tt,jt,!0),Gt++;else{const Gi=Gt,lr=Gt,jr=new Map;for(Gt=lr;Gt<=_i;Gt++){const Cn=Le[Gt]=Yt?uc(Le[Gt]):uo(Le[Gt]);Cn.key!=null&&jr.set(Cn.key,Gt)}let _r,xn=0;const qr=_i-lr+1;let Fn=!1,Tn=0;const es=new Array(qr);for(Gt=0;Gt<qr;Gt++)es[Gt]=0;for(Gt=Gi;Gt<=ti;Gt++){const Cn=we[Gt];if(xn>=qr){In(Cn,Tt,jt,!0);continue}let ts;if(Cn.key!=null)ts=jr.get(Cn.key);else for(_r=lr;_r<=_i;_r++)if(es[_r-lr]===0&&qo(Cn,Le[_r])){ts=_r;break}ts===void 0?In(Cn,Tt,jt,!0):(es[ts-lr]=Gt+1,ts>=Tn?Tn=ts:Fn=!0,pe(Cn,Le[ts],ht,null,Tt,jt,Jt,Xt,Yt),xn++)}const ho=Fn?LD(es):Sd;for(_r=ho.length-1,Gt=qr-1;Gt>=0;Gt--){const Cn=lr+Gt,ts=Le[Cn],Mr=Cn+1<Bi?Le[Cn+1].el:Pt;es[Gt]===0?pe(null,ts,ht,Mr,Tt,jt,Jt,Xt,Yt):Fn&&(_r<0||Gt!==ho[_r]?vn(ts,ht,Mr,2):_r--)}}},vn=(we,Le,ht,Pt,Tt=null)=>{const{el:jt,type:Jt,transition:Xt,children:Yt,shapeFlag:Gt}=we;if(Gt&6){vn(we.component.subTree,Le,ht,Pt);return}if(Gt&128){we.suspense.move(Le,ht,Pt);return}if(Gt&64){Jt.move(we,Le,ht,Ei);return}if(Jt===Cs){y(jt,Le,ht);for(let ti=0;ti<Yt.length;ti++)vn(Yt[ti],Le,ht,Pt);y(we.anchor,Le,ht);return}if(Jt===Wp){be(we,Le,ht);return}if(Pt!==2&&Gt&1&&Xt)if(Pt===0)Xt.beforeEnter(jt),y(jt,Le,ht),gs(()=>Xt.enter(jt),Tt);else{const{leave:ti,delayLeave:_i,afterLeave:Gi}=Xt,lr=()=>y(jt,Le,ht),jr=()=>{ti(jt,()=>{lr(),Gi&&Gi()})};_i?_i(jt,lr,jr):jr()}else y(jt,Le,ht)},In=(we,Le,ht,Pt=!1,Tt=!1)=>{const{type:jt,props:Jt,ref:Xt,children:Yt,dynamicChildren:Gt,shapeFlag:Bi,patchFlag:ti,dirs:_i,cacheIndex:Gi}=we;if(ti===-2&&(Tt=!1),Xt!=null&&am(Xt,null,ht,we,!0),Gi!=null&&(Le.renderCache[Gi]=void 0),Bi&256){Le.ctx.deactivate(we);return}const lr=Bi&1&&_i,jr=!yc(we);let _r;if(jr&&(_r=Jt&&Jt.onVnodeBeforeUnmount)&&Zs(_r,Le,we),Bi&6)gr(we.component,ht,Pt);else{if(Bi&128){we.suspense.unmount(ht,Pt);return}lr&&Ta(we,null,Le,"beforeUnmount"),Bi&64?we.type.remove(we,Le,ht,Ei,Pt):Gt&&!Gt.hasOnce&&(jt!==Cs||ti>0&&ti&64)?tr(Gt,Le,ht,!1,!0):(jt===Cs&&ti&384||!Tt&&Bi&16)&&tr(Yt,Le,ht),Pt&&Rs(we)}(jr&&(_r=Jt&&Jt.onVnodeUnmounted)||lr)&&gs(()=>{_r&&Zs(_r,Le,we),lr&&Ta(we,null,Le,"unmounted")},ht)},Rs=we=>{const{type:Le,el:ht,anchor:Pt,transition:Tt}=we;if(Le===Cs){ys(ht,Pt);return}if(Le===Wp){ke(we);return}const jt=()=>{T(ht),Tt&&!Tt.persisted&&Tt.afterLeave&&Tt.afterLeave()};if(we.shapeFlag&1&&Tt&&!Tt.persisted){const{leave:Jt,delayLeave:Xt}=Tt,Yt=()=>Jt(ht,jt);Xt?Xt(we.el,jt,Yt):Yt()}else jt()},ys=(we,Le)=>{let ht;for(;we!==Le;)ht=le(we),T(we),we=ht;T(Le)},gr=(we,Le,ht)=>{const{bum:Pt,scope:Tt,job:jt,subTree:Jt,um:Xt,m:Yt,a:Gt}=we;Kg(Yt),Kg(Gt),Pt&&Id(Pt),Tt.stop(),jt&&(jt.flags|=8,In(Jt,we,Le,ht)),Xt&&gs(Xt,Le),gs(()=>{we.isUnmounted=!0},Le),Le&&Le.pendingBranch&&!Le.isUnmounted&&we.asyncDep&&!we.asyncResolved&&we.suspenseId===Le.pendingId&&(Le.deps--,Le.deps===0&&Le.resolve())},tr=(we,Le,ht,Pt=!1,Tt=!1,jt=0)=>{for(let Jt=jt;Jt<we.length;Jt++)In(we[Jt],Le,ht,Pt,Tt)},_t=we=>{if(we.shapeFlag&6)return _t(we.component.subTree);if(we.shapeFlag&128)return we.suspense.next();const Le=le(we.anchor||we.el),ht=Le&&Le[eD];return ht?le(ht):Le};let fi=!1;const $t=(we,Le,ht)=>{we==null?Le._vnode&&In(Le._vnode,null,null,!0):pe(Le._vnode||null,we,Le,null,null,null,ht),Le._vnode=we,fi||(fi=!0,dS(),Wg(),fi=!1)},Ei={p:pe,um:In,m:vn,r:Rs,mt:vi,mc:hi,pc:mi,pbc:Zt,n:_t,o:a};let yr,Sr;return c&&([yr,Sr]=c(Ei)),{render:$t,hydrate:yr,createApp:ED($t,yr)}}function D0({type:a,props:c},m){return m==="svg"&&a==="foreignObject"||m==="mathml"&&a==="annotation-xml"&&c&&c.encoding&&c.encoding.includes("html")?void 0:m}function Au({effect:a,job:c},m){m?(a.flags|=32,c.flags|=4):(a.flags&=-33,c.flags&=-5)}function pA(a,c){return(!a||a&&!a.pendingBranch)&&c&&!c.persisted}function mA(a,c,m=!1){const y=a.children,T=c.children;if(qi(y)&&qi(T))for(let S=0;S<y.length;S++){const M=y[S];let n=T[S];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=T[S]=uc(T[S]),n.el=M.el),!m&&n.patchFlag!==-2&&mA(M,n)),n.type===Nu&&(n.el=M.el)}}function LD(a){const c=a.slice(),m=[0];let y,T,S,M,n;const F=a.length;for(y=0;y<F;y++){const W=a[y];if(W!==0){if(T=m[m.length-1],a[T]<W){c[y]=T,m.push(y);continue}for(S=0,M=m.length-1;S<M;)n=S+M>>1,a[m[n]]<W?S=n+1:M=n;W<a[m[S]]&&(S>0&&(c[y]=m[S-1]),m[S]=y)}}for(S=m.length,M=m[S-1];S-- >0;)m[S]=M,M=c[M];return m}function _A(a){const c=a.subTree.component;if(c)return c.asyncDep&&!c.asyncResolved?c:_A(c)}function Kg(a){if(a)for(let c=0;c<a.length;c++)a[c].flags|=8}const zD=Symbol.for("v-scx"),OD=()=>Ms(zD);function FD(a,c){return Qx(a,null,c)}function Pd(a,c,m){return Qx(a,c,m)}function Qx(a,c,m=dn){const{immediate:y,deep:T,flush:S,once:M}=m,n=ds({},m),F=c&&y||!c&&S!=="post";let W;if(zd){if(S==="sync"){const de=OD();W=de.__watcherHandles||(de.__watcherHandles=[])}else if(!F){const de=()=>{};return de.stop=Ea,de.resume=Ea,de.pause=Ea,de}}const N=Jn;n.call=(de,Te,pe)=>Xo(de,N,Te,pe);let Y=!1;S==="post"?n.scheduler=de=>{gs(de,N&&N.suspense)}:S!=="sync"&&(Y=!0,n.scheduler=(de,Te)=>{Te?de():Wx(de)}),n.augmentJob=de=>{c&&(de.flags|=4),Y&&(de.flags|=2,N&&(de.id=N.uid,de.i=N))};const le=YR(a,c,n);return zd&&(W?W.push(le):F&&le()),le}function BD(a,c,m){const y=this.proxy,T=An(a)?a.includes(".")?gA(y,a):()=>y[a]:a.bind(y,y);let S;er(c)?S=c:(S=c.handler,m=c);const M=vm(this),n=Qx(T,S.bind(y),m);return M(),n}function gA(a,c){const m=c.split(".");return()=>{let y=a;for(let T=0;T<m.length&&y;T++)y=y[m[T]];return y}}const ND=(a,c)=>c==="modelValue"||c==="model-value"?a.modelModifiers:a[`${c}Modifiers`]||a[`${Io(c)}Modifiers`]||a[`${xc(c)}Modifiers`];function UD(a,c,...m){if(a.isUnmounted)return;const y=a.vnode.props||dn;let T=m;const S=c.startsWith("update:"),M=S&&ND(y,c.slice(7));M&&(M.trim&&(T=m.map(N=>An(N)?N.trim():N)),M.number&&(T=m.map($g)));let n,F=y[n=T0(c)]||y[n=T0(Io(c))];!F&&S&&(F=y[n=T0(xc(c))]),F&&Xo(F,a,6,T);const W=y[n+"Once"];if(W){if(!a.emitted)a.emitted={};else if(a.emitted[n])return;a.emitted[n]=!0,Xo(W,a,6,T)}}function yA(a,c,m=!1){const y=c.emitsCache,T=y.get(a);if(T!==void 0)return T;const S=a.emits;let M={},n=!1;if(!er(a)){const F=W=>{const N=yA(W,c,!0);N&&(n=!0,ds(M,N))};!m&&c.mixins.length&&c.mixins.forEach(F),a.extends&&F(a.extends),a.mixins&&a.mixins.forEach(F)}return!S&&!n?(cn(a)&&y.set(a,null),null):(qi(S)?S.forEach(F=>M[F]=null):ds(M,S),cn(a)&&y.set(a,M),M)}function _y(a,c){return!a||!mm(c)?!1:(c=c.slice(2).replace(/Once$/,""),sn(a,c[0].toLowerCase()+c.slice(1))||sn(a,xc(c))||sn(a,c))}function k0(a){const{type:c,vnode:m,proxy:y,withProxy:T,propsOptions:[S],slots:M,attrs:n,emit:F,render:W,renderCache:N,props:Y,data:le,setupState:de,ctx:Te,inheritAttrs:pe}=a,qe=Zg(a);let $e,ze;try{if(m.shapeFlag&4){const ke=T||y,Ke=ke;$e=uo(W.call(Ke,ke,N,Y,de,le,Te)),ze=n}else{const ke=c;$e=uo(ke.length>1?ke(Y,{attrs:n,slots:M,emit:F}):ke(Y,null)),ze=c.props?n:jD(n)}}catch(ke){Zp.length=0,Vd(ke,a,1),$e=kn(Yn)}let be=$e;if(ze&&pe!==!1){const ke=Object.keys(ze),{shapeFlag:Ke}=be;ke.length&&Ke&7&&(S&&ke.some(Fx)&&(ze=$D(ze,S)),be=hl(be,ze,!1,!0))}return m.dirs&&(be=hl(be,null,!1,!0),be.dirs=be.dirs?be.dirs.concat(m.dirs):m.dirs),m.transition&&kd(be,m.transition),$e=be,Zg(qe),$e}function VD(a,c=!0){let m;for(let y=0;y<a.length;y++){const T=a[y];if($u(T)){if(T.type!==Yn||T.children==="v-if"){if(m)return;m=T}}else return}return m}const jD=a=>{let c;for(const m in a)(m==="class"||m==="style"||mm(m))&&((c||(c={}))[m]=a[m]);return c},$D=(a,c)=>{const m={};for(const y in a)(!Fx(y)||!(y.slice(9)in c))&&(m[y]=a[y]);return m};function GD(a,c,m){const{props:y,children:T,component:S}=a,{props:M,children:n,patchFlag:F}=c,W=S.emitsOptions;if(c.dirs||c.transition)return!0;if(m&&F>=0){if(F&1024)return!0;if(F&16)return y?wS(y,M,W):!!M;if(F&8){const N=c.dynamicProps;for(let Y=0;Y<N.length;Y++){const le=N[Y];if(M[le]!==y[le]&&!_y(W,le))return!0}}}else return(T||n)&&(!n||!n.$stable)?!0:y===M?!1:y?M?wS(y,M,W):!0:!!M;return!1}function wS(a,c,m){const y=Object.keys(c);if(y.length!==Object.keys(a).length)return!0;for(let T=0;T<y.length;T++){const S=y[T];if(c[S]!==a[S]&&!_y(m,S))return!0}return!1}function gy({vnode:a,parent:c},m){for(;c;){const y=c.subTree;if(y.suspense&&y.suspense.activeBranch===a&&(y.el=a.el),y===a)(a=c.vnode).el=m,c=c.parent;else break}}const Yg=a=>a.__isSuspense;let cx=0;const HD={name:"Suspense",__isSuspense:!0,process(a,c,m,y,T,S,M,n,F,W){if(a==null)qD(c,m,y,T,S,M,n,F,W);else{if(S&&S.deps>0&&!a.suspense.isInFallback){c.suspense=a.suspense,c.suspense.vnode=c,c.el=a.el;return}WD(a,c,m,y,T,M,n,F,W)}},hydrate:ZD,normalize:XD},eb=HD;function lm(a,c){const m=a.props&&a.props[c];er(m)&&m()}function qD(a,c,m,y,T,S,M,n,F){const{p:W,o:{createElement:N}}=F,Y=N("div"),le=a.suspense=vA(a,T,y,c,Y,m,S,M,n,F);W(null,le.pendingBranch=a.ssContent,Y,null,y,le,S,M),le.deps>0?(lm(a,"onPending"),lm(a,"onFallback"),W(null,a.ssFallback,c,m,y,null,S,M),Md(le,a.ssFallback)):le.resolve(!1,!0)}function WD(a,c,m,y,T,S,M,n,{p:F,um:W,o:{createElement:N}}){const Y=c.suspense=a.suspense;Y.vnode=c,c.el=a.el;const le=c.ssContent,de=c.ssFallback,{activeBranch:Te,pendingBranch:pe,isInFallback:qe,isHydrating:$e}=Y;if(pe)Y.pendingBranch=le,qo(le,pe)?(F(pe,le,Y.hiddenContainer,null,T,Y,S,M,n),Y.deps<=0?Y.resolve():qe&&($e||(F(Te,de,m,y,T,null,S,M,n),Md(Y,de)))):(Y.pendingId=cx++,$e?(Y.isHydrating=!1,Y.activeBranch=pe):W(pe,T,Y),Y.deps=0,Y.effects.length=0,Y.hiddenContainer=N("div"),qe?(F(null,le,Y.hiddenContainer,null,T,Y,S,M,n),Y.deps<=0?Y.resolve():(F(Te,de,m,y,T,null,S,M,n),Md(Y,de))):Te&&qo(le,Te)?(F(Te,le,m,y,T,Y,S,M,n),Y.resolve(!0)):(F(null,le,Y.hiddenContainer,null,T,Y,S,M,n),Y.deps<=0&&Y.resolve()));else if(Te&&qo(le,Te))F(Te,le,m,y,T,Y,S,M,n),Md(Y,le);else if(lm(c,"onPending"),Y.pendingBranch=le,le.shapeFlag&512?Y.pendingId=le.component.suspenseId:Y.pendingId=cx++,F(null,le,Y.hiddenContainer,null,T,Y,S,M,n),Y.deps<=0)Y.resolve();else{const{timeout:ze,pendingId:be}=Y;ze>0?setTimeout(()=>{Y.pendingId===be&&Y.fallback(de)},ze):ze===0&&Y.fallback(de)}}function vA(a,c,m,y,T,S,M,n,F,W,N=!1){const{p:Y,m:le,um:de,n:Te,o:{parentNode:pe,remove:qe}}=W;let $e;const ze=KD(a);ze&&c&&c.pendingBranch&&($e=c.pendingId,c.deps++);const be=a.props?h2(a.props.timeout):void 0,ke=S,Ke={vnode:a,parent:c,parentComponent:m,namespace:M,container:y,hiddenContainer:T,deps:0,pendingId:cx++,timeout:typeof be=="number"?be:-1,activeBranch:null,pendingBranch:null,isInFallback:!N,isHydrating:N,isUnmounted:!1,effects:[],resolve(St=!1,kt=!1){const{vnode:hi,activeBranch:Wt,pendingBranch:Zt,pendingId:ni,effects:qt,parentComponent:di,container:vi}=Ke;let Ni=!1;Ke.isHydrating?Ke.isHydrating=!1:St||(Ni=Wt&&Zt.transition&&Zt.transition.mode==="out-in",Ni&&(Wt.transition.afterLeave=()=>{ni===Ke.pendingId&&(le(Zt,vi,S===ke?Te(Wt):S,0),ix(qt))}),Wt&&(pe(Wt.el)===vi&&(S=Te(Wt)),de(Wt,di,Ke,!0)),Ni||le(Zt,vi,S,0)),Md(Ke,Zt),Ke.pendingBranch=null,Ke.isInFallback=!1;let si=Ke.parent,Ui=!1;for(;si;){if(si.pendingBranch){si.effects.push(...qt),Ui=!0;break}si=si.parent}!Ui&&!Ni&&ix(qt),Ke.effects=[],ze&&c&&c.pendingBranch&&$e===c.pendingId&&(c.deps--,c.deps===0&&!kt&&c.resolve()),lm(hi,"onResolve")},fallback(St){if(!Ke.pendingBranch)return;const{vnode:kt,activeBranch:hi,parentComponent:Wt,container:Zt,namespace:ni}=Ke;lm(kt,"onFallback");const qt=Te(hi),di=()=>{Ke.isInFallback&&(Y(null,St,Zt,qt,Wt,null,ni,n,F),Md(Ke,St))},vi=St.transition&&St.transition.mode==="out-in";vi&&(hi.transition.afterLeave=di),Ke.isInFallback=!0,de(hi,Wt,null,!0),vi||di()},move(St,kt,hi){Ke.activeBranch&&le(Ke.activeBranch,St,kt,hi),Ke.container=St},next(){return Ke.activeBranch&&Te(Ke.activeBranch)},registerDep(St,kt,hi){const Wt=!!Ke.pendingBranch;Wt&&Ke.deps++;const Zt=St.vnode.el;St.asyncDep.catch(ni=>{Vd(ni,St,0)}).then(ni=>{if(St.isUnmounted||Ke.isUnmounted||Ke.pendingId!==St.suspenseId)return;St.asyncResolved=!0;const{vnode:qt}=St;hx(St,ni),Zt&&(qt.el=Zt);const di=!Zt&&St.subTree.el;kt(St,qt,pe(Zt||St.subTree.el),Zt?null:Te(St.subTree),Ke,M,hi),di&&qe(di),gy(St,qt.el),Wt&&--Ke.deps===0&&Ke.resolve()})},unmount(St,kt){Ke.isUnmounted=!0,Ke.activeBranch&&de(Ke.activeBranch,m,St,kt),Ke.pendingBranch&&de(Ke.pendingBranch,m,St,kt)}};return Ke}function ZD(a,c,m,y,T,S,M,n,F){const W=c.suspense=vA(c,y,m,a.parentNode,document.createElement("div"),null,T,S,M,n,!0),N=F(a,W.pendingBranch=c.ssContent,m,W,S,M);return W.deps===0&&W.resolve(!1,!0),N}function XD(a){const{shapeFlag:c,children:m}=a,y=c&32;a.ssContent=TS(y?m.default:m),a.ssFallback=y?TS(m.fallback):kn(Yn)}function TS(a){let c;if(er(a)){const m=Ld&&a._c;m&&(a._d=!1,So()),a=a(),m&&(a._d=!0,c=Xs,bA())}return qi(a)&&(a=VD(a)),a=uo(a),c&&!a.dynamicChildren&&(a.dynamicChildren=c.filter(m=>m!==a)),a}function xA(a,c){c&&c.pendingBranch?qi(a)?c.effects.push(...a):c.effects.push(a):ix(a)}function Md(a,c){a.activeBranch=c;const{vnode:m,parentComponent:y}=a;let T=c.el;for(;!T&&c.component;)c=c.component.subTree,T=c.el;m.el=T,y&&y.subTree===m&&(y.vnode.el=T,gy(y,T))}function KD(a){const c=a.props&&a.props.suspensible;return c!=null&&c!==!1}const Cs=Symbol.for("v-fgt"),Nu=Symbol.for("v-txt"),Yn=Symbol.for("v-cmt"),Wp=Symbol.for("v-stc"),Zp=[];let Xs=null;function So(a=!1){Zp.push(Xs=a?null:[])}function bA(){Zp.pop(),Xs=Zp[Zp.length-1]||null}let Ld=1;function SS(a,c=!1){Ld+=a,a<0&&Xs&&c&&(Xs.hasOnce=!0)}function wA(a){return a.dynamicChildren=Ld>0?Xs||Sd:null,bA(),Ld>0&&Xs&&Xs.push(a),a}function YD(a,c,m,y,T,S){return wA(SA(a,c,m,y,T,S,!0))}function Sa(a,c,m,y,T){return wA(kn(a,c,m,y,T,!0))}function $u(a){return a?a.__v_isVNode===!0:!1}function qo(a,c){return a.type===c.type&&a.key===c.key}const TA=({key:a})=>a??null,Bg=({ref:a,ref_key:c,ref_for:m})=>(typeof a=="number"&&(a=""+a),a!=null?An(a)||Hn(a)||er(a)?{i:Qn,r:a,k:c,f:!!m}:a:null);function SA(a,c=null,m=null,y=0,T=null,S=a===Cs?0:1,M=!1,n=!1){const F={__v_isVNode:!0,__v_skip:!0,type:a,props:c,key:c&&TA(c),ref:c&&Bg(c),scopeId:B2,slotScopeIds:null,children:m,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:S,patchFlag:y,dynamicProps:T,dynamicChildren:null,appContext:null,ctx:Qn};return n?(tb(F,m),S&128&&a.normalize(F)):m&&(F.shapeFlag|=An(m)?8:16),Ld>0&&!M&&Xs&&(F.patchFlag>0||S&6)&&F.patchFlag!==32&&Xs.push(F),F}const kn=JD;function JD(a,c=null,m=null,y=0,T=null,S=!1){if((!a||a===J2)&&(a=Yn),$u(a)){const n=hl(a,c,!0);return m&&tb(n,m),Ld>0&&!S&&Xs&&(n.shapeFlag&6?Xs[Xs.indexOf(a)]=n:Xs.push(n)),n.patchFlag=-2,n}if(ok(a)&&(a=a.__vccOpts),c){c=EA(c);let{class:n,style:F}=c;n&&!An(n)&&(c.class=fy(n)),cn(F)&&(qx(F)&&!qi(F)&&(F=ds({},F)),c.style=dy(F))}const M=An(a)?1:Yg(a)?128:N2(a)?64:cn(a)?4:er(a)?2:0;return SA(a,c,m,y,T,M,S,!0)}function EA(a){return a?qx(a)||oA(a)?ds({},a):a:null}function hl(a,c,m=!1,y=!1){const{props:T,ref:S,patchFlag:M,children:n,transition:F}=a,W=c?IA(T||{},c):T,N={__v_isVNode:!0,__v_skip:!0,type:a.type,props:W,key:W&&TA(W),ref:c&&c.ref?m&&S?qi(S)?S.concat(Bg(c)):[S,Bg(c)]:Bg(c):S,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:n,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:c&&a.type!==Cs?M===-1?16:M|16:M,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:F,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&hl(a.ssContent),ssFallback:a.ssFallback&&hl(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return F&&y&&kd(N,F.clone(N)),N}function AA(a=" ",c=0){return kn(Nu,null,a,c)}function MN(a,c){const m=kn(Wp,null,a);return m.staticCount=c,m}function RN(a="",c=!1){return c?(So(),Sa(Yn,null,a)):kn(Yn,null,a)}function uo(a){return a==null||typeof a=="boolean"?kn(Yn):qi(a)?kn(Cs,null,a.slice()):$u(a)?uc(a):kn(Nu,null,String(a))}function uc(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:hl(a)}function tb(a,c){let m=0;const{shapeFlag:y}=a;if(c==null)c=null;else if(qi(c))m=16;else if(typeof c=="object")if(y&65){const T=c.default;T&&(T._c&&(T._d=!1),tb(a,T()),T._c&&(T._d=!0));return}else{m=32;const T=c._;!T&&!oA(c)?c._ctx=Qn:T===3&&Qn&&(Qn.slots._===1?c._=1:(c._=2,a.patchFlag|=1024))}else er(c)?(c={default:c,_ctx:Qn},m=32):(c=String(c),y&64?(m=16,c=[AA(c)]):m=8);a.children=c,a.shapeFlag|=m}function IA(...a){const c={};for(let m=0;m<a.length;m++){const y=a[m];for(const T in y)if(T==="class")c.class!==y.class&&(c.class=fy([c.class,y.class]));else if(T==="style")c.style=dy([c.style,y.style]);else if(mm(T)){const S=c[T],M=y[T];M&&S!==M&&!(qi(S)&&S.includes(M))&&(c[T]=S?[].concat(S,M):M)}else T!==""&&(c[T]=y[T])}return c}function Zs(a,c,m,y=null){Xo(a,c,7,[m,y])}const QD=rA();let ek=0;function tk(a,c,m){const y=a.type,T=(c?c.appContext:a.appContext)||QD,S={uid:ek++,vnode:a,type:y,parent:c,appContext:T,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new m2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:c?c.provides:Object.create(T.provides),ids:c?c.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:lA(y,T),emitsOptions:yA(y,T),emit:null,emitted:null,propsDefaults:dn,inheritAttrs:y.inheritAttrs,ctx:dn,data:dn,props:dn,attrs:dn,slots:dn,refs:dn,setupState:dn,setupContext:null,suspense:m,suspenseId:m?m.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return S.ctx={_:S},S.root=c?c.root:S,S.emit=UD.bind(null,S),a.ce&&a.ce(S),S}let Jn=null;const yy=()=>Jn||Qn;let Jg,ux;{const a=hy(),c=(m,y)=>{let T;return(T=a[m])||(T=a[m]=[]),T.push(y),S=>{T.length>1?T.forEach(M=>M(S)):T[0](S)}};Jg=c("__VUE_INSTANCE_SETTERS__",m=>Jn=m),ux=c("__VUE_SSR_SETTERS__",m=>zd=m)}const vm=a=>{const c=Jn;return Jg(a),a.scope.on(),()=>{a.scope.off(),Jg(c)}},ES=()=>{Jn&&Jn.scope.off(),Jg(null)};function CA(a){return a.vnode.shapeFlag&4}let zd=!1;function ik(a,c=!1,m=!1){c&&ux(c);const{props:y,children:T}=a.vnode,S=CA(a);AD(a,y,S,c),MD(a,T,m);const M=S?rk(a,c):void 0;return c&&ux(!1),M}function rk(a,c){const m=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,yD);const{setup:y}=m;if(y){bc();const T=a.setupContext=y.length>1?sk(a):null,S=vm(a),M=_m(y,a,0,[a.props,T]),n=a2(M);if(wc(),S(),(n||a.sp)&&!yc(a)&&Xx(a),n){if(M.then(ES,ES),c)return M.then(F=>{hx(a,F)}).catch(F=>{Vd(F,a,0)});a.asyncDep=M}else hx(a,M)}else PA(a)}function hx(a,c,m){er(c)?a.type.__ssrInlineRender?a.ssrRender=c:a.render=c:cn(c)&&(a.setupState=k2(c)),PA(a)}function PA(a,c,m){const y=a.type;a.render||(a.render=y.render||Ea);{const T=vm(a);bc();try{vD(a)}finally{wc(),T()}}}const nk={get(a,c){return As(a,"get",""),a[c]}};function sk(a){const c=m=>{a.exposed=m||{}};return{attrs:new Proxy(a.attrs,nk),slots:a.slots,emit:a.emit,expose:c}}function vy(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(k2(VR(a.exposed)),{get(c,m){if(m in c)return c[m];if(m in qp)return qp[m](a)},has(c,m){return m in c||m in qp}})):a.proxy}function dx(a,c=!0){return er(a)?a.displayName||a.name:a.name||c&&a.__name}function ok(a){return er(a)&&"__vccOpts"in a}const Eo=(a,c)=>XR(a,c,zd);function Ps(a,c,m){const y=arguments.length;return y===2?cn(c)&&!qi(c)?$u(c)?kn(a,null,[c]):kn(a,c):kn(a,null,c):(y>3?m=Array.prototype.slice.call(arguments,2):y===3&&$u(m)&&(m=[m]),kn(a,c,m))}const ak="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let fx;const AS=typeof window<"u"&&window.trustedTypes;if(AS)try{fx=AS.createPolicy("vue",{createHTML:a=>a})}catch{}const MA=fx?a=>fx.createHTML(a):a=>a,lk="http://www.w3.org/2000/svg",ck="http://www.w3.org/1998/Math/MathML",sl=typeof document<"u"?document:null,IS=sl&&sl.createElement("template"),uk={insert:(a,c,m)=>{c.insertBefore(a,m||null)},remove:a=>{const c=a.parentNode;c&&c.removeChild(a)},createElement:(a,c,m,y)=>{const T=c==="svg"?sl.createElementNS(lk,a):c==="mathml"?sl.createElementNS(ck,a):m?sl.createElement(a,{is:m}):sl.createElement(a);return a==="select"&&y&&y.multiple!=null&&T.setAttribute("multiple",y.multiple),T},createText:a=>sl.createTextNode(a),createComment:a=>sl.createComment(a),setText:(a,c)=>{a.nodeValue=c},setElementText:(a,c)=>{a.textContent=c},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>sl.querySelector(a),setScopeId(a,c){a.setAttribute(c,"")},insertStaticContent(a,c,m,y,T,S){const M=m?m.previousSibling:c.lastChild;if(T&&(T===S||T.nextSibling))for(;c.insertBefore(T.cloneNode(!0),m),!(T===S||!(T=T.nextSibling)););else{IS.innerHTML=MA(y==="svg"?`<svg>${a}</svg>`:y==="mathml"?`<math>${a}</math>`:a);const n=IS.content;if(y==="svg"||y==="mathml"){const F=n.firstChild;for(;F.firstChild;)n.appendChild(F.firstChild);n.removeChild(F)}c.insertBefore(n,m)}return[M?M.nextSibling:c.firstChild,m?m.previousSibling:c.lastChild]}},sc="transition",zp="animation",cm=Symbol("_vtc"),RA={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},hk=ds({},U2,RA),dk=a=>(a.displayName="Transition",a.props=hk,a),fk=dk((a,{slots:c})=>Ps(rD,pk(a),c)),Iu=(a,c=[])=>{qi(a)?a.forEach(m=>m(...c)):a&&a(...c)},CS=a=>a?qi(a)?a.some(c=>c.length>1):a.length>1:!1;function pk(a){const c={};for(const qt in a)qt in RA||(c[qt]=a[qt]);if(a.css===!1)return c;const{name:m="v",type:y,duration:T,enterFromClass:S=`${m}-enter-from`,enterActiveClass:M=`${m}-enter-active`,enterToClass:n=`${m}-enter-to`,appearFromClass:F=S,appearActiveClass:W=M,appearToClass:N=n,leaveFromClass:Y=`${m}-leave-from`,leaveActiveClass:le=`${m}-leave-active`,leaveToClass:de=`${m}-leave-to`}=a,Te=mk(T),pe=Te&&Te[0],qe=Te&&Te[1],{onBeforeEnter:$e,onEnter:ze,onEnterCancelled:be,onLeave:ke,onLeaveCancelled:Ke,onBeforeAppear:St=$e,onAppear:kt=ze,onAppearCancelled:hi=be}=c,Wt=(qt,di,vi,Ni)=>{qt._enterCancelled=Ni,Cu(qt,di?N:n),Cu(qt,di?W:M),vi&&vi()},Zt=(qt,di)=>{qt._isLeaving=!1,Cu(qt,Y),Cu(qt,de),Cu(qt,le),di&&di()},ni=qt=>(di,vi)=>{const Ni=qt?kt:ze,si=()=>Wt(di,qt,vi);Iu(Ni,[di,si]),PS(()=>{Cu(di,qt?F:S),rl(di,qt?N:n),CS(Ni)||MS(di,y,pe,si)})};return ds(c,{onBeforeEnter(qt){Iu($e,[qt]),rl(qt,S),rl(qt,M)},onBeforeAppear(qt){Iu(St,[qt]),rl(qt,F),rl(qt,W)},onEnter:ni(!1),onAppear:ni(!0),onLeave(qt,di){qt._isLeaving=!0;const vi=()=>Zt(qt,di);rl(qt,Y),qt._enterCancelled?(rl(qt,le),kS()):(kS(),rl(qt,le)),PS(()=>{qt._isLeaving&&(Cu(qt,Y),rl(qt,de),CS(ke)||MS(qt,y,qe,vi))}),Iu(ke,[qt,vi])},onEnterCancelled(qt){Wt(qt,!1,void 0,!0),Iu(be,[qt])},onAppearCancelled(qt){Wt(qt,!0,void 0,!0),Iu(hi,[qt])},onLeaveCancelled(qt){Zt(qt),Iu(Ke,[qt])}})}function mk(a){if(a==null)return null;if(cn(a))return[L0(a.enter),L0(a.leave)];{const c=L0(a);return[c,c]}}function L0(a){return h2(a)}function rl(a,c){c.split(/\s+/).forEach(m=>m&&a.classList.add(m)),(a[cm]||(a[cm]=new Set)).add(c)}function Cu(a,c){c.split(/\s+/).forEach(y=>y&&a.classList.remove(y));const m=a[cm];m&&(m.delete(c),m.size||(a[cm]=void 0))}function PS(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let _k=0;function MS(a,c,m,y){const T=a._endId=++_k,S=()=>{T===a._endId&&y()};if(m!=null)return setTimeout(S,m);const{type:M,timeout:n,propCount:F}=gk(a,c);if(!M)return y();const W=M+"end";let N=0;const Y=()=>{a.removeEventListener(W,le),S()},le=de=>{de.target===a&&++N>=F&&Y()};setTimeout(()=>{N<F&&Y()},n+1),a.addEventListener(W,le)}function gk(a,c){const m=window.getComputedStyle(a),y=Te=>(m[Te]||"").split(", "),T=y(`${sc}Delay`),S=y(`${sc}Duration`),M=RS(T,S),n=y(`${zp}Delay`),F=y(`${zp}Duration`),W=RS(n,F);let N=null,Y=0,le=0;c===sc?M>0&&(N=sc,Y=M,le=S.length):c===zp?W>0&&(N=zp,Y=W,le=F.length):(Y=Math.max(M,W),N=Y>0?M>W?sc:zp:null,le=N?N===sc?S.length:F.length:0);const de=N===sc&&/\b(transform|all)(,|$)/.test(y(`${sc}Property`).toString());return{type:N,timeout:Y,propCount:le,hasTransform:de}}function RS(a,c){for(;a.length<c.length;)a=a.concat(a);return Math.max(...c.map((m,y)=>DS(m)+DS(a[y])))}function DS(a){return a==="auto"?0:Number(a.slice(0,-1).replace(",","."))*1e3}function kS(){return document.body.offsetHeight}function yk(a,c,m){const y=a[cm];y&&(c=(c?[c,...y]:[...y]).join(" ")),c==null?a.removeAttribute("class"):m?a.setAttribute("class",c):a.className=c}const Qg=Symbol("_vod"),DA=Symbol("_vsh"),DN={beforeMount(a,{value:c},{transition:m}){a[Qg]=a.style.display==="none"?"":a.style.display,m&&c?m.beforeEnter(a):Op(a,c)},mounted(a,{value:c},{transition:m}){m&&c&&m.enter(a)},updated(a,{value:c,oldValue:m},{transition:y}){!c!=!m&&(y?c?(y.beforeEnter(a),Op(a,!0),y.enter(a)):y.leave(a,()=>{Op(a,!1)}):Op(a,c))},beforeUnmount(a,{value:c}){Op(a,c)}};function Op(a,c){a.style.display=c?a[Qg]:"none",a[DA]=!c}const vk=Symbol(""),xk=/(^|;)\s*display\s*:/;function bk(a,c,m){const y=a.style,T=An(m);let S=!1;if(m&&!T){if(c)if(An(c))for(const M of c.split(";")){const n=M.slice(0,M.indexOf(":")).trim();m[n]==null&&Ng(y,n,"")}else for(const M in c)m[M]==null&&Ng(y,M,"");for(const M in m)M==="display"&&(S=!0),Ng(y,M,m[M])}else if(T){if(c!==m){const M=y[vk];M&&(m+=";"+M),y.cssText=m,S=xk.test(m)}}else c&&a.removeAttribute("style");Qg in a&&(a[Qg]=S?y.display:"",a[DA]&&(y.display="none"))}const LS=/\s*!important$/;function Ng(a,c,m){if(qi(m))m.forEach(y=>Ng(a,c,y));else if(m==null&&(m=""),c.startsWith("--"))a.setProperty(c,m);else{const y=wk(a,c);LS.test(m)?a.setProperty(xc(y),m.replace(LS,""),"important"):a[y]=m}}const zS=["Webkit","Moz","ms"],z0={};function wk(a,c){const m=z0[c];if(m)return m;let y=Io(c);if(y!=="filter"&&y in a)return z0[c]=y;y=uy(y);for(let T=0;T<zS.length;T++){const S=zS[T]+y;if(S in a)return z0[c]=S}return c}const OS="http://www.w3.org/1999/xlink";function FS(a,c,m,y,T,S=gR(c)){y&&c.startsWith("xlink:")?m==null?a.removeAttributeNS(OS,c.slice(6,c.length)):a.setAttributeNS(OS,c,m):m==null||S&&!d2(m)?a.removeAttribute(c):a.setAttribute(c,S?"":Zo(m)?String(m):m)}function BS(a,c,m,y,T){if(c==="innerHTML"||c==="textContent"){m!=null&&(a[c]=c==="innerHTML"?MA(m):m);return}const S=a.tagName;if(c==="value"&&S!=="PROGRESS"&&!S.includes("-")){const n=S==="OPTION"?a.getAttribute("value")||"":a.value,F=m==null?a.type==="checkbox"?"on":"":String(m);(n!==F||!("_value"in a))&&(a.value=F),m==null&&a.removeAttribute(c),a._value=m;return}let M=!1;if(m===""||m==null){const n=typeof a[c];n==="boolean"?m=d2(m):m==null&&n==="string"?(m="",M=!0):n==="number"&&(m=0,M=!0)}try{a[c]=m}catch{}M&&a.removeAttribute(T||c)}function pc(a,c,m,y){a.addEventListener(c,m,y)}function Tk(a,c,m,y){a.removeEventListener(c,m,y)}const NS=Symbol("_vei");function Sk(a,c,m,y,T=null){const S=a[NS]||(a[NS]={}),M=S[c];if(y&&M)M.value=y;else{const[n,F]=Ek(c);if(y){const W=S[c]=Ck(y,T);pc(a,n,W,F)}else M&&(Tk(a,n,M,F),S[c]=void 0)}}const US=/(?:Once|Passive|Capture)$/;function Ek(a){let c;if(US.test(a)){c={};let y;for(;y=a.match(US);)a=a.slice(0,a.length-y[0].length),c[y[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):xc(a.slice(2)),c]}let O0=0;const Ak=Promise.resolve(),Ik=()=>O0||(Ak.then(()=>O0=0),O0=Date.now());function Ck(a,c){const m=y=>{if(!y._vts)y._vts=Date.now();else if(y._vts<=m.attached)return;Xo(Pk(y,m.value),c,5,[y])};return m.value=a,m.attached=Ik(),m}function Pk(a,c){if(qi(c)){const m=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{m.call(a),a._stopped=!0},c.map(y=>T=>!T._stopped&&y&&y(T))}else return c}const VS=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,Mk=(a,c,m,y,T,S)=>{const M=T==="svg";c==="class"?yk(a,y,M):c==="style"?bk(a,m,y):mm(c)?Fx(c)||Sk(a,c,m,y,S):(c[0]==="."?(c=c.slice(1),!0):c[0]==="^"?(c=c.slice(1),!1):Rk(a,c,y,M))?(BS(a,c,y),!a.tagName.includes("-")&&(c==="value"||c==="checked"||c==="selected")&&FS(a,c,y,M,S,c!=="value")):a._isVueCE&&(/[A-Z]/.test(c)||!An(y))?BS(a,Io(c),y,S,c):(c==="true-value"?a._trueValue=y:c==="false-value"&&(a._falseValue=y),FS(a,c,y,M))};function Rk(a,c,m,y){if(y)return!!(c==="innerHTML"||c==="textContent"||c in a&&VS(c)&&er(m));if(c==="spellcheck"||c==="draggable"||c==="translate"||c==="form"||c==="list"&&a.tagName==="INPUT"||c==="type"&&a.tagName==="TEXTAREA")return!1;if(c==="width"||c==="height"){const T=a.tagName;if(T==="IMG"||T==="VIDEO"||T==="CANVAS"||T==="SOURCE")return!1}return VS(c)&&An(m)?!1:c in a}const Od=a=>{const c=a.props["onUpdate:modelValue"]||!1;return qi(c)?m=>Id(c,m):c};function Dk(a){a.target.composing=!0}function jS(a){const c=a.target;c.composing&&(c.composing=!1,c.dispatchEvent(new Event("input")))}const ul=Symbol("_assign"),kN={created(a,{modifiers:{lazy:c,trim:m,number:y}},T){a[ul]=Od(T);const S=y||T.props&&T.props.type==="number";pc(a,c?"change":"input",M=>{if(M.target.composing)return;let n=a.value;m&&(n=n.trim()),S&&(n=$g(n)),a[ul](n)}),m&&pc(a,"change",()=>{a.value=a.value.trim()}),c||(pc(a,"compositionstart",Dk),pc(a,"compositionend",jS),pc(a,"change",jS))},mounted(a,{value:c}){a.value=c??""},beforeUpdate(a,{value:c,oldValue:m,modifiers:{lazy:y,trim:T,number:S}},M){if(a[ul]=Od(M),a.composing)return;const n=(S||a.type==="number")&&!/^0\d/.test(a.value)?$g(a.value):a.value,F=c??"";n!==F&&(document.activeElement===a&&a.type!=="range"&&(y&&c===m||T&&a.value.trim()===F)||(a.value=F))}},LN={created(a,{value:c},m){a.checked=Dd(c,m.props.value),a[ul]=Od(m),pc(a,"change",()=>{a[ul](um(a))})},beforeUpdate(a,{value:c,oldValue:m},y){a[ul]=Od(y),c!==m&&(a.checked=Dd(c,y.props.value))}},zN={deep:!0,created(a,{value:c,modifiers:{number:m}},y){const T=ly(c);pc(a,"change",()=>{const S=Array.prototype.filter.call(a.options,M=>M.selected).map(M=>m?$g(um(M)):um(M));a[ul](a.multiple?T?new Set(S):S:S[0]),a._assigning=!0,ju(()=>{a._assigning=!1})}),a[ul]=Od(y)},mounted(a,{value:c}){$S(a,c)},beforeUpdate(a,c,m){a[ul]=Od(m)},updated(a,{value:c}){a._assigning||$S(a,c)}};function $S(a,c){const m=a.multiple,y=qi(c);if(!(m&&!y&&!ly(c))){for(let T=0,S=a.options.length;T<S;T++){const M=a.options[T],n=um(M);if(m)if(y){const F=typeof n;F==="string"||F==="number"?M.selected=c.some(W=>String(W)===String(n)):M.selected=vR(c,n)>-1}else M.selected=c.has(n);else if(Dd(um(M),c)){a.selectedIndex!==T&&(a.selectedIndex=T);return}}!m&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function um(a){return"_value"in a?a._value:a.value}const kk=["ctrl","shift","alt","meta"],Lk={stop:a=>a.stopPropagation(),prevent:a=>a.preventDefault(),self:a=>a.target!==a.currentTarget,ctrl:a=>!a.ctrlKey,shift:a=>!a.shiftKey,alt:a=>!a.altKey,meta:a=>!a.metaKey,left:a=>"button"in a&&a.button!==0,middle:a=>"button"in a&&a.button!==1,right:a=>"button"in a&&a.button!==2,exact:(a,c)=>kk.some(m=>a[`${m}Key`]&&!c.includes(m))},ON=(a,c)=>{const m=a._withMods||(a._withMods={}),y=c.join(".");return m[y]||(m[y]=(T,...S)=>{for(let M=0;M<c.length;M++){const n=Lk[c[M]];if(n&&n(T,c))return}return a(T,...S)})},zk={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},FN=(a,c)=>{const m=a._withKeys||(a._withKeys={}),y=c.join(".");return m[y]||(m[y]=T=>{if(!("key"in T))return;const S=xc(T.key);if(c.some(M=>M===S||zk[M]===S))return a(T)})},kA=ds({patchProp:Mk},uk);let Xp,GS=!1;function Ok(){return Xp||(Xp=DD(kA))}function Fk(){return Xp=GS?Xp:kD(kA),GS=!0,Xp}const Bk=(...a)=>{const c=Ok().createApp(...a),{mount:m}=c;return c.mount=y=>{const T=zA(y);if(!T)return;const S=c._component;!er(S)&&!S.render&&!S.template&&(S.template=T.innerHTML),T.nodeType===1&&(T.textContent="");const M=m(T,!1,LA(T));return T instanceof Element&&(T.removeAttribute("v-cloak"),T.setAttribute("data-v-app","")),M},c},Nk=(...a)=>{const c=Fk().createApp(...a),{mount:m}=c;return c.mount=y=>{const T=zA(y);if(T)return m(T,!0,LA(T))},c};function LA(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function zA(a){return An(a)?document.querySelector(a):a}const Uk=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Vk=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,jk=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function $k(a,c){if(a==="__proto__"||a==="constructor"&&c&&typeof c=="object"&&"prototype"in c){Gk(a);return}return c}function Gk(a){console.warn(`[destr] Dropping "${a}" key to prevent prototype pollution.`)}function ey(a,c={}){if(typeof a!="string")return a;if(a[0]==='"'&&a[a.length-1]==='"'&&a.indexOf("\\")===-1)return a.slice(1,-1);const m=a.trim();if(m.length<=9)switch(m.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!jk.test(a)){if(c.strict)throw new SyntaxError("[destr] Invalid JSON");return a}try{if(Uk.test(a)||Vk.test(a)){if(c.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(a,$k)}return JSON.parse(a)}catch(y){if(c.strict)throw y;return a}}const Hk=/#/g,qk=/&/g,Wk=/\//g,Zk=/=/g,ib=/\+/g,Xk=/%5e/gi,Kk=/%60/gi,Yk=/%7c/gi,Jk=/%20/gi;function Qk(a){return encodeURI(""+a).replace(Yk,"|")}function px(a){return Qk(typeof a=="string"?a:JSON.stringify(a)).replace(ib,"%2B").replace(Jk,"+").replace(Hk,"%23").replace(qk,"%26").replace(Kk,"`").replace(Xk,"^").replace(Wk,"%2F")}function F0(a){return px(a).replace(Zk,"%3D")}function ty(a=""){try{return decodeURIComponent(""+a)}catch{return""+a}}function eL(a){return ty(a.replace(ib," "))}function tL(a){return ty(a.replace(ib," "))}function OA(a=""){const c=Object.create(null);a[0]==="?"&&(a=a.slice(1));for(const m of a.split("&")){const y=m.match(/([^=]+)=?(.*)/)||[];if(y.length<2)continue;const T=eL(y[1]);if(T==="__proto__"||T==="constructor")continue;const S=tL(y[2]||"");c[T]===void 0?c[T]=S:Array.isArray(c[T])?c[T].push(S):c[T]=[c[T],S]}return c}function iL(a,c){return(typeof c=="number"||typeof c=="boolean")&&(c=String(c)),c?Array.isArray(c)?c.map(m=>`${F0(a)}=${px(m)}`).join("&"):`${F0(a)}=${px(c)}`:F0(a)}function rL(a){return Object.keys(a).filter(c=>a[c]!==void 0).map(c=>iL(c,a[c])).filter(Boolean).join("&")}const nL=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,sL=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,oL=/^([/\\]\s*){2,}[^/\\]/,aL=/^[\s\0]*(blob|data|javascript|vbscript):$/i,lL=/\/$|\/\?|\/#/,cL=/^\.?\//;function Gu(a,c={}){return typeof c=="boolean"&&(c={acceptRelative:c}),c.strict?nL.test(a):sL.test(a)||(c.acceptRelative?oL.test(a):!1)}function uL(a){return!!a&&aL.test(a)}function mx(a="",c){return c?lL.test(a):a.endsWith("/")}function hm(a="",c){if(!c)return(mx(a)?a.slice(0,-1):a)||"/";if(!mx(a,!0))return a||"/";let m=a,y="";const T=a.indexOf("#");T!==-1&&(m=a.slice(0,T),y=a.slice(T));const[S,...M]=m.split("?");return((S.endsWith("/")?S.slice(0,-1):S)||"/")+(M.length>0?`?${M.join("?")}`:"")+y}function hL(a="",c){if(!c)return a.endsWith("/")?a:a+"/";if(mx(a,!0))return a||"/";let m=a,y="";const T=a.indexOf("#");if(T!==-1&&(m=a.slice(0,T),y=a.slice(T),!m))return y;const[S,...M]=m.split("?");return S+"/"+(M.length>0?`?${M.join("?")}`:"")+y}function dL(a,c){if(BA(c)||Gu(a))return a;const m=hm(c);return a.startsWith(m)?a:rb(m,a)}function HS(a,c){if(BA(c))return a;const m=hm(c);if(!a.startsWith(m))return a;const y=a.slice(m.length);return y[0]==="/"?y:"/"+y}function FA(a,c){const m=VA(a),y={...OA(m.search),...c};return m.search=rL(y),mL(m)}function BA(a){return!a||a==="/"}function fL(a){return a&&a!=="/"}function rb(a,...c){let m=a||"";for(const y of c.filter(T=>fL(T)))if(m){const T=y.replace(cL,"");m=hL(m)+T}else m=y;return m}function NA(...a){var M,n,F,W;const c=/\/(?!\/)/,m=a.filter(Boolean),y=[];let T=0;for(const N of m)if(!(!N||N==="/")){for(const[Y,le]of N.split(c).entries())if(!(!le||le===".")){if(le===".."){if(y.length===1&&Gu(y[0]))continue;y.pop(),T--;continue}if(Y===1&&((M=y[y.length-1])!=null&&M.endsWith(":/"))){y[y.length-1]+="/"+le;continue}y.push(le),T++}}let S=y.join("/");return T>=0?(n=m[0])!=null&&n.startsWith("/")&&!S.startsWith("/")?S="/"+S:(F=m[0])!=null&&F.startsWith("./")&&!S.startsWith("./")&&(S="./"+S):S="../".repeat(-1*T)+S,(W=m[m.length-1])!=null&&W.endsWith("/")&&!S.endsWith("/")&&(S+="/"),S}function pL(a,c){return ty(hm(a))===ty(hm(c))}const UA=Symbol.for("ufo:protocolRelative");function VA(a="",c){const m=a.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(m){const[,Y,le=""]=m;return{protocol:Y.toLowerCase(),pathname:le,href:Y+le,auth:"",host:"",search:"",hash:""}}if(!Gu(a,{acceptRelative:!0}))return qS(a);const[,y="",T,S=""]=a.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,M="",n=""]=S.match(/([^#/?]*)(.*)?/)||[];y==="file:"&&(n=n.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:F,search:W,hash:N}=qS(n);return{protocol:y.toLowerCase(),auth:T?T.slice(0,Math.max(0,T.length-1)):"",host:M,pathname:F,search:W,hash:N,[UA]:!y}}function qS(a=""){const[c="",m="",y=""]=(a.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:c,search:m,hash:y}}function mL(a){const c=a.pathname||"",m=a.search?(a.search.startsWith("?")?"":"?")+a.search:"",y=a.hash||"",T=a.auth?a.auth+"@":"",S=a.host||"";return(a.protocol||a[UA]?(a.protocol||"")+"//":"")+T+S+c+m+y}class _L extends Error{constructor(c,m){super(c,m),this.name="FetchError",m!=null&&m.cause&&!this.cause&&(this.cause=m.cause)}}function gL(a){var F,W,N,Y,le;const c=((F=a.error)==null?void 0:F.message)||((W=a.error)==null?void 0:W.toString())||"",m=((N=a.request)==null?void 0:N.method)||((Y=a.options)==null?void 0:Y.method)||"GET",y=((le=a.request)==null?void 0:le.url)||String(a.request)||"/",T=`[${m}] ${JSON.stringify(y)}`,S=a.response?`${a.response.status} ${a.response.statusText}`:"<no response>",M=`${T}: ${S}${c?` ${c}`:""}`,n=new _L(M,a.error?{cause:a.error}:void 0);for(const de of["request","options","response"])Object.defineProperty(n,de,{get(){return a[de]}});for(const[de,Te]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(n,de,{get(){return a.response&&a.response[Te]}});return n}const yL=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function WS(a="GET"){return yL.has(a.toUpperCase())}function vL(a){if(a===void 0)return!1;const c=typeof a;return c==="string"||c==="number"||c==="boolean"||c===null?!0:c!=="object"?!1:Array.isArray(a)?!0:a.buffer?!1:a.constructor&&a.constructor.name==="Object"||typeof a.toJSON=="function"}const xL=new Set(["image/svg","application/xml","application/xhtml","application/html"]),bL=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function wL(a=""){if(!a)return"json";const c=a.split(";").shift()||"";return bL.test(c)?"json":xL.has(c)||c.startsWith("text/")?"text":"blob"}function TL(a,c,m,y){const T=SL((c==null?void 0:c.headers)??(a==null?void 0:a.headers),m==null?void 0:m.headers,y);let S;return(m!=null&&m.query||m!=null&&m.params||c!=null&&c.params||c!=null&&c.query)&&(S={...m==null?void 0:m.params,...m==null?void 0:m.query,...c==null?void 0:c.params,...c==null?void 0:c.query}),{...m,...c,query:S,params:S,headers:T}}function SL(a,c,m){if(!c)return new m(a);const y=new m(c);if(a)for(const[T,S]of Symbol.iterator in a||Array.isArray(a)?a:new m(a))y.set(T,S);return y}async function Cg(a,c){if(c)if(Array.isArray(c))for(const m of c)await m(a);else await c(a)}const EL=new Set([408,409,425,429,500,502,503,504]),AL=new Set([101,204,205,304]);function jA(a={}){const{fetch:c=globalThis.fetch,Headers:m=globalThis.Headers,AbortController:y=globalThis.AbortController}=a;async function T(n){const F=n.error&&n.error.name==="AbortError"&&!n.options.timeout||!1;if(n.options.retry!==!1&&!F){let N;typeof n.options.retry=="number"?N=n.options.retry:N=WS(n.options.method)?0:1;const Y=n.response&&n.response.status||500;if(N>0&&(Array.isArray(n.options.retryStatusCodes)?n.options.retryStatusCodes.includes(Y):EL.has(Y))){const le=typeof n.options.retryDelay=="function"?n.options.retryDelay(n):n.options.retryDelay||0;return le>0&&await new Promise(de=>setTimeout(de,le)),S(n.request,{...n.options,retry:N-1})}}const W=gL(n);throw Error.captureStackTrace&&Error.captureStackTrace(W,S),W}const S=async function(F,W={}){const N={request:F,options:TL(F,W,a.defaults,m),response:void 0,error:void 0};N.options.method&&(N.options.method=N.options.method.toUpperCase()),N.options.onRequest&&await Cg(N,N.options.onRequest),typeof N.request=="string"&&(N.options.baseURL&&(N.request=dL(N.request,N.options.baseURL)),N.options.query&&(N.request=FA(N.request,N.options.query),delete N.options.query),"query"in N.options&&delete N.options.query,"params"in N.options&&delete N.options.params),N.options.body&&WS(N.options.method)&&(vL(N.options.body)?(N.options.body=typeof N.options.body=="string"?N.options.body:JSON.stringify(N.options.body),N.options.headers=new m(N.options.headers||{}),N.options.headers.has("content-type")||N.options.headers.set("content-type","application/json"),N.options.headers.has("accept")||N.options.headers.set("accept","application/json")):("pipeTo"in N.options.body&&typeof N.options.body.pipeTo=="function"||typeof N.options.body.pipe=="function")&&("duplex"in N.options||(N.options.duplex="half")));let Y;if(!N.options.signal&&N.options.timeout){const de=new y;Y=setTimeout(()=>{const Te=new Error("[TimeoutError]: The operation was aborted due to timeout");Te.name="TimeoutError",Te.code=23,de.abort(Te)},N.options.timeout),N.options.signal=de.signal}try{N.response=await c(N.request,N.options)}catch(de){return N.error=de,N.options.onRequestError&&await Cg(N,N.options.onRequestError),await T(N)}finally{Y&&clearTimeout(Y)}if((N.response.body||N.response._bodyInit)&&!AL.has(N.response.status)&&N.options.method!=="HEAD"){const de=(N.options.parseResponse?"json":N.options.responseType)||wL(N.response.headers.get("content-type")||"");switch(de){case"json":{const Te=await N.response.text(),pe=N.options.parseResponse||ey;N.response._data=pe(Te);break}case"stream":{N.response._data=N.response.body||N.response._bodyInit;break}default:N.response._data=await N.response[de]()}}return N.options.onResponse&&await Cg(N,N.options.onResponse),!N.options.ignoreResponseError&&N.response.status>=400&&N.response.status<600?(N.options.onResponseError&&await Cg(N,N.options.onResponseError),await T(N)):N.response},M=async function(F,W){return(await S(F,W))._data};return M.raw=S,M.native=(...n)=>c(...n),M.create=(n={},F={})=>jA({...a,...F,defaults:{...a.defaults,...F.defaults,...n}}),M}const iy=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),IL=iy.fetch?(...a)=>iy.fetch(...a):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),CL=iy.Headers,PL=iy.AbortController,ML=jA({fetch:IL,Headers:CL,AbortController:PL}),RL=ML,DL=()=>{var a;return((a=window==null?void 0:window.__NUXT__)==null?void 0:a.config)||{}},ry=DL().app,kL=()=>ry.baseURL,LL=()=>ry.buildAssetsDir,nb=(...a)=>NA($A(),LL(),...a),$A=(...a)=>{const c=ry.cdnURL||ry.baseURL;return a.length?NA(c,...a):c};globalThis.__buildAssetsURL=nb,globalThis.__publicAssetsURL=$A;globalThis.$fetch||(globalThis.$fetch=RL.create({baseURL:kL()}));function _x(a,c={},m){for(const y in a){const T=a[y],S=m?`${m}:${y}`:y;typeof T=="object"&&T!==null?_x(T,c,S):typeof T=="function"&&(c[S]=T)}return c}const zL={run:a=>a()},OL=()=>zL,GA=typeof console.createTask<"u"?console.createTask:OL;function FL(a,c){const m=c.shift(),y=GA(m);return a.reduce((T,S)=>T.then(()=>y.run(()=>S(...c))),Promise.resolve())}function BL(a,c){const m=c.shift(),y=GA(m);return Promise.all(a.map(T=>y.run(()=>T(...c))))}function B0(a,c){for(const m of[...a])m(c)}class NL{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(c,m,y={}){if(!c||typeof m!="function")return()=>{};const T=c;let S;for(;this._deprecatedHooks[c];)S=this._deprecatedHooks[c],c=S.to;if(S&&!y.allowDeprecated){let M=S.message;M||(M=`${T} hook has been deprecated`+(S.to?`, please use ${S.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(M)||(console.warn(M),this._deprecatedMessages.add(M))}if(!m.name)try{Object.defineProperty(m,"name",{get:()=>"_"+c.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[c]=this._hooks[c]||[],this._hooks[c].push(m),()=>{m&&(this.removeHook(c,m),m=void 0)}}hookOnce(c,m){let y,T=(...S)=>(typeof y=="function"&&y(),y=void 0,T=void 0,m(...S));return y=this.hook(c,T),y}removeHook(c,m){if(this._hooks[c]){const y=this._hooks[c].indexOf(m);y!==-1&&this._hooks[c].splice(y,1),this._hooks[c].length===0&&delete this._hooks[c]}}deprecateHook(c,m){this._deprecatedHooks[c]=typeof m=="string"?{to:m}:m;const y=this._hooks[c]||[];delete this._hooks[c];for(const T of y)this.hook(c,T)}deprecateHooks(c){Object.assign(this._deprecatedHooks,c);for(const m in c)this.deprecateHook(m,c[m])}addHooks(c){const m=_x(c),y=Object.keys(m).map(T=>this.hook(T,m[T]));return()=>{for(const T of y.splice(0,y.length))T()}}removeHooks(c){const m=_x(c);for(const y in m)this.removeHook(y,m[y])}removeAllHooks(){for(const c in this._hooks)delete this._hooks[c]}callHook(c,...m){return m.unshift(c),this.callHookWith(FL,c,...m)}callHookParallel(c,...m){return m.unshift(c),this.callHookWith(BL,c,...m)}callHookWith(c,m,...y){const T=this._before||this._after?{name:m,args:y,context:{}}:void 0;this._before&&B0(this._before,T);const S=c(m in this._hooks?[...this._hooks[m]]:[],y);return S instanceof Promise?S.finally(()=>{this._after&&T&&B0(this._after,T)}):(this._after&&T&&B0(this._after,T),S)}beforeEach(c){return this._before=this._before||[],this._before.push(c),()=>{if(this._before!==void 0){const m=this._before.indexOf(c);m!==-1&&this._before.splice(m,1)}}}afterEach(c){return this._after=this._after||[],this._after.push(c),()=>{if(this._after!==void 0){const m=this._after.indexOf(c);m!==-1&&this._after.splice(m,1)}}}}function HA(){return new NL}function UL(a={}){let c,m=!1;const y=M=>{if(c&&c!==M)throw new Error("Context conflict")};let T;if(a.asyncContext){const M=a.AsyncLocalStorage||globalThis.AsyncLocalStorage;M?T=new M:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const S=()=>{if(T){const M=T.getStore();if(M!==void 0)return M}return c};return{use:()=>{const M=S();if(M===void 0)throw new Error("Context is not available");return M},tryUse:()=>S(),set:(M,n)=>{n||y(M),c=M,m=!0},unset:()=>{c=void 0,m=!1},call:(M,n)=>{y(M),c=M;try{return T?T.run(M,n):n()}finally{m||(c=void 0)}},async callAsync(M,n){c=M;const F=()=>{c=M},W=()=>c===M?F:void 0;gx.add(W);try{const N=T?T.run(M,n):n();return m||(c=void 0),await N}finally{gx.delete(W)}}}}function VL(a={}){const c={};return{get(m,y={}){return c[m]||(c[m]=UL({...a,...y})),c[m]}}}const ny=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},ZS="__unctx__",jL=ny[ZS]||(ny[ZS]=VL()),$L=(a,c={})=>jL.get(a,c),XS="__unctx_async_handlers__",gx=ny[XS]||(ny[XS]=new Set);function Uu(a){const c=[];for(const T of gx){const S=T();S&&c.push(S)}const m=()=>{for(const T of c)T()};let y=a();return y&&typeof y=="object"&&"catch"in y&&(y=y.catch(T=>{throw m(),T})),[y,m]}const GL=!1,KS=!1,HL=!1,BN={componentName:"NuxtLink",prefetch:!0,prefetchOn:{visibility:!0}},qL=null,WL="#__nuxt",qA="nuxt-app",YS=36e5,ZL="vite:preloadError";function WA(a=qA){return $L(a,{asyncContext:!1})}const XL="__nuxt_plugin";function KL(a){var T;let c=0;const m={_id:a.id||qA||"nuxt-app",_scope:bR(),provide:void 0,globalName:"nuxt",versions:{get nuxt(){return"3.17.2"},get vue(){return m.vueApp.version}},payload:cl({...((T=a.ssrContext)==null?void 0:T.payload)||{},data:cl({}),state:Tc({}),once:new Set,_errors:cl({})}),static:{data:{}},runWithContext(S){return m._scope.active&&!_2()?m._scope.run(()=>JS(m,S)):JS(m,S)},isHydrating:!0,deferHydration(){if(!m.isHydrating)return()=>{};c++;let S=!1;return()=>{if(!S&&(S=!0,c--,c===0))return m.isHydrating=!1,m.callHook("app:suspense:resolve")}},_asyncDataPromises:{},_asyncData:cl({}),_payloadRevivers:{},...a};{const S=window.__NUXT__;if(S)for(const M in S)switch(M){case"data":case"state":case"_errors":Object.assign(m.payload[M],S[M]);break;default:m.payload[M]=S[M]}}m.hooks=HA(),m.hook=m.hooks.hook,m.callHook=m.hooks.callHook,m.provide=(S,M)=>{const n="$"+S;Pg(m,n,M),Pg(m.vueApp.config.globalProperties,n,M)},Pg(m.vueApp,"$nuxt",m),Pg(m.vueApp.config.globalProperties,"$nuxt",m);{window.addEventListener(ZL,M=>{m.callHook("app:chunkError",{error:M.payload}),(m.isHydrating||M.payload.message.includes("Unable to preload CSS"))&&M.preventDefault()}),window.useNuxtApp||(window.useNuxtApp=qn);const S=m.hook("app:error",(...M)=>{console.error("[nuxt] error caught during app initialization",...M)});m.hook("app:mounted",S)}const y=m.payload.config;return m.provide("config",y),m}function YL(a,c){c.hooks&&a.hooks.addHooks(c.hooks)}async function JL(a,c){if(typeof c=="function"){const{provide:m}=await a.runWithContext(()=>c(a))||{};if(m&&typeof m=="object")for(const y in m)a.provide(y,m[y])}}async function QL(a,c){const m=[],y=[],T=[],S=[];let M=0;async function n(F){var N;const W=((N=F.dependsOn)==null?void 0:N.filter(Y=>c.some(le=>le._name===Y)&&!m.includes(Y)))??[];if(W.length>0)y.push([new Set(W),F]);else{const Y=JL(a,F).then(async()=>{F._name&&(m.push(F._name),await Promise.all(y.map(async([le,de])=>{le.has(F._name)&&(le.delete(F._name),le.size===0&&(M++,await n(de)))})))});F.parallel?T.push(Y.catch(le=>S.push(le))):await Y}}for(const F of c)YL(a,F);for(const F of c)await n(F);if(await Promise.all(T),M)for(let F=0;F<M;F++)await Promise.all(T);if(S.length)throw S[0]}function Yo(a){if(typeof a=="function")return a;const c=a._name||a.name;return delete a.name,Object.assign(a.setup||(()=>{}),a,{[XL]:!0,_name:c})}function JS(a,c,m){const y=()=>c();return WA(a._id).set(a),a.vueApp.runWithContext(y)}function ez(a){var m;let c;return Yx()&&(c=(m=yy())==null?void 0:m.appContext.app.$nuxt),c||(c=WA(a).tryUse()),c||null}function qn(a){const c=ez(a);if(!c)throw new Error("[nuxt] instance unavailable");return c}function jd(a){return qn().$config}function Pg(a,c,m){Object.defineProperty(a,c,{get:()=>m})}function tz(a,c){return{ctx:{table:a},matchAll:m=>XA(m,a)}}function ZA(a){const c={};for(const m in a)c[m]=m==="dynamic"?new Map(Object.entries(a[m]).map(([y,T])=>[y,ZA(T)])):new Map(Object.entries(a[m]));return c}function iz(a){return tz(ZA(a))}function XA(a,c,m){a.endsWith("/")&&(a=a.slice(0,-1)||"/");const y=[];for(const[S,M]of QS(c.wildcard))(a===S||a.startsWith(S+"/"))&&y.push(M);for(const[S,M]of QS(c.dynamic))if(a.startsWith(S+"/")){const n="/"+a.slice(S.length).split("/").splice(2).join("/");y.push(...XA(n,M))}const T=c.static.get(a);return T&&y.push(T),y.filter(Boolean)}function QS(a){return[...a.entries()].sort((c,m)=>c[0].length-m[0].length)}function N0(a){if(a===null||typeof a!="object")return!1;const c=Object.getPrototypeOf(a);return c!==null&&c!==Object.prototype&&Object.getPrototypeOf(c)!==null||Symbol.iterator in a?!1:Symbol.toStringTag in a?Object.prototype.toString.call(a)==="[object Module]":!0}function yx(a,c,m=".",y){if(!N0(c))return yx(a,{},m,y);const T=Object.assign({},c);for(const S in a){if(S==="__proto__"||S==="constructor")continue;const M=a[S];M!=null&&(y&&y(T,S,M,m)||(Array.isArray(M)&&Array.isArray(T[S])?T[S]=[...M,...T[S]]:N0(M)&&N0(T[S])?T[S]=yx(M,T[S],(m?`${m}.`:"")+S.toString(),y):T[S]=M))}return T}function rz(a){return(...c)=>c.reduce((m,y)=>yx(m,y,"",a),{})}const KA=rz();function nz(a,c){try{return c in a}catch{return!1}}class vx extends Error{constructor(m,y={}){super(m,y);nc(this,"statusCode",500);nc(this,"fatal",!1);nc(this,"unhandled",!1);nc(this,"statusMessage");nc(this,"data");nc(this,"cause");y.cause&&!this.cause&&(this.cause=y.cause)}toJSON(){const m={message:this.message,statusCode:xx(this.statusCode,500)};return this.statusMessage&&(m.statusMessage=YA(this.statusMessage)),this.data!==void 0&&(m.data=this.data),m}}nc(vx,"__h3_error__",!0);function sz(a){if(typeof a=="string")return new vx(a);if(oz(a))return a;const c=new vx(a.message??a.statusMessage??"",{cause:a.cause||a});if(nz(a,"stack"))try{Object.defineProperty(c,"stack",{get(){return a.stack}})}catch{try{c.stack=a.stack}catch{}}if(a.data&&(c.data=a.data),a.statusCode?c.statusCode=xx(a.statusCode,c.statusCode):a.status&&(c.statusCode=xx(a.status,c.statusCode)),a.statusMessage?c.statusMessage=a.statusMessage:a.statusText&&(c.statusMessage=a.statusText),c.statusMessage){const m=c.statusMessage;YA(c.statusMessage)!==m&&console.warn("[h3] Please prefer using `message` for longer error messages instead of `statusMessage`. In the future, `statusMessage` will be sanitized by default.")}return a.fatal!==void 0&&(c.fatal=a.fatal),a.unhandled!==void 0&&(c.unhandled=a.unhandled),c}function oz(a){var c;return((c=a==null?void 0:a.constructor)==null?void 0:c.__h3_error__)===!0}const az=/[^\u0009\u0020-\u007E]/g;function YA(a=""){return a.replace(az,"")}function xx(a,c=200){return!a||(typeof a=="string"&&(a=Number.parseInt(a,10)),a<100||a>999)?c:a}const JA=Symbol("layout-meta"),xm=Symbol("route"),Co=()=>{var a;return(a=qn())==null?void 0:a.$router},sb=()=>Yx()?Ms(xm,qn()._route):qn()._route;const lz=()=>{try{if(qn()._processingMiddleware)return!0}catch{return!1}return!1},NN=(a,c)=>{a||(a="/");const m=typeof a=="string"?a:"path"in a?cz(a):Co().resolve(a).href;if(c!=null&&c.open){const{target:F="_blank",windowFeatures:W={}}=c.open,N=Object.entries(W).filter(([Y,le])=>le!==void 0).map(([Y,le])=>`${Y.toLowerCase()}=${le}`).join(", ");return open(m,F,N),Promise.resolve()}const y=Gu(m,{acceptRelative:!0}),T=(c==null?void 0:c.external)||y;if(T){if(!(c!=null&&c.external))throw new Error("Navigating to an external URL is not allowed by default. Use `navigateTo(url, { external: true })`.");const{protocol:F}=new URL(m,window.location.href);if(F&&uL(F))throw new Error(`Cannot navigate to a URL with '${F}' protocol.`)}const S=lz();if(!T&&S){if(c!=null&&c.replace){if(typeof a=="string"){const{pathname:F,search:W,hash:N}=VA(a);return{path:F,...W&&{query:OA(W)},...N&&{hash:N},replace:!0}}return{...a,replace:!0}}return a}const M=Co(),n=qn();return T?(n._scope.stop(),c!=null&&c.replace?location.replace(m):location.href=m,S?n.isHydrating?new Promise(()=>{}):!1:Promise.resolve()):c!=null&&c.replace?M.replace(a):M.push(a)};function cz(a){return FA(a.path||"",a.query||{})+(a.hash||"")}const QA="__nuxt_error",xy=()=>L2(qn().payload,"error"),Du=a=>{const c=Vu(a);try{const m=qn(),y=xy();m.hooks.callHook("app:error",c),y.value||(y.value=c)}catch{throw c}return c},uz=async(a={})=>{const c=qn(),m=xy();c.callHook("app:error:cleared",a),a.redirect&&await Co().replace(a.redirect),m.value=qL},eI=a=>!!a&&typeof a=="object"&&QA in a,Vu=a=>{const c=sz(a);return Object.defineProperty(c,QA,{value:!0,configurable:!1,writable:!1}),c};function eE(a){const c=dz(a),m=new ArrayBuffer(c.length),y=new DataView(m);for(let T=0;T<m.byteLength;T++)y.setUint8(T,c.charCodeAt(T));return m}const hz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function dz(a){a.length%4===0&&(a=a.replace(/==?$/,""));let c="",m=0,y=0;for(let T=0;T<a.length;T++)m<<=6,m|=hz.indexOf(a[T]),y+=6,y===24&&(c+=String.fromCharCode((m&16711680)>>16),c+=String.fromCharCode((m&65280)>>8),c+=String.fromCharCode(m&255),m=y=0);return y===12?(m>>=4,c+=String.fromCharCode(m)):y===18&&(m>>=2,c+=String.fromCharCode((m&65280)>>8),c+=String.fromCharCode(m&255)),c}const fz=-1,pz=-2,mz=-3,_z=-4,gz=-5,yz=-6;function vz(a,c){return xz(JSON.parse(a),c)}function xz(a,c){if(typeof a=="number")return T(a,!0);if(!Array.isArray(a)||a.length===0)throw new Error("Invalid input");const m=a,y=Array(m.length);function T(S,M=!1){if(S===fz)return;if(S===mz)return NaN;if(S===_z)return 1/0;if(S===gz)return-1/0;if(S===yz)return-0;if(M)throw new Error("Invalid input");if(S in y)return y[S];const n=m[S];if(!n||typeof n!="object")y[S]=n;else if(Array.isArray(n))if(typeof n[0]=="string"){const F=n[0],W=c==null?void 0:c[F];if(W)return y[S]=W(T(n[1]));switch(F){case"Date":y[S]=new Date(n[1]);break;case"Set":const N=new Set;y[S]=N;for(let de=1;de<n.length;de+=1)N.add(T(n[de]));break;case"Map":const Y=new Map;y[S]=Y;for(let de=1;de<n.length;de+=2)Y.set(T(n[de]),T(n[de+1]));break;case"RegExp":y[S]=new RegExp(n[1],n[2]);break;case"Object":y[S]=Object(n[1]);break;case"BigInt":y[S]=BigInt(n[1]);break;case"null":const le=Object.create(null);y[S]=le;for(let de=1;de<n.length;de+=2)le[n[de]]=T(n[de+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const de=globalThis[F],Te=n[1],pe=eE(Te),qe=new de(pe);y[S]=qe;break}case"ArrayBuffer":{const de=n[1],Te=eE(de);y[S]=Te;break}default:throw new Error(`Unknown type ${F}`)}}else{const F=new Array(n.length);y[S]=F;for(let W=0;W<n.length;W+=1){const N=n[W];N!==pz&&(F[W]=T(N))}}else{const F={};y[S]=F;for(const W in n){const N=n[W];F[W]=T(N)}}return y[S]}return T(0)}const bz=new Set(["link","style","script","noscript"]),wz=new Set(["title","titleTemplate","script","style","noscript"]),tE=new Set(["base","meta","link","style","script","noscript"]),Tz=new Set(["title","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),Sz=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),Ez=new Set(["key","tagPosition","tagPriority","tagDuplicateStrategy","innerHTML","textContent","processTemplateParams"]),Az=new Set(["templateParams","htmlAttrs","bodyAttrs"]),Iz=new Set(["theme-color","google-site-verification","og","article","book","profile","twitter","author"]);const Cz=["name","property","http-equiv"];function tI(a){const c=a.split(":")[1];return Iz.has(c)}function bx(a){const{props:c,tag:m}=a;if(Sz.has(m))return m;if(m==="link"&&c.rel==="canonical")return"canonical";if(c.charset)return"charset";if(a.tag==="meta"){for(const y of Cz)if(c[y]!==void 0)return`${m}:${c[y]}`}if(a.key)return`${m}:key:${a.key}`;if(c.id)return`${m}:id:${c.id}`;if(wz.has(m)){const y=a.textContent||a.innerHTML;if(y)return`${m}:content:${y}`}}function iE(a){const c=a._h||a._d;if(c)return c;const m=a.textContent||a.innerHTML;return m||`${a.tag}:${Object.entries(a.props).map(([y,T])=>`${y}:${String(T)}`).join(",")}`}function sy(a,c,m){typeof a==="function"&&(!m||m!=="titleTemplate"&&!(m[0]==="o"&&m[1]==="n"))&&(a=a());let T;if(c&&(T=c(m,a)),Array.isArray(T))return T.map(S=>sy(S,c));if((T==null?void 0:T.constructor)===Object){const S={};for(const M of Object.keys(T))S[M]=sy(T[M],c,M);return S}return T}function Pz(a,c){const m=a==="style"?new Map:new Set;function y(T){const S=T.trim();if(S)if(a==="style"){const[M,...n]=S.split(":").map(F=>F.trim());M&&n.length&&m.set(M,n.join(":"))}else S.split(" ").filter(Boolean).forEach(M=>m.add(M))}return typeof c=="string"?a==="style"?c.split(";").forEach(y):y(c):Array.isArray(c)?c.forEach(T=>y(T)):c&&typeof c=="object"&&Object.entries(c).forEach(([T,S])=>{S&&S!=="false"&&(a==="style"?m.set(T.trim(),S):y(T))}),m}function iI(a,c){return a.props=a.props||{},c&&Object.entries(c).forEach(([m,y])=>{if(y===null){a.props[m]=null;return}if(m==="class"||m==="style"){a.props[m]=Pz(m,y);return}if(Ez.has(m)){if(["textContent","innerHTML"].includes(m)&&typeof y=="object"){let M=c.type;if(c.type||(M="application/json"),!(M!=null&&M.endsWith("json"))&&M!=="speculationrules")return;c.type=M,a.props.type=M,a[m]=JSON.stringify(y)}else a[m]=y;return}const T=String(y),S=m.startsWith("data-");T==="true"||T===""?a.props[m]=S?T:!0:!y&&S&&T==="false"?a.props[m]="false":y!==void 0&&(a.props[m]=y)}),a}function Mz(a,c){const m=typeof c=="object"&&typeof c!="function"?c:{[a==="script"||a==="noscript"||a==="style"?"innerHTML":"textContent"]:c},y=iI({tag:a,props:{}},m);return y.key&&bz.has(y.tag)&&(y.props["data-hid"]=y._h=y.key),y.tag==="script"&&typeof y.innerHTML=="object"&&(y.innerHTML=JSON.stringify(y.innerHTML),y.props.type=y.props.type||"application/json"),Array.isArray(y.props.content)?y.props.content.map(T=>({...y,props:{...y.props,content:T}})):y}function Rz(a,c){if(!a)return[];typeof a=="function"&&(a=a());const m=(T,S)=>{for(let M=0;M<c.length;M++)S=c[M](T,S);return S};a=m(void 0,a);const y=[];return a=sy(a,m),Object.entries(a||{}).forEach(([T,S])=>{if(S!==void 0)for(const M of Array.isArray(S)?S:[S])y.push(Mz(T,M))}),y.flat()}const wx=(a,c)=>a._w===c._w?a._p-c._p:a._w-c._w,rE={base:-10,title:10},Dz={critical:-8,high:-1,low:2},nE={meta:{"content-security-policy":-30,charset:-20,viewport:-15},link:{preconnect:20,stylesheet:60,preload:70,modulepreload:70,prefetch:90,"dns-prefetch":90,prerender:90},script:{async:30,defer:80,sync:50},style:{imported:40,sync:60}},kz=/@import/,Fp=a=>a===""||a===!0;function Lz(a,c){var S;if(typeof c.tagPriority=="number")return c.tagPriority;let m=100;const y=Dz[c.tagPriority]||0,T=a.resolvedOptions.disableCapoSorting?{link:{},script:{},style:{}}:nE;if(c.tag in rE)m=rE[c.tag];else if(c.tag==="meta"){const M=c.props["http-equiv"]==="content-security-policy"?"content-security-policy":c.props.charset?"charset":c.props.name==="viewport"?"viewport":null;M&&(m=nE.meta[M])}else c.tag==="link"&&c.props.rel?m=T.link[c.props.rel]:c.tag==="script"?Fp(c.props.async)?m=T.script.async:c.props.src&&!Fp(c.props.defer)&&!Fp(c.props.async)&&c.props.type!=="module"&&!((S=c.props.type)!=null&&S.endsWith("json"))?m=T.script.sync:Fp(c.props.defer)&&c.props.src&&!Fp(c.props.async)&&(m=T.script.defer):c.tag==="style"&&(m=c.innerHTML&&kz.test(c.innerHTML)?T.style.imported:T.style.sync);return(m||100)+y}function sE(a,c){const m=typeof c=="function"?c(a):c,y=m.key||String(a.plugins.size+1);a.plugins.get(y)||(a.plugins.set(y,m),a.hooks.addHooks(m.hooks||{}))}function zz(a={}){var n;const c=HA();c.addHooks(a.hooks||{});const m=!a.document,y=new Map,T=new Map,S=[],M={_entryCount:1,plugins:T,dirty:!1,resolvedOptions:a,hooks:c,ssr:m,entries:y,headEntries(){return[...y.values()]},use:F=>sE(M,F),push(F,W){const N={...W||{}};delete N.head;const Y=N._index??M._entryCount++,le={_i:Y,input:F,options:N},de={_poll(Te=!1){M.dirty=!0,!Te&&S.push(Y),c.callHook("entries:updated",M)},dispose(){y.delete(Y)&&de._poll(!0)},patch(Te){(!N.mode||N.mode==="server"&&m||N.mode==="client"&&!m)&&(le.input=Te,y.set(Y,le),de._poll())}};return de.patch(F),de},async resolveTags(){var de;const F={tagMap:new Map,tags:[],entries:[...M.entries.values()]};for(await c.callHook("entries:resolve",F);S.length;){const Te=S.shift(),pe=y.get(Te);if(pe){const qe={tags:Rz(pe.input,a.propResolvers||[]).map($e=>Object.assign($e,pe.options)),entry:pe};await c.callHook("entries:normalize",qe),pe._tags=qe.tags.map(($e,ze)=>($e._w=Lz(M,$e),$e._p=(pe._i<<10)+ze,$e._d=bx($e),$e))}}let W=!1;F.entries.flatMap(Te=>(Te._tags||[]).map(pe=>({...pe,props:{...pe.props}}))).sort(wx).reduce((Te,pe)=>{const qe=String(pe._d||pe._p);if(!Te.has(qe))return Te.set(qe,pe);const $e=Te.get(qe);if(((pe==null?void 0:pe.tagDuplicateStrategy)||(Az.has(pe.tag)?"merge":null)||(pe.key&&pe.key===$e.key?"merge":null))==="merge"){const be={...$e.props};Object.entries(pe.props).forEach(([ke,Ke])=>be[ke]=ke==="style"?new Map([...$e.props.style||new Map,...Ke]):ke==="class"?new Set([...$e.props.class||new Set,...Ke]):Ke),Te.set(qe,{...pe,props:be})}else pe._p>>10===$e._p>>10&&tI(pe._d)?(Te.set(qe,Object.assign([...Array.isArray($e)?$e:[$e],pe],pe)),W=!0):(pe._w===$e._w?pe._p>$e._p:(pe==null?void 0:pe._w)<($e==null?void 0:$e._w))&&Te.set(qe,pe);return Te},F.tagMap);const N=F.tagMap.get("title"),Y=F.tagMap.get("titleTemplate");if(M._title=N==null?void 0:N.textContent,Y){const Te=Y==null?void 0:Y.textContent;if(M._titleTemplate=Te,Te){let pe=typeof Te=="function"?Te(N==null?void 0:N.textContent):Te;typeof pe=="string"&&!M.plugins.has("template-params")&&(pe=pe.replace("%s",(N==null?void 0:N.textContent)||"")),N?pe===null?F.tagMap.delete("title"):F.tagMap.set("title",{...N,textContent:pe}):(Y.tag="title",Y.textContent=pe)}}F.tags=Array.from(F.tagMap.values()),W&&(F.tags=F.tags.flat().sort(wx)),await c.callHook("tags:beforeResolve",F),await c.callHook("tags:resolve",F),await c.callHook("tags:afterResolve",F);const le=[];for(const Te of F.tags){const{innerHTML:pe,tag:qe,props:$e}=Te;if(Tz.has(qe)&&!(Object.keys($e).length===0&&!Te.innerHTML&&!Te.textContent)&&!(qe==="meta"&&!$e.content&&!$e["http-equiv"]&&!$e.charset)){if(qe==="script"&&pe){if((de=$e.type)!=null&&de.endsWith("json")){const ze=typeof pe=="string"?pe:JSON.stringify(pe);Te.innerHTML=ze.replace(/</g,"\\u003C")}else typeof pe=="string"&&(Te.innerHTML=pe.replace(new RegExp(`</${qe}`,"g"),`<\\/${qe}`));Te._d=bx(Te)}le.push(Te)}}return le}};return((a==null?void 0:a.plugins)||[]).forEach(F=>sE(M,F)),M.hooks.callHook("init",M),(n=a.init)==null||n.forEach(F=>F&&M.push(F)),M}const hc="%separator",Oz=new RegExp(`${hc}(?:\\s*${hc})*`,"g");function Fz(a,c,m=!1){var T;let y;if(c==="s"||c==="pageTitle")y=a.pageTitle;else if(c.includes(".")){const S=c.indexOf(".");y=(T=a[c.substring(0,S)])==null?void 0:T[c.substring(S+1)]}else y=a[c];if(y!==void 0)return m?(y||"").replace(/\\/g,"\\\\").replace(/</g,"\\u003C").replace(/"/g,'\\"'):y||""}function Mg(a,c,m,y=!1){if(typeof a!="string"||!a.includes("%"))return a;let T=a;try{T=decodeURI(a)}catch{}const S=T.match(/%\w+(?:\.\w+)?/g);if(!S)return a;const M=a.includes(hc);return a=a.replace(/%\w+(?:\.\w+)?/g,n=>{if(n===hc||!S.includes(n))return n;const F=Fz(c,n.slice(1),y);return F!==void 0?F:n}).trim(),M&&(a.endsWith(hc)&&(a=a.slice(0,-hc.length)),a.startsWith(hc)&&(a=a.slice(hc.length)),a=a.replace(Oz,m||"").trim()),a}const oE=a=>a.includes(":key")?a:a.split(":").join(":key:"),Bz={key:"aliasSorting",hooks:{"tags:resolve":a=>{let c=!1;for(const m of a.tags){const y=m.tagPriority;if(!y)continue;const T=String(y);if(T.startsWith("before:")){const S=oE(T.slice(7)),M=a.tagMap.get(S);M&&(typeof M.tagPriority=="number"&&(m.tagPriority=M.tagPriority),m._p=M._p-1,c=!0)}else if(T.startsWith("after:")){const S=oE(T.slice(6)),M=a.tagMap.get(S);M&&(typeof M.tagPriority=="number"&&(m.tagPriority=M.tagPriority),m._p=M._p+1,c=!0)}}c&&(a.tags=a.tags.sort(wx))}}},Nz={key:"deprecations",hooks:{"entries:normalize":({tags:a})=>{for(const c of a)c.props.children&&(c.innerHTML=c.props.children,delete c.props.children),c.props.hid&&(c.key=c.props.hid,delete c.props.hid),c.props.vmid&&(c.key=c.props.vmid,delete c.props.vmid),c.props.body&&(c.tagPosition="bodyClose",delete c.props.body)}}};async function Tx(a){if(typeof a==="function")return a;if(a instanceof Promise)return await a;if(Array.isArray(a))return await Promise.all(a.map(m=>Tx(m)));if((a==null?void 0:a.constructor)===Object){const m={};for(const y of Object.keys(a))m[y]=await Tx(a[y]);return m}return a}const Uz={key:"promises",hooks:{"entries:resolve":async a=>{const c=[];for(const m in a.entries)a.entries[m]._promisesProcessed||c.push(Tx(a.entries[m].input).then(y=>{a.entries[m].input=y,a.entries[m]._promisesProcessed=!0}));await Promise.all(c)}}},Vz={meta:"content",link:"href",htmlAttrs:"lang"},jz=["innerHTML","textContent"],$z=a=>({key:"template-params",hooks:{"entries:normalize":c=>{var y,T,S;const m=((T=(y=c.tags.filter(M=>M.tag==="templateParams"&&M.mode==="server"))==null?void 0:y[0])==null?void 0:T.props)||{};Object.keys(m).length&&(a._ssrPayload={templateParams:{...((S=a._ssrPayload)==null?void 0:S.templateParams)||{},...m}})},"tags:resolve":({tagMap:c,tags:m})=>{var S;const y=((S=c.get("templateParams"))==null?void 0:S.props)||{},T=y.separator||"|";delete y.separator,y.pageTitle=Mg(y.pageTitle||a._title||"",y,T);for(const M of m){if(M.processTemplateParams===!1)continue;const n=Vz[M.tag];if(n&&typeof M.props[n]=="string")M.props[n]=Mg(M.props[n],y,T);else if(M.processTemplateParams||M.tag==="titleTemplate"||M.tag==="title")for(const F of jz)typeof M[F]=="string"&&(M[F]=Mg(M[F],y,T,M.tag==="script"&&M.props.type.endsWith("json")))}a._templateParams=y,a._separator=T},"tags:afterResolve":({tagMap:c})=>{const m=c.get("title");m!=null&&m.textContent&&m.processTemplateParams!==!1&&(m.textContent=Mg(m.textContent,a._templateParams,a._separator))}}}),Gz=(a,c)=>Hn(c)?$R(c):c,rI="usehead";function Hz(a){return{install(m){m.config.globalProperties.$unhead=a,m.config.globalProperties.$head=a,m.provide(rI,a)}}.install}function qz(){if(Yx()){const a=Ms(rI);if(!a)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return a}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}function UN(a,c={}){const m=c.head||qz();return m.ssr?m.push(a||{},c):Wz(m,a,c)}function Wz(a,c,m={}){const y=Aa(!1);let T;return FD(()=>{const M=y.value?{}:sy(c,Gz);T?T.patch(M):T=a.push(M,m)}),yy()&&(ym(()=>{T.dispose()}),q2(()=>{y.value=!0}),H2(()=>{y.value=!1})),T}const Zz="modulepreload",Xz=function(a,c){return new URL(a,c).href},aE={},Fs=function(c,m,y){let T=Promise.resolve();if(m&&m.length>0){let M=function(N){return Promise.all(N.map(Y=>Promise.resolve(Y).then(le=>({status:"fulfilled",value:le}),le=>({status:"rejected",reason:le}))))};const n=document.getElementsByTagName("link"),F=document.querySelector("meta[property=csp-nonce]"),W=(F==null?void 0:F.nonce)||(F==null?void 0:F.getAttribute("nonce"));T=M(m.map(N=>{if(N=Xz(N,y),N in aE)return;aE[N]=!0;const Y=N.endsWith(".css"),le=Y?'[rel="stylesheet"]':"";if(!!y)for(let pe=n.length-1;pe>=0;pe--){const qe=n[pe];if(qe.href===N&&(!Y||qe.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${N}"]${le}`))return;const Te=document.createElement("link");if(Te.rel=Y?"stylesheet":Zz,Y||(Te.as="script"),Te.crossOrigin="",Te.href=N,W&&Te.setAttribute("nonce",W),document.head.appendChild(Te),Y)return new Promise((pe,qe)=>{Te.addEventListener("load",pe),Te.addEventListener("error",()=>qe(new Error(`Unable to preload CSS for ${N}`)))})}))}function S(M){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=M,window.dispatchEvent(n),!n.defaultPrevented)throw M}return T.then(M=>{for(const n of M||[])n.status==="rejected"&&S(n.reason);return c().catch(S)})};let Ug,Vg;function Kz(){return Ug=$fetch(nb(`builds/meta/${jd().app.buildId}.json`),{responseType:"json"}),Ug.then(a=>{Vg=iz(a.matcher)}).catch(a=>{console.error("[nuxt] Error fetching app manifest.",a)}),Ug}function by(){return Ug||Kz()}async function ob(a){const c=typeof a=="string"?a:a.path;if(await by(),!Vg)return console.error("[nuxt] Error creating app manifest matcher.",Vg),{};try{return KA({},...Vg.matchAll(c).reverse())}catch(m){return console.error("[nuxt] Error matching route rules.",m),{}}}async function lE(a,c={}){if(!await sI(a))return null;const y=await Jz(a,c);return await nI(y)||null}const Yz="_payload.json";async function Jz(a,c={}){const m=new URL(a,"http://localhost");if(m.host!=="localhost"||Gu(m.pathname,{acceptRelative:!0}))throw new Error("Payload URL must not include hostname: "+a);const y=jd(),T=c.hash||(c.fresh?Date.now():y.app.buildId),S=y.app.cdnURL,M=S&&await sI(a)?S:y.app.baseURL;return rb(M,m.pathname,Yz+(T?`?${T}`:""))}async function nI(a){const c=fetch(a,{cache:"force-cache"}).then(m=>m.text().then(oI));try{return await c}catch(m){console.warn("[nuxt] Cannot load payload ",a,m)}return null}async function sI(a=sb().path){const c=qn();return a=hm(a),(await by()).prerendered.includes(a)?!0:c.runWithContext(async()=>{const y=await ob({path:a});return!!y.prerender&&!y.redirect})}let Pu=null;async function Qz(){var y;if(Pu)return Pu;const a=document.getElementById("__NUXT_DATA__");if(!a)return{};const c=await oI(a.textContent||""),m=a.dataset.src?await nI(a.dataset.src):void 0;return Pu={...c,...m,...window.__NUXT__},(y=Pu.config)!=null&&y.public&&(Pu.config.public=Tc(Pu.config.public)),Pu}async function oI(a){return await vz(a,qn()._payloadRevivers)}function eO(a,c){qn()._payloadRevivers[a]=c}const tO=[["NuxtError",a=>Vu(a)],["EmptyShallowRef",a=>sm(a==="_"?void 0:a==="0n"?BigInt(0):ey(a))],["EmptyRef",a=>Aa(a==="_"?void 0:a==="0n"?BigInt(0):ey(a))],["ShallowRef",a=>sm(a)],["ShallowReactive",a=>cl(a)],["Ref",a=>Aa(a)],["Reactive",a=>Tc(a)]],iO=Yo({name:"nuxt:revive-payload:client",order:-30,async setup(a){let c,m;for(const[y,T]of tO)eO(y,T);Object.assign(a.payload,([c,m]=Uu(()=>a.runWithContext(Qz)),c=await c,m(),c)),window.__NUXT__=a.payload}});async function ab(a,c={}){const m=c.document||a.resolvedOptions.document;if(!m||!a.dirty)return;const y={shouldRender:!0,tags:[]};if(await a.hooks.callHook("dom:beforeRender",y),!!y.shouldRender)return a._domUpdatePromise||(a._domUpdatePromise=new Promise(async T=>{var de;const S=new Map,M=new Promise(Te=>{a.resolveTags().then(pe=>{Te(pe.map(qe=>{const $e=S.get(qe._d)||0,ze={tag:qe,id:($e?`${qe._d}:${$e}`:qe._d)||iE(qe),shouldRender:!0};return qe._d&&tI(qe._d)&&S.set(qe._d,$e+1),ze}))})});let n=a._dom;if(!n){n={title:m.title,elMap:new Map().set("htmlAttrs",m.documentElement).set("bodyAttrs",m.body)};for(const Te of["body","head"]){const pe=(de=m[Te])==null?void 0:de.children;for(const qe of pe){const $e=qe.tagName.toLowerCase();if(!tE.has($e))continue;const ze=iI({tag:$e,props:{}},{innerHTML:qe.innerHTML,...qe.getAttributeNames().reduce((be,ke)=>(be[ke]=qe.getAttribute(ke),be),{})||{}});if(ze.key=qe.getAttribute("data-hid")||void 0,ze._d=bx(ze)||iE(ze),n.elMap.has(ze._d)){let be=1,ke=ze._d;for(;n.elMap.has(ke);)ke=`${ze._d}:${be++}`;n.elMap.set(ke,qe)}else n.elMap.set(ze._d,qe)}}}n.pendingSideEffects={...n.sideEffects},n.sideEffects={};function F(Te,pe,qe){const $e=`${Te}:${pe}`;n.sideEffects[$e]=qe,delete n.pendingSideEffects[$e]}function W({id:Te,$el:pe,tag:qe}){const $e=qe.tag.endsWith("Attrs");n.elMap.set(Te,pe),$e||(qe.textContent&&qe.textContent!==pe.textContent&&(pe.textContent=qe.textContent),qe.innerHTML&&qe.innerHTML!==pe.innerHTML&&(pe.innerHTML=qe.innerHTML),F(Te,"el",()=>{pe==null||pe.remove(),n.elMap.delete(Te)}));for(const ze in qe.props){if(!Object.prototype.hasOwnProperty.call(qe.props,ze))continue;const be=qe.props[ze];if(ze.startsWith("on")&&typeof be=="function"){const Ke=pe==null?void 0:pe.dataset;if(Ke&&Ke[`${ze}fired`]){const St=ze.slice(0,-5);be.call(pe,new Event(St.substring(2)))}pe.getAttribute(`data-${ze}`)!==""&&((qe.tag==="bodyAttrs"?m.defaultView:pe).addEventListener(ze.substring(2),be.bind(pe)),pe.setAttribute(`data-${ze}`,""));continue}const ke=`attr:${ze}`;if(ze==="class"){if(!be)continue;for(const Ke of be)$e&&F(Te,`${ke}:${Ke}`,()=>pe.classList.remove(Ke)),!pe.classList.contains(Ke)&&pe.classList.add(Ke)}else if(ze==="style"){if(!be)continue;for(const[Ke,St]of be)F(Te,`${ke}:${Ke}`,()=>{pe.style.removeProperty(Ke)}),pe.style.setProperty(Ke,St)}else be!==!1&&be!==null&&(pe.getAttribute(ze)!==be&&pe.setAttribute(ze,be===!0?"":String(be)),$e&&F(Te,ke,()=>pe.removeAttribute(ze)))}}const N=[],Y={bodyClose:void 0,bodyOpen:void 0,head:void 0},le=await M;for(const Te of le){const{tag:pe,shouldRender:qe,id:$e}=Te;if(qe){if(pe.tag==="title"){m.title=pe.textContent,F("title","",()=>m.title=n.title);continue}Te.$el=Te.$el||n.elMap.get($e),Te.$el?W(Te):tE.has(pe.tag)&&N.push(Te)}}for(const Te of N){const pe=Te.tag.tagPosition||"head";Te.$el=m.createElement(Te.tag.tag),W(Te),Y[pe]=Y[pe]||m.createDocumentFragment(),Y[pe].appendChild(Te.$el)}for(const Te of le)await a.hooks.callHook("dom:renderTag",Te,m,F);Y.head&&m.head.appendChild(Y.head),Y.bodyOpen&&m.body.insertBefore(Y.bodyOpen,m.body.firstChild),Y.bodyClose&&m.body.appendChild(Y.bodyClose);for(const Te in n.pendingSideEffects)n.pendingSideEffects[Te]();a._dom=n,await a.hooks.callHook("dom:rendered",{renders:le}),T()}).finally(()=>{a._domUpdatePromise=void 0,a.dirty=!1})),a._domUpdatePromise}function rO(a={}){var y,T,S;const c=((y=a.domOptions)==null?void 0:y.render)||ab;a.document=a.document||(typeof window<"u"?document:void 0);const m=((S=(T=a.document)==null?void 0:T.head.querySelector('script[id="unhead:payload"]'))==null?void 0:S.innerHTML)||!1;return zz({...a,plugins:[...a.plugins||[],{key:"client",hooks:{"entries:updated":c}}],init:[m?JSON.parse(m):!1,...a.init||[]]})}function nO(a,c){let m=0;return()=>{const y=++m;c(()=>{m===y&&a()})}}function sO(a={}){const c=rO({domOptions:{render:nO(()=>ab(c),m=>setTimeout(m,0))},...a});return c.install=Hz(c),c}const oO={disableDefaults:!0,disableCapoSorting:!1,plugins:[Nz,Uz,$z,Bz]},aO=Yo({name:"nuxt:head",enforce:"pre",setup(a){const c=sO(oO);a.vueApp.use(c);{let m=!0;const y=async()=>{m=!1,await ab(c)};c.hooks.hook("dom:beforeRender",T=>{T.shouldRender=!m}),a.hooks.hook("page:start",()=>{m=!0}),a.hooks.hook("page:finish",()=>{a.isHydrating||y()}),a.hooks.hook("app:error",y),a.hooks.hook("app:suspense:resolve",y)}}});/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const bd=typeof document<"u";function aI(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function lO(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&aI(a.default)}const nn=Object.assign;function U0(a,c){const m={};for(const y in c){const T=c[y];m[y]=Ko(T)?T.map(a):a(T)}return m}const Kp=()=>{},Ko=Array.isArray,lI=/#/g,cO=/&/g,uO=/\//g,hO=/=/g,dO=/\?/g,cI=/\+/g,fO=/%5B/g,pO=/%5D/g,uI=/%5E/g,mO=/%60/g,hI=/%7B/g,_O=/%7C/g,dI=/%7D/g,gO=/%20/g;function lb(a){return encodeURI(""+a).replace(_O,"|").replace(fO,"[").replace(pO,"]")}function yO(a){return lb(a).replace(hI,"{").replace(dI,"}").replace(uI,"^")}function Sx(a){return lb(a).replace(cI,"%2B").replace(gO,"+").replace(lI,"%23").replace(cO,"%26").replace(mO,"`").replace(hI,"{").replace(dI,"}").replace(uI,"^")}function vO(a){return Sx(a).replace(hO,"%3D")}function xO(a){return lb(a).replace(lI,"%23").replace(dO,"%3F")}function bO(a){return a==null?"":xO(a).replace(uO,"%2F")}function dm(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const wO=/\/$/,TO=a=>a.replace(wO,"");function V0(a,c,m="/"){let y,T={},S="",M="";const n=c.indexOf("#");let F=c.indexOf("?");return n<F&&n>=0&&(F=-1),F>-1&&(y=c.slice(0,F),S=c.slice(F+1,n>-1?n:c.length),T=a(S)),n>-1&&(y=y||c.slice(0,n),M=c.slice(n,c.length)),y=IO(y??c,m),{fullPath:y+(S&&"?")+S+M,path:y,query:T,hash:dm(M)}}function SO(a,c){const m=c.query?a(c.query):"";return c.path+(m&&"?")+m+(c.hash||"")}function cE(a,c){return!c||!a.toLowerCase().startsWith(c.toLowerCase())?a:a.slice(c.length)||"/"}function EO(a,c,m){const y=c.matched.length-1,T=m.matched.length-1;return y>-1&&y===T&&Fd(c.matched[y],m.matched[T])&&fI(c.params,m.params)&&a(c.query)===a(m.query)&&c.hash===m.hash}function Fd(a,c){return(a.aliasOf||a)===(c.aliasOf||c)}function fI(a,c){if(Object.keys(a).length!==Object.keys(c).length)return!1;for(const m in a)if(!AO(a[m],c[m]))return!1;return!0}function AO(a,c){return Ko(a)?uE(a,c):Ko(c)?uE(c,a):a===c}function uE(a,c){return Ko(c)?a.length===c.length&&a.every((m,y)=>m===c[y]):a.length===1&&a[0]===c}function IO(a,c){if(a.startsWith("/"))return a;if(!a)return c;const m=c.split("/"),y=a.split("/"),T=y[y.length-1];(T===".."||T===".")&&y.push("");let S=m.length-1,M,n;for(M=0;M<y.length;M++)if(n=y[M],n!==".")if(n==="..")S>1&&S--;else break;return m.slice(0,S).join("/")+"/"+y.slice(M).join("/")}const To={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var fm;(function(a){a.pop="pop",a.push="push"})(fm||(fm={}));var Yp;(function(a){a.back="back",a.forward="forward",a.unknown=""})(Yp||(Yp={}));function CO(a){if(!a)if(bd){const c=document.querySelector("base");a=c&&c.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),TO(a)}const PO=/^[^#]+#/;function MO(a,c){return a.replace(PO,"#")+c}function RO(a,c){const m=document.documentElement.getBoundingClientRect(),y=a.getBoundingClientRect();return{behavior:c.behavior,left:y.left-m.left-(c.left||0),top:y.top-m.top-(c.top||0)}}const wy=()=>({left:window.scrollX,top:window.scrollY});function DO(a){let c;if("el"in a){const m=a.el,y=typeof m=="string"&&m.startsWith("#"),T=typeof m=="string"?y?document.getElementById(m.slice(1)):document.querySelector(m):m;if(!T)return;c=RO(T,a)}else c=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(c):window.scrollTo(c.left!=null?c.left:window.scrollX,c.top!=null?c.top:window.scrollY)}function hE(a,c){return(history.state?history.state.position-c:-1)+a}const Ex=new Map;function kO(a,c){Ex.set(a,c)}function LO(a){const c=Ex.get(a);return Ex.delete(a),c}let zO=()=>location.protocol+"//"+location.host;function pI(a,c){const{pathname:m,search:y,hash:T}=c,S=a.indexOf("#");if(S>-1){let n=T.includes(a.slice(S))?a.slice(S).length:1,F=T.slice(n);return F[0]!=="/"&&(F="/"+F),cE(F,"")}return cE(m,a)+y+T}function OO(a,c,m,y){let T=[],S=[],M=null;const n=({state:le})=>{const de=pI(a,location),Te=m.value,pe=c.value;let qe=0;if(le){if(m.value=de,c.value=le,M&&M===Te){M=null;return}qe=pe?le.position-pe.position:0}else y(de);T.forEach($e=>{$e(m.value,Te,{delta:qe,type:fm.pop,direction:qe?qe>0?Yp.forward:Yp.back:Yp.unknown})})};function F(){M=m.value}function W(le){T.push(le);const de=()=>{const Te=T.indexOf(le);Te>-1&&T.splice(Te,1)};return S.push(de),de}function N(){const{history:le}=window;le.state&&le.replaceState(nn({},le.state,{scroll:wy()}),"")}function Y(){for(const le of S)le();S=[],window.removeEventListener("popstate",n),window.removeEventListener("beforeunload",N)}return window.addEventListener("popstate",n),window.addEventListener("beforeunload",N,{passive:!0}),{pauseListeners:F,listen:W,destroy:Y}}function dE(a,c,m,y=!1,T=!1){return{back:a,current:c,forward:m,replaced:y,position:window.history.length,scroll:T?wy():null}}function FO(a){const{history:c,location:m}=window,y={value:pI(a,m)},T={value:c.state};T.value||S(y.value,{back:null,current:y.value,forward:null,position:c.length-1,replaced:!0,scroll:null},!0);function S(F,W,N){const Y=a.indexOf("#"),le=Y>-1?(m.host&&document.querySelector("base")?a:a.slice(Y))+F:zO()+a+F;try{c[N?"replaceState":"pushState"](W,"",le),T.value=W}catch(de){console.error(de),m[N?"replace":"assign"](le)}}function M(F,W){const N=nn({},c.state,dE(T.value.back,F,T.value.forward,!0),W,{position:T.value.position});S(F,N,!0),y.value=F}function n(F,W){const N=nn({},T.value,c.state,{forward:F,scroll:wy()});S(N.current,N,!0);const Y=nn({},dE(y.value,F,null),{position:N.position+1},W);S(F,Y,!1),y.value=F}return{location:y,state:T,push:n,replace:M}}function BO(a){a=CO(a);const c=FO(a),m=OO(a,c.state,c.location,c.replace);function y(S,M=!0){M||m.pauseListeners(),history.go(S)}const T=nn({location:"",base:a,go:y,createHref:MO.bind(null,a)},c,m);return Object.defineProperty(T,"location",{enumerable:!0,get:()=>c.location.value}),Object.defineProperty(T,"state",{enumerable:!0,get:()=>c.state.value}),T}function NO(a){return typeof a=="string"||a&&typeof a=="object"}function mI(a){return typeof a=="string"||typeof a=="symbol"}const _I=Symbol("");var fE;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(fE||(fE={}));function Bd(a,c){return nn(new Error,{type:a,[_I]:!0},c)}function nl(a,c){return a instanceof Error&&_I in a&&(c==null||!!(a.type&c))}const pE="[^/]+?",UO={sensitive:!1,strict:!1,start:!0,end:!0},VO=/[.+*?^${}()[\]/\\]/g;function jO(a,c){const m=nn({},UO,c),y=[];let T=m.start?"^":"";const S=[];for(const W of a){const N=W.length?[]:[90];m.strict&&!W.length&&(T+="/");for(let Y=0;Y<W.length;Y++){const le=W[Y];let de=40+(m.sensitive?.25:0);if(le.type===0)Y||(T+="/"),T+=le.value.replace(VO,"\\$&"),de+=40;else if(le.type===1){const{value:Te,repeatable:pe,optional:qe,regexp:$e}=le;S.push({name:Te,repeatable:pe,optional:qe});const ze=$e||pE;if(ze!==pE){de+=10;try{new RegExp(`(${ze})`)}catch(ke){throw new Error(`Invalid custom RegExp for param "${Te}" (${ze}): `+ke.message)}}let be=pe?`((?:${ze})(?:/(?:${ze}))*)`:`(${ze})`;Y||(be=qe&&W.length<2?`(?:/${be})`:"/"+be),qe&&(be+="?"),T+=be,de+=20,qe&&(de+=-8),pe&&(de+=-20),ze===".*"&&(de+=-50)}N.push(de)}y.push(N)}if(m.strict&&m.end){const W=y.length-1;y[W][y[W].length-1]+=.7000000000000001}m.strict||(T+="/?"),m.end?T+="$":m.strict&&!T.endsWith("/")&&(T+="(?:/|$)");const M=new RegExp(T,m.sensitive?"":"i");function n(W){const N=W.match(M),Y={};if(!N)return null;for(let le=1;le<N.length;le++){const de=N[le]||"",Te=S[le-1];Y[Te.name]=de&&Te.repeatable?de.split("/"):de}return Y}function F(W){let N="",Y=!1;for(const le of a){(!Y||!N.endsWith("/"))&&(N+="/"),Y=!1;for(const de of le)if(de.type===0)N+=de.value;else if(de.type===1){const{value:Te,repeatable:pe,optional:qe}=de,$e=Te in W?W[Te]:"";if(Ko($e)&&!pe)throw new Error(`Provided param "${Te}" is an array but it is not repeatable (* or + modifiers)`);const ze=Ko($e)?$e.join("/"):$e;if(!ze)if(qe)le.length<2&&(N.endsWith("/")?N=N.slice(0,-1):Y=!0);else throw new Error(`Missing required param "${Te}"`);N+=ze}}return N||"/"}return{re:M,score:y,keys:S,parse:n,stringify:F}}function $O(a,c){let m=0;for(;m<a.length&&m<c.length;){const y=c[m]-a[m];if(y)return y;m++}return a.length<c.length?a.length===1&&a[0]===80?-1:1:a.length>c.length?c.length===1&&c[0]===80?1:-1:0}function gI(a,c){let m=0;const y=a.score,T=c.score;for(;m<y.length&&m<T.length;){const S=$O(y[m],T[m]);if(S)return S;m++}if(Math.abs(T.length-y.length)===1){if(mE(y))return 1;if(mE(T))return-1}return T.length-y.length}function mE(a){const c=a[a.length-1];return a.length>0&&c[c.length-1]<0}const GO={type:0,value:""},HO=/[a-zA-Z0-9_]/;function qO(a){if(!a)return[[]];if(a==="/")return[[GO]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function c(de){throw new Error(`ERR (${m})/"${W}": ${de}`)}let m=0,y=m;const T=[];let S;function M(){S&&T.push(S),S=[]}let n=0,F,W="",N="";function Y(){W&&(m===0?S.push({type:0,value:W}):m===1||m===2||m===3?(S.length>1&&(F==="*"||F==="+")&&c(`A repeatable param (${W}) must be alone in its segment. eg: '/:ids+.`),S.push({type:1,value:W,regexp:N,repeatable:F==="*"||F==="+",optional:F==="*"||F==="?"})):c("Invalid state to consume buffer"),W="")}function le(){W+=F}for(;n<a.length;){if(F=a[n++],F==="\\"&&m!==2){y=m,m=4;continue}switch(m){case 0:F==="/"?(W&&Y(),M()):F===":"?(Y(),m=1):le();break;case 4:le(),m=y;break;case 1:F==="("?m=2:HO.test(F)?le():(Y(),m=0,F!=="*"&&F!=="?"&&F!=="+"&&n--);break;case 2:F===")"?N[N.length-1]=="\\"?N=N.slice(0,-1)+F:m=3:N+=F;break;case 3:Y(),m=0,F!=="*"&&F!=="?"&&F!=="+"&&n--,N="";break;default:c("Unknown state");break}}return m===2&&c(`Unfinished custom RegExp for param "${W}"`),Y(),M(),T}function WO(a,c,m){const y=jO(qO(a.path),m),T=nn(y,{record:a,parent:c,children:[],alias:[]});return c&&!T.record.aliasOf==!c.record.aliasOf&&c.children.push(T),T}function ZO(a,c){const m=[],y=new Map;c=vE({strict:!1,end:!0,sensitive:!1},c);function T(Y){return y.get(Y)}function S(Y,le,de){const Te=!de,pe=gE(Y);pe.aliasOf=de&&de.record;const qe=vE(c,Y),$e=[pe];if("alias"in Y){const ke=typeof Y.alias=="string"?[Y.alias]:Y.alias;for(const Ke of ke)$e.push(gE(nn({},pe,{components:de?de.record.components:pe.components,path:Ke,aliasOf:de?de.record:pe})))}let ze,be;for(const ke of $e){const{path:Ke}=ke;if(le&&Ke[0]!=="/"){const St=le.record.path,kt=St[St.length-1]==="/"?"":"/";ke.path=le.record.path+(Ke&&kt+Ke)}if(ze=WO(ke,le,qe),de?de.alias.push(ze):(be=be||ze,be!==ze&&be.alias.push(ze),Te&&Y.name&&!yE(ze)&&M(Y.name)),yI(ze)&&F(ze),pe.children){const St=pe.children;for(let kt=0;kt<St.length;kt++)S(St[kt],ze,de&&de.children[kt])}de=de||ze}return be?()=>{M(be)}:Kp}function M(Y){if(mI(Y)){const le=y.get(Y);le&&(y.delete(Y),m.splice(m.indexOf(le),1),le.children.forEach(M),le.alias.forEach(M))}else{const le=m.indexOf(Y);le>-1&&(m.splice(le,1),Y.record.name&&y.delete(Y.record.name),Y.children.forEach(M),Y.alias.forEach(M))}}function n(){return m}function F(Y){const le=YO(Y,m);m.splice(le,0,Y),Y.record.name&&!yE(Y)&&y.set(Y.record.name,Y)}function W(Y,le){let de,Te={},pe,qe;if("name"in Y&&Y.name){if(de=y.get(Y.name),!de)throw Bd(1,{location:Y});qe=de.record.name,Te=nn(_E(le.params,de.keys.filter(be=>!be.optional).concat(de.parent?de.parent.keys.filter(be=>be.optional):[]).map(be=>be.name)),Y.params&&_E(Y.params,de.keys.map(be=>be.name))),pe=de.stringify(Te)}else if(Y.path!=null)pe=Y.path,de=m.find(be=>be.re.test(pe)),de&&(Te=de.parse(pe),qe=de.record.name);else{if(de=le.name?y.get(le.name):m.find(be=>be.re.test(le.path)),!de)throw Bd(1,{location:Y,currentLocation:le});qe=de.record.name,Te=nn({},le.params,Y.params),pe=de.stringify(Te)}const $e=[];let ze=de;for(;ze;)$e.unshift(ze.record),ze=ze.parent;return{name:qe,path:pe,params:Te,matched:$e,meta:KO($e)}}a.forEach(Y=>S(Y));function N(){m.length=0,y.clear()}return{addRoute:S,resolve:W,removeRoute:M,clearRoutes:N,getRoutes:n,getRecordMatcher:T}}function _E(a,c){const m={};for(const y of c)y in a&&(m[y]=a[y]);return m}function gE(a){const c={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:XO(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(c,"mods",{value:{}}),c}function XO(a){const c={},m=a.props||!1;if("component"in a)c.default=m;else for(const y in a.components)c[y]=typeof m=="object"?m[y]:m;return c}function yE(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function KO(a){return a.reduce((c,m)=>nn(c,m.meta),{})}function vE(a,c){const m={};for(const y in a)m[y]=y in c?c[y]:a[y];return m}function YO(a,c){let m=0,y=c.length;for(;m!==y;){const S=m+y>>1;gI(a,c[S])<0?y=S:m=S+1}const T=JO(a);return T&&(y=c.lastIndexOf(T,y-1)),y}function JO(a){let c=a;for(;c=c.parent;)if(yI(c)&&gI(a,c)===0)return c}function yI({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function QO(a){const c={};if(a===""||a==="?")return c;const y=(a[0]==="?"?a.slice(1):a).split("&");for(let T=0;T<y.length;++T){const S=y[T].replace(cI," "),M=S.indexOf("="),n=dm(M<0?S:S.slice(0,M)),F=M<0?null:dm(S.slice(M+1));if(n in c){let W=c[n];Ko(W)||(W=c[n]=[W]),W.push(F)}else c[n]=F}return c}function xE(a){let c="";for(let m in a){const y=a[m];if(m=vO(m),y==null){y!==void 0&&(c+=(c.length?"&":"")+m);continue}(Ko(y)?y.map(S=>S&&Sx(S)):[y&&Sx(y)]).forEach(S=>{S!==void 0&&(c+=(c.length?"&":"")+m,S!=null&&(c+="="+S))})}return c}function eF(a){const c={};for(const m in a){const y=a[m];y!==void 0&&(c[m]=Ko(y)?y.map(T=>T==null?null:""+T):y==null?y:""+y)}return c}const tF=Symbol(""),bE=Symbol(""),Ty=Symbol(""),cb=Symbol(""),Ax=Symbol("");function Bp(){let a=[];function c(y){return a.push(y),()=>{const T=a.indexOf(y);T>-1&&a.splice(T,1)}}function m(){a=[]}return{add:c,list:()=>a.slice(),reset:m}}function dc(a,c,m,y,T,S=M=>M()){const M=y&&(y.enterCallbacks[T]=y.enterCallbacks[T]||[]);return()=>new Promise((n,F)=>{const W=le=>{le===!1?F(Bd(4,{from:m,to:c})):le instanceof Error?F(le):NO(le)?F(Bd(2,{from:c,to:le})):(M&&y.enterCallbacks[T]===M&&typeof le=="function"&&M.push(le),n())},N=S(()=>a.call(y&&y.instances[T],c,m,W));let Y=Promise.resolve(N);a.length<3&&(Y=Y.then(W)),Y.catch(le=>F(le))})}function j0(a,c,m,y,T=S=>S()){const S=[];for(const M of a)for(const n in M.components){let F=M.components[n];if(!(c!=="beforeRouteEnter"&&!M.instances[n]))if(aI(F)){const N=(F.__vccOpts||F)[c];N&&S.push(dc(N,m,y,M,n,T))}else{let W=F();S.push(()=>W.then(N=>{if(!N)throw new Error(`Couldn't resolve component "${n}" at "${M.path}"`);const Y=lO(N)?N.default:N;M.mods[n]=N,M.components[n]=Y;const de=(Y.__vccOpts||Y)[c];return de&&dc(de,m,y,M,n,T)()}))}}return S}function wE(a){const c=Ms(Ty),m=Ms(cb),y=Eo(()=>{const F=wn(a.to);return c.resolve(F)}),T=Eo(()=>{const{matched:F}=y.value,{length:W}=F,N=F[W-1],Y=m.matched;if(!N||!Y.length)return-1;const le=Y.findIndex(Fd.bind(null,N));if(le>-1)return le;const de=TE(F[W-2]);return W>1&&TE(N)===de&&Y[Y.length-1].path!==de?Y.findIndex(Fd.bind(null,F[W-2])):le}),S=Eo(()=>T.value>-1&&oF(m.params,y.value.params)),M=Eo(()=>T.value>-1&&T.value===m.matched.length-1&&fI(m.params,y.value.params));function n(F={}){if(sF(F)){const W=c[wn(a.replace)?"replace":"push"](wn(a.to)).catch(Kp);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>W),W}return Promise.resolve()}return{route:y,href:Eo(()=>y.value.href),isActive:S,isExactActive:M,navigate:n}}function iF(a){return a.length===1?a[0]:a}const rF=Sc({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:wE,setup(a,{slots:c}){const m=Tc(wE(a)),{options:y}=Ms(Ty),T=Eo(()=>({[SE(a.activeClass,y.linkActiveClass,"router-link-active")]:m.isActive,[SE(a.exactActiveClass,y.linkExactActiveClass,"router-link-exact-active")]:m.isExactActive}));return()=>{const S=c.default&&iF(c.default(m));return a.custom?S:Ps("a",{"aria-current":m.isExactActive?a.ariaCurrentValue:null,href:m.href,onClick:m.navigate,class:T.value},S)}}}),nF=rF;function sF(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const c=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(c))return}return a.preventDefault&&a.preventDefault(),!0}}function oF(a,c){for(const m in c){const y=c[m],T=a[m];if(typeof y=="string"){if(y!==T)return!1}else if(!Ko(T)||T.length!==y.length||y.some((S,M)=>S!==T[M]))return!1}return!0}function TE(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const SE=(a,c,m)=>a??c??m,aF=Sc({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:c,slots:m}){const y=Ms(Ax),T=Eo(()=>a.route||y.value),S=Ms(bE,0),M=Eo(()=>{let W=wn(S);const{matched:N}=T.value;let Y;for(;(Y=N[W])&&!Y.components;)W++;return W}),n=Eo(()=>T.value.matched[M.value]);Bu(bE,Eo(()=>M.value+1)),Bu(tF,n),Bu(Ax,T);const F=Aa();return Pd(()=>[F.value,n.value,a.name],([W,N,Y],[le,de,Te])=>{N&&(N.instances[Y]=W,de&&de!==N&&W&&W===le&&(N.leaveGuards.size||(N.leaveGuards=de.leaveGuards),N.updateGuards.size||(N.updateGuards=de.updateGuards))),W&&N&&(!de||!Fd(N,de)||!le)&&(N.enterCallbacks[Y]||[]).forEach(pe=>pe(W))},{flush:"post"}),()=>{const W=T.value,N=a.name,Y=n.value,le=Y&&Y.components[N];if(!le)return EE(m.default,{Component:le,route:W});const de=Y.props[N],Te=de?de===!0?W.params:typeof de=="function"?de(W):de:null,qe=Ps(le,nn({},Te,c,{onVnodeUnmounted:$e=>{$e.component.isUnmounted&&(Y.instances[N]=null)},ref:F}));return EE(m.default,{Component:qe,route:W})||qe}}});function EE(a,c){if(!a)return null;const m=a(c);return m.length===1?m[0]:m}const vI=aF;function lF(a){const c=ZO(a.routes,a),m=a.parseQuery||QO,y=a.stringifyQuery||xE,T=a.history,S=Bp(),M=Bp(),n=Bp(),F=sm(To);let W=To;bd&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const N=U0.bind(null,_t=>""+_t),Y=U0.bind(null,bO),le=U0.bind(null,dm);function de(_t,fi){let $t,Ei;return mI(_t)?($t=c.getRecordMatcher(_t),Ei=fi):Ei=_t,c.addRoute(Ei,$t)}function Te(_t){const fi=c.getRecordMatcher(_t);fi&&c.removeRoute(fi)}function pe(){return c.getRoutes().map(_t=>_t.record)}function qe(_t){return!!c.getRecordMatcher(_t)}function $e(_t,fi){if(fi=nn({},fi||F.value),typeof _t=="string"){const Le=V0(m,_t,fi.path),ht=c.resolve({path:Le.path},fi),Pt=T.createHref(Le.fullPath);return nn(Le,ht,{params:le(ht.params),hash:dm(Le.hash),redirectedFrom:void 0,href:Pt})}let $t;if(_t.path!=null)$t=nn({},_t,{path:V0(m,_t.path,fi.path).path});else{const Le=nn({},_t.params);for(const ht in Le)Le[ht]==null&&delete Le[ht];$t=nn({},_t,{params:Y(Le)}),fi.params=Y(fi.params)}const Ei=c.resolve($t,fi),yr=_t.hash||"";Ei.params=N(le(Ei.params));const Sr=SO(y,nn({},_t,{hash:yO(yr),path:Ei.path})),we=T.createHref(Sr);return nn({fullPath:Sr,hash:yr,query:y===xE?eF(_t.query):_t.query||{}},Ei,{redirectedFrom:void 0,href:we})}function ze(_t){return typeof _t=="string"?V0(m,_t,F.value.path):nn({},_t)}function be(_t,fi){if(W!==_t)return Bd(8,{from:fi,to:_t})}function ke(_t){return kt(_t)}function Ke(_t){return ke(nn(ze(_t),{replace:!0}))}function St(_t){const fi=_t.matched[_t.matched.length-1];if(fi&&fi.redirect){const{redirect:$t}=fi;let Ei=typeof $t=="function"?$t(_t):$t;return typeof Ei=="string"&&(Ei=Ei.includes("?")||Ei.includes("#")?Ei=ze(Ei):{path:Ei},Ei.params={}),nn({query:_t.query,hash:_t.hash,params:Ei.path!=null?{}:_t.params},Ei)}}function kt(_t,fi){const $t=W=$e(_t),Ei=F.value,yr=_t.state,Sr=_t.force,we=_t.replace===!0,Le=St($t);if(Le)return kt(nn(ze(Le),{state:typeof Le=="object"?nn({},yr,Le.state):yr,force:Sr,replace:we}),fi||$t);const ht=$t;ht.redirectedFrom=fi;let Pt;return!Sr&&EO(y,Ei,$t)&&(Pt=Bd(16,{to:ht,from:Ei}),vn(Ei,Ei,!0,!1)),(Pt?Promise.resolve(Pt):Zt(ht,Ei)).catch(Tt=>nl(Tt)?nl(Tt,2)?Tt:Yi(Tt):mi(Tt,ht,Ei)).then(Tt=>{if(Tt){if(nl(Tt,2))return kt(nn({replace:we},ze(Tt.to),{state:typeof Tt.to=="object"?nn({},yr,Tt.to.state):yr,force:Sr}),fi||ht)}else Tt=qt(ht,Ei,!0,we,yr);return ni(ht,Ei,Tt),Tt})}function hi(_t,fi){const $t=be(_t,fi);return $t?Promise.reject($t):Promise.resolve()}function Wt(_t){const fi=ys.values().next().value;return fi&&typeof fi.runWithContext=="function"?fi.runWithContext(_t):_t()}function Zt(_t,fi){let $t;const[Ei,yr,Sr]=cF(_t,fi);$t=j0(Ei.reverse(),"beforeRouteLeave",_t,fi);for(const Le of Ei)Le.leaveGuards.forEach(ht=>{$t.push(dc(ht,_t,fi))});const we=hi.bind(null,_t,fi);return $t.push(we),tr($t).then(()=>{$t=[];for(const Le of S.list())$t.push(dc(Le,_t,fi));return $t.push(we),tr($t)}).then(()=>{$t=j0(yr,"beforeRouteUpdate",_t,fi);for(const Le of yr)Le.updateGuards.forEach(ht=>{$t.push(dc(ht,_t,fi))});return $t.push(we),tr($t)}).then(()=>{$t=[];for(const Le of Sr)if(Le.beforeEnter)if(Ko(Le.beforeEnter))for(const ht of Le.beforeEnter)$t.push(dc(ht,_t,fi));else $t.push(dc(Le.beforeEnter,_t,fi));return $t.push(we),tr($t)}).then(()=>(_t.matched.forEach(Le=>Le.enterCallbacks={}),$t=j0(Sr,"beforeRouteEnter",_t,fi,Wt),$t.push(we),tr($t))).then(()=>{$t=[];for(const Le of M.list())$t.push(dc(Le,_t,fi));return $t.push(we),tr($t)}).catch(Le=>nl(Le,8)?Le:Promise.reject(Le))}function ni(_t,fi,$t){n.list().forEach(Ei=>Wt(()=>Ei(_t,fi,$t)))}function qt(_t,fi,$t,Ei,yr){const Sr=be(_t,fi);if(Sr)return Sr;const we=fi===To,Le=bd?history.state:{};$t&&(Ei||we?T.replace(_t.fullPath,nn({scroll:we&&Le&&Le.scroll},yr)):T.push(_t.fullPath,yr)),F.value=_t,vn(_t,fi,$t,we),Yi()}let di;function vi(){di||(di=T.listen((_t,fi,$t)=>{if(!gr.listening)return;const Ei=$e(_t),yr=St(Ei);if(yr){kt(nn(yr,{replace:!0,force:!0}),Ei).catch(Kp);return}W=Ei;const Sr=F.value;bd&&kO(hE(Sr.fullPath,$t.delta),wy()),Zt(Ei,Sr).catch(we=>nl(we,12)?we:nl(we,2)?(kt(nn(ze(we.to),{force:!0}),Ei).then(Le=>{nl(Le,20)&&!$t.delta&&$t.type===fm.pop&&T.go(-1,!1)}).catch(Kp),Promise.reject()):($t.delta&&T.go(-$t.delta,!1),mi(we,Ei,Sr))).then(we=>{we=we||qt(Ei,Sr,!1),we&&($t.delta&&!nl(we,8)?T.go(-$t.delta,!1):$t.type===fm.pop&&nl(we,20)&&T.go(-1,!1)),ni(Ei,Sr,we)}).catch(Kp)}))}let Ni=Bp(),si=Bp(),Ui;function mi(_t,fi,$t){Yi(_t);const Ei=si.list();return Ei.length?Ei.forEach(yr=>yr(_t,fi,$t)):console.error(_t),Promise.reject(_t)}function Yr(){return Ui&&F.value!==To?Promise.resolve():new Promise((_t,fi)=>{Ni.add([_t,fi])})}function Yi(_t){return Ui||(Ui=!_t,vi(),Ni.list().forEach(([fi,$t])=>_t?$t(_t):fi()),Ni.reset()),_t}function vn(_t,fi,$t,Ei){const{scrollBehavior:yr}=a;if(!bd||!yr)return Promise.resolve();const Sr=!$t&&LO(hE(_t.fullPath,0))||(Ei||!$t)&&history.state&&history.state.scroll||null;return ju().then(()=>yr(_t,fi,Sr)).then(we=>we&&DO(we)).catch(we=>mi(we,_t,fi))}const In=_t=>T.go(_t);let Rs;const ys=new Set,gr={currentRoute:F,listening:!0,addRoute:de,removeRoute:Te,clearRoutes:c.clearRoutes,hasRoute:qe,getRoutes:pe,resolve:$e,options:a,push:ke,replace:Ke,go:In,back:()=>In(-1),forward:()=>In(1),beforeEach:S.add,beforeResolve:M.add,afterEach:n.add,onError:si.add,isReady:Yr,install(_t){const fi=this;_t.component("RouterLink",nF),_t.component("RouterView",vI),_t.config.globalProperties.$router=fi,Object.defineProperty(_t.config.globalProperties,"$route",{enumerable:!0,get:()=>wn(F)}),bd&&!Rs&&F.value===To&&(Rs=!0,ke(T.location).catch(yr=>{}));const $t={};for(const yr in To)Object.defineProperty($t,yr,{get:()=>F.value[yr],enumerable:!0});_t.provide(Ty,fi),_t.provide(cb,cl($t)),_t.provide(Ax,F);const Ei=_t.unmount;ys.add(_t),_t.unmount=function(){ys.delete(_t),ys.size<1&&(W=To,di&&di(),di=null,F.value=To,Rs=!1,Ui=!1),Ei()}}};function tr(_t){return _t.reduce((fi,$t)=>fi.then(()=>Wt($t)),Promise.resolve())}return gr}function cF(a,c){const m=[],y=[],T=[],S=Math.max(c.matched.length,a.matched.length);for(let M=0;M<S;M++){const n=c.matched[M];n&&(a.matched.find(W=>Fd(W,n))?y.push(n):m.push(n));const F=a.matched[M];F&&(c.matched.find(W=>Fd(W,F))||T.push(F))}return[m,y,T]}function VN(){return Ms(Ty)}function uF(a){return Ms(cb)}const hF=/(:\w+)\([^)]+\)/g,dF=/(:\w+)[?+*]/g,fF=/:\w+/g,pF=(a,c)=>c.path.replace(hF,"$1").replace(dF,"$1").replace(fF,m=>{var y;return((y=a.params[m.slice(1)])==null?void 0:y.toString())||""}),Ix=(a,c)=>{const m=a.route.matched.find(T=>{var S;return((S=T.components)==null?void 0:S.default)===a.Component.type}),y=c??(m==null?void 0:m.meta.key)??(m&&pF(a.route,m));return typeof y=="function"?y(a.route):y},mF=(a,c)=>({default:()=>a?Ps(uD,a===!0?{}:a,c):c});function ub(a){return Array.isArray(a)?a:[a]}const _F={layout:"default"},gF={layout:"default"},yF={layout:"default"},$0=[{name:"about",path:"/about",meta:_F||{},component:()=>Fs(()=>import("./qX4yzrMJ.js"),[],import.meta.url)},{name:"index",path:"/",meta:gF||{},component:()=>Fs(()=>import("./Cr9T9vnx.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)},{name:"trips",path:"/trips",meta:yF||{},component:()=>Fs(()=>import("./dkBrcp1I.js"),__vite__mapDeps([6,4,7]),import.meta.url),children:[{name:"trips-id",path:":id()",component:()=>Fs(()=>import("./CcvJkp3n.js"),__vite__mapDeps([8,4,9]),import.meta.url)}]},{name:"reports",path:"/reports",component:()=>Fs(()=>import("./DXz-Cb5v.js"),__vite__mapDeps([10,3,4,11]),import.meta.url)},{name:"settings",path:"/settings",component:()=>Fs(()=>import("./-5dIiHNc.js"),__vite__mapDeps([12,1,3,4,13]),import.meta.url)}],xI=(a,c)=>({default:()=>{var m;return a?Ps(fk,a===!0?{}:a,c):(m=c.default)==null?void 0:m.call(c)}}),vF=/(:\w+)\([^)]+\)/g,xF=/(:\w+)[?+*]/g,bF=/:\w+/g;function AE(a){const c=(a==null?void 0:a.meta.key)??a.path.replace(vF,"$1").replace(xF,"$1").replace(bF,m=>{var y;return((y=a.params[m.slice(1)])==null?void 0:y.toString())||""});return typeof c=="function"?c(a):c}function wF(a,c){return a===c||c===To?!1:AE(a)!==AE(c)?!0:!a.matched.every((y,T)=>{var S,M;return y.components&&y.components.default===((M=(S=c.matched[T])==null?void 0:S.components)==null?void 0:M.default)})}const TF={scrollBehavior(a,c,m){var F;const y=qn(),T=((F=Co().options)==null?void 0:F.scrollBehaviorType)??"auto";if(a.path===c.path)return c.hash&&!a.hash?{left:0,top:0}:a.hash?{el:a.hash,top:bI(a.hash),behavior:T}:!1;if((typeof a.meta.scrollToTop=="function"?a.meta.scrollToTop(a,c):a.meta.scrollToTop)===!1)return!1;let M=m||void 0;!M&&wF(a,c)&&(M={left:0,top:0});const n=y._runningTransition?"page:transition:finish":"page:loading:end";return new Promise(W=>{if(c===To){W(IE(a,"instant",M));return}y.hooks.hookOnce(n,()=>{requestAnimationFrame(()=>W(IE(a,"instant",M)))})})}};function bI(a){try{const c=document.querySelector(a);if(c)return(Number.parseFloat(getComputedStyle(c).scrollMarginTop)||0)+(Number.parseFloat(getComputedStyle(document.documentElement).scrollPaddingTop)||0)}catch{}return 0}function IE(a,c,m){return m||(a.hash?{el:a.hash,top:bI(a.hash),behavior:c}:{left:0,top:0,behavior:c})}const SF={hashMode:!1,scrollBehaviorType:"auto"},xa={...SF,...TF},EF=async(a,c)=>{var M;let m,y;if(!((M=a.meta)!=null&&M.validate))return;const T=([m,y]=Uu(()=>Promise.resolve(a.meta.validate(a))),m=await m,y(),m);if(T===!0)return;const S=Vu({fatal:!0,statusCode:T&&T.statusCode||404,statusMessage:T&&T.statusMessage||`Page Not Found: ${a.fullPath}`,data:{path:a.fullPath}});return typeof window<"u"&&window.history.pushState({},"",c.fullPath),S},AF=async a=>{let c,m;const y=([c,m]=Uu(()=>ob({path:a.path})),c=await c,m(),c);if(y.redirect)return Gu(y.redirect,{acceptRelative:!0})?(window.location.href=y.redirect,!1):y.redirect},IF=[EF,AF],Jp={};function CF(a,c,m){const{pathname:y,search:T,hash:S}=c,M=a.indexOf("#");if(M>-1){const W=S.includes(a.slice(M))?a.slice(M).length:1;let N=S.slice(W);return N[0]!=="/"&&(N="/"+N),HS(N,"")}const n=HS(y,a),F=!m||pL(n,m)?n:m;return F+(F.includes("?")?"":T)+S}const PF=Yo({name:"nuxt:router",enforce:"pre",async setup(a){var qe;let c,m,y=jd().app.baseURL;const T=((qe=xa.history)==null?void 0:qe.call(xa,y))??BO(y),S=xa.routes?([c,m]=Uu(()=>xa.routes($0)),c=await c,m(),c??$0):$0;let M;const n=lF({...xa,scrollBehavior:($e,ze,be)=>{if(ze===To){M=be;return}if(xa.scrollBehavior){if(n.options.scrollBehavior=xa.scrollBehavior,"scrollRestoration"in window.history){const ke=n.beforeEach(()=>{ke(),window.history.scrollRestoration="manual"})}return xa.scrollBehavior($e,To,M||be)}},history:T,routes:S});"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto"),a.vueApp.use(n);const F=sm(n.currentRoute.value);n.afterEach(($e,ze)=>{F.value=ze}),Object.defineProperty(a.vueApp.config.globalProperties,"previousRoute",{get:()=>F.value});const W=CF(y,window.location,a.payload.path),N=sm(n.currentRoute.value),Y=()=>{N.value=n.currentRoute.value};a.hook("page:finish",Y),n.afterEach(($e,ze)=>{var be,ke,Ke,St;((ke=(be=$e.matched[0])==null?void 0:be.components)==null?void 0:ke.default)===((St=(Ke=ze.matched[0])==null?void 0:Ke.components)==null?void 0:St.default)&&Y()});const le={};for(const $e in N.value)Object.defineProperty(le,$e,{get:()=>N.value[$e],enumerable:!0});a._route=cl(le),a._middleware||(a._middleware={global:[],named:{}});const de=xy();n.afterEach(async($e,ze,be)=>{delete a._processingMiddleware,!a.isHydrating&&de.value&&await a.runWithContext(uz),be&&await a.callHook("page:loading:end")});try{[c,m]=Uu(()=>n.isReady()),await c,m()}catch($e){[c,m]=Uu(()=>a.runWithContext(()=>Du($e))),await c,m()}const Te=W!==n.currentRoute.value.fullPath?n.resolve(W):n.currentRoute.value;Y();const pe=a.payload.state._layout;return n.beforeEach(async($e,ze)=>{var be;await a.callHook("page:loading:start"),$e.meta=Tc($e.meta),a.isHydrating&&pe&&!vc($e.meta.layout)&&($e.meta.layout=pe),a._processingMiddleware=!0;{const ke=new Set([...IF,...a._middleware.global]);for(const Ke of $e.matched){const St=Ke.meta.middleware;if(St)for(const kt of ub(St))ke.add(kt)}{const Ke=await a.runWithContext(()=>ob({path:$e.path}));if(Ke.appMiddleware)for(const St in Ke.appMiddleware)Ke.appMiddleware[St]?ke.add(St):ke.delete(St)}for(const Ke of ke){const St=typeof Ke=="string"?a._middleware.named[Ke]||await((be=Jp[Ke])==null?void 0:be.call(Jp).then(kt=>kt.default||kt)):Ke;if(!St)throw new Error(`Unknown route middleware: '${Ke}'.`);try{const kt=await a.runWithContext(()=>St($e,ze));if(!a.payload.serverRendered&&a.isHydrating&&(kt===!1||kt instanceof Error)){const hi=kt||Vu({statusCode:404,statusMessage:`Page Not Found: ${W}`});return await a.runWithContext(()=>Du(hi)),!1}if(kt===!0)continue;if(kt===!1)return kt;if(kt)return eI(kt)&&kt.fatal&&await a.runWithContext(()=>Du(kt)),kt}catch(kt){const hi=Vu(kt);return hi.fatal&&await a.runWithContext(()=>Du(hi)),hi}}}}),n.onError(async()=>{delete a._processingMiddleware,await a.callHook("page:loading:end")}),n.afterEach(async($e,ze)=>{$e.matched.length===0&&await a.runWithContext(()=>Du(Vu({statusCode:404,fatal:!1,statusMessage:`Page not found: ${$e.fullPath}`,data:{path:$e.fullPath}})))}),a.hooks.hookOnce("app:created",async()=>{try{"name"in Te&&(Te.name=void 0),await n.replace({...Te,force:!0}),n.options.scrollBehavior=xa.scrollBehavior}catch($e){await a.runWithContext(()=>Du($e))}}),{provide:{router:n}}}}),MF=a=>{let c;return a?c=a:typeof fetch>"u"?c=(...m)=>Fs(async()=>{const{default:y}=await Promise.resolve().then(()=>$d);return{default:y}},void 0,import.meta.url).then(({default:y})=>y(...m)):c=fetch,(...m)=>c(...m)};class hb extends Error{constructor(c,m="FunctionsError",y){super(c),this.name=m,this.context=y}}class RF extends hb{constructor(c){super("Failed to send a request to the Edge Function","FunctionsFetchError",c)}}class DF extends hb{constructor(c){super("Relay Error invoking the Edge Function","FunctionsRelayError",c)}}class kF extends hb{constructor(c){super("Edge Function returned a non-2xx status code","FunctionsHttpError",c)}}var Cx;(function(a){a.Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2"})(Cx||(Cx={}));var LF=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};class zF{constructor(c,{headers:m={},customFetch:y,region:T=Cx.Any}={}){this.url=c,this.headers=m,this.region=T,this.fetch=MF(y)}setAuth(c){this.headers.Authorization=`Bearer ${c}`}invoke(c,m={}){var y;return LF(this,void 0,void 0,function*(){try{const{headers:T,method:S,body:M}=m;let n={},{region:F}=m;F||(F=this.region),F&&F!=="any"&&(n["x-region"]=F);let W;M&&(T&&!Object.prototype.hasOwnProperty.call(T,"Content-Type")||!T)&&(typeof Blob<"u"&&M instanceof Blob||M instanceof ArrayBuffer?(n["Content-Type"]="application/octet-stream",W=M):typeof M=="string"?(n["Content-Type"]="text/plain",W=M):typeof FormData<"u"&&M instanceof FormData?W=M:(n["Content-Type"]="application/json",W=JSON.stringify(M)));const N=yield this.fetch(`${this.url}/${c}`,{method:S||"POST",headers:Object.assign(Object.assign(Object.assign({},n),this.headers),T),body:W}).catch(Te=>{throw new RF(Te)}),Y=N.headers.get("x-relay-error");if(Y&&Y==="true")throw new DF(N);if(!N.ok)throw new kF(N);let le=((y=N.headers.get("Content-Type"))!==null&&y!==void 0?y:"text/plain").split(";")[0].trim(),de;return le==="application/json"?de=yield N.json():le==="application/octet-stream"?de=yield N.blob():le==="text/event-stream"?de=N:le==="multipart/form-data"?de=yield N.formData():de=yield N.text(),{data:de,error:null}}catch(T){return{data:null,error:T}}})}}function wI(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function OF(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var c=a.default;if(typeof c=="function"){var m=function y(){return this instanceof y?Reflect.construct(c,arguments,this.constructor):c.apply(this,arguments)};m.prototype=c.prototype}else m={};return Object.defineProperty(m,"__esModule",{value:!0}),Object.keys(a).forEach(function(y){var T=Object.getOwnPropertyDescriptor(a,y);Object.defineProperty(m,y,T.get?T:{enumerable:!0,get:function(){return a[y]}})}),m}var us={},dd={},fd={},pd={},md={},_d={},FF=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Nd=FF();const BF=Nd.fetch,TI=Nd.fetch.bind(Nd),SI=Nd.Headers,NF=Nd.Request,UF=Nd.Response,$d=Object.freeze(Object.defineProperty({__proto__:null,Headers:SI,Request:NF,Response:UF,default:TI,fetch:BF},Symbol.toStringTag,{value:"Module"})),VF=OF($d);var Rg={},CE;function EI(){if(CE)return Rg;CE=1,Object.defineProperty(Rg,"__esModule",{value:!0});class a extends Error{constructor(m){super(m.message),this.name="PostgrestError",this.details=m.details,this.hint=m.hint,this.code=m.code}}return Rg.default=a,Rg}var PE;function AI(){if(PE)return _d;PE=1;var a=_d&&_d.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(_d,"__esModule",{value:!0});const c=a(VF),m=a(EI());class y{constructor(S){this.shouldThrowOnError=!1,this.method=S.method,this.url=S.url,this.headers=S.headers,this.schema=S.schema,this.body=S.body,this.shouldThrowOnError=S.shouldThrowOnError,this.signal=S.signal,this.isMaybeSingle=S.isMaybeSingle,S.fetch?this.fetch=S.fetch:typeof fetch>"u"?this.fetch=c.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(S,M){return this.headers=Object.assign({},this.headers),this.headers[S]=M,this}then(S,M){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let F=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async W=>{var N,Y,le;let de=null,Te=null,pe=null,qe=W.status,$e=W.statusText;if(W.ok){if(this.method!=="HEAD"){const Ke=await W.text();Ke===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?Te=Ke:Te=JSON.parse(Ke))}const be=(N=this.headers.Prefer)===null||N===void 0?void 0:N.match(/count=(exact|planned|estimated)/),ke=(Y=W.headers.get("content-range"))===null||Y===void 0?void 0:Y.split("/");be&&ke&&ke.length>1&&(pe=parseInt(ke[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Te)&&(Te.length>1?(de={code:"PGRST116",details:`Results contain ${Te.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Te=null,pe=null,qe=406,$e="Not Acceptable"):Te.length===1?Te=Te[0]:Te=null)}else{const be=await W.text();try{de=JSON.parse(be),Array.isArray(de)&&W.status===404&&(Te=[],de=null,qe=200,$e="OK")}catch{W.status===404&&be===""?(qe=204,$e="No Content"):de={message:be}}if(de&&this.isMaybeSingle&&(!((le=de==null?void 0:de.details)===null||le===void 0)&&le.includes("0 rows"))&&(de=null,qe=200,$e="OK"),de&&this.shouldThrowOnError)throw new m.default(de)}return{error:de,data:Te,count:pe,status:qe,statusText:$e}});return this.shouldThrowOnError||(F=F.catch(W=>{var N,Y,le;return{error:{message:`${(N=W==null?void 0:W.name)!==null&&N!==void 0?N:"FetchError"}: ${W==null?void 0:W.message}`,details:`${(Y=W==null?void 0:W.stack)!==null&&Y!==void 0?Y:""}`,hint:"",code:`${(le=W==null?void 0:W.code)!==null&&le!==void 0?le:""}`},data:null,count:null,status:0,statusText:""}})),F.then(S,M)}returns(){return this}overrideTypes(){return this}}return _d.default=y,_d}var ME;function II(){if(ME)return md;ME=1;var a=md&&md.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(md,"__esModule",{value:!0});const c=a(AI());class m extends c.default{select(T){let S=!1;const M=(T??"*").split("").map(n=>/\s/.test(n)&&!S?"":(n==='"'&&(S=!S),n)).join("");return this.url.searchParams.set("select",M),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(T,{ascending:S=!0,nullsFirst:M,foreignTable:n,referencedTable:F=n}={}){const W=F?`${F}.order`:"order",N=this.url.searchParams.get(W);return this.url.searchParams.set(W,`${N?`${N},`:""}${T}.${S?"asc":"desc"}${M===void 0?"":M?".nullsfirst":".nullslast"}`),this}limit(T,{foreignTable:S,referencedTable:M=S}={}){const n=typeof M>"u"?"limit":`${M}.limit`;return this.url.searchParams.set(n,`${T}`),this}range(T,S,{foreignTable:M,referencedTable:n=M}={}){const F=typeof n>"u"?"offset":`${n}.offset`,W=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(F,`${T}`),this.url.searchParams.set(W,`${S-T+1}`),this}abortSignal(T){return this.signal=T,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:T=!1,verbose:S=!1,settings:M=!1,buffers:n=!1,wal:F=!1,format:W="text"}={}){var N;const Y=[T?"analyze":null,S?"verbose":null,M?"settings":null,n?"buffers":null,F?"wal":null].filter(Boolean).join("|"),le=(N=this.headers.Accept)!==null&&N!==void 0?N:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${W}; for="${le}"; options=${Y};`,W==="json"?this:this}rollback(){var T;return((T=this.headers.Prefer)!==null&&T!==void 0?T:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return md.default=m,md}var RE;function db(){if(RE)return pd;RE=1;var a=pd&&pd.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(pd,"__esModule",{value:!0});const c=a(II());class m extends c.default{eq(T,S){return this.url.searchParams.append(T,`eq.${S}`),this}neq(T,S){return this.url.searchParams.append(T,`neq.${S}`),this}gt(T,S){return this.url.searchParams.append(T,`gt.${S}`),this}gte(T,S){return this.url.searchParams.append(T,`gte.${S}`),this}lt(T,S){return this.url.searchParams.append(T,`lt.${S}`),this}lte(T,S){return this.url.searchParams.append(T,`lte.${S}`),this}like(T,S){return this.url.searchParams.append(T,`like.${S}`),this}likeAllOf(T,S){return this.url.searchParams.append(T,`like(all).{${S.join(",")}}`),this}likeAnyOf(T,S){return this.url.searchParams.append(T,`like(any).{${S.join(",")}}`),this}ilike(T,S){return this.url.searchParams.append(T,`ilike.${S}`),this}ilikeAllOf(T,S){return this.url.searchParams.append(T,`ilike(all).{${S.join(",")}}`),this}ilikeAnyOf(T,S){return this.url.searchParams.append(T,`ilike(any).{${S.join(",")}}`),this}is(T,S){return this.url.searchParams.append(T,`is.${S}`),this}in(T,S){const M=Array.from(new Set(S)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(T,`in.(${M})`),this}contains(T,S){return typeof S=="string"?this.url.searchParams.append(T,`cs.${S}`):Array.isArray(S)?this.url.searchParams.append(T,`cs.{${S.join(",")}}`):this.url.searchParams.append(T,`cs.${JSON.stringify(S)}`),this}containedBy(T,S){return typeof S=="string"?this.url.searchParams.append(T,`cd.${S}`):Array.isArray(S)?this.url.searchParams.append(T,`cd.{${S.join(",")}}`):this.url.searchParams.append(T,`cd.${JSON.stringify(S)}`),this}rangeGt(T,S){return this.url.searchParams.append(T,`sr.${S}`),this}rangeGte(T,S){return this.url.searchParams.append(T,`nxl.${S}`),this}rangeLt(T,S){return this.url.searchParams.append(T,`sl.${S}`),this}rangeLte(T,S){return this.url.searchParams.append(T,`nxr.${S}`),this}rangeAdjacent(T,S){return this.url.searchParams.append(T,`adj.${S}`),this}overlaps(T,S){return typeof S=="string"?this.url.searchParams.append(T,`ov.${S}`):this.url.searchParams.append(T,`ov.{${S.join(",")}}`),this}textSearch(T,S,{config:M,type:n}={}){let F="";n==="plain"?F="pl":n==="phrase"?F="ph":n==="websearch"&&(F="w");const W=M===void 0?"":`(${M})`;return this.url.searchParams.append(T,`${F}fts${W}.${S}`),this}match(T){return Object.entries(T).forEach(([S,M])=>{this.url.searchParams.append(S,`eq.${M}`)}),this}not(T,S,M){return this.url.searchParams.append(T,`not.${S}.${M}`),this}or(T,{foreignTable:S,referencedTable:M=S}={}){const n=M?`${M}.or`:"or";return this.url.searchParams.append(n,`(${T})`),this}filter(T,S,M){return this.url.searchParams.append(T,`${S}.${M}`),this}}return pd.default=m,pd}var DE;function CI(){if(DE)return fd;DE=1;var a=fd&&fd.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(fd,"__esModule",{value:!0});const c=a(db());class m{constructor(T,{headers:S={},schema:M,fetch:n}){this.url=T,this.headers=S,this.schema=M,this.fetch=n}select(T,{head:S=!1,count:M}={}){const n=S?"HEAD":"GET";let F=!1;const W=(T??"*").split("").map(N=>/\s/.test(N)&&!F?"":(N==='"'&&(F=!F),N)).join("");return this.url.searchParams.set("select",W),M&&(this.headers.Prefer=`count=${M}`),new c.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(T,{count:S,defaultToNull:M=!0}={}){const n="POST",F=[];if(this.headers.Prefer&&F.push(this.headers.Prefer),S&&F.push(`count=${S}`),M||F.push("missing=default"),this.headers.Prefer=F.join(","),Array.isArray(T)){const W=T.reduce((N,Y)=>N.concat(Object.keys(Y)),[]);if(W.length>0){const N=[...new Set(W)].map(Y=>`"${Y}"`);this.url.searchParams.set("columns",N.join(","))}}return new c.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:T,fetch:this.fetch,allowEmpty:!1})}upsert(T,{onConflict:S,ignoreDuplicates:M=!1,count:n,defaultToNull:F=!0}={}){const W="POST",N=[`resolution=${M?"ignore":"merge"}-duplicates`];if(S!==void 0&&this.url.searchParams.set("on_conflict",S),this.headers.Prefer&&N.push(this.headers.Prefer),n&&N.push(`count=${n}`),F||N.push("missing=default"),this.headers.Prefer=N.join(","),Array.isArray(T)){const Y=T.reduce((le,de)=>le.concat(Object.keys(de)),[]);if(Y.length>0){const le=[...new Set(Y)].map(de=>`"${de}"`);this.url.searchParams.set("columns",le.join(","))}}return new c.default({method:W,url:this.url,headers:this.headers,schema:this.schema,body:T,fetch:this.fetch,allowEmpty:!1})}update(T,{count:S}={}){const M="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),S&&n.push(`count=${S}`),this.headers.Prefer=n.join(","),new c.default({method:M,url:this.url,headers:this.headers,schema:this.schema,body:T,fetch:this.fetch,allowEmpty:!1})}delete({count:T}={}){const S="DELETE",M=[];return T&&M.push(`count=${T}`),this.headers.Prefer&&M.unshift(this.headers.Prefer),this.headers.Prefer=M.join(","),new c.default({method:S,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return fd.default=m,fd}var Np={},Up={},kE;function jF(){return kE||(kE=1,Object.defineProperty(Up,"__esModule",{value:!0}),Up.version=void 0,Up.version="0.0.0-automated"),Up}var LE;function $F(){if(LE)return Np;LE=1,Object.defineProperty(Np,"__esModule",{value:!0}),Np.DEFAULT_HEADERS=void 0;const a=jF();return Np.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${a.version}`},Np}var zE;function GF(){if(zE)return dd;zE=1;var a=dd&&dd.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(dd,"__esModule",{value:!0});const c=a(CI()),m=a(db()),y=$F();class T{constructor(M,{headers:n={},schema:F,fetch:W}={}){this.url=M,this.headers=Object.assign(Object.assign({},y.DEFAULT_HEADERS),n),this.schemaName=F,this.fetch=W}from(M){const n=new URL(`${this.url}/${M}`);return new c.default(n,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(M){return new T(this.url,{headers:this.headers,schema:M,fetch:this.fetch})}rpc(M,n={},{head:F=!1,get:W=!1,count:N}={}){let Y;const le=new URL(`${this.url}/rpc/${M}`);let de;F||W?(Y=F?"HEAD":"GET",Object.entries(n).filter(([pe,qe])=>qe!==void 0).map(([pe,qe])=>[pe,Array.isArray(qe)?`{${qe.join(",")}}`:`${qe}`]).forEach(([pe,qe])=>{le.searchParams.append(pe,qe)})):(Y="POST",de=n);const Te=Object.assign({},this.headers);return N&&(Te.Prefer=`count=${N}`),new m.default({method:Y,url:le,headers:Te,schema:this.schemaName,body:de,fetch:this.fetch,allowEmpty:!1})}}return dd.default=T,dd}var OE;function HF(){if(OE)return us;OE=1;var a=us&&us.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(us,"__esModule",{value:!0}),us.PostgrestError=us.PostgrestBuilder=us.PostgrestTransformBuilder=us.PostgrestFilterBuilder=us.PostgrestQueryBuilder=us.PostgrestClient=void 0;const c=a(GF());us.PostgrestClient=c.default;const m=a(CI());us.PostgrestQueryBuilder=m.default;const y=a(db());us.PostgrestFilterBuilder=y.default;const T=a(II());us.PostgrestTransformBuilder=T.default;const S=a(AI());us.PostgrestBuilder=S.default;const M=a(EI());return us.PostgrestError=M.default,us.default={PostgrestClient:c.default,PostgrestQueryBuilder:m.default,PostgrestFilterBuilder:y.default,PostgrestTransformBuilder:T.default,PostgrestBuilder:S.default,PostgrestError:M.default},us}var qF=HF();const WF=wI(qF),{PostgrestClient:ZF,PostgrestQueryBuilder:jN,PostgrestFilterBuilder:$N,PostgrestTransformBuilder:GN,PostgrestBuilder:HN,PostgrestError:qN}=WF,XF="2.11.2",KF={"X-Client-Info":`realtime-js/${XF}`},YF="1.0.0",PI=1e4,JF=1e3;var Rd;(function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"})(Rd||(Rd={}));var lo;(function(a){a.closed="closed",a.errored="errored",a.joined="joined",a.joining="joining",a.leaving="leaving"})(lo||(lo={}));var Ho;(function(a){a.close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token"})(Ho||(Ho={}));var Px;(function(a){a.websocket="websocket"})(Px||(Px={}));var Lu;(function(a){a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed"})(Lu||(Lu={}));class QF{constructor(){this.HEADER_LENGTH=1}decode(c,m){return c.constructor===ArrayBuffer?m(this._binaryDecode(c)):m(typeof c=="string"?JSON.parse(c):{})}_binaryDecode(c){const m=new DataView(c),y=new TextDecoder;return this._decodeBroadcast(c,m,y)}_decodeBroadcast(c,m,y){const T=m.getUint8(1),S=m.getUint8(2);let M=this.HEADER_LENGTH+2;const n=y.decode(c.slice(M,M+T));M=M+T;const F=y.decode(c.slice(M,M+S));M=M+S;const W=JSON.parse(y.decode(c.slice(M,c.byteLength)));return{ref:null,topic:n,event:F,payload:W}}}class MI{constructor(c,m){this.callback=c,this.timerCalc=m,this.timer=void 0,this.tries=0,this.callback=c,this.timerCalc=m}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var gn;(function(a){a.abstime="abstime",a.bool="bool",a.date="date",a.daterange="daterange",a.float4="float4",a.float8="float8",a.int2="int2",a.int4="int4",a.int4range="int4range",a.int8="int8",a.int8range="int8range",a.json="json",a.jsonb="jsonb",a.money="money",a.numeric="numeric",a.oid="oid",a.reltime="reltime",a.text="text",a.time="time",a.timestamp="timestamp",a.timestamptz="timestamptz",a.timetz="timetz",a.tsrange="tsrange",a.tstzrange="tstzrange"})(gn||(gn={}));const FE=(a,c,m={})=>{var y;const T=(y=m.skipTypes)!==null&&y!==void 0?y:[];return Object.keys(c).reduce((S,M)=>(S[M]=e3(M,a,c,T),S),{})},e3=(a,c,m,y)=>{const T=c.find(n=>n.name===a),S=T==null?void 0:T.type,M=m[a];return S&&!y.includes(S)?RI(S,M):Mx(M)},RI=(a,c)=>{if(a.charAt(0)==="_"){const m=a.slice(1,a.length);return n3(c,m)}switch(a){case gn.bool:return t3(c);case gn.float4:case gn.float8:case gn.int2:case gn.int4:case gn.int8:case gn.numeric:case gn.oid:return i3(c);case gn.json:case gn.jsonb:return r3(c);case gn.timestamp:return s3(c);case gn.abstime:case gn.date:case gn.daterange:case gn.int4range:case gn.int8range:case gn.money:case gn.reltime:case gn.text:case gn.time:case gn.timestamptz:case gn.timetz:case gn.tsrange:case gn.tstzrange:return Mx(c);default:return Mx(c)}},Mx=a=>a,t3=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},i3=a=>{if(typeof a=="string"){const c=parseFloat(a);if(!Number.isNaN(c))return c}return a},r3=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(c){return console.log(`JSON parse error: ${c}`),a}return a},n3=(a,c)=>{if(typeof a!="string")return a;const m=a.length-1,y=a[m];if(a[0]==="{"&&y==="}"){let S;const M=a.slice(1,m);try{S=JSON.parse("["+M+"]")}catch{S=M?M.split(","):[]}return S.map(n=>RI(c,n))}return a},s3=a=>typeof a=="string"?a.replace(" ","T"):a,DI=a=>{let c=a;return c=c.replace(/^ws/i,"http"),c=c.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),c.replace(/\/+$/,"")};class G0{constructor(c,m,y={},T=PI){this.channel=c,this.event=m,this.payload=y,this.timeout=T,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(c){this.timeout=c,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(c){this.payload=Object.assign(Object.assign({},this.payload),c)}receive(c,m){var y;return this._hasReceived(c)&&m((y=this.receivedResp)===null||y===void 0?void 0:y.response),this.recHooks.push({status:c,callback:m}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const c=m=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=m,this._matchReceive(m)};this.channel._on(this.refEvent,{},c),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(c,m){this.refEvent&&this.channel._trigger(this.refEvent,{status:c,response:m})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:c,response:m}){this.recHooks.filter(y=>y.status===c).forEach(y=>y.callback(m))}_hasReceived(c){return this.receivedResp&&this.receivedResp.status===c}}var BE;(function(a){a.SYNC="sync",a.JOIN="join",a.LEAVE="leave"})(BE||(BE={}));class Qp{constructor(c,m){this.channel=c,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const y=(m==null?void 0:m.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(y.state,{},T=>{const{onJoin:S,onLeave:M,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qp.syncState(this.state,T,S,M),this.pendingDiffs.forEach(F=>{this.state=Qp.syncDiff(this.state,F,S,M)}),this.pendingDiffs=[],n()}),this.channel._on(y.diff,{},T=>{const{onJoin:S,onLeave:M,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(T):(this.state=Qp.syncDiff(this.state,T,S,M),n())}),this.onJoin((T,S,M)=>{this.channel._trigger("presence",{event:"join",key:T,currentPresences:S,newPresences:M})}),this.onLeave((T,S,M)=>{this.channel._trigger("presence",{event:"leave",key:T,currentPresences:S,leftPresences:M})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(c,m,y,T){const S=this.cloneDeep(c),M=this.transformState(m),n={},F={};return this.map(S,(W,N)=>{M[W]||(F[W]=N)}),this.map(M,(W,N)=>{const Y=S[W];if(Y){const le=N.map(qe=>qe.presence_ref),de=Y.map(qe=>qe.presence_ref),Te=N.filter(qe=>de.indexOf(qe.presence_ref)<0),pe=Y.filter(qe=>le.indexOf(qe.presence_ref)<0);Te.length>0&&(n[W]=Te),pe.length>0&&(F[W]=pe)}else n[W]=N}),this.syncDiff(S,{joins:n,leaves:F},y,T)}static syncDiff(c,m,y,T){const{joins:S,leaves:M}={joins:this.transformState(m.joins),leaves:this.transformState(m.leaves)};return y||(y=()=>{}),T||(T=()=>{}),this.map(S,(n,F)=>{var W;const N=(W=c[n])!==null&&W!==void 0?W:[];if(c[n]=this.cloneDeep(F),N.length>0){const Y=c[n].map(de=>de.presence_ref),le=N.filter(de=>Y.indexOf(de.presence_ref)<0);c[n].unshift(...le)}y(n,N,F)}),this.map(M,(n,F)=>{let W=c[n];if(!W)return;const N=F.map(Y=>Y.presence_ref);W=W.filter(Y=>N.indexOf(Y.presence_ref)<0),c[n]=W,T(n,W,F),W.length===0&&delete c[n]}),c}static map(c,m){return Object.getOwnPropertyNames(c).map(y=>m(y,c[y]))}static transformState(c){return c=this.cloneDeep(c),Object.getOwnPropertyNames(c).reduce((m,y)=>{const T=c[y];return"metas"in T?m[y]=T.metas.map(S=>(S.presence_ref=S.phx_ref,delete S.phx_ref,delete S.phx_ref_prev,S)):m[y]=T,m},{})}static cloneDeep(c){return JSON.parse(JSON.stringify(c))}onJoin(c){this.caller.onJoin=c}onLeave(c){this.caller.onLeave=c}onSync(c){this.caller.onSync=c}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var NE;(function(a){a.ALL="*",a.INSERT="INSERT",a.UPDATE="UPDATE",a.DELETE="DELETE"})(NE||(NE={}));var UE;(function(a){a.BROADCAST="broadcast",a.PRESENCE="presence",a.POSTGRES_CHANGES="postgres_changes",a.SYSTEM="system"})(UE||(UE={}));var ol;(function(a){a.SUBSCRIBED="SUBSCRIBED",a.TIMED_OUT="TIMED_OUT",a.CLOSED="CLOSED",a.CHANNEL_ERROR="CHANNEL_ERROR"})(ol||(ol={}));class fb{constructor(c,m={config:{}},y){this.topic=c,this.params=m,this.socket=y,this.bindings={},this.state=lo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=c.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},m.config),this.timeout=this.socket.timeout,this.joinPush=new G0(this,Ho.join,this.params,this.timeout),this.rejoinTimer=new MI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=lo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(T=>T.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=lo.closed,this.socket._remove(this)}),this._onError(T=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,T),this.state=lo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=lo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ho.reply,{},(T,S)=>{this._trigger(this._replyEventName(S),T)}),this.presence=new Qp(this),this.broadcastEndpointURL=DI(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(c,m=this.timeout){var y,T;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:S,presence:M,private:n}}=this.params;this._onError(N=>c==null?void 0:c(ol.CHANNEL_ERROR,N)),this._onClose(()=>c==null?void 0:c(ol.CLOSED));const F={},W={broadcast:S,presence:M,postgres_changes:(T=(y=this.bindings.postgres_changes)===null||y===void 0?void 0:y.map(N=>N.filter))!==null&&T!==void 0?T:[],private:n};this.socket.accessTokenValue&&(F.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:W},F)),this.joinedOnce=!0,this._rejoin(m),this.joinPush.receive("ok",async({postgres_changes:N})=>{var Y;if(this.socket.setAuth(),N===void 0){c==null||c(ol.SUBSCRIBED);return}else{const le=this.bindings.postgres_changes,de=(Y=le==null?void 0:le.length)!==null&&Y!==void 0?Y:0,Te=[];for(let pe=0;pe<de;pe++){const qe=le[pe],{filter:{event:$e,schema:ze,table:be,filter:ke}}=qe,Ke=N&&N[pe];if(Ke&&Ke.event===$e&&Ke.schema===ze&&Ke.table===be&&Ke.filter===ke)Te.push(Object.assign(Object.assign({},qe),{id:Ke.id}));else{this.unsubscribe(),c==null||c(ol.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Te,c&&c(ol.SUBSCRIBED);return}}).receive("error",N=>{c==null||c(ol.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(N).join(", ")||"error")))}).receive("timeout",()=>{c==null||c(ol.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(c,m={}){return await this.send({type:"presence",event:"track",payload:c},m.timeout||this.timeout)}async untrack(c={}){return await this.send({type:"presence",event:"untrack"},c)}on(c,m,y){return this._on(c,m,y)}async send(c,m={}){var y,T;if(!this._canPush()&&c.type==="broadcast"){const{event:S,payload:M}=c,F={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:S,payload:M,private:this.private}]})};try{const W=await this._fetchWithTimeout(this.broadcastEndpointURL,F,(y=m.timeout)!==null&&y!==void 0?y:this.timeout);return await((T=W.body)===null||T===void 0?void 0:T.cancel()),W.ok?"ok":"error"}catch(W){return W.name==="AbortError"?"timed out":"error"}}else return new Promise(S=>{var M,n,F;const W=this._push(c.type,c,m.timeout||this.timeout);c.type==="broadcast"&&!(!((F=(n=(M=this.params)===null||M===void 0?void 0:M.config)===null||n===void 0?void 0:n.broadcast)===null||F===void 0)&&F.ack)&&S("ok"),W.receive("ok",()=>S("ok")),W.receive("error",()=>S("error")),W.receive("timeout",()=>S("timed out"))})}updateJoinPayload(c){this.joinPush.updatePayload(c)}unsubscribe(c=this.timeout){this.state=lo.leaving;const m=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ho.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(y=>{const T=new G0(this,Ho.leave,{},c);T.receive("ok",()=>{m(),y("ok")}).receive("timeout",()=>{m(),y("timed out")}).receive("error",()=>{y("error")}),T.send(),this._canPush()||T.trigger("ok",{})})}async _fetchWithTimeout(c,m,y){const T=new AbortController,S=setTimeout(()=>T.abort(),y),M=await this.socket.fetch(c,Object.assign(Object.assign({},m),{signal:T.signal}));return clearTimeout(S),M}_push(c,m,y=this.timeout){if(!this.joinedOnce)throw`tried to push '${c}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let T=new G0(this,c,m,y);return this._canPush()?T.send():(T.startTimeout(),this.pushBuffer.push(T)),T}_onMessage(c,m,y){return m}_isMember(c){return this.topic===c}_joinRef(){return this.joinPush.ref}_trigger(c,m,y){var T,S;const M=c.toLocaleLowerCase(),{close:n,error:F,leave:W,join:N}=Ho;if(y&&[n,F,W,N].indexOf(M)>=0&&y!==this._joinRef())return;let le=this._onMessage(M,m,y);if(m&&!le)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(M)?(T=this.bindings.postgres_changes)===null||T===void 0||T.filter(de=>{var Te,pe,qe;return((Te=de.filter)===null||Te===void 0?void 0:Te.event)==="*"||((qe=(pe=de.filter)===null||pe===void 0?void 0:pe.event)===null||qe===void 0?void 0:qe.toLocaleLowerCase())===M}).map(de=>de.callback(le,y)):(S=this.bindings[M])===null||S===void 0||S.filter(de=>{var Te,pe,qe,$e,ze,be;if(["broadcast","presence","postgres_changes"].includes(M))if("id"in de){const ke=de.id,Ke=(Te=de.filter)===null||Te===void 0?void 0:Te.event;return ke&&((pe=m.ids)===null||pe===void 0?void 0:pe.includes(ke))&&(Ke==="*"||(Ke==null?void 0:Ke.toLocaleLowerCase())===((qe=m.data)===null||qe===void 0?void 0:qe.type.toLocaleLowerCase()))}else{const ke=(ze=($e=de==null?void 0:de.filter)===null||$e===void 0?void 0:$e.event)===null||ze===void 0?void 0:ze.toLocaleLowerCase();return ke==="*"||ke===((be=m==null?void 0:m.event)===null||be===void 0?void 0:be.toLocaleLowerCase())}else return de.type.toLocaleLowerCase()===M}).map(de=>{if(typeof le=="object"&&"ids"in le){const Te=le.data,{schema:pe,table:qe,commit_timestamp:$e,type:ze,errors:be}=Te;le=Object.assign(Object.assign({},{schema:pe,table:qe,commit_timestamp:$e,eventType:ze,new:{},old:{},errors:be}),this._getPayloadRecords(Te))}de.callback(le,y)})}_isClosed(){return this.state===lo.closed}_isJoined(){return this.state===lo.joined}_isJoining(){return this.state===lo.joining}_isLeaving(){return this.state===lo.leaving}_replyEventName(c){return`chan_reply_${c}`}_on(c,m,y){const T=c.toLocaleLowerCase(),S={type:T,filter:m,callback:y};return this.bindings[T]?this.bindings[T].push(S):this.bindings[T]=[S],this}_off(c,m){const y=c.toLocaleLowerCase();return this.bindings[y]=this.bindings[y].filter(T=>{var S;return!(((S=T.type)===null||S===void 0?void 0:S.toLocaleLowerCase())===y&&fb.isEqual(T.filter,m))}),this}static isEqual(c,m){if(Object.keys(c).length!==Object.keys(m).length)return!1;for(const y in c)if(c[y]!==m[y])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(c){this._on(Ho.close,{},c)}_onError(c){this._on(Ho.error,{},m=>c(m))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(c=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=lo.joining,this.joinPush.resend(c))}_getPayloadRecords(c){const m={new:{},old:{}};return(c.type==="INSERT"||c.type==="UPDATE")&&(m.new=FE(c.columns,c.record)),(c.type==="UPDATE"||c.type==="DELETE")&&(m.old=FE(c.columns,c.old_record)),m}}const o3=()=>{},a3=typeof WebSocket<"u",l3=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class c3{constructor(c,m){var y;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=KF,this.params={},this.timeout=PI,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=o3,this.conn=null,this.sendBuffer=[],this.serializer=new QF,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=S=>{let M;return S?M=S:typeof fetch>"u"?M=(...n)=>Fs(async()=>{const{default:F}=await Promise.resolve().then(()=>$d);return{default:F}},void 0,import.meta.url).then(({default:F})=>F(...n)):M=fetch,(...n)=>M(...n)},this.endPoint=`${c}/${Px.websocket}`,this.httpEndpoint=DI(c),m!=null&&m.transport?this.transport=m.transport:this.transport=null,m!=null&&m.params&&(this.params=m.params),m!=null&&m.headers&&(this.headers=Object.assign(Object.assign({},this.headers),m.headers)),m!=null&&m.timeout&&(this.timeout=m.timeout),m!=null&&m.logger&&(this.logger=m.logger),m!=null&&m.heartbeatIntervalMs&&(this.heartbeatIntervalMs=m.heartbeatIntervalMs);const T=(y=m==null?void 0:m.params)===null||y===void 0?void 0:y.apikey;if(T&&(this.accessTokenValue=T,this.apiKey=T),this.reconnectAfterMs=m!=null&&m.reconnectAfterMs?m.reconnectAfterMs:S=>[1e3,2e3,5e3,1e4][S-1]||1e4,this.encode=m!=null&&m.encode?m.encode:(S,M)=>M(JSON.stringify(S)),this.decode=m!=null&&m.decode?m.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new MI(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(m==null?void 0:m.fetch),m!=null&&m.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(m==null?void 0:m.worker)||!1,this.workerUrl=m==null?void 0:m.workerUrl}this.accessToken=(m==null?void 0:m.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(a3){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new u3(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Fs(async()=>{const{default:c}=await import("./nFLbPgJC.js").then(m=>m.b);return{default:c}},[],import.meta.url).then(({default:c})=>{this.conn=new c(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:YF}))}disconnect(c,m){this.conn&&(this.conn.onclose=function(){},c?this.conn.close(c,m??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(c){const m=await c.unsubscribe();return this.channels.length===0&&this.disconnect(),m}async removeAllChannels(){const c=await Promise.all(this.channels.map(m=>m.unsubscribe()));return this.disconnect(),c}log(c,m,y){this.logger(c,m,y)}connectionState(){switch(this.conn&&this.conn.readyState){case Rd.connecting:return Lu.Connecting;case Rd.open:return Lu.Open;case Rd.closing:return Lu.Closing;default:return Lu.Closed}}isConnected(){return this.connectionState()===Lu.Open}channel(c,m={config:{}}){const y=new fb(`realtime:${c}`,m,this);return this.channels.push(y),y}push(c){const{topic:m,event:y,payload:T,ref:S}=c,M=()=>{this.encode(c,n=>{var F;(F=this.conn)===null||F===void 0||F.send(n)})};this.log("push",`${m} ${y} (${S})`,T),this.isConnected()?M():this.sendBuffer.push(M)}async setAuth(c=null){let m=c||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(m){let y=null;try{y=JSON.parse(atob(m.split(".")[1]))}catch{}if(y&&y.exp&&!(Math.floor(Date.now()/1e3)-y.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${y.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${y.exp}`);this.accessTokenValue=m,this.channels.forEach(T=>{m&&T.updateJoinPayload({access_token:m}),T.joinedOnce&&T._isJoined()&&T._push(Ho.access_token,{access_token:m})})}}async sendHeartbeat(){var c;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(c=this.conn)===null||c===void 0||c.close(JF,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(c=>c()),this.sendBuffer=[])}_makeRef(){let c=this.ref+1;return c===this.ref?this.ref=0:this.ref=c,this.ref.toString()}_leaveOpenTopic(c){let m=this.channels.find(y=>y.topic===c&&(y._isJoined()||y._isJoining()));m&&(this.log("transport",`leaving duplicate topic "${c}"`),m.unsubscribe())}_remove(c){this.channels=this.channels.filter(m=>m._joinRef()!==c._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=c=>this._onConnError(c),this.conn.onmessage=c=>this._onConnMessage(c),this.conn.onclose=c=>this._onConnClose(c))}_onConnMessage(c){this.decode(c.data,m=>{let{topic:y,event:T,payload:S,ref:M}=m;M&&M===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${S.status||""} ${y} ${T} ${M&&"("+M+")"||""}`,S),this.channels.filter(n=>n._isMember(y)).forEach(n=>n._trigger(T,S,M)),this.stateChangeCallbacks.message.forEach(n=>n(m))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const c=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(c),this.workerRef.onerror=m=>{this.log("worker","worker error",m.message),this.workerRef.terminate()},this.workerRef.onmessage=m=>{m.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(c=>c())}_onConnClose(c){this.log("transport","close",c),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(m=>m(c))}_onConnError(c){this.log("transport",c.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(m=>m(c))}_triggerChanError(){this.channels.forEach(c=>c._trigger(Ho.error))}_appendParams(c,m){if(Object.keys(m).length===0)return c;const y=c.match(/\?/)?"&":"?",T=new URLSearchParams(m);return`${c}${y}${T}`}_workerObjectUrl(c){let m;if(c)m=c;else{const y=new Blob([l3],{type:"application/javascript"});m=URL.createObjectURL(y)}return m}}class u3{constructor(c,m,y){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Rd.connecting,this.send=()=>{},this.url=null,this.url=c,this.close=y.close}}class pb extends Error{constructor(c){super(c),this.__isStorageError=!0,this.name="StorageError"}}function hs(a){return typeof a=="object"&&a!==null&&"__isStorageError"in a}class h3 extends pb{constructor(c,m){super(c),this.name="StorageApiError",this.status=m}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Rx extends pb{constructor(c,m){super(c),this.name="StorageUnknownError",this.originalError=m}}var d3=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};const kI=a=>{let c;return a?c=a:typeof fetch>"u"?c=(...m)=>Fs(async()=>{const{default:y}=await Promise.resolve().then(()=>$d);return{default:y}},void 0,import.meta.url).then(({default:y})=>y(...m)):c=fetch,(...m)=>c(...m)},f3=()=>d3(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Fs(()=>Promise.resolve().then(()=>$d),void 0,import.meta.url)).Response:Response}),Dx=a=>{if(Array.isArray(a))return a.map(m=>Dx(m));if(typeof a=="function"||a!==Object(a))return a;const c={};return Object.entries(a).forEach(([m,y])=>{const T=m.replace(/([-_][a-z])/gi,S=>S.toUpperCase().replace(/[-_]/g,""));c[T]=Dx(y)}),c};var Hu=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};const H0=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),p3=(a,c,m)=>Hu(void 0,void 0,void 0,function*(){const y=yield f3();a instanceof y&&!(m!=null&&m.noResolveJson)?a.json().then(T=>{c(new h3(H0(T),a.status||500))}).catch(T=>{c(new Rx(H0(T),T))}):c(new Rx(H0(a),a))}),m3=(a,c,m,y)=>{const T={method:a,headers:(c==null?void 0:c.headers)||{}};return a==="GET"?T:(T.headers=Object.assign({"Content-Type":"application/json"},c==null?void 0:c.headers),y&&(T.body=JSON.stringify(y)),Object.assign(Object.assign({},T),m))};function bm(a,c,m,y,T,S){return Hu(this,void 0,void 0,function*(){return new Promise((M,n)=>{a(m,m3(c,y,T,S)).then(F=>{if(!F.ok)throw F;return y!=null&&y.noResolveJson?F:F.json()}).then(F=>M(F)).catch(F=>p3(F,n,y))})})}function oy(a,c,m,y){return Hu(this,void 0,void 0,function*(){return bm(a,"GET",c,m,y)})}function fc(a,c,m,y,T){return Hu(this,void 0,void 0,function*(){return bm(a,"POST",c,y,T,m)})}function _3(a,c,m,y,T){return Hu(this,void 0,void 0,function*(){return bm(a,"PUT",c,y,T,m)})}function g3(a,c,m,y){return Hu(this,void 0,void 0,function*(){return bm(a,"HEAD",c,Object.assign(Object.assign({},m),{noResolveJson:!0}),y)})}function LI(a,c,m,y,T){return Hu(this,void 0,void 0,function*(){return bm(a,"DELETE",c,y,T,m)})}var Ws=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};const y3={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},VE={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class v3{constructor(c,m={},y,T){this.url=c,this.headers=m,this.bucketId=y,this.fetch=kI(T)}uploadOrUpdate(c,m,y,T){return Ws(this,void 0,void 0,function*(){try{let S;const M=Object.assign(Object.assign({},VE),T);let n=Object.assign(Object.assign({},this.headers),c==="POST"&&{"x-upsert":String(M.upsert)});const F=M.metadata;typeof Blob<"u"&&y instanceof Blob?(S=new FormData,S.append("cacheControl",M.cacheControl),F&&S.append("metadata",this.encodeMetadata(F)),S.append("",y)):typeof FormData<"u"&&y instanceof FormData?(S=y,S.append("cacheControl",M.cacheControl),F&&S.append("metadata",this.encodeMetadata(F))):(S=y,n["cache-control"]=`max-age=${M.cacheControl}`,n["content-type"]=M.contentType,F&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(F)))),T!=null&&T.headers&&(n=Object.assign(Object.assign({},n),T.headers));const W=this._removeEmptyFolders(m),N=this._getFinalPath(W),Y=yield this.fetch(`${this.url}/object/${N}`,Object.assign({method:c,body:S,headers:n},M!=null&&M.duplex?{duplex:M.duplex}:{})),le=yield Y.json();return Y.ok?{data:{path:W,id:le.Id,fullPath:le.Key},error:null}:{data:null,error:le}}catch(S){if(hs(S))return{data:null,error:S};throw S}})}upload(c,m,y){return Ws(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",c,m,y)})}uploadToSignedUrl(c,m,y,T){return Ws(this,void 0,void 0,function*(){const S=this._removeEmptyFolders(c),M=this._getFinalPath(S),n=new URL(this.url+`/object/upload/sign/${M}`);n.searchParams.set("token",m);try{let F;const W=Object.assign({upsert:VE.upsert},T),N=Object.assign(Object.assign({},this.headers),{"x-upsert":String(W.upsert)});typeof Blob<"u"&&y instanceof Blob?(F=new FormData,F.append("cacheControl",W.cacheControl),F.append("",y)):typeof FormData<"u"&&y instanceof FormData?(F=y,F.append("cacheControl",W.cacheControl)):(F=y,N["cache-control"]=`max-age=${W.cacheControl}`,N["content-type"]=W.contentType);const Y=yield this.fetch(n.toString(),{method:"PUT",body:F,headers:N}),le=yield Y.json();return Y.ok?{data:{path:S,fullPath:le.Key},error:null}:{data:null,error:le}}catch(F){if(hs(F))return{data:null,error:F};throw F}})}createSignedUploadUrl(c,m){return Ws(this,void 0,void 0,function*(){try{let y=this._getFinalPath(c);const T=Object.assign({},this.headers);m!=null&&m.upsert&&(T["x-upsert"]="true");const S=yield fc(this.fetch,`${this.url}/object/upload/sign/${y}`,{},{headers:T}),M=new URL(this.url+S.url),n=M.searchParams.get("token");if(!n)throw new pb("No token returned by API");return{data:{signedUrl:M.toString(),path:c,token:n},error:null}}catch(y){if(hs(y))return{data:null,error:y};throw y}})}update(c,m,y){return Ws(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",c,m,y)})}move(c,m,y){return Ws(this,void 0,void 0,function*(){try{return{data:yield fc(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:c,destinationKey:m,destinationBucket:y==null?void 0:y.destinationBucket},{headers:this.headers}),error:null}}catch(T){if(hs(T))return{data:null,error:T};throw T}})}copy(c,m,y){return Ws(this,void 0,void 0,function*(){try{return{data:{path:(yield fc(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:c,destinationKey:m,destinationBucket:y==null?void 0:y.destinationBucket},{headers:this.headers})).Key},error:null}}catch(T){if(hs(T))return{data:null,error:T};throw T}})}createSignedUrl(c,m,y){return Ws(this,void 0,void 0,function*(){try{let T=this._getFinalPath(c),S=yield fc(this.fetch,`${this.url}/object/sign/${T}`,Object.assign({expiresIn:m},y!=null&&y.transform?{transform:y.transform}:{}),{headers:this.headers});const M=y!=null&&y.download?`&download=${y.download===!0?"":y.download}`:"";return S={signedUrl:encodeURI(`${this.url}${S.signedURL}${M}`)},{data:S,error:null}}catch(T){if(hs(T))return{data:null,error:T};throw T}})}createSignedUrls(c,m,y){return Ws(this,void 0,void 0,function*(){try{const T=yield fc(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:m,paths:c},{headers:this.headers}),S=y!=null&&y.download?`&download=${y.download===!0?"":y.download}`:"";return{data:T.map(M=>Object.assign(Object.assign({},M),{signedUrl:M.signedURL?encodeURI(`${this.url}${M.signedURL}${S}`):null})),error:null}}catch(T){if(hs(T))return{data:null,error:T};throw T}})}download(c,m){return Ws(this,void 0,void 0,function*(){const T=typeof(m==null?void 0:m.transform)<"u"?"render/image/authenticated":"object",S=this.transformOptsToQueryString((m==null?void 0:m.transform)||{}),M=S?`?${S}`:"";try{const n=this._getFinalPath(c);return{data:yield(yield oy(this.fetch,`${this.url}/${T}/${n}${M}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(n){if(hs(n))return{data:null,error:n};throw n}})}info(c){return Ws(this,void 0,void 0,function*(){const m=this._getFinalPath(c);try{const y=yield oy(this.fetch,`${this.url}/object/info/${m}`,{headers:this.headers});return{data:Dx(y),error:null}}catch(y){if(hs(y))return{data:null,error:y};throw y}})}exists(c){return Ws(this,void 0,void 0,function*(){const m=this._getFinalPath(c);try{return yield g3(this.fetch,`${this.url}/object/${m}`,{headers:this.headers}),{data:!0,error:null}}catch(y){if(hs(y)&&y instanceof Rx){const T=y.originalError;if([400,404].includes(T==null?void 0:T.status))return{data:!1,error:y}}throw y}})}getPublicUrl(c,m){const y=this._getFinalPath(c),T=[],S=m!=null&&m.download?`download=${m.download===!0?"":m.download}`:"";S!==""&&T.push(S);const n=typeof(m==null?void 0:m.transform)<"u"?"render/image":"object",F=this.transformOptsToQueryString((m==null?void 0:m.transform)||{});F!==""&&T.push(F);let W=T.join("&");return W!==""&&(W=`?${W}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${y}${W}`)}}}remove(c){return Ws(this,void 0,void 0,function*(){try{return{data:yield LI(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:c},{headers:this.headers}),error:null}}catch(m){if(hs(m))return{data:null,error:m};throw m}})}list(c,m,y){return Ws(this,void 0,void 0,function*(){try{const T=Object.assign(Object.assign(Object.assign({},y3),m),{prefix:c||""});return{data:yield fc(this.fetch,`${this.url}/object/list/${this.bucketId}`,T,{headers:this.headers},y),error:null}}catch(T){if(hs(T))return{data:null,error:T};throw T}})}encodeMetadata(c){return JSON.stringify(c)}toBase64(c){return typeof Buffer<"u"?Buffer.from(c).toString("base64"):btoa(c)}_getFinalPath(c){return`${this.bucketId}/${c}`}_removeEmptyFolders(c){return c.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(c){const m=[];return c.width&&m.push(`width=${c.width}`),c.height&&m.push(`height=${c.height}`),c.resize&&m.push(`resize=${c.resize}`),c.format&&m.push(`format=${c.format}`),c.quality&&m.push(`quality=${c.quality}`),m.join("&")}}const x3="2.7.1",b3={"X-Client-Info":`storage-js/${x3}`};var gd=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};class w3{constructor(c,m={},y){this.url=c,this.headers=Object.assign(Object.assign({},b3),m),this.fetch=kI(y)}listBuckets(){return gd(this,void 0,void 0,function*(){try{return{data:yield oy(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(c){if(hs(c))return{data:null,error:c};throw c}})}getBucket(c){return gd(this,void 0,void 0,function*(){try{return{data:yield oy(this.fetch,`${this.url}/bucket/${c}`,{headers:this.headers}),error:null}}catch(m){if(hs(m))return{data:null,error:m};throw m}})}createBucket(c,m={public:!1}){return gd(this,void 0,void 0,function*(){try{return{data:yield fc(this.fetch,`${this.url}/bucket`,{id:c,name:c,public:m.public,file_size_limit:m.fileSizeLimit,allowed_mime_types:m.allowedMimeTypes},{headers:this.headers}),error:null}}catch(y){if(hs(y))return{data:null,error:y};throw y}})}updateBucket(c,m){return gd(this,void 0,void 0,function*(){try{return{data:yield _3(this.fetch,`${this.url}/bucket/${c}`,{id:c,name:c,public:m.public,file_size_limit:m.fileSizeLimit,allowed_mime_types:m.allowedMimeTypes},{headers:this.headers}),error:null}}catch(y){if(hs(y))return{data:null,error:y};throw y}})}emptyBucket(c){return gd(this,void 0,void 0,function*(){try{return{data:yield fc(this.fetch,`${this.url}/bucket/${c}/empty`,{},{headers:this.headers}),error:null}}catch(m){if(hs(m))return{data:null,error:m};throw m}})}deleteBucket(c){return gd(this,void 0,void 0,function*(){try{return{data:yield LI(this.fetch,`${this.url}/bucket/${c}`,{},{headers:this.headers}),error:null}}catch(m){if(hs(m))return{data:null,error:m};throw m}})}}class T3 extends w3{constructor(c,m={},y){super(c,m,y)}from(c){return new v3(this.url,this.headers,c,this.fetch)}}const S3="2.49.4";let $p="";typeof Deno<"u"?$p="deno":typeof document<"u"?$p="web":typeof navigator<"u"&&navigator.product==="ReactNative"?$p="react-native":$p="node";const E3={"X-Client-Info":`supabase-js-${$p}/${S3}`},A3={headers:E3},I3={schema:"public"},C3={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},P3={};var M3=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};const R3=a=>{let c;return a?c=a:typeof fetch>"u"?c=TI:c=fetch,(...m)=>c(...m)},D3=()=>typeof Headers>"u"?SI:Headers,k3=(a,c,m)=>{const y=R3(m),T=D3();return(S,M)=>M3(void 0,void 0,void 0,function*(){var n;const F=(n=yield c())!==null&&n!==void 0?n:a;let W=new T(M==null?void 0:M.headers);return W.has("apikey")||W.set("apikey",a),W.has("Authorization")||W.set("Authorization",`Bearer ${F}`),y(S,Object.assign(Object.assign({},M),{headers:W}))})};var L3=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};function z3(a){return a.replace(/\/$/,"")}function O3(a,c){const{db:m,auth:y,realtime:T,global:S}=a,{db:M,auth:n,realtime:F,global:W}=c,N={db:Object.assign(Object.assign({},M),m),auth:Object.assign(Object.assign({},n),y),realtime:Object.assign(Object.assign({},F),T),global:Object.assign(Object.assign({},W),S),accessToken:()=>L3(this,void 0,void 0,function*(){return""})};return a.accessToken?N.accessToken=a.accessToken:delete N.accessToken,N}const zI="2.69.1",wd=30*1e3,kx=3,q0=kx*wd,F3="http://localhost:9999",B3="supabase.auth.token",N3={"X-Client-Info":`gotrue-js/${zI}`},Lx="X-Supabase-Api-Version",OI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},U3=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,V3=6e5;class mb extends Error{constructor(c,m,y){super(c),this.__isAuthError=!0,this.name="AuthError",this.status=m,this.code=y}}function Tr(a){return typeof a=="object"&&a!==null&&"__isAuthError"in a}class j3 extends mb{constructor(c,m,y){super(c,m,y),this.name="AuthApiError",this.status=m,this.code=y}}function $3(a){return Tr(a)&&a.name==="AuthApiError"}class FI extends mb{constructor(c,m){super(c),this.name="AuthUnknownError",this.originalError=m}}class Ec extends mb{constructor(c,m,y,T){super(c,y,T),this.name=m,this.status=y}}class oc extends Ec{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function G3(a){return Tr(a)&&a.name==="AuthSessionMissingError"}class W0 extends Ec{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Dg extends Ec{constructor(c){super(c,"AuthInvalidCredentialsError",400,void 0)}}class kg extends Ec{constructor(c,m=null){super(c,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=m}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function H3(a){return Tr(a)&&a.name==="AuthImplicitGrantRedirectError"}class jE extends Ec{constructor(c,m=null){super(c,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=m}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zx extends Ec{constructor(c,m){super(c,"AuthRetryableFetchError",m,void 0)}}function Z0(a){return Tr(a)&&a.name==="AuthRetryableFetchError"}class $E extends Ec{constructor(c,m,y){super(c,"AuthWeakPasswordError",m,"weak_password"),this.reasons=y}}class em extends Ec{constructor(c){super(c,"AuthInvalidJwtError",400,"invalid_jwt")}}const GE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),HE=` 	
\r=`.split(""),q3=(()=>{const a=new Array(128);for(let c=0;c<a.length;c+=1)a[c]=-1;for(let c=0;c<HE.length;c+=1)a[HE[c].charCodeAt(0)]=-2;for(let c=0;c<GE.length;c+=1)a[GE[c].charCodeAt(0)]=c;return a})();function BI(a,c,m){const y=q3[a];if(y>-1)for(c.queue=c.queue<<6|y,c.queuedBits+=6;c.queuedBits>=8;)m(c.queue>>c.queuedBits-8&255),c.queuedBits-=8;else{if(y===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}}function qE(a){const c=[],m=M=>{c.push(String.fromCodePoint(M))},y={utf8seq:0,codepoint:0},T={queue:0,queuedBits:0},S=M=>{X3(M,y,m)};for(let M=0;M<a.length;M+=1)BI(a.charCodeAt(M),T,S);return c.join("")}function W3(a,c){if(a<=127){c(a);return}else if(a<=2047){c(192|a>>6),c(128|a&63);return}else if(a<=65535){c(224|a>>12),c(128|a>>6&63),c(128|a&63);return}else if(a<=1114111){c(240|a>>18),c(128|a>>12&63),c(128|a>>6&63),c(128|a&63);return}throw new Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}function Z3(a,c){for(let m=0;m<a.length;m+=1){let y=a.charCodeAt(m);if(y>55295&&y<=56319){const T=(y-55296)*1024&65535;y=(a.charCodeAt(m+1)-56320&65535|T)+65536,m+=1}W3(y,c)}}function X3(a,c,m){if(c.utf8seq===0){if(a<=127){m(a);return}for(let y=1;y<6;y+=1)if((a>>7-y&1)===0){c.utf8seq=y;break}if(c.utf8seq===2)c.codepoint=a&31;else if(c.utf8seq===3)c.codepoint=a&15;else if(c.utf8seq===4)c.codepoint=a&7;else throw new Error("Invalid UTF-8 sequence");c.utf8seq-=1}else if(c.utf8seq>0){if(a<=127)throw new Error("Invalid UTF-8 sequence");c.codepoint=c.codepoint<<6|a&63,c.utf8seq-=1,c.utf8seq===0&&m(c.codepoint)}}function K3(a){const c=[],m={queue:0,queuedBits:0},y=T=>{c.push(T)};for(let T=0;T<a.length;T+=1)BI(a.charCodeAt(T),m,y);return new Uint8Array(c)}function Y3(a){const c=[];return Z3(a,m=>c.push(m)),new Uint8Array(c)}function J3(a){return Math.round(Date.now()/1e3)+a}function Q3(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const c=Math.random()*16|0;return(a=="x"?c:c&3|8).toString(16)})}const ba=()=>typeof window<"u"&&typeof document<"u",Mu={tested:!1,writable:!1},tm=()=>{if(!ba())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mu.tested)return Mu.writable;const a=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(a,a),globalThis.localStorage.removeItem(a),Mu.tested=!0,Mu.writable=!0}catch{Mu.tested=!0,Mu.writable=!1}return Mu.writable};function eB(a){const c={},m=new URL(a);if(m.hash&&m.hash[0]==="#")try{new URLSearchParams(m.hash.substring(1)).forEach((T,S)=>{c[S]=T})}catch{}return m.searchParams.forEach((y,T)=>{c[T]=y}),c}const NI=a=>{let c;return a?c=a:typeof fetch>"u"?c=(...m)=>Fs(async()=>{const{default:y}=await Promise.resolve().then(()=>$d);return{default:y}},void 0,import.meta.url).then(({default:y})=>y(...m)):c=fetch,(...m)=>c(...m)},tB=a=>typeof a=="object"&&a!==null&&"status"in a&&"ok"in a&&"json"in a&&typeof a.json=="function",UI=async(a,c,m)=>{await a.setItem(c,JSON.stringify(m))},Lg=async(a,c)=>{const m=await a.getItem(c);if(!m)return null;try{return JSON.parse(m)}catch{return m}},zg=async(a,c)=>{await a.removeItem(c)};class Sy{constructor(){this.promise=new Sy.promiseConstructor((c,m)=>{this.resolve=c,this.reject=m})}}Sy.promiseConstructor=Promise;function X0(a){const c=a.split(".");if(c.length!==3)throw new em("Invalid JWT structure");for(let y=0;y<c.length;y++)if(!U3.test(c[y]))throw new em("JWT not in base64url format");return{header:JSON.parse(qE(c[0])),payload:JSON.parse(qE(c[1])),signature:K3(c[2]),raw:{header:c[0],payload:c[1]}}}async function iB(a){return await new Promise(c=>{setTimeout(()=>c(null),a)})}function rB(a,c){return new Promise((y,T)=>{(async()=>{for(let S=0;S<1/0;S++)try{const M=await a(S);if(!c(S,null,M)){y(M);return}}catch(M){if(!c(S,M)){T(M);return}}})()})}function nB(a){return("0"+a.toString(16)).substr(-2)}function sB(){const c=new Uint32Array(56);if(typeof crypto>"u"){const m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",y=m.length;let T="";for(let S=0;S<56;S++)T+=m.charAt(Math.floor(Math.random()*y));return T}return crypto.getRandomValues(c),Array.from(c,nB).join("")}async function oB(a){const m=new TextEncoder().encode(a),y=await crypto.subtle.digest("SHA-256",m),T=new Uint8Array(y);return Array.from(T).map(S=>String.fromCharCode(S)).join("")}async function aB(a){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a;const m=await oB(a);return btoa(m).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function yd(a,c,m=!1){const y=sB();let T=y;m&&(T+="/PASSWORD_RECOVERY"),await UI(a,`${c}-code-verifier`,T);const S=await aB(y);return[S,y===S?"plain":"s256"]}const lB=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function cB(a){const c=a.headers.get(Lx);if(!c||!c.match(lB))return null;try{return new Date(`${c}T00:00:00.0Z`)}catch{return null}}function uB(a){if(!a)throw new Error("Missing exp claim");const c=Math.floor(Date.now()/1e3);if(a<=c)throw new Error("JWT has expired")}function hB(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var dB=function(a,c){var m={};for(var y in a)Object.prototype.hasOwnProperty.call(a,y)&&c.indexOf(y)<0&&(m[y]=a[y]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(a);T<y.length;T++)c.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(a,y[T])&&(m[y[T]]=a[y[T]]);return m};const ku=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),fB=[502,503,504];async function WE(a){var c;if(!tB(a))throw new zx(ku(a),0);if(fB.includes(a.status))throw new zx(ku(a),a.status);let m;try{m=await a.json()}catch(S){throw new FI(ku(S),S)}let y;const T=cB(a);if(T&&T.getTime()>=OI["2024-01-01"].timestamp&&typeof m=="object"&&m&&typeof m.code=="string"?y=m.code:typeof m=="object"&&m&&typeof m.error_code=="string"&&(y=m.error_code),y){if(y==="weak_password")throw new $E(ku(m),a.status,((c=m.weak_password)===null||c===void 0?void 0:c.reasons)||[]);if(y==="session_not_found")throw new oc}else if(typeof m=="object"&&m&&typeof m.weak_password=="object"&&m.weak_password&&Array.isArray(m.weak_password.reasons)&&m.weak_password.reasons.length&&m.weak_password.reasons.reduce((S,M)=>S&&typeof M=="string",!0))throw new $E(ku(m),a.status,m.weak_password.reasons);throw new j3(ku(m),a.status||500,y)}const pB=(a,c,m,y)=>{const T={method:a,headers:(c==null?void 0:c.headers)||{}};return a==="GET"?T:(T.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},c==null?void 0:c.headers),T.body=JSON.stringify(y),Object.assign(Object.assign({},T),m))};async function Vr(a,c,m,y){var T;const S=Object.assign({},y==null?void 0:y.headers);S[Lx]||(S[Lx]=OI["2024-01-01"].name),y!=null&&y.jwt&&(S.Authorization=`Bearer ${y.jwt}`);const M=(T=y==null?void 0:y.query)!==null&&T!==void 0?T:{};y!=null&&y.redirectTo&&(M.redirect_to=y.redirectTo);const n=Object.keys(M).length?"?"+new URLSearchParams(M).toString():"",F=await mB(a,c,m+n,{headers:S,noResolveJson:y==null?void 0:y.noResolveJson},{},y==null?void 0:y.body);return y!=null&&y.xform?y==null?void 0:y.xform(F):{data:Object.assign({},F),error:null}}async function mB(a,c,m,y,T,S){const M=pB(c,y,T,S);let n;try{n=await a(m,Object.assign({},M))}catch(F){throw console.error(F),new zx(ku(F),0)}if(n.ok||await WE(n),y!=null&&y.noResolveJson)return n;try{return await n.json()}catch(F){await WE(F)}}function ac(a){var c;let m=null;vB(a)&&(m=Object.assign({},a),a.expires_at||(m.expires_at=J3(a.expires_in)));const y=(c=a.user)!==null&&c!==void 0?c:a;return{data:{session:m,user:y},error:null}}function ZE(a){const c=ac(a);return!c.error&&a.weak_password&&typeof a.weak_password=="object"&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&typeof a.weak_password.message=="string"&&a.weak_password.reasons.reduce((m,y)=>m&&typeof y=="string",!0)&&(c.data.weak_password=a.weak_password),c}function mc(a){var c;return{data:{user:(c=a.user)!==null&&c!==void 0?c:a},error:null}}function _B(a){return{data:a,error:null}}function gB(a){const{action_link:c,email_otp:m,hashed_token:y,redirect_to:T,verification_type:S}=a,M=dB(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),n={action_link:c,email_otp:m,hashed_token:y,redirect_to:T,verification_type:S},F=Object.assign({},M);return{data:{properties:n,user:F},error:null}}function yB(a){return a}function vB(a){return a.access_token&&a.refresh_token&&a.expires_in}var xB=function(a,c){var m={};for(var y in a)Object.prototype.hasOwnProperty.call(a,y)&&c.indexOf(y)<0&&(m[y]=a[y]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(a);T<y.length;T++)c.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(a,y[T])&&(m[y[T]]=a[y[T]]);return m};class bB{constructor({url:c="",headers:m={},fetch:y}){this.url=c,this.headers=m,this.fetch=NI(y),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(c,m="global"){try{return await Vr(this.fetch,"POST",`${this.url}/logout?scope=${m}`,{headers:this.headers,jwt:c,noResolveJson:!0}),{data:null,error:null}}catch(y){if(Tr(y))return{data:null,error:y};throw y}}async inviteUserByEmail(c,m={}){try{return await Vr(this.fetch,"POST",`${this.url}/invite`,{body:{email:c,data:m.data},headers:this.headers,redirectTo:m.redirectTo,xform:mc})}catch(y){if(Tr(y))return{data:{user:null},error:y};throw y}}async generateLink(c){try{const{options:m}=c,y=xB(c,["options"]),T=Object.assign(Object.assign({},y),m);return"newEmail"in y&&(T.new_email=y==null?void 0:y.newEmail,delete T.newEmail),await Vr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:T,headers:this.headers,xform:gB,redirectTo:m==null?void 0:m.redirectTo})}catch(m){if(Tr(m))return{data:{properties:null,user:null},error:m};throw m}}async createUser(c){try{return await Vr(this.fetch,"POST",`${this.url}/admin/users`,{body:c,headers:this.headers,xform:mc})}catch(m){if(Tr(m))return{data:{user:null},error:m};throw m}}async listUsers(c){var m,y,T,S,M,n,F;try{const W={nextPage:null,lastPage:0,total:0},N=await Vr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(y=(m=c==null?void 0:c.page)===null||m===void 0?void 0:m.toString())!==null&&y!==void 0?y:"",per_page:(S=(T=c==null?void 0:c.perPage)===null||T===void 0?void 0:T.toString())!==null&&S!==void 0?S:""},xform:yB});if(N.error)throw N.error;const Y=await N.json(),le=(M=N.headers.get("x-total-count"))!==null&&M!==void 0?M:0,de=(F=(n=N.headers.get("link"))===null||n===void 0?void 0:n.split(","))!==null&&F!==void 0?F:[];return de.length>0&&(de.forEach(Te=>{const pe=parseInt(Te.split(";")[0].split("=")[1].substring(0,1)),qe=JSON.parse(Te.split(";")[1].split("=")[1]);W[`${qe}Page`]=pe}),W.total=parseInt(le)),{data:Object.assign(Object.assign({},Y),W),error:null}}catch(W){if(Tr(W))return{data:{users:[]},error:W};throw W}}async getUserById(c){try{return await Vr(this.fetch,"GET",`${this.url}/admin/users/${c}`,{headers:this.headers,xform:mc})}catch(m){if(Tr(m))return{data:{user:null},error:m};throw m}}async updateUserById(c,m){try{return await Vr(this.fetch,"PUT",`${this.url}/admin/users/${c}`,{body:m,headers:this.headers,xform:mc})}catch(y){if(Tr(y))return{data:{user:null},error:y};throw y}}async deleteUser(c,m=!1){try{return await Vr(this.fetch,"DELETE",`${this.url}/admin/users/${c}`,{headers:this.headers,body:{should_soft_delete:m},xform:mc})}catch(y){if(Tr(y))return{data:{user:null},error:y};throw y}}async _listFactors(c){try{const{data:m,error:y}=await Vr(this.fetch,"GET",`${this.url}/admin/users/${c.userId}/factors`,{headers:this.headers,xform:T=>({data:{factors:T},error:null})});return{data:m,error:y}}catch(m){if(Tr(m))return{data:null,error:m};throw m}}async _deleteFactor(c){try{return{data:await Vr(this.fetch,"DELETE",`${this.url}/admin/users/${c.userId}/factors/${c.id}`,{headers:this.headers}),error:null}}catch(m){if(Tr(m))return{data:null,error:m};throw m}}}const wB={getItem:a=>tm()?globalThis.localStorage.getItem(a):null,setItem:(a,c)=>{tm()&&globalThis.localStorage.setItem(a,c)},removeItem:a=>{tm()&&globalThis.localStorage.removeItem(a)}};function XE(a={}){return{getItem:c=>a[c]||null,setItem:(c,m)=>{a[c]=m},removeItem:c=>{delete a[c]}}}function TB(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const vd={debug:!!(globalThis&&tm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class VI extends Error{constructor(c){super(c),this.isAcquireTimeout=!0}}class SB extends VI{}async function EB(a,c,m){vd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",a,c);const y=new globalThis.AbortController;return c>0&&setTimeout(()=>{y.abort(),vd.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",a)},c),await Promise.resolve().then(()=>globalThis.navigator.locks.request(a,c===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:y.signal},async T=>{if(T){vd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",a,T.name);try{return await m()}finally{vd.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",a,T.name)}}else{if(c===0)throw vd.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",a),new SB(`Acquiring an exclusive Navigator LockManager lock "${a}" immediately failed`);if(vd.debug)try{const S=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(S,null,"  "))}catch(S){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",S)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await m()}}))}TB();const AB={url:F3,storageKey:B3,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:N3,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function KE(a,c,m){return await m()}class pm{constructor(c){var m,y;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=pm.nextInstanceID,pm.nextInstanceID+=1,this.instanceID>0&&ba()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const T=Object.assign(Object.assign({},AB),c);if(this.logDebugMessages=!!T.debug,typeof T.debug=="function"&&(this.logger=T.debug),this.persistSession=T.persistSession,this.storageKey=T.storageKey,this.autoRefreshToken=T.autoRefreshToken,this.admin=new bB({url:T.url,headers:T.headers,fetch:T.fetch}),this.url=T.url,this.headers=T.headers,this.fetch=NI(T.fetch),this.lock=T.lock||KE,this.detectSessionInUrl=T.detectSessionInUrl,this.flowType=T.flowType,this.hasCustomAuthorizationHeader=T.hasCustomAuthorizationHeader,T.lock?this.lock=T.lock:ba()&&(!((m=globalThis==null?void 0:globalThis.navigator)===null||m===void 0)&&m.locks)?this.lock=EB:this.lock=KE,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?T.storage?this.storage=T.storage:tm()?this.storage=wB:(this.memoryStorage={},this.storage=XE(this.memoryStorage)):(this.memoryStorage={},this.storage=XE(this.memoryStorage)),ba()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(S){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",S)}(y=this.broadcastChannel)===null||y===void 0||y.addEventListener("message",async S=>{this._debug("received broadcast notification from other tab or client",S),await this._notifyAllSubscribers(S.data.event,S.data.session,!1)})}this.initialize()}_debug(...c){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${zI}) ${new Date().toISOString()}`,...c),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var c;try{const m=eB(window.location.href);let y="none";if(this._isImplicitGrantCallback(m)?y="implicit":await this._isPKCECallback(m)&&(y="pkce"),ba()&&this.detectSessionInUrl&&y!=="none"){const{data:T,error:S}=await this._getSessionFromURL(m,y);if(S){if(this._debug("#_initialize()","error detecting session from URL",S),H3(S)){const F=(c=S.details)===null||c===void 0?void 0:c.code;if(F==="identity_already_exists"||F==="identity_not_found"||F==="single_identity_not_deletable")return{error:S}}return await this._removeSession(),{error:S}}const{session:M,redirectType:n}=T;return this._debug("#_initialize()","detected session in URL",M,"redirect type",n),await this._saveSession(M),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",M):await this._notifyAllSubscribers("SIGNED_IN",M)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(m){return Tr(m)?{error:m}:{error:new FI("Unexpected error during initialization",m)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(c){var m,y,T;try{const S=await Vr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(y=(m=c==null?void 0:c.options)===null||m===void 0?void 0:m.data)!==null&&y!==void 0?y:{},gotrue_meta_security:{captcha_token:(T=c==null?void 0:c.options)===null||T===void 0?void 0:T.captchaToken}},xform:ac}),{data:M,error:n}=S;if(n||!M)return{data:{user:null,session:null},error:n};const F=M.session,W=M.user;return M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",F)),{data:{user:W,session:F},error:null}}catch(S){if(Tr(S))return{data:{user:null,session:null},error:S};throw S}}async signUp(c){var m,y,T;try{let S;if("email"in c){const{email:N,password:Y,options:le}=c;let de=null,Te=null;this.flowType==="pkce"&&([de,Te]=await yd(this.storage,this.storageKey)),S=await Vr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:le==null?void 0:le.emailRedirectTo,body:{email:N,password:Y,data:(m=le==null?void 0:le.data)!==null&&m!==void 0?m:{},gotrue_meta_security:{captcha_token:le==null?void 0:le.captchaToken},code_challenge:de,code_challenge_method:Te},xform:ac})}else if("phone"in c){const{phone:N,password:Y,options:le}=c;S=await Vr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:N,password:Y,data:(y=le==null?void 0:le.data)!==null&&y!==void 0?y:{},channel:(T=le==null?void 0:le.channel)!==null&&T!==void 0?T:"sms",gotrue_meta_security:{captcha_token:le==null?void 0:le.captchaToken}},xform:ac})}else throw new Dg("You must provide either an email or phone number and a password");const{data:M,error:n}=S;if(n||!M)return{data:{user:null,session:null},error:n};const F=M.session,W=M.user;return M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",F)),{data:{user:W,session:F},error:null}}catch(S){if(Tr(S))return{data:{user:null,session:null},error:S};throw S}}async signInWithPassword(c){try{let m;if("email"in c){const{email:S,password:M,options:n}=c;m=await Vr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:S,password:M,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:ZE})}else if("phone"in c){const{phone:S,password:M,options:n}=c;m=await Vr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:S,password:M,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:ZE})}else throw new Dg("You must provide either an email or phone number and a password");const{data:y,error:T}=m;return T?{data:{user:null,session:null},error:T}:!y||!y.session||!y.user?{data:{user:null,session:null},error:new W0}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({user:y.user,session:y.session},y.weak_password?{weakPassword:y.weak_password}:null),error:T})}catch(m){if(Tr(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithOAuth(c){var m,y,T,S;return await this._handleProviderSignIn(c.provider,{redirectTo:(m=c.options)===null||m===void 0?void 0:m.redirectTo,scopes:(y=c.options)===null||y===void 0?void 0:y.scopes,queryParams:(T=c.options)===null||T===void 0?void 0:T.queryParams,skipBrowserRedirect:(S=c.options)===null||S===void 0?void 0:S.skipBrowserRedirect})}async exchangeCodeForSession(c){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(c))}async _exchangeCodeForSession(c){const m=await Lg(this.storage,`${this.storageKey}-code-verifier`),[y,T]=(m??"").split("/");try{const{data:S,error:M}=await Vr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:c,code_verifier:y},xform:ac});if(await zg(this.storage,`${this.storageKey}-code-verifier`),M)throw M;return!S||!S.session||!S.user?{data:{user:null,session:null,redirectType:null},error:new W0}:(S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),{data:Object.assign(Object.assign({},S),{redirectType:T??null}),error:M})}catch(S){if(Tr(S))return{data:{user:null,session:null,redirectType:null},error:S};throw S}}async signInWithIdToken(c){try{const{options:m,provider:y,token:T,access_token:S,nonce:M}=c,n=await Vr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:y,id_token:T,access_token:S,nonce:M,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:ac}),{data:F,error:W}=n;return W?{data:{user:null,session:null},error:W}:!F||!F.session||!F.user?{data:{user:null,session:null},error:new W0}:(F.session&&(await this._saveSession(F.session),await this._notifyAllSubscribers("SIGNED_IN",F.session)),{data:F,error:W})}catch(m){if(Tr(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithOtp(c){var m,y,T,S,M;try{if("email"in c){const{email:n,options:F}=c;let W=null,N=null;this.flowType==="pkce"&&([W,N]=await yd(this.storage,this.storageKey));const{error:Y}=await Vr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:(m=F==null?void 0:F.data)!==null&&m!==void 0?m:{},create_user:(y=F==null?void 0:F.shouldCreateUser)!==null&&y!==void 0?y:!0,gotrue_meta_security:{captcha_token:F==null?void 0:F.captchaToken},code_challenge:W,code_challenge_method:N},redirectTo:F==null?void 0:F.emailRedirectTo});return{data:{user:null,session:null},error:Y}}if("phone"in c){const{phone:n,options:F}=c,{data:W,error:N}=await Vr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:n,data:(T=F==null?void 0:F.data)!==null&&T!==void 0?T:{},create_user:(S=F==null?void 0:F.shouldCreateUser)!==null&&S!==void 0?S:!0,gotrue_meta_security:{captcha_token:F==null?void 0:F.captchaToken},channel:(M=F==null?void 0:F.channel)!==null&&M!==void 0?M:"sms"}});return{data:{user:null,session:null,messageId:W==null?void 0:W.message_id},error:N}}throw new Dg("You must provide either an email or phone number.")}catch(n){if(Tr(n))return{data:{user:null,session:null},error:n};throw n}}async verifyOtp(c){var m,y;try{let T,S;"options"in c&&(T=(m=c.options)===null||m===void 0?void 0:m.redirectTo,S=(y=c.options)===null||y===void 0?void 0:y.captchaToken);const{data:M,error:n}=await Vr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},c),{gotrue_meta_security:{captcha_token:S}}),redirectTo:T,xform:ac});if(n)throw n;if(!M)throw new Error("An error occurred on token verification.");const F=M.session,W=M.user;return F!=null&&F.access_token&&(await this._saveSession(F),await this._notifyAllSubscribers(c.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",F)),{data:{user:W,session:F},error:null}}catch(T){if(Tr(T))return{data:{user:null,session:null},error:T};throw T}}async signInWithSSO(c){var m,y,T;try{let S=null,M=null;return this.flowType==="pkce"&&([S,M]=await yd(this.storage,this.storageKey)),await Vr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in c?{provider_id:c.providerId}:null),"domain"in c?{domain:c.domain}:null),{redirect_to:(y=(m=c.options)===null||m===void 0?void 0:m.redirectTo)!==null&&y!==void 0?y:void 0}),!((T=c==null?void 0:c.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:c.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:S,code_challenge_method:M}),headers:this.headers,xform:_B})}catch(S){if(Tr(S))return{data:null,error:S};throw S}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async c=>{const{data:{session:m},error:y}=c;if(y)throw y;if(!m)throw new oc;const{error:T}=await Vr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:m.access_token});return{data:{user:null,session:null},error:T}})}catch(c){if(Tr(c))return{data:{user:null,session:null},error:c};throw c}}async resend(c){try{const m=`${this.url}/resend`;if("email"in c){const{email:y,type:T,options:S}=c,{error:M}=await Vr(this.fetch,"POST",m,{headers:this.headers,body:{email:y,type:T,gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken}},redirectTo:S==null?void 0:S.emailRedirectTo});return{data:{user:null,session:null},error:M}}else if("phone"in c){const{phone:y,type:T,options:S}=c,{data:M,error:n}=await Vr(this.fetch,"POST",m,{headers:this.headers,body:{phone:y,type:T,gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken}}});return{data:{user:null,session:null,messageId:M==null?void 0:M.message_id},error:n}}throw new Dg("You must provide either an email or phone number and a type")}catch(m){if(Tr(m))return{data:{user:null,session:null},error:m};throw m}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async m=>m))}async _acquireLock(c,m){this._debug("#_acquireLock","begin",c);try{if(this.lockAcquired){const y=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),T=(async()=>(await y,await m()))();return this.pendingInLock.push((async()=>{try{await T}catch{}})()),T}return await this.lock(`lock:${this.storageKey}`,c,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const y=m();for(this.pendingInLock.push((async()=>{try{await y}catch{}})()),await y;this.pendingInLock.length;){const T=[...this.pendingInLock];await Promise.all(T),this.pendingInLock.splice(0,T.length)}return await y}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(c){this._debug("#_useSession","begin");try{const m=await this.__loadSession();return await c(m)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let c=null;const m=await Lg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",m),m!==null&&(this._isValidSession(m)?c=m:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!c)return{data:{session:null},error:null};const y=c.expires_at?c.expires_at*1e3-Date.now()<q0:!1;if(this._debug("#__loadSession()",`session has${y?"":" not"} expired`,"expires_at",c.expires_at),!y){if(this.storage.isServer){let M=this.suppressGetSessionWarning;c=new Proxy(c,{get:(F,W,N)=>(!M&&W==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),M=!0,this.suppressGetSessionWarning=!0),Reflect.get(F,W,N))})}return{data:{session:c},error:null}}const{session:T,error:S}=await this._callRefreshToken(c.refresh_token);return S?{data:{session:null},error:S}:{data:{session:T},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(c){return c?await this._getUser(c):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(c){try{return c?await Vr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:c,xform:mc}):await this._useSession(async m=>{var y,T,S;const{data:M,error:n}=m;if(n)throw n;return!(!((y=M.session)===null||y===void 0)&&y.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new oc}:await Vr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(S=(T=M.session)===null||T===void 0?void 0:T.access_token)!==null&&S!==void 0?S:void 0,xform:mc})})}catch(m){if(Tr(m))return G3(m)&&(await this._removeSession(),await zg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:m};throw m}}async updateUser(c,m={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(c,m))}async _updateUser(c,m={}){try{return await this._useSession(async y=>{const{data:T,error:S}=y;if(S)throw S;if(!T.session)throw new oc;const M=T.session;let n=null,F=null;this.flowType==="pkce"&&c.email!=null&&([n,F]=await yd(this.storage,this.storageKey));const{data:W,error:N}=await Vr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:Object.assign(Object.assign({},c),{code_challenge:n,code_challenge_method:F}),jwt:M.access_token,xform:mc});if(N)throw N;return M.user=W.user,await this._saveSession(M),await this._notifyAllSubscribers("USER_UPDATED",M),{data:{user:M.user},error:null}})}catch(y){if(Tr(y))return{data:{user:null},error:y};throw y}}async setSession(c){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(c))}async _setSession(c){try{if(!c.access_token||!c.refresh_token)throw new oc;const m=Date.now()/1e3;let y=m,T=!0,S=null;const{payload:M}=X0(c.access_token);if(M.exp&&(y=M.exp,T=y<=m),T){const{session:n,error:F}=await this._callRefreshToken(c.refresh_token);if(F)return{data:{user:null,session:null},error:F};if(!n)return{data:{user:null,session:null},error:null};S=n}else{const{data:n,error:F}=await this._getUser(c.access_token);if(F)throw F;S={access_token:c.access_token,refresh_token:c.refresh_token,user:n.user,token_type:"bearer",expires_in:y-m,expires_at:y},await this._saveSession(S),await this._notifyAllSubscribers("SIGNED_IN",S)}return{data:{user:S.user,session:S},error:null}}catch(m){if(Tr(m))return{data:{session:null,user:null},error:m};throw m}}async refreshSession(c){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(c))}async _refreshSession(c){try{return await this._useSession(async m=>{var y;if(!c){const{data:M,error:n}=m;if(n)throw n;c=(y=M.session)!==null&&y!==void 0?y:void 0}if(!(c!=null&&c.refresh_token))throw new oc;const{session:T,error:S}=await this._callRefreshToken(c.refresh_token);return S?{data:{user:null,session:null},error:S}:T?{data:{user:T.user,session:T},error:null}:{data:{user:null,session:null},error:null}})}catch(m){if(Tr(m))return{data:{user:null,session:null},error:m};throw m}}async _getSessionFromURL(c,m){try{if(!ba())throw new kg("No browser detected.");if(c.error||c.error_description||c.error_code)throw new kg(c.error_description||"Error in URL with unspecified error_description",{error:c.error||"unspecified_error",code:c.error_code||"unspecified_code"});switch(m){case"implicit":if(this.flowType==="pkce")throw new jE("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new kg("Not a valid implicit grant flow url.");break;default:}if(m==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!c.code)throw new jE("No code detected.");const{data:ze,error:be}=await this._exchangeCodeForSession(c.code);if(be)throw be;const ke=new URL(window.location.href);return ke.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ke.toString()),{data:{session:ze.session,redirectType:null},error:null}}const{provider_token:y,provider_refresh_token:T,access_token:S,refresh_token:M,expires_in:n,expires_at:F,token_type:W}=c;if(!S||!n||!M||!W)throw new kg("No session defined in URL");const N=Math.round(Date.now()/1e3),Y=parseInt(n);let le=N+Y;F&&(le=parseInt(F));const de=le-N;de*1e3<=wd&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${de}s, should have been closer to ${Y}s`);const Te=le-Y;N-Te>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Te,le,N):N-Te<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Te,le,N);const{data:pe,error:qe}=await this._getUser(S);if(qe)throw qe;const $e={provider_token:y,provider_refresh_token:T,access_token:S,expires_in:Y,expires_at:le,refresh_token:M,token_type:W,user:pe.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:$e,redirectType:c.type},error:null}}catch(y){if(Tr(y))return{data:{session:null,redirectType:null},error:y};throw y}}_isImplicitGrantCallback(c){return!!(c.access_token||c.error_description)}async _isPKCECallback(c){const m=await Lg(this.storage,`${this.storageKey}-code-verifier`);return!!(c.code&&m)}async signOut(c={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(c))}async _signOut({scope:c}={scope:"global"}){return await this._useSession(async m=>{var y;const{data:T,error:S}=m;if(S)return{error:S};const M=(y=T.session)===null||y===void 0?void 0:y.access_token;if(M){const{error:n}=await this.admin.signOut(M,c);if(n&&!($3(n)&&(n.status===404||n.status===401||n.status===403)))return{error:n}}return c!=="others"&&(await this._removeSession(),await zg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(c){const m=Q3(),y={id:m,callback:c,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",m),this.stateChangeEmitters.delete(m)}};return this._debug("#onAuthStateChange()","registered callback with id",m),this.stateChangeEmitters.set(m,y),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(m)})))(),{data:{subscription:y}}}async _emitInitialSession(c){return await this._useSession(async m=>{var y,T;try{const{data:{session:S},error:M}=m;if(M)throw M;await((y=this.stateChangeEmitters.get(c))===null||y===void 0?void 0:y.callback("INITIAL_SESSION",S)),this._debug("INITIAL_SESSION","callback id",c,"session",S)}catch(S){await((T=this.stateChangeEmitters.get(c))===null||T===void 0?void 0:T.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",c,"error",S),console.error(S)}})}async resetPasswordForEmail(c,m={}){let y=null,T=null;this.flowType==="pkce"&&([y,T]=await yd(this.storage,this.storageKey,!0));try{return await Vr(this.fetch,"POST",`${this.url}/recover`,{body:{email:c,code_challenge:y,code_challenge_method:T,gotrue_meta_security:{captcha_token:m.captchaToken}},headers:this.headers,redirectTo:m.redirectTo})}catch(S){if(Tr(S))return{data:null,error:S};throw S}}async getUserIdentities(){var c;try{const{data:m,error:y}=await this.getUser();if(y)throw y;return{data:{identities:(c=m.user.identities)!==null&&c!==void 0?c:[]},error:null}}catch(m){if(Tr(m))return{data:null,error:m};throw m}}async linkIdentity(c){var m;try{const{data:y,error:T}=await this._useSession(async S=>{var M,n,F,W,N;const{data:Y,error:le}=S;if(le)throw le;const de=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,c.provider,{redirectTo:(M=c.options)===null||M===void 0?void 0:M.redirectTo,scopes:(n=c.options)===null||n===void 0?void 0:n.scopes,queryParams:(F=c.options)===null||F===void 0?void 0:F.queryParams,skipBrowserRedirect:!0});return await Vr(this.fetch,"GET",de,{headers:this.headers,jwt:(N=(W=Y.session)===null||W===void 0?void 0:W.access_token)!==null&&N!==void 0?N:void 0})});if(T)throw T;return ba()&&!(!((m=c.options)===null||m===void 0)&&m.skipBrowserRedirect)&&window.location.assign(y==null?void 0:y.url),{data:{provider:c.provider,url:y==null?void 0:y.url},error:null}}catch(y){if(Tr(y))return{data:{provider:c.provider,url:null},error:y};throw y}}async unlinkIdentity(c){try{return await this._useSession(async m=>{var y,T;const{data:S,error:M}=m;if(M)throw M;return await Vr(this.fetch,"DELETE",`${this.url}/user/identities/${c.identity_id}`,{headers:this.headers,jwt:(T=(y=S.session)===null||y===void 0?void 0:y.access_token)!==null&&T!==void 0?T:void 0})})}catch(m){if(Tr(m))return{data:null,error:m};throw m}}async _refreshAccessToken(c){const m=`#_refreshAccessToken(${c.substring(0,5)}...)`;this._debug(m,"begin");try{const y=Date.now();return await rB(async T=>(T>0&&await iB(200*Math.pow(2,T-1)),this._debug(m,"refreshing attempt",T),await Vr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:c},headers:this.headers,xform:ac})),(T,S)=>{const M=200*Math.pow(2,T);return S&&Z0(S)&&Date.now()+M-y<wd})}catch(y){if(this._debug(m,"error",y),Tr(y))return{data:{session:null,user:null},error:y};throw y}finally{this._debug(m,"end")}}_isValidSession(c){return typeof c=="object"&&c!==null&&"access_token"in c&&"refresh_token"in c&&"expires_at"in c}async _handleProviderSignIn(c,m){const y=await this._getUrlForProvider(`${this.url}/authorize`,c,{redirectTo:m.redirectTo,scopes:m.scopes,queryParams:m.queryParams});return this._debug("#_handleProviderSignIn()","provider",c,"options",m,"url",y),ba()&&!m.skipBrowserRedirect&&window.location.assign(y),{data:{provider:c,url:y},error:null}}async _recoverAndRefresh(){var c;const m="#_recoverAndRefresh()";this._debug(m,"begin");try{const y=await Lg(this.storage,this.storageKey);if(this._debug(m,"session from storage",y),!this._isValidSession(y)){this._debug(m,"session is not valid"),y!==null&&await this._removeSession();return}const T=((c=y.expires_at)!==null&&c!==void 0?c:1/0)*1e3-Date.now()<q0;if(this._debug(m,`session has${T?"":" not"} expired with margin of ${q0}s`),T){if(this.autoRefreshToken&&y.refresh_token){const{error:S}=await this._callRefreshToken(y.refresh_token);S&&(console.error(S),Z0(S)||(this._debug(m,"refresh failed with a non-retryable error, removing the session",S),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",y)}catch(y){this._debug(m,"error",y),console.error(y);return}finally{this._debug(m,"end")}}async _callRefreshToken(c){var m,y;if(!c)throw new oc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const T=`#_callRefreshToken(${c.substring(0,5)}...)`;this._debug(T,"begin");try{this.refreshingDeferred=new Sy;const{data:S,error:M}=await this._refreshAccessToken(c);if(M)throw M;if(!S.session)throw new oc;await this._saveSession(S.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",S.session);const n={session:S.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(S){if(this._debug(T,"error",S),Tr(S)){const M={session:null,error:S};return Z0(S)||await this._removeSession(),(m=this.refreshingDeferred)===null||m===void 0||m.resolve(M),M}throw(y=this.refreshingDeferred)===null||y===void 0||y.reject(S),S}finally{this.refreshingDeferred=null,this._debug(T,"end")}}async _notifyAllSubscribers(c,m,y=!0){const T=`#_notifyAllSubscribers(${c})`;this._debug(T,"begin",m,`broadcast = ${y}`);try{this.broadcastChannel&&y&&this.broadcastChannel.postMessage({event:c,session:m});const S=[],M=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(c,m)}catch(F){S.push(F)}});if(await Promise.all(M),S.length>0){for(let n=0;n<S.length;n+=1)console.error(S[n]);throw S[0]}}finally{this._debug(T,"end")}}async _saveSession(c){this._debug("#_saveSession()",c),this.suppressGetSessionWarning=!0,await UI(this.storage,this.storageKey,c)}async _removeSession(){this._debug("#_removeSession()"),await zg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const c=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{c&&ba()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",c)}catch(m){console.error("removing visibilitychange callback failed",m)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const c=setInterval(()=>this._autoRefreshTokenTick(),wd);this.autoRefreshTicker=c,c&&typeof c=="object"&&typeof c.unref=="function"?c.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(c),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const c=this.autoRefreshTicker;this.autoRefreshTicker=null,c&&clearInterval(c)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const c=Date.now();try{return await this._useSession(async m=>{const{data:{session:y}}=m;if(!y||!y.refresh_token||!y.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const T=Math.floor((y.expires_at*1e3-c)/wd);this._debug("#_autoRefreshTokenTick()",`access token expires in ${T} ticks, a tick lasts ${wd}ms, refresh threshold is ${kx} ticks`),T<=kx&&await this._callRefreshToken(y.refresh_token)})}catch(m){console.error("Auto refresh tick failed with error. This is likely a transient error.",m)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(c){if(c.isAcquireTimeout||c instanceof VI)this._debug("auto refresh token tick lock not available");else throw c}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ba()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(c){console.error("_handleVisibilityChange",c)}}async _onVisibilityChanged(c){const m=`#_onVisibilityChanged(${c})`;this._debug(m,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),c||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(m,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(c,m,y){const T=[`provider=${encodeURIComponent(m)}`];if(y!=null&&y.redirectTo&&T.push(`redirect_to=${encodeURIComponent(y.redirectTo)}`),y!=null&&y.scopes&&T.push(`scopes=${encodeURIComponent(y.scopes)}`),this.flowType==="pkce"){const[S,M]=await yd(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(S)}`,code_challenge_method:`${encodeURIComponent(M)}`});T.push(n.toString())}if(y!=null&&y.queryParams){const S=new URLSearchParams(y.queryParams);T.push(S.toString())}return y!=null&&y.skipBrowserRedirect&&T.push(`skip_http_redirect=${y.skipBrowserRedirect}`),`${c}?${T.join("&")}`}async _unenroll(c){try{return await this._useSession(async m=>{var y;const{data:T,error:S}=m;return S?{data:null,error:S}:await Vr(this.fetch,"DELETE",`${this.url}/factors/${c.factorId}`,{headers:this.headers,jwt:(y=T==null?void 0:T.session)===null||y===void 0?void 0:y.access_token})})}catch(m){if(Tr(m))return{data:null,error:m};throw m}}async _enroll(c){try{return await this._useSession(async m=>{var y,T;const{data:S,error:M}=m;if(M)return{data:null,error:M};const n=Object.assign({friendly_name:c.friendlyName,factor_type:c.factorType},c.factorType==="phone"?{phone:c.phone}:{issuer:c.issuer}),{data:F,error:W}=await Vr(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:(y=S==null?void 0:S.session)===null||y===void 0?void 0:y.access_token});return W?{data:null,error:W}:(c.factorType==="totp"&&(!((T=F==null?void 0:F.totp)===null||T===void 0)&&T.qr_code)&&(F.totp.qr_code=`data:image/svg+xml;utf-8,${F.totp.qr_code}`),{data:F,error:null})})}catch(m){if(Tr(m))return{data:null,error:m};throw m}}async _verify(c){return this._acquireLock(-1,async()=>{try{return await this._useSession(async m=>{var y;const{data:T,error:S}=m;if(S)return{data:null,error:S};const{data:M,error:n}=await Vr(this.fetch,"POST",`${this.url}/factors/${c.factorId}/verify`,{body:{code:c.code,challenge_id:c.challengeId},headers:this.headers,jwt:(y=T==null?void 0:T.session)===null||y===void 0?void 0:y.access_token});return n?{data:null,error:n}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+M.expires_in},M)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",M),{data:M,error:n})})}catch(m){if(Tr(m))return{data:null,error:m};throw m}})}async _challenge(c){return this._acquireLock(-1,async()=>{try{return await this._useSession(async m=>{var y;const{data:T,error:S}=m;return S?{data:null,error:S}:await Vr(this.fetch,"POST",`${this.url}/factors/${c.factorId}/challenge`,{body:{channel:c.channel},headers:this.headers,jwt:(y=T==null?void 0:T.session)===null||y===void 0?void 0:y.access_token})})}catch(m){if(Tr(m))return{data:null,error:m};throw m}})}async _challengeAndVerify(c){const{data:m,error:y}=await this._challenge({factorId:c.factorId});return y?{data:null,error:y}:await this._verify({factorId:c.factorId,challengeId:m.id,code:c.code})}async _listFactors(){const{data:{user:c},error:m}=await this.getUser();if(m)return{data:null,error:m};const y=(c==null?void 0:c.factors)||[],T=y.filter(M=>M.factor_type==="totp"&&M.status==="verified"),S=y.filter(M=>M.factor_type==="phone"&&M.status==="verified");return{data:{all:y,totp:T,phone:S},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async c=>{var m,y;const{data:{session:T},error:S}=c;if(S)return{data:null,error:S};if(!T)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:M}=X0(T.access_token);let n=null;M.aal&&(n=M.aal);let F=n;((y=(m=T.user.factors)===null||m===void 0?void 0:m.filter(Y=>Y.status==="verified"))!==null&&y!==void 0?y:[]).length>0&&(F="aal2");const N=M.amr||[];return{data:{currentLevel:n,nextLevel:F,currentAuthenticationMethods:N},error:null}}))}async fetchJwk(c,m={keys:[]}){let y=m.keys.find(M=>M.kid===c);if(y||(y=this.jwks.keys.find(M=>M.kid===c),y&&this.jwks_cached_at+V3>Date.now()))return y;const{data:T,error:S}=await Vr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(S)throw S;if(!T.keys||T.keys.length===0)throw new em("JWKS is empty");if(this.jwks=T,this.jwks_cached_at=Date.now(),y=T.keys.find(M=>M.kid===c),!y)throw new em("No matching signing key found in JWKS");return y}async getClaims(c,m={keys:[]}){try{let y=c;if(!y){const{data:de,error:Te}=await this.getSession();if(Te||!de.session)return{data:null,error:Te};y=de.session.access_token}const{header:T,payload:S,signature:M,raw:{header:n,payload:F}}=X0(y);if(uB(S.exp),!T.kid||T.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:de}=await this.getUser(y);if(de)throw de;return{data:{claims:S,header:T,signature:M},error:null}}const W=hB(T.alg),N=await this.fetchJwk(T.kid,m),Y=await crypto.subtle.importKey("jwk",N,W,!0,["verify"]);if(!await crypto.subtle.verify(W,Y,M,Y3(`${n}.${F}`)))throw new em("Invalid JWT signature");return{data:{claims:S,header:T,signature:M},error:null}}catch(y){if(Tr(y))return{data:null,error:y};throw y}}}pm.nextInstanceID=0;const IB=pm;class CB extends IB{constructor(c){super(c)}}var PB=function(a,c,m,y){function T(S){return S instanceof m?S:new m(function(M){M(S)})}return new(m||(m=Promise))(function(S,M){function n(N){try{W(y.next(N))}catch(Y){M(Y)}}function F(N){try{W(y.throw(N))}catch(Y){M(Y)}}function W(N){N.done?S(N.value):T(N.value).then(n,F)}W((y=y.apply(a,c||[])).next())})};class MB{constructor(c,m,y){var T,S,M;if(this.supabaseUrl=c,this.supabaseKey=m,!c)throw new Error("supabaseUrl is required.");if(!m)throw new Error("supabaseKey is required.");const n=z3(c);this.realtimeUrl=`${n}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${n}/auth/v1`,this.storageUrl=`${n}/storage/v1`,this.functionsUrl=`${n}/functions/v1`;const F=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,W={db:I3,realtime:P3,auth:Object.assign(Object.assign({},C3),{storageKey:F}),global:A3},N=O3(y??{},W);this.storageKey=(T=N.auth.storageKey)!==null&&T!==void 0?T:"",this.headers=(S=N.global.headers)!==null&&S!==void 0?S:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(Y,le)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(le)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((M=N.auth)!==null&&M!==void 0?M:{},this.headers,N.global.fetch),this.fetch=k3(m,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new ZF(`${n}/rest/v1`,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),N.accessToken||this._listenForAuthEvents()}get functions(){return new zF(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new T3(this.storageUrl,this.headers,this.fetch)}from(c){return this.rest.from(c)}schema(c){return this.rest.schema(c)}rpc(c,m={},y={}){return this.rest.rpc(c,m,y)}channel(c,m={config:{}}){return this.realtime.channel(c,m)}getChannels(){return this.realtime.getChannels()}removeChannel(c){return this.realtime.removeChannel(c)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var c,m;return PB(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:y}=yield this.auth.getSession();return(m=(c=y.session)===null||c===void 0?void 0:c.access_token)!==null&&m!==void 0?m:null})}_initSupabaseAuthClient({autoRefreshToken:c,persistSession:m,detectSessionInUrl:y,storage:T,storageKey:S,flowType:M,lock:n,debug:F},W,N){const Y={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new CB({url:this.authUrl,headers:Object.assign(Object.assign({},Y),W),storageKey:S,autoRefreshToken:c,persistSession:m,detectSessionInUrl:y,storage:T,flowType:M,lock:n,debug:F,fetch:N,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(c){return new c3(this.realtimeUrl,Object.assign(Object.assign({},c),{params:Object.assign({apikey:this.supabaseKey},c==null?void 0:c.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((m,y)=>{this._handleTokenChanged(m,"CLIENT",y==null?void 0:y.access_token)})}_handleTokenChanged(c,m,y){(c==="TOKEN_REFRESHED"||c==="SIGNED_IN")&&this.changedAccessToken!==y?this.changedAccessToken=y:c==="SIGNED_OUT"&&(this.realtime.setAuth(),m=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const jI=(a,c,m)=>new MB(a,c,m),RB="0.5.2";var Og={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var YE;function DB(){if(YE)return Og;YE=1,Og.parse=M,Og.serialize=W;var a=Object.prototype.toString,c=Object.prototype.hasOwnProperty,m=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,y=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,T=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,S=/^[\u0020-\u003A\u003D-\u007E]*$/;function M(de,Te){if(typeof de!="string")throw new TypeError("argument str must be a string");var pe={},qe=de.length;if(qe<2)return pe;var $e=Te&&Te.decode||N,ze=0,be=0,ke=0;do{if(be=de.indexOf("=",ze),be===-1)break;if(ke=de.indexOf(";",ze),ke===-1)ke=qe;else if(be>ke){ze=de.lastIndexOf(";",be-1)+1;continue}var Ke=n(de,ze,be),St=F(de,be,Ke),kt=de.slice(Ke,St);if(!c.call(pe,kt)){var hi=n(de,be+1,ke),Wt=F(de,ke,hi);de.charCodeAt(hi)===34&&de.charCodeAt(Wt-1)===34&&(hi++,Wt--);var Zt=de.slice(hi,Wt);pe[kt]=le(Zt,$e)}ze=ke+1}while(ze<qe);return pe}function n(de,Te,pe){do{var qe=de.charCodeAt(Te);if(qe!==32&&qe!==9)return Te}while(++Te<pe);return pe}function F(de,Te,pe){for(;Te>pe;){var qe=de.charCodeAt(--Te);if(qe!==32&&qe!==9)return Te+1}return pe}function W(de,Te,pe){var qe=pe&&pe.encode||encodeURIComponent;if(typeof qe!="function")throw new TypeError("option encode is invalid");if(!m.test(de))throw new TypeError("argument name is invalid");var $e=qe(Te);if(!y.test($e))throw new TypeError("argument val is invalid");var ze=de+"="+$e;if(!pe)return ze;if(pe.maxAge!=null){var be=Math.floor(pe.maxAge);if(!isFinite(be))throw new TypeError("option maxAge is invalid");ze+="; Max-Age="+be}if(pe.domain){if(!T.test(pe.domain))throw new TypeError("option domain is invalid");ze+="; Domain="+pe.domain}if(pe.path){if(!S.test(pe.path))throw new TypeError("option path is invalid");ze+="; Path="+pe.path}if(pe.expires){var ke=pe.expires;if(!Y(ke)||isNaN(ke.valueOf()))throw new TypeError("option expires is invalid");ze+="; Expires="+ke.toUTCString()}if(pe.httpOnly&&(ze+="; HttpOnly"),pe.secure&&(ze+="; Secure"),pe.partitioned&&(ze+="; Partitioned"),pe.priority){var Ke=typeof pe.priority=="string"?pe.priority.toLowerCase():pe.priority;switch(Ke){case"low":ze+="; Priority=Low";break;case"medium":ze+="; Priority=Medium";break;case"high":ze+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(pe.sameSite){var St=typeof pe.sameSite=="string"?pe.sameSite.toLowerCase():pe.sameSite;switch(St){case!0:ze+="; SameSite=Strict";break;case"lax":ze+="; SameSite=Lax";break;case"strict":ze+="; SameSite=Strict";break;case"none":ze+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return ze}function N(de){return de.indexOf("%")!==-1?decodeURIComponent(de):de}function Y(de){return a.call(de)==="[object Date]"}function le(de,Te){try{return Te(de)}catch{return de}}return Og}var JE=DB();function im(){return typeof window<"u"&&typeof window.document<"u"}const Fg={path:"/",sameSite:"lax",httpOnly:!1,maxAge:400*24*60*60},kB=3180,LB=/^(.*)[.](0|[1-9][0-9]*)$/;function QE(a,c){if(a===c)return!0;const m=a.match(LB);return!!(m&&m[1]===c)}function zB(a,c,m){const y=kB;let T=encodeURIComponent(c);if(T.length<=y)return[{name:a,value:c}];const S=[];for(;T.length>0;){let M=T.slice(0,y);const n=M.lastIndexOf("%");n>y-3&&(M=M.slice(0,n));let F="";for(;M.length>0;)try{F=decodeURIComponent(M);break}catch(W){if(W instanceof URIError&&M.at(-3)==="%"&&M.length>3)M=M.slice(0,M.length-3);else throw W}S.push(F),T=T.slice(M.length)}return S.map((M,n)=>({name:`${a}.${n}`,value:M}))}async function OB(a,c){const m=await c(a);if(m)return m;let y=[];for(let T=0;;T++){const S=`${a}.${T}`,M=await c(S);if(!M)break;y.push(M)}return y.length>0?y.join(""):null}const ay="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),e2=` 	
\r=`.split(""),FB=(()=>{const a=new Array(128);for(let c=0;c<a.length;c+=1)a[c]=-1;for(let c=0;c<e2.length;c+=1)a[e2[c].charCodeAt(0)]=-2;for(let c=0;c<ay.length;c+=1)a[ay[c].charCodeAt(0)]=c;return a})();function BB(a){const c=[];let m=0,y=0;if(VB(a,S=>{for(m=m<<8|S,y+=8;y>=6;){const M=m>>y-6&63;c.push(ay[M]),y-=6}}),y>0)for(m=m<<6-y,y=6;y>=6;){const S=m>>y-6&63;c.push(ay[S]),y-=6}return c.join("")}function NB(a){const c=[],m=M=>{c.push(String.fromCodePoint(M))},y={utf8seq:0,codepoint:0};let T=0,S=0;for(let M=0;M<a.length;M+=1){const n=a.charCodeAt(M),F=FB[n];if(F>-1)for(T=T<<6|F,S+=6;S>=8;)jB(T>>S-8&255,y,m),S-=8;else{if(F===-2)continue;throw new Error(`Invalid Base64-URL character "${a.at(M)}" at position ${M}`)}}return c.join("")}function UB(a,c){if(a<=127){c(a);return}else if(a<=2047){c(192|a>>6),c(128|a&63);return}else if(a<=65535){c(224|a>>12),c(128|a>>6&63),c(128|a&63);return}else if(a<=1114111){c(240|a>>18),c(128|a>>12&63),c(128|a>>6&63),c(128|a&63);return}throw new Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}function VB(a,c){for(let m=0;m<a.length;m+=1){let y=a.charCodeAt(m);if(y>55295&&y<=56319){const T=(y-55296)*1024&65535;y=(a.charCodeAt(m+1)-56320&65535|T)+65536,m+=1}UB(y,c)}}function jB(a,c,m){if(c.utf8seq===0){if(a<=127){m(a);return}for(let y=1;y<6;y+=1)if((a>>7-y&1)===0){c.utf8seq=y;break}if(c.utf8seq===2)c.codepoint=a&31;else if(c.utf8seq===3)c.codepoint=a&15;else if(c.utf8seq===4)c.codepoint=a&7;else throw new Error("Invalid UTF-8 sequence");c.utf8seq-=1}else if(c.utf8seq>0){if(a<=127)throw new Error("Invalid UTF-8 sequence");c.codepoint=c.codepoint<<6|a&63,c.utf8seq-=1,c.utf8seq===0&&m(c.codepoint)}}const K0="base64-";function $B(a,c){const m=a.cookies??null,y=a.cookieEncoding,T={},S={};let M,n;if(m)if("get"in m){const F=async W=>{const N=W.flatMap(le=>[le,...Array.from({length:5}).map((de,Te)=>`${le}.${Te}`)]),Y=[];for(let le=0;le<N.length;le+=1){const de=await m.get(N[le]);!de&&typeof de!="string"||Y.push({name:N[le],value:de})}return Y};if(M=async W=>await F(W),"set"in m&&"remove"in m)n=async W=>{for(let N=0;N<W.length;N+=1){const{name:Y,value:le,options:de}=W[N];le?await m.set(Y,le,de):await m.remove(Y,de)}};else throw new Error("@supabase/ssr: createBrowserClient requires configuring a getAll and setAll cookie method (deprecated: alternatively both get, set and remove can be used)")}else if("getAll"in m)if(M=async()=>await m.getAll(),"setAll"in m)n=m.setAll;else throw new Error("@supabase/ssr: createBrowserClient requires configuring both getAll and setAll cookie methods (deprecated: alternatively both get, set and remove can be used)");else throw new Error(`@supabase/ssr: createBrowserClient requires configuring getAll and setAll cookie methods (deprecated: alternatively use get, set and remove).${im()?" As this is called in a browser runtime, consider removing the cookies option object to use the document.cookie API automatically.":""}`);else if(im()){const F=()=>{const W=JE.parse(document.cookie);return Object.keys(W).map(N=>({name:N,value:W[N]}))};M=()=>F(),n=W=>{W.forEach(({name:N,value:Y,options:le})=>{document.cookie=JE.serialize(N,Y,le)})}}else M=()=>[],n=()=>{throw new Error("@supabase/ssr: createBrowserClient in non-browser runtimes (including Next.js pre-rendering mode) was not initialized cookie options that specify getAll and setAll functions (deprecated: alternatively use get, set and remove), but they were needed")};return{getAll:M,setAll:n,setItems:T,removedItems:S,storage:{isServer:!1,getItem:async F=>{const W=await M([F]),N=await OB(F,async le=>{const de=(W==null?void 0:W.find(({name:Te})=>Te===le))||null;return de?de.value:null});if(!N)return null;let Y=N;return N.startsWith(K0)&&(Y=NB(N.substring(K0.length))),Y},setItem:async(F,W)=>{const N=await M([F]),Y=(N==null?void 0:N.map(({name:ze})=>ze))||[],le=new Set(Y.filter(ze=>QE(ze,F)));let de=W;y==="base64url"&&(de=K0+BB(W));const Te=zB(F,de);Te.forEach(({name:ze})=>{le.delete(ze)});const pe={...Fg,...a==null?void 0:a.cookieOptions,maxAge:0},qe={...Fg,...a==null?void 0:a.cookieOptions,maxAge:Fg.maxAge};delete pe.name,delete qe.name;const $e=[...[...le].map(ze=>({name:ze,value:"",options:pe})),...Te.map(({name:ze,value:be})=>({name:ze,value:be,options:qe}))];$e.length>0&&await n($e)},removeItem:async F=>{const W=await M([F]),Y=((W==null?void 0:W.map(({name:de})=>de))||[]).filter(de=>QE(de,F)),le={...Fg,...a==null?void 0:a.cookieOptions,maxAge:0};delete le.name,Y.length>0&&await n(Y.map(de=>({name:de,value:"",options:le})))}}}}let Y0;function GB(a,c,m){var M,n;const y=(m==null?void 0:m.isSingleton)===!0||(!m||!("isSingleton"in m))&&im();if(y&&Y0)return Y0;if(!a||!c)throw new Error(`@supabase/ssr: Your project's URL and API key are required to create a Supabase client!

Check your Supabase project's API settings to find these values

https://supabase.com/dashboard/project/_/settings/api`);const{storage:T}=$B({...m,cookieEncoding:(m==null?void 0:m.cookieEncoding)??"base64url"}),S=jI(a,c,{...m,global:{...m==null?void 0:m.global,headers:{...(M=m==null?void 0:m.global)==null?void 0:M.headers,"X-Client-Info":`supabase-ssr/${RB}`}},auth:{...m==null?void 0:m.auth,...(n=m==null?void 0:m.cookieOptions)!=null&&n.name?{storageKey:m.cookieOptions.name}:null,flowType:"pkce",autoRefreshToken:im(),detectSessionInUrl:im(),persistSession:!0,storage:T}});return y&&(Y0=S),S}async function t2(a,c){var y;for(let T=1;T<=3;T++)try{return await fetch(a,c)}catch(S){if((y=c==null?void 0:c.signal)!=null&&y.aborted)throw S;if(T===3)throw console.error(`Error fetching request ${a}`,S,c),S;console.warn(`Retrying fetch attempt ${T+1} for request: ${a}`)}throw new Error("Unreachable code")}const HB="$s";function $I(...a){const c=typeof a[a.length-1]=="string"?a.pop():void 0;typeof a[0]!="string"&&a.unshift(c);const[m,y]=a;if(!m||typeof m!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+m);if(y!==void 0&&typeof y!="function")throw new Error("[nuxt] [useState] init must be a function: "+y);const T=HB+m,S=qn(),M=L2(S.payload.state,T);if(M.value===void 0&&y){const n=y();if(Hn(n))return S.payload.state[T]=n,n;M.value=n}return M}const qB=()=>$I("supabase_session",()=>null),WB=()=>$I("supabase_user",()=>null),ZB=Yo({name:"supabase",enforce:"pre",async setup({provide:a}){let c,m;const{url:y,key:T,cookieOptions:S,cookiePrefix:M,useSsrCookies:n,clientOptions:F}=jd().public.supabase;let W;n?W=GB(y,T,{...F,cookieOptions:{...S,name:M},isSingleton:!0,global:{fetch:t2,...F.global}}):W=jI(y,T,{...F,global:{fetch:t2,...F.global}}),a("supabase",{client:W});const N=qB(),Y=WB(),{data:{session:le}}=([c,m]=Uu(()=>W.auth.getSession()),c=await c,m(),c);N.value=le,Y.value=(le==null?void 0:le.user)??null,W.auth.onAuthStateChange((de,Te)=>{JSON.stringify(N.value)!==JSON.stringify(Te)&&(N.value=Te,Y.value=(Te==null?void 0:Te.user)??null)})}}),i2=globalThis.requestIdleCallback||(a=>{const c=Date.now(),m={didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-c))};return setTimeout(()=>{a(m)},1)}),WN=globalThis.cancelIdleCallback||(a=>{clearTimeout(a)}),_b=a=>{const c=qn();c.isHydrating?c.hooks.hookOnce("app:suspense:resolve",()=>{i2(()=>a())}):i2(()=>a())},XB=Yo({name:"nuxt:payload",setup(a){const c=new Set;Co().beforeResolve(async(m,y)=>{if(m.path===y.path)return;const T=await lE(m.path);if(T){for(const S of c)delete a.static.data[S];for(const S in T.data)S in a.static.data||c.add(S),a.static.data[S]=T.data[S]}}),_b(()=>{var m;a.hooks.hook("link:prefetch",async y=>{const{hostname:T}=new URL(y,window.location.href);T===window.location.hostname&&await lE(y).catch(()=>{console.warn("[nuxt] Error preloading payload for",y)})}),((m=navigator.connection)==null?void 0:m.effectiveType)!=="slow-2g"&&setTimeout(by,1e3)})}}),KB=Yo(()=>{const a=Co();_b(()=>{a.beforeResolve(async()=>{await new Promise(c=>{setTimeout(c,100),requestAnimationFrame(()=>{setTimeout(c,0)})})})})}),YB=Yo(a=>{let c;async function m(){const y=await by();c&&clearTimeout(c),c=setTimeout(m,YS);try{const T=await $fetch(nb("builds/latest.json")+`?${Date.now()}`);T.id!==y.id&&a.hooks.callHook("app:manifest:update",T)}catch{}}_b(()=>{c=setTimeout(m,YS)})});function JB(a={}){const c=a.path||window.location.pathname;let m={};try{m=ey(sessionStorage.getItem("nuxt:reload")||"{}")}catch{}if(a.force||(m==null?void 0:m.path)!==c||(m==null?void 0:m.expires)<Date.now()){try{sessionStorage.setItem("nuxt:reload",JSON.stringify({path:c,expires:Date.now()+(a.ttl??1e4)}))}catch{}if(a.persistState)try{sessionStorage.setItem("nuxt:reload:state",JSON.stringify({state:qn().payload.state}))}catch{}window.location.pathname!==c?window.location.href=c:window.location.reload()}}const QB=Yo({name:"nuxt:chunk-reload",setup(a){const c=Co(),m=jd(),y=new Set;c.beforeEach(()=>{y.clear()}),a.hook("app:chunkError",({error:S})=>{y.add(S)});function T(S){const n="href"in S&&S.href[0]==="#"?m.app.baseURL+S.href:rb(m.app.baseURL,S.fullPath);JB({path:n,persistState:!0})}a.hook("app:manifest:update",()=>{c.beforeResolve(T)}),c.onError((S,M)=>{y.has(S)&&T(M)})}}),eN=Yo({name:"nuxt:global-components"}),_c={default:nx(()=>Fs(()=>import("./B1nwnt7I.js"),__vite__mapDeps([14,15,2,3,4,16]),import.meta.url).then(a=>a.default||a))},tN=Yo({name:"nuxt:prefetch",setup(a){const c=Co();a.hooks.hook("app:mounted",()=>{c.beforeEach(async m=>{var T;const y=(T=m==null?void 0:m.meta)==null?void 0:T.layout;y&&typeof _c[y]=="function"&&await _c[y]()})}),a.hooks.hook("link:prefetch",m=>{if(Gu(m))return;const y=c.resolve(m);if(!y)return;const T=y.meta.layout;let S=ub(y.meta.middleware);S=S.filter(M=>typeof M=="string");for(const M of S)typeof Jp[M]=="function"&&Jp[M]();T&&typeof _c[T]=="function"&&_c[T]()})}});var jg={exports:{}},iN=jg.exports,r2;function rN(){return r2||(r2=1,function(a,c){(function(m,y){a.exports=y()})(iN,function(){var m,y,T;function S(n,F){if(!m)m=F;else if(!y)y=F;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",N={};m(N),T=F(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}S(["exports"],function(n){var F=1e-6,W=typeof Float32Array<"u"?Float32Array:Array;function N(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*d-l*o;return f?(r[0]=d*(f=1/f),r[1]=-o*f,r[2]=-l*f,r[3]=i*f,r):null}function Y(){var r=new W(9);return W!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function le(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],w=e[7],A=e[8];return r[0]=f*A-g*w,r[1]=l*w-o*A,r[2]=o*g-l*f,r[3]=g*x-d*A,r[4]=i*A-l*x,r[5]=l*d-i*g,r[6]=d*w-f*x,r[7]=o*x-i*w,r[8]=i*f-o*d,r}function de(r,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],A=e[7],I=e[8],P=i[0],L=i[1],z=i[2],B=i[3],H=i[4],Z=i[5],te=i[6],J=i[7],U=i[8];return r[0]=P*o+L*f+z*w,r[1]=P*l+L*g+z*A,r[2]=P*d+L*x+z*I,r[3]=B*o+H*f+Z*w,r[4]=B*l+H*g+Z*A,r[5]=B*d+H*x+Z*I,r[6]=te*o+J*f+U*w,r[7]=te*l+J*g+U*A,r[8]=te*d+J*x+U*I,r}function Te(){var r=new W(16);return W!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function pe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function qe(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],w=e[7],A=e[8],I=e[9],P=e[10],L=e[11],z=e[12],B=e[13],H=e[14],Z=e[15],te=i*g-o*f,J=i*x-l*f,U=i*w-d*f,X=o*x-l*g,ee=o*w-d*g,ne=l*w-d*x,me=A*B-I*z,xe=A*H-P*z,Se=A*Z-L*z,Pe=I*H-P*B,He=I*Z-L*B,nt=P*Z-L*H,et=te*nt-J*He+U*Pe+X*Se-ee*xe+ne*me;return et?(r[0]=(g*nt-x*He+w*Pe)*(et=1/et),r[1]=(l*He-o*nt-d*Pe)*et,r[2]=(B*ne-H*ee+Z*X)*et,r[3]=(P*ee-I*ne-L*X)*et,r[4]=(x*Se-f*nt-w*xe)*et,r[5]=(i*nt-l*Se+d*xe)*et,r[6]=(H*U-z*ne-Z*J)*et,r[7]=(A*ne-P*U+L*J)*et,r[8]=(f*He-g*Se+w*me)*et,r[9]=(o*Se-i*He-d*me)*et,r[10]=(z*ee-B*U+Z*te)*et,r[11]=(I*U-A*ee-L*te)*et,r[12]=(g*xe-f*Pe-x*me)*et,r[13]=(i*Pe-o*xe+l*me)*et,r[14]=(B*J-z*X-H*te)*et,r[15]=(A*X-I*J+P*te)*et,r):null}function $e(r,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],A=e[7],I=e[8],P=e[9],L=e[10],z=e[11],B=e[12],H=e[13],Z=e[14],te=e[15],J=i[0],U=i[1],X=i[2],ee=i[3];return r[0]=J*o+U*g+X*I+ee*B,r[1]=J*l+U*x+X*P+ee*H,r[2]=J*d+U*w+X*L+ee*Z,r[3]=J*f+U*A+X*z+ee*te,r[4]=(J=i[4])*o+(U=i[5])*g+(X=i[6])*I+(ee=i[7])*B,r[5]=J*l+U*x+X*P+ee*H,r[6]=J*d+U*w+X*L+ee*Z,r[7]=J*f+U*A+X*z+ee*te,r[8]=(J=i[8])*o+(U=i[9])*g+(X=i[10])*I+(ee=i[11])*B,r[9]=J*l+U*x+X*P+ee*H,r[10]=J*d+U*w+X*L+ee*Z,r[11]=J*f+U*A+X*z+ee*te,r[12]=(J=i[12])*o+(U=i[13])*g+(X=i[14])*I+(ee=i[15])*B,r[13]=J*l+U*x+X*P+ee*H,r[14]=J*d+U*w+X*L+ee*Z,r[15]=J*f+U*A+X*z+ee*te,r}function ze(r,e,i){var o,l,d,f,g,x,w,A,I,P,L,z,B=i[0],H=i[1],Z=i[2];return e===r?(r[12]=e[0]*B+e[4]*H+e[8]*Z+e[12],r[13]=e[1]*B+e[5]*H+e[9]*Z+e[13],r[14]=e[2]*B+e[6]*H+e[10]*Z+e[14],r[15]=e[3]*B+e[7]*H+e[11]*Z+e[15]):(l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],A=e[7],I=e[8],P=e[9],L=e[10],z=e[11],r[0]=o=e[0],r[1]=l,r[2]=d,r[3]=f,r[4]=g,r[5]=x,r[6]=w,r[7]=A,r[8]=I,r[9]=P,r[10]=L,r[11]=z,r[12]=o*B+g*H+I*Z+e[12],r[13]=l*B+x*H+P*Z+e[13],r[14]=d*B+w*H+L*Z+e[14],r[15]=f*B+A*H+z*Z+e[15]),r}function be(r,e,i){var o=i[0],l=i[1],d=i[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*l,r[5]=e[5]*l,r[6]=e[6]*l,r[7]=e[7]*l,r[8]=e[8]*d,r[9]=e[9]*d,r[10]=e[10]*d,r[11]=e[11]*d,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ke(r,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[4],f=e[5],g=e[6],x=e[7],w=e[8],A=e[9],I=e[10],P=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=d*l+w*o,r[5]=f*l+A*o,r[6]=g*l+I*o,r[7]=x*l+P*o,r[8]=w*l-d*o,r[9]=A*l-f*o,r[10]=I*l-g*o,r[11]=P*l-x*o,r}function Ke(r,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],w=e[8],A=e[9],I=e[10],P=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*l-w*o,r[1]=f*l-A*o,r[2]=g*l-I*o,r[3]=x*l-P*o,r[8]=d*o+w*l,r[9]=f*o+A*l,r[10]=g*o+I*l,r[11]=x*o+P*l,r}function St(r,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],w=e[4],A=e[5],I=e[6],P=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*l+w*o,r[1]=f*l+A*o,r[2]=g*l+I*o,r[3]=x*l+P*o,r[4]=w*l-d*o,r[5]=A*l-f*o,r[6]=I*l-g*o,r[7]=P*l-x*o,r}function kt(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function hi(r,e,i){var o,l,d,f=i[0],g=i[1],x=i[2],w=Math.hypot(f,g,x);return w<F?null:(f*=w=1/w,g*=w,x*=w,o=Math.sin(e),l=Math.cos(e),r[0]=f*f*(d=1-l)+l,r[1]=g*f*d+x*o,r[2]=x*f*d-g*o,r[3]=0,r[4]=f*g*d-x*o,r[5]=g*g*d+l,r[6]=x*g*d+f*o,r[7]=0,r[8]=f*x*d+g*o,r[9]=g*x*d-f*o,r[10]=x*x*d+l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Wt(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i+i,g=o+o,x=l+l,w=i*f,A=o*f,I=o*g,P=l*f,L=l*g,z=l*x,B=d*f,H=d*g,Z=d*x;return r[0]=1-I-z,r[1]=A+Z,r[2]=P-H,r[3]=0,r[4]=A-Z,r[5]=1-w-z,r[6]=L+B,r[7]=0,r[8]=P+H,r[9]=L-B,r[10]=1-w-I,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Zt=$e;function ni(){var r=new W(3);return W!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function qt(r){var e=new W(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function di(r){return Math.hypot(r[0],r[1],r[2])}function vi(r,e,i){var o=new W(3);return o[0]=r,o[1]=e,o[2]=i,o}function Ni(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function si(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Ui(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function mi(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function Yr(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Yi(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function vn(r,e,i,o){return r[0]=e[0]+i[0]*o,r[1]=e[1]+i[1]*o,r[2]=e[2]+i[2]*o,r}function In(r,e){var i=e[0]-r[0],o=e[1]-r[1],l=e[2]-r[2];return i*i+o*o+l*l}function Rs(r){var e=r[0],i=r[1],o=r[2];return e*e+i*i+o*o}function ys(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function gr(r,e){var i=e[0],o=e[1],l=e[2],d=i*i+o*o+l*l;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r[2]=e[2]*d,r}function tr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function _t(r,e,i){var o=e[0],l=e[1],d=e[2],f=i[0],g=i[1],x=i[2];return r[0]=l*x-d*g,r[1]=d*f-o*x,r[2]=o*g-l*f,r}function fi(r,e,i,o){var l=e[0],d=e[1],f=e[2];return r[0]=l+o*(i[0]-l),r[1]=d+o*(i[1]-d),r[2]=f+o*(i[2]-f),r}function $t(r,e,i){var o=e[0],l=e[1],d=e[2],f=i[3]*o+i[7]*l+i[11]*d+i[15];return r[0]=(i[0]*o+i[4]*l+i[8]*d+i[12])/(f=f||1),r[1]=(i[1]*o+i[5]*l+i[9]*d+i[13])/f,r[2]=(i[2]*o+i[6]*l+i[10]*d+i[14])/f,r}function Ei(r,e,i){var o=e[0],l=e[1],d=e[2];return r[0]=o*i[0]+l*i[3]+d*i[6],r[1]=o*i[1]+l*i[4]+d*i[7],r[2]=o*i[2]+l*i[5]+d*i[8],r}function yr(r,e,i){var o=i[0],l=i[1],d=i[2],f=e[0],g=e[1],x=e[2],w=l*x-d*g,A=d*f-o*x,I=o*g-l*f,P=l*I-d*A,L=d*w-o*I,z=o*A-l*w,B=2*i[3];return A*=B,I*=B,L*=2,z*=2,r[0]=f+(w*=B)+(P*=2),r[1]=g+A+L,r[2]=x+I+z,r}function Sr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var we=si,Le=Ui,ht=di;function Pt(){var r=new W(4);return W!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Tt(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function jt(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*i+o*o+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),r[0]=i*f,r[1]=o*f,r[2]=l*f,r[3]=d*f,r}function Jt(r,e,i){var o=e[0],l=e[1],d=e[2],f=e[3];return r[0]=i[0]*o+i[4]*l+i[8]*d+i[12]*f,r[1]=i[1]*o+i[5]*l+i[9]*d+i[13]*f,r[2]=i[2]*o+i[6]*l+i[10]*d+i[14]*f,r[3]=i[3]*o+i[7]*l+i[11]*d+i[15]*f,r}function Xt(){var r=new W(4);return W!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Yt(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Gt(r,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=o*x+f*g,r[1]=l*x+d*g,r[2]=d*x-l*g,r[3]=f*x-o*g,r}function Bi(r,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=o*x-d*g,r[1]=l*x+f*g,r[2]=d*x+o*g,r[3]=f*x-l*g,r}ni(),Pt();var ti,_i,Gi,lr,jr,_r=jt,xn=(ti=ni(),_i=vi(1,0,0),Gi=vi(0,1,0),function(r,e,i){var o=tr(e,i);return o<-.999999?(_t(ti,_i,e),ht(ti)<1e-6&&_t(ti,Gi,e),gr(ti,ti),function(l,d,f){f*=.5;var g=Math.sin(f);l[0]=g*d[0],l[1]=g*d[1],l[2]=g*d[2],l[3]=Math.cos(f)}(r,ti,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(_t(ti,e,i),r[0]=ti[0],r[1]=ti[1],r[2]=ti[2],r[3]=1+o,_r(r,r))});function qr(){var r=new W(2);return W!=Float32Array&&(r[0]=0,r[1]=0),r}function Fn(r,e){var i=new W(2);return i[0]=r,i[1]=e,i}function Tn(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function es(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function ho(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function Cn(r){return Math.hypot(r[0],r[1])}function ts(r,e){var i=e[0],o=e[1],l=i*i+o*o;return l>0&&(l=1/Math.sqrt(l)),r[0]=e[0]*l,r[1]=e[1]*l,r}function Mr(r,e){return r[0]*e[0]+r[1]*e[1]}function fo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Xt(),Xt(),Y(),qr();var fl,Bs,Ac=function(){if(jr)return lr;function r(e,i,o,l){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=l}return jr=1,lr=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,l=0;l<8;l++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=d/f}var g=0,x=1;for(o=e,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));l++)e>d?g=o:x=o,o=.5*(x-g)+g;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},lr}(),qu=fo(Ac);function Ic(){if(Bs)return fl;function r(e,i){this.x=e,this.y=i}return Bs=1,fl=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),l=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=l,this},_rotateAround:function(e,i){var o=Math.cos(e),l=Math.sin(e),d=i.y+l*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-l*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},fl}var gt=fo(Ic());function Po(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Po(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Po(r[i],e[i]))return!1;return!0}return r===e}const Wu=Math.PI/180,We=180/Math.PI;function G(r){return r*Wu}function K(r){return r*We}const ce=[[0,0],[1,0],[1,1],[0,1]];function ve(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function ye(r,e,i,o){const l=new qu(r,e,i,o);return function(d){return l.solve(d)}}const Ee=ye(.25,.1,.25,1);function Ae(r,e,i){return Math.min(i,Math.max(e,r))}function Ie(r,e,i){return(i=Ae((i-r)/(e-r),0,1))*i*(3-2*i)}function Ue(r,e,i){const o=i-e,l=((r-e)%o+o)%o+e;return l===e?i:l}function Ye(r,e,i){if(!r.length)return i(null,[]);let o=r.length;const l=new Array(r.length);let d=null;r.forEach((f,g)=>{e(f,(x,w)=>{x&&(d=x),l[g]=w,--o==0&&i(d,l)})})}function Be(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let yt=1;function Et(){return yt++}function Bt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function pi(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function xi(r,e,i){const o={};for(const l in r)o[l]=e.call(this,r[l],l,r);return o}function Ii(r,e,i){const o={};for(const l in r)e.call(this,r[l],l,r)&&(o[l]=r[l]);return o}function Ri(r){return Array.isArray(r)?r.map(Ri):typeof r=="object"&&r?xi(r,Ri):r}const Wr={};function ki(r){Wr[r]||(typeof console<"u"&&console.warn(r),Wr[r]=!0)}function vr(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Xi(r){let e=0;for(let i,o,l=0,d=r.length,f=d-1;l<d;f=l++)i=r[l],o=r[f],e+=(o.x-i.x)*(i.y+o.y);return e}function xr([r,e,i]){const o=G(e+90),l=G(i);return{x:r*Math.cos(o)*Math.sin(l),y:r*Math.sin(o)*Math.sin(l),z:r*Math.cos(l),azimuthal:e,polar:i}}function Er(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function rn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,l,d)=>{const f=l||d;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fn=null;function Pn(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Bn(r,e,i,o){for(;e<i;){const l=e+i>>1;r[l]<o?e=l+1:i=l}return e}function Mo(r,e,i,o){for(;e<i;){const l=e+i>>1;r[l]<=o?e=l+1:i=l}return e}function Wn(r){return r>0?1/(1.001-r):1+r}function Zn(r){return r>0?1-1/(1.001-r):-r}function Ln(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Vn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Vn.API_URL)return null;try{const r=new URL(Vn.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function po(r){return Vn.API_URL_REGEX.test(r)}function Ia(r){return Vn.API_SPRITE_REGEX.test(r)}let Cc,pl,Zu,Pc,Ca,Mc;function Gd(){return Cc==null&&(Cc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cc}const Ks={now:()=>Pc!==void 0?Pc:performance.now(),setNow(r){Pc=r},restoreNow(){Pc=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:o}=r;Ca||(Ca=document.createElement("canvas"));const l=Ca.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>Ca.width||o>Ca.height)&&(Ca.width=i,Ca.height=o),l.clearRect(-e,-e,i+2*e,o+2*e),l.drawImage(r,0,0,i,o),l.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:r=>(pl||(pl=document.createElement("a")),pl.href=r,pl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Zu==null&&(Zu=window.matchMedia("(prefers-reduced-motion: reduce)")),Zu.matches)},hasCanvasFingerprintNoise(){if(Mc!==void 0)return Mc;if(!Gd())return Mc=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<r.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const o=e.getImageData(0,0,r.width,r.height);i=0;for(let l=0;l<o.data.length;++l)if(l%4!=3&&i++!==o.data[l])return Mc=!0,!0;return Mc=!1,!1}};function Hd(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(r.slice(i));for(const l in e)o.set(l,e[l]);return`${r.slice(0,i)}?${o.toString()}`}function vs(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const o=new URLSearchParams,l=new URLSearchParams(r.slice(i));for(const f of e.persistentParams){const g=l.get(f);g&&o.set(f,g)}const d=o.toString();return`${r.slice(0,i)}${d.length>0?`?${d}`:""}`}const Ys="mapbox-tiles";let Ro=500,Js=50;const Do=["language","worldview","jobid"];let Ns,Rc;function qd(){try{return caches}catch{}}function ko(){const r=qd();r&&Ns==null&&(Ns=r.open(Ys))}let Dc=1/0;const Wd={supported:!1,testSupport:function(r){!Xu&&is&&(Ku?wm(r):kc=r)}};let kc,is,Xu=!1,Ku=!1;const ml=typeof self<"u"?self:{};function wm(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,is),r.isContextLost())return;Wd.supported=!0}catch{}r.deleteTexture(e),Xu=!0}ml.document&&(is=ml.document.createElement("img"),is.onload=function(){kc&&wm(kc),kc=null,Ku=!0},is.onerror=function(){Xu=!0,kc=null},is.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Yu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Yu);class Ju extends Error{constructor(e,i,o){i===401&&po(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wi=Er()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,_l=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Wi())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,l){const d=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Wi(),referrerPolicy:o.referrerPolicy,signal:d.signal});let g=!1,x=!1;const w=(A=f.url).indexOf("sku=")>0&&po(A);var A;o.type==="json"&&f.headers.set("Accept","application/json");const I=(L,z,B)=>{if(x)return;if(L&&L.message!=="SecurityError"&&ki(L.toString()),z&&B)return P(z);const H=Date.now();fetch(f).then(Z=>{if(Z.ok){const te=w?Z.clone():null;return P(Z,te,H)}return l(new Ju(Z.statusText,Z.status,o.url))}).catch(Z=>{Z.name!=="AbortError"&&l(new Error(`${Z.message} ${o.url}`))})},P=(L,z,B)=>{(o.type==="arrayBuffer"?L.arrayBuffer():o.type==="json"?L.json():L.text()).then(H=>{x||(z&&B&&function(Z,te,J){if(ko(),Ns==null)return;const U=rn(te.headers.get("Cache-Control")||"");if(U["no-store"])return;const X={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((me,xe)=>X.headers.set(xe,me)),U["max-age"]&&X.headers.set("Expires",new Date(J+1e3*U["max-age"]).toUTCString());const ee=X.headers.get("Expires");if(!ee||new Date(ee).getTime()-J<42e4)return;let ne=vs(Z.url,{persistentParams:Do});if(te.status===206){const me=Z.headers.get("Range");if(!me)return;X.status=200,ne=Hd(ne,{range:me})}(function(me,xe){if(Rc===void 0)try{new Response(new ReadableStream),Rc=!0}catch{Rc=!1}Rc?xe(me.body):me.blob().then(xe).catch(Se=>ki(Se.message))})(te,me=>{const xe=new Response((Se=te.status)!==200&&Se!==404&&[101,103,204,205,304].includes(Se)?null:me,X);var Se;ko(),Ns!=null&&Ns.then(Pe=>Pe.put(ne,xe)).catch(Pe=>ki(Pe.message))})}(f,z,B),g=!0,l(null,H,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(H=>{x||l(new Error(H.message))})};return w?function(L,z){if(ko(),Ns==null)return z(null);Ns.then(B=>{let H=vs(L.url,{persistentParams:Do});const Z=L.headers.get("Range");Z&&(H=Hd(H,{range:Z})),B.match(H).then(te=>{const J=function(U){if(!U)return!1;const X=new Date(U.headers.get("Expires")||0),ee=rn(U.headers.get("Cache-Control")||"");return Number(X)>Date.now()&&!ee["no-cache"]}(te);B.delete(H).catch(z),J&&B.put(H,te.clone()).catch(z),z(null,te,J)}).catch(z)}).catch(z)}(f,I):I(null,null),{cancel:()=>{x=!0,g||d.abort()}}}(r,e);if(Er(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(o,l){const d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in o.headers)d.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(o.type==="json")try{f=JSON.parse(d.response)}catch(g){return l(g)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new Ju(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(r,e)},gl=function(r,e){return _l(Be(r,{type:"arrayBuffer"}),e)};function Ey(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Tm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pa,Jo;Pa=[],Jo=0;const yl=function(r,e){if(Wd.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Jo>=Vn.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pa.push(d),d}Jo++;let i=!1;const o=()=>{if(!i)for(i=!0,Jo--;Pa.length&&Jo<Vn.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Pa.shift(),{requestParameters:f,callback:g,cancelled:x}=d;x||(d.cancel=yl(f,g).cancel)}},l=gl(r,(d,f,g,x)=>{o(),d?e(d):f&&(self.createImageBitmap?function(w,A){const I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(w,A)=>e(w,A,g,x)):function(w,A){const I=new Image;I.onload=()=>{A(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Tm})},I.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(P):Tm}(f,(w,A)=>e(w,A,g,x)))});return{cancel:()=>{l.cancel(),o()}}};var Sm,Zd,Ma,Lc={exports:{}},vl={exports:{}},Qu={exports:{}},Xd=function(){if(Ma)return Lc.exports;Ma=1;var r=(Sm||(Sm=1,vl.exports=function(i,o){var l,d,f,g,x,w,A,I;for(d=i.length-(l=3&i.length),f=o,x=3432918353,w=461845907,I=0;I<d;)A=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,f=27492+(65535&(g=5*(65535&(f=(f^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(A=0,l){case 3:A^=(255&i.charCodeAt(I+2))<<16;case 2:A^=(255&i.charCodeAt(I+1))<<8;case 1:f^=A=(65535&(A=(A=(65535&(A^=255&i.charCodeAt(I)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),vl.exports),e=(Zd||(Zd=1,Qu.exports=function(i,o){for(var l,d=i.length,f=o^d,g=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++g;switch(d){case 3:f^=(255&i.charCodeAt(g+2))<<16;case 2:f^=(255&i.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Qu.exports);return Lc.exports=r,Lc.exports.murmur3=r,Lc.exports.murmur2=e,Lc.exports}(),xs=fo(Xd);class Qo{constructor(e,...i){Be(this,i[0]||{}),this.type=e}}class Kd extends Qo{constructor(e,i={}){super("error",Be({error:e},i))}}function Yd(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function eh(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class Ra{on(e,i){return this._listeners=this._listeners||{},Yd(e,i,this._listeners),this}off(e,i){return eh(e,i,this._listeners),eh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Yd(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new Qo(e,i):e,l=o.type;if(this.listens(l)){o.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of d)x.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)eh(l,x,this._oneTimeListeners),x.call(this,o);const g=this._eventedParent;g&&(Be(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof Kd&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class bs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new bs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new bs({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return bs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Jd,th={},zc=function(){if(Jd)return th;Jd=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function o(d){return(f=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:f>1?1:f;var f}function l(d,f,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?d+(f-d)*g*6:2*g<1?f:3*g<2?d+(f-d)*(2/3-g)*6:d}try{th.parseCSSColor=function(d){var f,g=d.replace(/ /g,"").toLowerCase();if(g in r)return r[g].slice();if(g[0]==="#")return g.length===4?(f=parseInt(g.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:g.length===7&&(f=parseInt(g.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var x=g.indexOf("("),w=g.indexOf(")");if(x!==-1&&w+1===g.length){var A=g.substr(0,x),I=g.substr(x+1,w-(x+1)).split(","),P=1;switch(A){case"rgba":if(I.length!==4)return null;P=o(I.pop());case"rgb":return I.length!==3?null:[i(I[0]),i(I[1]),i(I[2]),P];case"hsla":if(I.length!==4)return null;P=o(I.pop());case"hsl":if(I.length!==3)return null;var L=(parseFloat(I[0])%360+360)%360/360,z=o(I[1]),B=o(I[2]),H=B<=.5?B*(z+1):B+z-B*z,Z=2*B-H;return[e(255*l(Z,H,L+1/3)),e(255*l(Z,H,L)),e(255*l(Z,H,L-1/3)),P];default:return null}}return null}}catch{}return th}();class Ji{constructor(e,i,o,l=1){this.r=e,this.g=i,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof Ji)return e;if(typeof e!="string")return;const i=zc.parseCSSColor(e);return i?new Ji(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${l})`}toString(){const[e,i,o,l]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${l})`}toRenderColor(e){const{r:i,g:o,b:l,a:d}=this;return new Em(e,i,o,l,d)}clone(){return new Ji(this.r,this.g,this.b,this.a)}}class Em{constructor(e,i,o,l,d){if(e){const f=e.image.height,g=f*f;i=d===0?0:i/d*(f-1),o=d===0?0:o/d*(f-1),l=d===0?0:l/d*(f-1);const x=Math.floor(i),w=Math.floor(o),A=Math.floor(l),I=Math.ceil(i),P=Math.ceil(o),L=Math.ceil(l),z=i-x,B=o-w,H=l-A,Z=e.image.data,te=4*(x+w*g+A*f),J=4*(x+w*g+L*f),U=4*(x+P*g+A*f),X=4*(x+P*g+L*f),ee=4*(I+w*g+A*f),ne=4*(I+w*g+L*f),me=4*(I+P*g+A*f),xe=4*(I+P*g+L*f);if(te<0||xe>=Z.length)throw new Error("out of range");this.r=Kt(Kt(Kt(Z[te],Z[J],H),Kt(Z[U],Z[X],H),B),Kt(Kt(Z[ee],Z[ne],H),Kt(Z[me],Z[xe],H),B),z)/255*d,this.g=Kt(Kt(Kt(Z[te+1],Z[J+1],H),Kt(Z[U+1],Z[X+1],H),B),Kt(Kt(Z[ee+1],Z[ne+1],H),Kt(Z[me+1],Z[xe+1],H),B),z)/255*d,this.b=Kt(Kt(Kt(Z[te+2],Z[J+2],H),Kt(Z[U+2],Z[X+2],H),B),Kt(Kt(Z[ee+2],Z[ne+2],H),Kt(Z[me+2],Z[xe+2],H),B),z)/255*d,this.a=d}else this.r=i,this.g=o,this.b=l,this.a=d}toArray(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*i/l,255*o/l,l]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:l}=this,d=Math.min(Math.max(e/l,0),1),f=Math.min(Math.max(i/l,0),1),g=Math.min(Math.max(o/l,0),1),x=Math.min(d,f,g),w=Math.max(d,f,g),A=(x+w)/2;if(x===w)return[0,0,100*A,l];const I=w-x,P=A>.5?I/(2-w-x):I/(w+x);let L=0;return w===d?L=(f-g)/I+(f<g?6:0):w===f?L=(g-d)/I+2:w===g&&(L=(d-f)/I+4),L*=60,[Math.min(Math.max(L,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*A,0),100),l]}toArray01(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,i/l,o/l,l]}toArray01Scaled(e){const{r:i,g:o,b:l,a:d}=this;return d===0?[0,0,0]:[i/d*e,o/d*e,l/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:l}=this;return[e,i,o,l]}toArray01Linear(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(i/l,2.2),Math.pow(o/l,2.2),l]}}function Kt(r,e,i){return r*(1-i)+e*i}function Am(r,e,i){return r.map((o,l)=>Kt(o,e[l],i))}function ih(r){return r*r*r*r*r}Ji.black=new Ji(0,0,0,1),Ji.white=new Ji(1,1,1,1),Ji.transparent=new Ji(0,0,0,0),Ji.red=new Ji(1,0,0,1),Ji.blue=new Ji(0,0,1,1);var rh=Object.freeze({__proto__:null,array:Am,color:function(r,e,i){return new Ji(Kt(r.r,e.r,i),Kt(r.g,e.g,i),Kt(r.b,e.b,i),Kt(r.a,e.a,i))},easeIn:ih,number:Kt});function Oc(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}class Us extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Da{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(e){return new Da(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ea={kind:"null"},Ht={kind:"number"},fr={kind:"string"},nr={kind:"boolean"},fs={kind:"color"},ta={kind:"object"},ir={kind:"value"},ka={kind:"collator"},Fc={kind:"formatted"},Bc={kind:"resolvedImage"};function rs(r,e){return{kind:"array",itemType:r,N:e}}function pn(r){if(r.kind==="array"){const e=pn(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ay=[ea,Ht,fr,nr,fs,Fc,ta,rs(ir),Bc];function Nc(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Nc(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Ay)if(!Nc(i,e))return null}}return`Expected ${pn(r)} but found ${pn(e)} instead.`}function Qd(r,e){return e.some(i=>i.kind===r.kind)}function xl(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}class ia{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class nh{constructor(e,i,o,l,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=l,this.textColor=d}}class ns{constructor(e){this.sections=e}static fromString(e){return new ns([new nh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ns?e:ns.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const l=i.image.getPrimary().id.toString();e.push(["image",l]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class Qs{constructor(e,i={}){if(this.id=bs.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:l,c:d,d:f,e:g,f:x}=i.transform;this.options.transform=new DOMMatrix([o,l,d,f,g,x])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:l,e:d,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:l,e:d,f}})}static parse(e){let i,o,l,d;try{({name:i,iconsetId:o,params:l,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:g,c:x,d:w,e:A,f:I}=d||{};return new Qs({name:i,iconsetId:o},{params:l,transform:new DOMMatrix([f,g,x,w,A,I])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class ps{constructor(e,i,o,l,d=!1){this.primaryId=bs.from(e),this.primaryOptions=i,o&&(this.secondaryId=bs.from(o)),this.secondaryOptions=l,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Qs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Qs(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ps.build({name:e}):e}static build(e,i,o,l){return!e||typeof e=="object"&&!("name"in e)?null:new ps(e,o,i,l)}}function Im(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ji||r instanceof ia||r instanceof ns||r instanceof ps)return!0;if(Array.isArray(r)){for(const e of r)if(!bl(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!bl(r[e]))return!1;return!0}return!1}function Sn(r){if(r===null)return ea;if(typeof r=="string")return fr;if(typeof r=="boolean")return nr;if(typeof r=="number")return Ht;if(r instanceof Ji)return fs;if(r instanceof ia)return ka;if(r instanceof ns)return Fc;if(r instanceof ps)return Bc;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const l=Sn(o);if(i){if(i===l)continue;i=ir;break}i=l}return rs(i||ir,e)}return ta}function ss(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Ji?r.toStringPremultipliedAlpha():r instanceof ns||r instanceof ps?r.toString():JSON.stringify(r)}class Ci{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bl(e[1]))return i.error("invalid value");const o=e[1];let l=Sn(o);const d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Ci(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ji?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ns?this.value.serialize():this.value}}class Dt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Uc={string:fr,number:Ht,boolean:nr,object:ta};class ai{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,l=1;const d=e[0];if(d==="array"){let g,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Uc)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=Uc[w],l++}else g=ir;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}o=rs(g,x)}else o=Uc[d];const f=[];for(;l<e.length;l++){const g=i.parse(e[l],l,ir);if(!g)return null;f.push(g)}return new ai(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Nc(this.type,Sn(o)))return o;if(i===this.args.length-1)throw new Dt(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${pn(Sn(o))} but was expected to be of type ${pn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(o=>o.serialize()))}}class La{constructor(e){this.type=Fc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let x=null;if(g["font-scale"]&&(x=i.parseObjectValue(g["font-scale"],f,"font-scale",Ht),!x))return null;let w=null;if(g["text-font"]&&(w=i.parseObjectValue(g["text-font"],f,"text-font",rs(fr)),!w))return null;let A=null;if(g["text-color"]&&(A=i.parseObjectValue(g["text-color"],f,"text-color",fs),!A))return null;const I=l[l.length-1];I.scale=x,I.font=w,I.textColor=A}else{const x=i.parse(e[f],f,ir);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new La(l)}evaluate(e){return new ns(this.sections.map(i=>{const o=i.content.evaluate(e);return Sn(o)===Bc?new nh("",o,null,null,null):new nh(ss(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class wl{constructor(e,i,o,l){this._imageWarnHistory={},this.type=Bc,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),l&&(this.paramsSecondary=l.params,this.iconsetIdSecondary=l.iconset?l.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const l=[];function d(){if(o<e.length){const g=i.parse(e[o],o++,fr);return g?(l.push({image:g,options:{}}),!0):(i.error(l.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){const x=e[o];if((g=x)===null||typeof g!="object"||Array.isArray(g))return!0;const w=x.params,A=x.iconset,I=i.concat(o);if(!w&&!A)return o++,!0;if(w){if(typeof w!="object"||w.constructor!==Object)return I.error('Image options "params" should be an object'),!1;const P={},L=I.concat(void 0,"params");for(const z in w){if(!z)return L.error("Image parameter name should be non-empty"),!1;const B=L.concat(void 0,z).parse(w[z],void 0,fs,void 0,{typeAnnotation:"coerce"});if(!B)return!1;P[z]=B}l[l.length-1].options.params=P}if(A){if(typeof A!="object"||A.constructor!==Object)return I.error('Image options "iconset" should be an object'),!1;if(!A.id)return I.error('Image options "iconset" should have an "id" property'),!1;l[l.length-1].options.iconset=A}return o++,!0}var g;return!0}for(let g=0;g<2;g++)if(!d()||!f())return;return new wl(l[0].image,l[1]?l[1].image:void 0,l[0].options,l[1]?l[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const l in i)if(i[l])try{o[l]=i[l].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,l=ps.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(l&&e.availableImages){const d=l.getPrimary().id;if(l.available=e.availableImages.some(f=>bs.isEqual(f,d)),l.available){const f=l.getSecondary()?l.getSecondary().id:null;f&&(l.available=e.availableImages.some(g=>bs.isEqual(g,f)))}}return l}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const l in e)e[l]&&(o.params[l]=e[l].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function li(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const Cm={"to-boolean":nr,"to-color":fs,"to-number":Ht,"to-string":fr};class eo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],l=[];let d=ea;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=rs(i.expectedType.itemType,f)}else{if(!(f>0&&bl(e[1][0])))return null;d=rs(Sn(e[1][0]),f)}for(let g=0;g<f;g++){const x=e[1][g];let w;if(li(x)==="array")w=i.parse(x,void 0,d.itemType);else{const A=li(x);if(A!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${A}.`);w=i.registry.literal.parse(["literal",x===void 0?null:x],i)}if(!w)return null;l.push(w)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=Cm[o];for(let f=1;f<e.length;f++){const g=i.parse(e[f],f,ir);if(!g)return null;l.push(g)}}return new eo(d,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const l of this.args){if(i=l.evaluate(e),o=null,i instanceof Ji)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Im(i[0],i[1],i[2],i[3]),!o))return new Ji(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Dt(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new Dt(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ns.fromString(ss(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ps.build(ss(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ss(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new La([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Pm=["Unknown","Point","LineString","Polygon"];class sh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ji.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Xn{constructor(e,i,o,l,d){this.name=e,this.type=i,this._evaluate=o,this.args=l,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=Xn.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],l=Xn.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[];let x=null,w=-1;for(const[A,I]of f){if(Array.isArray(A)&&A.length!==e.length-1)continue;g.push(A),w++,x=new Nm(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const P=[];let L=!1;for(let z=1;z<e.length;z++){const B=e[z],H=Array.isArray(A)?A[z-1]:A.type,Z=x.parse(B,1+P.length,H);if(!Z){L=!0;break}P.push(Z)}if(!L)if(Array.isArray(A)&&A.length!==P.length)x.error(`Expected ${A.length} arguments, but found ${P.length} instead.`);else{for(let z=0;z<P.length;z++){const B=Array.isArray(A)?A[z]:A.type,H=P[z];x.concat(z+1).checkSubtype(B,H.type)}if(x.errors.length===0)return new Xn(o,d,I,P,w)}}if(g.length===1)i.errors.push(...x.errors);else{const A=(g.length?g:f.map(([P])=>P)).map(os).join(" | "),I=[];for(let P=1;P<e.length;P++){const L=i.parse(e[P],1+I.length);if(!L)return null;I.push(pn(L.type))}i.error(`Expected arguments of type ${A}, but found (${I.join(", ")}) instead.`)}return null}static register(e,i){Xn.definitions=i;for(const o in i)e[o]=Xn}}function os(r){return Array.isArray(r)?`(${r.map(pn).join(", ")})`:`(${pn(r.type)}...)`}class Tl{constructor(e,i,o){this.type=ka,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=o["case-sensitive"]===void 0?i.parse(!1,1,nr):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",nr);if(!l)return null;const d=o["diacritic-sensitive"]===void 0?i.parse(!1,1,nr):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",nr);if(!d)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",fr),!f)?null:new Tl(l,d,f)}evaluate(e){return new ia(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ra(r,e,i=0,o=r.length-1,l=Oa){for(;o>i;){if(o-i>600){const x=o-i+1,w=e-i+1,A=Math.log(x),I=.5*Math.exp(2*A/3),P=.5*Math.sqrt(A*I*(x-I)/x)*(w-x/2<0?-1:1);ra(r,e,Math.max(i,Math.floor(e-w*I/x+P)),Math.min(o,Math.floor(e+(x-w)*I/x+P)),l)}const d=r[e];let f=i,g=o;for(za(r,i,e),l(r[o],d)>0&&za(r,i,o);f<g;){for(za(r,f,g),f++,g--;l(r[f],d)<0;)f++;for(;l(r[g],d)>0;)g--}l(r[i],d)===0?za(r,i,g):(g++,za(r,g,o)),g<=e&&(i=g+1),e<=g&&(o=g-1)}}function za(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function Oa(r,e){return r<e?-1:r>e?1:0}function as(r){let e=0;for(let i,o,l=0,d=r.length,f=d-1;l<d;f=l++)i=r[l],o=r[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Vc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function jc(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Iy(r,e,i){const o=r[0]-e[0],l=r[1]-e[1],d=r[0]-i[0],f=r[1]-i[1];return o*f-d*l==0&&o*d<=0&&l*f<=0}function Lo(r,e,i=!1){let o=!1;for(let g=0,x=e.length;g<x;g++){const w=e[g];for(let A=0,I=w.length,P=I-1;A<I;P=A++){const L=w[P],z=w[A];if(Iy(r,L,z))return i;(d=L)[1]>(l=r)[1]!=(f=z)[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(o=!o)}}var l,d,f;return o}function ef(r,e,i,o){const l=o[0]-i[0],d=o[1]-i[1],f=(r[0]-i[0])*d-l*(r[1]-i[1]),g=(e[0]-i[0])*d-l*(e[1]-i[1]);return f>0&&g<0||f<0&&g>0}function mo(r,e,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-r[0],e[1]-r[1]])[1]-l[1]*d[0]!=0&&!(!ef(r,e,i,o)||!ef(i,o,r,e));var l,d}function tf(r){const e=new gt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new gt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of r[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const na=8192;function Cy(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*na),Math.round(o*l*na)]}function Py(r,e){for(let i=0;i<e.length;i++)if(Lo(r,e[i]))return!0;return!1}function Mm(r,e,i){for(const o of i)for(let l=0,d=o.length,f=d-1;l<d;f=l++)if(mo(r,e,o[f],o[l]))return!0;return!1}function Rm(r,e){for(let i=0;i<r.length;++i)if(!Lo(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Mm(r[i],r[i+1],e))return!1;return!0}function My(r,e){for(let i=0;i<e.length;i++)if(Rm(r,e[i]))return!0;return!1}function oh(r,e,i){const o=[];for(let l=0;l<r.length;l++){const d=[];for(let f=0;f<r[l].length;f++){const g=Cy(r[l][f],i);Vc(e,g),d.push(g)}o.push(d)}return o}function Dm(r,e,i){const o=[];for(let l=0;l<r.length;l++){const d=oh(r[l],e,i);o.push(d)}return o}function sa(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const l=.5*o;let d=r[0]-i[0]>l?-o:i[0]-r[0]>l?o:0;d===0&&(d=r[0]-i[2]>l?-o:i[2]-r[0]>l?o:0),r[0]+=d}Vc(e,r)}function km(r,e,i,o){const l=Math.pow(2,o.z)*na,d=[o.x*na,o.y*na],f=[];if(!r)return f;for(const g of r)for(const x of g){const w=[x.x+d[0],x.y+d[1]];sa(w,e,i,l),f.push(w)}return f}function Lm(r,e,i,o){const l=Math.pow(2,o.z)*na,d=[o.x*na,o.y*na],f=[];if(!r)return f;for(const x of r){const w=[];for(const A of x){const I=[A.x+d[0],A.y+d[1]];Vc(e,I),w.push(I)}f.push(w)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of f)for(const w of x)sa(w,e,i,l)}var g;return f}class zo{constructor(e,i){this.type=nr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bl(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const d=o.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new zo(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new zo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new zo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=oh(o.coordinates,d,f),x=km(i.geometry(),l,d,f);if(!jc(l,d))return!1;for(const w of x)if(!Lo(w,g))return!1}if(o.type==="MultiPolygon"){const g=Dm(o.coordinates,d,f),x=km(i.geometry(),l,d,f);if(!jc(l,d))return!1;for(const w of x)if(!Py(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=oh(o.coordinates,d,f),x=Lm(i.geometry(),l,d,f);if(!jc(l,d))return!1;for(const w of x)if(!Rm(w,g))return!1}if(o.type==="MultiPolygon"){const g=Dm(o.coordinates,d,f),x=Lm(i.geometry(),l,d,f);if(!jc(l,d))return!1;for(const w of x)if(!My(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const $c={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},rf=1/298.257223563,Vs=rf*(2-rf),Sl=Math.PI/180;class El{static fromTile(e,i,o){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Sl;return new El(d,o)}static get units(){return $c}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!$c[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys($c).join(", ")}`);const o=6378.137*Sl*(i?$c[i]:1),l=Math.cos(e*Sl),d=1/(1-Vs*(1-l*l)),f=Math.sqrt(d);this.kx=o*f*l,this.ky=o*f*d*(1-Vs)}distance(e,i){const o=Ds(e[0]-i[0])*this.kx,l=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}bearing(e,i){const o=Ds(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Sl}destination(e,i,o){const l=o*Sl;return this.offset(e,Math.sin(l)*i,Math.cos(l)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const l=e[o];for(let d=0,f=l.length,g=f-1;d<f;g=d++)i+=Ds(l[d][0]-l[g][0])*(l[d][1]+l[g][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let l=0;l<e.length-1;l++){const d=e[l],f=e[l+1],g=this.distance(d,f);if(o+=g,o>i)return ah(d,f,(i-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[l,d]=i,f=Ds(o[0]-l)*this.kx,g=(o[1]-d)*this.ky;if(f!==0||g!==0){const x=(Ds(e[0]-l)*this.kx*f+(e[1]-d)*this.ky*g)/(f*f+g*g);x>1?(l=o[0],d=o[1]):x>0&&(l+=f/this.kx*x,d+=g/this.ky*x)}return f=Ds(e[0]-l)*this.kx,g=(e[1]-d)*this.ky,Math.sqrt(f*f+g*g)}pointOnLine(e,i){let o=1/0,l=e[0][0],d=e[0][1],f=0,g=0;for(let x=0;x<e.length-1;x++){let w=e[x][0],A=e[x][1],I=Ds(e[x+1][0]-w)*this.kx,P=(e[x+1][1]-A)*this.ky,L=0;I===0&&P===0||(L=(Ds(i[0]-w)*this.kx*I+(i[1]-A)*this.ky*P)/(I*I+P*P),L>1?(w=e[x+1][0],A=e[x+1][1]):L>0&&(w+=I/this.kx*L,A+=P/this.ky*L)),I=Ds(i[0]-w)*this.kx,P=(i[1]-A)*this.ky;const z=I*I+P*P;z<o&&(o=z,l=w,d=A,f=x,g=L)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,o){let l=this.pointOnLine(o,e),d=this.pointOnLine(o,i);if(l.index>d.index||l.index===d.index&&l.t>d.t){const w=l;l=d,d=w}const f=[l.point],g=l.index+1,x=d.index;!nf(o[g],f[0])&&g<=x&&f.push(o[g]);for(let w=g+1;w<=x;w++)f.push(o[w]);return nf(o[x],d.point)||f.push(d.point),f}lineSliceAlong(e,i,o){let l=0;const d=[];for(let f=0;f<o.length-1;f++){const g=o[f],x=o[f+1],w=this.distance(g,x);if(l+=w,l>e&&d.length===0&&d.push(ah(g,x,(e-(l-w))/w)),l>=i)return d.push(ah(g,x,(i-(l-w))/w)),d;l>e&&d.push(x)}return d}bufferPoint(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[0]+l,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[2]+l,e[3]+o]}insideBBox(e,i){return Ds(e[0]-i[0])>=0&&Ds(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function nf(r,e){return r[0]===e[0]&&r[1]===e[1]}function ah(r,e,i){const o=Ds(e[0]-r[0]);return[r[0]+o*i,r[1]+(e[1]-r[1])*i]}function Ds(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class lh{constructor(e=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,l=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(o(l,f)>=0)break;i[e]=f,e=d}i[e]=l}_down(e){const{data:i,compare:o}=this,l=this.length>>1,d=i[e];for(;e<l;){let f=1+(e<<1);const g=f+1;if(g<this.length&&o(i[g],i[f])<0&&(f=g),o(i[f],d)>=0)break;i[e]=i[f],e=f}i[e]=d}}var vt=8192;function sf(r,e){return e.dist-r.dist}const ch=100,uh=50;function of(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function Fa(r){return r[1]-r[0]+1}function js(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Al(r,e){if(r[0]>r[1])return[null,null];const i=Fa(r);if(e){if(i===2)return[r,null];const o=Math.floor(i/2);return[[r[0],r[0]+o],[r[0]+o,r[1]]]}{if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}}function oa(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!js(e,r.length))return i;for(let o=e[0];o<=e[1];++o)Vc(i,r[o]);return i}function Gc(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let o=0;o<r[i].length;++o)Vc(e,r[i][o]);return e}function Ba(r,e,i){if(of(r)||of(e))return NaN;let o=0,l=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(l=r[1]-e[3]),r[3]<e[1]&&(l=e[1]-r[3]),i.distance([0,0],[o,l])}function Il(r){return 360*r-180}function ji(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function af(r,e){const i=Math.pow(2,e.z),o=(r.y/vt+e.y)/i;return[Il((r.x/vt+e.x)/i),ji(o)]}function Ry(r,e){const i=[];for(let o=0;o<r.length;++o)i.push(af(r[o],e));return i}function zm(r,e,i){const o=i.pointOnLine(e,r).point;return i.distance(r,o)}function lf(r,e,i,o,l){const d=i.slice(o[0],o[1]+1);let f=1/0;for(let g=e[0];g<=e[1];++g)if((f=Math.min(f,zm(r[g],d,l)))===0)return 0;return f}function cf(r,e,i,o,l){const d=Math.min(l.pointToSegmentDistance(r,i,o),l.pointToSegmentDistance(e,i,o)),f=Math.min(l.pointToSegmentDistance(i,r,e),l.pointToSegmentDistance(o,r,e));return Math.min(d,f)}function Zr(r,e,i,o,l){if(!js(e,r.length)||!js(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let g=o[0];g<o[1];++g){if(mo(r[f],r[f+1],i[g],i[g+1]))return 0;d=Math.min(d,cf(r[f],r[f+1],i[g],i[g+1],l))}return d}function Dy(r,e,i,o,l){if(!js(e,r.length)||!js(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let g=o[0];g<=o[1];++g)if((d=Math.min(d,l.distance(r[f],i[g])))===0)return d;return d}function ky(r,e,i){if(Lo(r,e,!0))return 0;let o=1/0;for(const l of e){const d=l.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[d-1]&&(o=Math.min(o,i.pointToSegmentDistance(r,l[d-1],l[0])))===0||(o=Math.min(o,zm(r,l,i)))===0)return o}return o}function Ly(r,e,i,o){if(!js(e,r.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Lo(r[d],i,!0))return 0;let l=1/0;for(let d=e[0];d<e[1];++d)for(const f of i)for(let g=0,x=f.length,w=x-1;g<x;w=g++){if(mo(r[d],r[d+1],f[w],f[g]))return 0;l=Math.min(l,cf(r[d],r[d+1],f[w],f[g],o))}return l}function Om(r,e){for(const i of r)for(let o=0;o<=i.length-1;++o)if(Lo(i[o],e,!0))return!0;return!1}function zy(r,e,i,o=1/0){const l=Gc(r),d=Gc(e);if(o!==1/0&&Ba(l,d,i)>=o)return o;if(jc(l,d)){if(Om(r,e))return 0}else if(Om(e,r))return 0;let f=o;for(const g of r)for(let x=0,w=g.length,A=w-1;x<w;A=x++)for(const I of e)for(let P=0,L=I.length,z=L-1;P<L;z=P++){if(mo(g[A],g[x],I[z],I[P]))return 0;f=Math.min(f,cf(g[A],g[x],I[z],I[P],i))}return f}function hh(r,e,i,o,l,d,f){if(d===null||f===null)return;const g=Ba(oa(o,d),oa(l,f),i);g<e&&r.push({dist:g,range1:d,range2:f})}function Oy(r,e,i,o,l=1/0){let d=Math.min(o.distance(r[0],i[0][0]),l);if(d===0)return d;const f=new lh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],sf),g=e?uh:ch,x=Gc(i);for(;f.length;){const w=f.pop();if(w.dist>=d)continue;const A=w.range1;if(Fa(A)<=g){if(!js(A,r.length))return NaN;if(e){const I=Ly(r,A,i,o);if((d=Math.min(d,I))===0)return d}else for(let I=A[0];I<=A[1];++I){const P=ky(r[I],i,o);if((d=Math.min(d,P))===0)return d}}else{const I=Al(A,e);if(I[0]!==null){const P=Ba(oa(r,I[0]),x,o);P<d&&f.push({dist:P,range1:I[0],range2:[0,0]})}if(I[1]!==null){const P=Ba(oa(r,I[1]),x,o);P<d&&f.push({dist:P,range1:I[1],range2:[0,0]})}}}return d}function Fm(r,e,i,o,l,d=1/0){let f=Math.min(d,l.distance(r[0],i[0]));if(f===0)return f;const g=new lh([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],sf),x=e?uh:ch,w=o?uh:ch;for(;g.length;){const A=g.pop();if(A.dist>=f)continue;const I=A.range1,P=A.range2;if(Fa(I)<=x&&Fa(P)<=w){if(!js(I,r.length)||!js(P,i.length))return NaN;if(e&&o?f=Math.min(f,Zr(r,I,i,P,l)):e||o?e&&!o?f=Math.min(f,lf(i,P,r,I,l)):!e&&o&&(f=Math.min(f,lf(r,I,i,P,l))):f=Math.min(f,Dy(r,I,i,P,l)),f===0)return f}else{const L=Al(I,e),z=Al(P,o);hh(g,f,l,r,i,L[0],z[0]),hh(g,f,l,r,i,L[0],z[1]),hh(g,f,l,r,i,L[1],z[0]),hh(g,f,l,r,i,L[1],z[1])}}return f}function uf(r,e,i,o,l=1/0){let d=l;const f=oa(r,[0,r.length-1]);for(const g of i)if(!(d!==1/0&&Ba(f,oa(g,[0,g.length-1]),o)>=d)&&(d=Math.min(d,Fm(r,e,g,!0,o,d)),d===0))return d;return d}function dh(r,e,i,o,l=1/0){let d=l;const f=oa(r,[0,r.length-1]);for(const g of i){if(d!==1/0&&Ba(f,Gc(g),o)>=d)continue;const x=Oy(r,e,g,o,d);if(isNaN(x))return x;if((d=Math.min(d,x))===0)return d}return d}function hf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Na{constructor(e,i){this.type=Ht,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(bl(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let l=0;l<o.features.length;++l)if(hf(o.features[l].geometry.type))return new Na(o,o.features[l].geometry)}else if(o.type==="Feature"){if(hf(o.geometry.type))return new Na(o,o.geometry)}else if(hf(o.type))return new Na(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(l,d,f){const g=[];for(const w of l)for(const A of w)g.push(af(A,d));const x=new El(g[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Fm(g,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?uf(g,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?dh(g,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(l,d,f){const g=[];for(const w of l){const A=[];for(const I of w)A.push(af(I,d));g.push(A)}const x=new El(g[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return uf(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let w=1/0;for(let A=0;A<f.coordinates.length;A++){const I=uf(f.coordinates[A],!0,g,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}if(f.type==="Polygon"||f.type==="MultiPolygon"){let w=1/0;for(let A=0;A<g.length;A++){const I=dh(g[A],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(l,d,f){const g=[];for(const w of function(A,I){const P=A.length;if(P<=1)return[A];const L=[];let z,B;for(let H=0;H<P;H++){const Z=as(A[H]);Z!==0&&(A[H].area=Math.abs(Z),B===void 0&&(B=Z<0),B===Z<0?(z&&L.push(z),z=[A[H]]):z.push(A[H]))}return z&&L.push(z),L}(l)){const A=[];for(let I=0;I<w.length;++I)A.push(Ry(w[I],d));g.push(A)}const x=new El(g[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return dh(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let w=1/0;for(let A=0;A<f.coordinates.length;A++){const I=dh(f.coordinates[A],!0,g,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return f.type==="Polygon"||f.type==="MultiPolygon"?function(w,A,I){let P=1/0;for(const L of w)for(const z of A){const B=zy(L,z,I,P);if(isNaN(B))return B;if((P=Math.min(P,B))===0)return P}return P}(f.type==="Polygon"?[f.coordinates]:f.coordinates,g,x):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function df(r,e){switch(r){case"string":return ss(e);case"number":return+e;case"boolean":return!!e;case"color":return Ji.parse(e);case"formatted":return ns.fromString(ss(e));case"resolvedImage":return ps.build(ss(e))}return e}function Bm(r,e,i,o){return o!==void 0&&(r=o*Math.round(r/o)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Cl{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=ir),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof Ci))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const d=i.parse(e[2],2);return d instanceof Ci?new Cl(o,ss(l.value),ss(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Cl(o,ss(l.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:l,value:d,values:f,minValue:g,maxValue:x,stepValue:w}=o,A=o.default.evaluate(e);let I=A;if(d){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),I=d.evaluate(e),e.scope=P}return l&&(I=df(l,I)),I===void 0||g===void 0&&x===void 0&&w===void 0||(typeof I=="number"?I=Bm(I,g,x,w):Array.isArray(I)&&(I=I.map(P=>typeof P=="number"?Bm(P,g,x,w):P))),d!==void 0&&I!==void 0&&f&&!f.includes(I)&&(I=A,l&&(I=df(l,I))),(l&&l!==this.type||I!==void 0&&Sn(I)!==this.type)&&(I=df(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Hc(r){if(r instanceof Xn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof zo||r instanceof Na)return!1;let e=!0;return r.eachChild(i=>{e&&!Hc(i)&&(e=!1)}),e}function fh(r){if(r instanceof Xn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!fh(i)&&(e=!1)}),e}function ph(r){if(r instanceof Cl)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...ph(i)])}),e}function Pl(r,e){if(r instanceof Xn&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!Pl(o,e)&&(i=!1)}),i}class mh{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new mh(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ff{constructor(e,i=[],o,l=new Da,d=[],f,g){this.registry=e,this.path=i,this.key=i.map(x=>typeof x=="string"?`['${x}']`:`[${x}]`).join(""),this.scope=l,this.errors=d,this.expectedType=o,this._scope=f,this.options=g}parse(e,i,o,l,d={}){return i||o?this.concat(i,null,o,l)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,o,l,d,f={}){return this.concat(i,o,l,d)._parse(e,f)}_parse(e,i){function o(l,d,f){return f==="assert"?new ai(d,[l]):f==="coerce"?new eo(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let d=l.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,g=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else d=o(d,f,i.typeAnnotation||"coerce");else d=o(d,f,i.typeAnnotation||"assert")}if(!(d instanceof Ci)&&d.type.kind!=="resolvedImage"&&pf(d)){const f=new sh(this._scope,this.options);try{d=new Ci(d.type,d.evaluate(f))}catch(g){return this.error(g.message),null}}return d}return eo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,l){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const f=l?this.scope.concat(l):this.scope;return new ff(this.registry,d,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new Us(o,e))}checkSubtype(e,i){const o=Nc(e,i);return o&&this.error(o),o}}var Nm=ff;function pf(r){if(r instanceof mh)return pf(r.boundExpression);if(r instanceof Xn&&r.name==="error"||r instanceof Tl||r instanceof zo||r instanceof Na||r instanceof Cl)return!1;const e=r instanceof eo||r instanceof ai;let i=!0;return r.eachChild(o=>{i=e?i&&pf(o):i&&o instanceof Ci}),!!i&&Hc(r)&&Pl(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _h(r,e){const i=r.length-1;let o,l,d=0,f=i,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),o=r[g],l=r[g+1],o<=e){if(g===i||e<l)return g;d=g+1}else{if(!(o>e))throw new Dt("Input is not a number.");f=g-1}return 0}class qc{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,d]of o)this.labels.push(l),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Ht);if(!o)return null;const l=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],x=e[f+1],w=f,A=f+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const I=i.parse(x,A,d);if(!I)return null;d=d||I.type,l.push([g,I])}return new qc(d,o,l)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;return l>=i[d-1]?o[d-1].evaluate(e):o[_h(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Um=.95047,Vm=1.08883,jm=4/29,Ml=6/29,$m=3*Ml*Ml,Fy=Ml*Ml*Ml,mf=Math.PI/180,By=180/Math.PI;function gh(r){return r>Fy?Math.pow(r,1/3):r/$m+jm}function _f(r){return r>Ml?r*r*r:$m*(r-jm)}function gf(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function yf(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function vf(r){const e=yf(r.r),i=yf(r.g),o=yf(r.b),l=gh((.4124564*e+.3575761*i+.1804375*o)/Um),d=gh((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-gh((.0193339*e+.119192*i+.9503041*o)/Vm)),alpha:r.a}}function xf(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,o=isNaN(r.b)?e:e-r.b/200;return e=1*_f(e),i=Um*_f(i),o=Vm*_f(o),new Ji(gf(3.2404542*i-1.5371385*e-.4985314*o),gf(-.969266*i+1.8760108*e+.041556*o),gf(.0556434*i-.2040259*e+1.0572252*o),r.alpha)}function Rl(r,e,i){const o=e-r;return r+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Dl={forward:vf,reverse:xf,interpolate:function(r,e,i){return{l:Kt(r.l,e.l,i),a:Kt(r.a,e.a,i),b:Kt(r.b,e.b,i),alpha:Kt(r.alpha,e.alpha,i)}}},kl={forward:function(r){const{l:e,a:i,b:o}=vf(r),l=Math.atan2(o,i)*By;return{h:l<0?l+360:l,c:Math.sqrt(i*i+o*o),l:e,alpha:r.a}},reverse:function(r){const e=r.h*mf,i=r.c;return xf({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Rl(r.h,e.h,i),c:Kt(r.c,e.c,i),l:Kt(r.l,e.l,i),alpha:Kt(r.alpha,e.alpha,i)}}};var Gm=Object.freeze({__proto__:null,hcl:kl,lab:Dl});class ms{constructor(e,i,o,l,d){this.type=e,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,i,o,l){let d=0;if(e.name==="exponential")d=Wc(i,e.base,o,l);else if(e.name==="linear")d=Wc(i,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new qu(f[0],f[1],f[2],f[3]).solve(Wc(i,1,o,l))}return d}static parse(e,i){let[o,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Ht),!d)return null;const g=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=fs:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<f.length;w+=2){const A=f[w],I=f[w+1],P=w+3,L=w+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=i.parse(I,L,x);if(!z)return null;x=x||z.type,g.push([A,z])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new ms(x,o,l,d,g):i.error(`Type ${pn(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;if(l>=i[d-1])return o[d-1].evaluate(e);const f=_h(i,l),g=ms.interpolationFactor(this.interpolation,l,i[f],i[f+1]),x=o[f].evaluate(e),w=o[f+1].evaluate(e);return this.operator==="interpolate"?rh[this.type.kind.toLowerCase()](x,w,g):this.operator==="interpolate-hcl"?kl.reverse(kl.interpolate(kl.forward(x),kl.forward(w),g)):Dl.reverse(Dl.interpolate(Dl.forward(x),Dl.forward(w),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Wc(r,e,i,o){const l=o-i,d=r-i;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class yh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const d=[];for(const g of e.slice(1)){const x=i.parse(g,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}const f=l&&d.some(g=>Nc(l,g.type));return new yh(f?ir:o,d)}evaluate(e){let i,o=null,l=0;for(const d of this.args){if(l++,o=d.evaluate(e),o&&o instanceof ps&&!o.available&&(i||(i=o),o=null,l===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class vh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=i.parse(e[d+1],d+1);if(!g)return null;o.push([f,g])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return l?new vh(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class xh{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ht),l=i.parse(e[2],2,rs(i.expectedType||ir));return o&&l?new xh(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Dt(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Dt(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Dt(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bh{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ht),l=i.parse(e[2],2,rs(i.expectedType||ir));return o&&l?new bh(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Dt(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new Dt(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const l=Math.floor(i),d=Math.ceil(i),f=o[l],g=o[d];if(typeof f!="number"||typeof g!="number")throw new Dt(`Cannot interpolate between non-number values at index ${i}.`);const x=i-l;return f*(1-x)+g*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class bf{constructor(e,i){this.type=nr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ir),l=i.parse(e[2],2,ir);return o&&l?Qd(o.type,[nr,fr,Ht,ea,ir])?new bf(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pn(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!xl(i,["boolean","string","number","null"]))throw new Dt(`Expected first argument to be of type boolean, string, number or null, but found ${pn(Sn(i))} instead.`);if(!xl(o,["string","array"]))throw new Dt(`Expected second argument to be of type array or string, but found ${pn(Sn(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wh{constructor(e,i,o){this.type=Ht,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ir),l=i.parse(e[2],2,ir);if(!o||!l)return null;if(!Qd(o.type,[nr,fr,Ht,ea,ir]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pn(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ht);return d?new wh(o,l,d):null}return new wh(o,l)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!xl(i,["boolean","string","number","null"]))throw new Dt(`Expected first argument to be of type boolean, string, number or null, but found ${pn(Sn(i))} instead.`);if(!xl(o,["string","array"]))throw new Dt(`Expected second argument to be of type array or string, but found ${pn(Sn(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(i,l)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wf{constructor(e,i,o,l,d,f){this.inputType=e,this.type=i,this.input=o,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d={},f=[];for(let w=2;w<e.length-1;w+=2){let A=e[w];const I=e[w+1];Array.isArray(A)||(A=[A]);const P=i.concat(w);if(A.length===0)return P.error("Expected at least one branch label.");for(const z of A){if(typeof z!="number"&&typeof z!="string")return P.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(o){if(P.checkSubtype(o,Sn(z)))return null}else o=Sn(z);if(d[String(z)]!==void 0)return P.error("Branch labels must be unique.");d[String(z)]=f.length}const L=i.parse(I,w,l);if(!L)return null;l=l||L.type,f.push(L)}const g=i.parse(e[1],1,ir);if(!g)return null;const x=i.parse(e[e.length-1],e.length-1,l);return x?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new wf(o,l,g,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(Sn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],l={};for(const f of i){const g=l[this.cases[f]];g===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[g][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of o)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Th{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const g=i.parse(e[f],f,nr);if(!g)return null;const x=i.parse(e[f+1],f+1,o);if(!x)return null;l.push([g,x]),o=o||x.type}const d=i.parse(e[e.length-1],e.length-1,o);return d?new Th(o,l,d):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Zc{constructor(e,i,o,l){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ir),l=i.parse(e[2],2,Ht);if(!o||!l)return null;if(!Qd(o.type,[rs(ir),fr,ir]))return i.error(`Expected first argument to be of type array or string, but found ${pn(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ht);return d?new Zc(o.type,o,l,d):null}return new Zc(o.type,o,l)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!xl(i,["string","array"]))throw new Dt(`Expected first argument to be of type array or string, but found ${pn(Sn(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(o,l)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Xc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Hm(r,e,i,o){return o.compare(e,i)===0}function Ua(r,e,i){const o=r!=="=="&&r!=="!=";return class GI{constructor(d,f,g){this.type=nr,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let x=f.parse(d[1],1,ir);if(!x)return null;if(!Xc(g,x.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${pn(x.type)}'.`);let w=f.parse(d[2],2,ir);if(!w)return null;if(!Xc(g,w.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${pn(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${pn(x.type)}' and '${pn(w.type)}'.`);o&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new ai(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new ai(x.type,[w])));let A=null;if(d.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(A=f.parse(d[3],3,ka),!A)return null}return new GI(x,w,A)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Sn(f),w=Sn(g);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Dt(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Sn(f),w=Sn(g);if(x.kind!=="string"||w.kind!=="string")return e(d,f,g)}return this.collator?i(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[r];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const Ny=Ua("==",function(r,e,i){return e===i},Hm),Uy=Ua("!=",function(r,e,i){return e!==i},function(r,e,i,o){return!Hm(0,e,i,o)}),qm=Ua("<",function(r,e,i){return e<i},function(r,e,i,o){return o.compare(e,i)<0}),Wm=Ua(">",function(r,e,i){return e>i},function(r,e,i,o){return o.compare(e,i)>0}),Vy=Ua("<=",function(r,e,i){return e<=i},function(r,e,i,o){return o.compare(e,i)<=0}),jy=Ua(">=",function(r,e,i){return e>=i},function(r,e,i,o){return o.compare(e,i)>=0});class Tf{constructor(e,i,o,l,d,f){this.type=fr,this.number=e,this.locale=i,this.currency=o,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ht);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parseObjectValue(l.locale,2,"locale",fr),!d))return null;let f=null;if(l.currency&&(f=i.parseObjectValue(l.currency,2,"currency",fr),!f))return null;let g=null;if(l.unit&&(g=i.parseObjectValue(l.unit,2,"unit",fr),!g))return null;let x=null;if(l["min-fraction-digits"]&&(x=i.parseObjectValue(l["min-fraction-digits"],2,"min-fraction-digits",Ht),!x))return null;let w=null;return l["max-fraction-digits"]&&(w=i.parseObjectValue(l["max-fraction-digits"],2,"max-fraction-digits",Ht),!w)?null:new Tf(o,d,f,g,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kc{constructor(e){this.type=Ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pn(o.type)} instead.`):new Kc(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Dt(`Expected value to be of type string or array, but found ${pn(Sn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Zm(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Va={"==":Ny,"!=":Uy,">":Wm,"<":qm,">=":jy,"<=":Vy,array:ai,at:xh,"at-interpolated":bh,boolean:ai,case:Th,coalesce:yh,collator:Tl,format:La,image:wl,in:bf,"index-of":wh,interpolate:ms,"interpolate-hcl":ms,"interpolate-lab":ms,length:Kc,let:vh,literal:Ci,match:wf,number:ai,"number-format":Tf,object:ai,slice:Zc,step:qc,string:ai,"to-boolean":eo,"to-color":eo,"to-number":eo,"to-string":eo,var:mh,within:zo,distance:Na,config:Cl};function Xm(r,[e,i,o,l]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const d=l?l.evaluate(r):1,f=Im(e,i,o,d);if(f)throw new Dt(f);return new Ji(e/255*d,i/255*d,o/255*d,d)}function Km(r,[e,i,o,l]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const d=l?l.evaluate(r):1,f=function(w,A,I,P){return typeof w=="number"&&w>=0&&w<=360?typeof A=="number"&&A>=0&&A<=100&&typeof I=="number"&&I>=0&&I<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[w,A,I,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[w,A,I,P]:[w,A,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[w,A,I,P]:[w,A,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,d);if(f)throw new Dt(f);const g=`hsla(${e}, ${i}%, ${o}%, ${d})`,x=Ji.parse(g);if(!x)throw new Dt(`Failed to parse HSLA color: ${g}`);return x}function Sf(r,e){return r in e}function Sh(r,e){const i=e[r];return i===void 0?null:i}function aa(r){return{type:r}}function Ym(r){return{result:"success",value:r}}function ks(r){return{result:"error",value:r}}function Ef(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Eh(r){return r["property-type"]==="data-driven"}function Jm(r){return Ef(r.expression,"measure-light")}function Af(r){return Ef(r.expression,"zoom")}function Ah(r){return!!r.expression&&r.expression.interpolated}function Ih(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Qm(r){return r}function Ch(r,e){const i=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",l=o||!(o||r.property!==void 0),d=r.type||(Ah(e)?"exponential":"interval");if(i&&((r=Oc({},r)).stops&&(r.stops=r.stops.map(w=>[w[0],Ji.parse(w[1])])),r.default=Ji.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Gm[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let f,g,x;if(d==="exponential")f=Oo;else if(d==="interval")f=$y;else if(d==="categorical"){f=e_,g=Object.create(null);for(const w of r.stops)g[w[0]]=w[1];x=typeof r.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=Gy}if(o){const w={},A=[];for(let L=0;L<r.stops.length;L++){const z=r.stops[L],B=z[0].zoom;w[B]===void 0&&(w[B]={zoom:B,type:r.type,property:r.property,default:r.default,stops:[]},A.push(B)),w[B].stops.push([z[0].value,z[1]])}const I=[];for(const L of A)I.push([w[L].zoom,Ch(w[L],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:ms.interpolationFactor.bind(void 0,P),zoomStops:I.map(L=>L[0]),evaluate:({zoom:L},z)=>Oo({stops:I,base:r.base},e,L).evaluate(L,z)}}if(l){const w=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:ms.interpolationFactor.bind(void 0,w),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>f(r,e,A,g,x)}}return{kind:"source",evaluate(w,A){const I=A&&A.properties?A.properties[r.property]:void 0;return I===void 0?ja(r.default,e.default):f(r,e,I,g,x)}}}function ja(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function e_(r,e,i,o,l){return ja(typeof i===l?o[i]:void 0,r.default,e.default)}function $y(r,e,i){if(li(i)!=="number")return ja(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const l=_h(r.stops.map(d=>d[0]),i);return r.stops[l][1]}function Oo(r,e,i){const o=r.base!==void 0?r.base:1;if(li(i)!=="number")return ja(r.default,e.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const d=_h(r.stops.map(A=>A[0]),i),f=function(A,I,P,L){const z=L-P,B=A-P;return z===0?0:I===1?B/z:(Math.pow(I,B)-1)/(Math.pow(I,z)-1)}(i,o,r.stops[d][0],r.stops[d+1][0]),g=r.stops[d][1],x=r.stops[d+1][1];let w=rh[e.type]||Qm;if(r.colorSpace&&r.colorSpace!=="rgb"){const A=Gm[r.colorSpace];w=(I,P)=>A.reverse(A.interpolate(A.forward(I),A.forward(P),f))}return typeof g.evaluate=="function"?{evaluate(...A){const I=g.evaluate.apply(void 0,A),P=x.evaluate.apply(void 0,A);if(I!==void 0&&P!==void 0)return w(I,P,f)}}:w(g,x,f)}function Gy(r,e,i){return e.type==="color"?i=Ji.parse(i):e.type==="formatted"?i=ns.fromString(i.toString()):e.type==="resolvedImage"?i=ps.build(i.toString()):li(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ja(i,r.default,e.default)}Xn.register(Va,{error:[{kind:"error"},[fr],(r,[e])=>{throw new Dt(e.evaluate(r))}],typeof:[fr,[ir],(r,[e])=>pn(Sn(e.evaluate(r)))],"to-rgba":[rs(Ht,4),[fs],(r,[e])=>e.evaluate(r).toRenderColor(null).toArray()],"to-hsla":[rs(Ht,4),[fs],(r,[e])=>e.evaluate(r).toRenderColor(null).toHslaArray()],rgb:[fs,[Ht,Ht,Ht],Xm],rgba:[fs,[Ht,Ht,Ht,Ht],Xm],hsl:[fs,[Ht,Ht,Ht],Km],hsla:[fs,[Ht,Ht,Ht,Ht],Km],has:{type:nr,overloads:[[[fr],(r,[e])=>Sf(e.evaluate(r),r.properties())],[[fr,ta],(r,[e,i])=>Sf(e.evaluate(r),i.evaluate(r))]]},get:{type:ir,overloads:[[[fr],(r,[e])=>Sh(e.evaluate(r),r.properties())],[[fr,ta],(r,[e,i])=>Sh(e.evaluate(r),i.evaluate(r))]]},"feature-state":[ir,[fr],(r,[e])=>Sh(e.evaluate(r),r.featureState||{})],properties:[ta,[],r=>r.properties()],"geometry-type":[fr,[],r=>r.geometryType()],id:[ir,[],r=>r.id()],zoom:[Ht,[],r=>r.globals.zoom],pitch:[Ht,[],r=>r.globals.pitch||0],"distance-from-center":[Ht,[],r=>r.distanceFromCenter()],"measure-light":[Ht,[fr],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Ht,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ht,[],r=>r.globals.lineProgress||0],"raster-value":[Ht,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Ht,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ht,[],r=>r.globals.skyRadialProgress||0],accumulated:[ir,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ht,aa(Ht),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[Ht,aa(Ht),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:Ht,overloads:[[[Ht,Ht],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ht],(r,[e])=>-e.evaluate(r)]]},"/":[Ht,[Ht,Ht],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ht,[Ht,Ht],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ht,[Ht],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ht,[Ht],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ht,[Ht],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ht,[Ht],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ht,[Ht],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ht,[Ht],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ht,[Ht],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ht,aa(Ht),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ht,aa(Ht),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ht,[Ht],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ht,[Ht],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ht,[Ht],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ht,[Ht],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[nr,[fr,ir],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[nr,[ir],(r,[e])=>r.id()===e.value],"filter-type-==":[nr,[fr],(r,[e])=>r.geometryType()===e.value],"filter-<":[nr,[fr,ir],(r,[e,i])=>{const o=r.properties()[e.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[nr,[ir],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[nr,[fr,ir],(r,[e,i])=>{const o=r.properties()[e.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[nr,[ir],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[nr,[fr,ir],(r,[e,i])=>{const o=r.properties()[e.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[nr,[ir],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[nr,[fr,ir],(r,[e,i])=>{const o=r.properties()[e.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[nr,[ir],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[nr,[ir],(r,[e])=>e.value in r.properties()],"filter-has-id":[nr,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[nr,[rs(fr)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[nr,[rs(ir)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[nr,[fr,rs(ir)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[nr,[fr,rs(ir)],(r,[e,i])=>function(o,l,d,f){for(;d<=f;){const g=d+f>>1;if(l[g]===o)return!0;l[g]>o?f=g-1:d=g+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:nr,overloads:[[[nr,nr],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[aa(nr),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:nr,overloads:[[[nr,nr],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[aa(nr),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[nr,[nr],(r,[e])=>!e.evaluate(r)],"is-supported-script":[nr,[fr],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[fr,[fr],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[fr,[fr],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[fr,aa(ir),(r,e)=>e.map(i=>ss(i.evaluate(r))).join("")],"resolved-locale":[fr,[ka],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Ht,[Ht,Ht,ir],(r,e)=>{const[i,o,l]=e.map(f=>f.evaluate(r));if(i>o||i===o)return i;let d;if(typeof l=="string")d=function(f){let g=0;if(f.length===0)return g;for(let x=0;x<f.length;x++)g=(g<<5)-g+f.charCodeAt(x),g|=0;return g}(l);else{if(typeof l!="number")throw new Dt(`Invalid seed input: ${l}`);d=l}return i+Zm(d)()*(o-i)}]});class If{constructor(e,i,o,l){this.expression=e,this._warningHistory={},this._evaluator=new sh(o,l),this._defaultValue=i?function(d){return d.type==="color"&&(Ih(d.default)||Array.isArray(d.default))?new Ji(0,0,0,0):d.type==="color"?Ji.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ph(e)}evaluateWithoutErrorHandling(e,i,o,l,d,f,g,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,l,d,f,g,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Dt(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${w.message}`)),this._defaultValue}}}function Ph(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Va}function Ll(r,e,i,o){const l=new Nm(Va,[],e?function(f){const g={color:fs,string:fr,number:Ht,enum:fr,boolean:nr,formatted:Fc,resolvedImage:Bc};return f.type==="array"?rs(g[f.value]||ir,f.length):g[f.type]}(e):void 0,void 0,void 0,i,o),d=l.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Ym(new If(d,e,i,o)):ks(l.errors)}class $a{constructor(e,i,o,l){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=l,this.isStateDependent=e!=="constant"&&!fh(i.expression),this.configDependencies=ph(i.expression)}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}}class zl{constructor(e,i,o,l,d,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!fh(i.expression),this.isLightConstant=d,this.isLineProgressConstant=f,this.configDependencies=ph(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}interpolationFactor(e,i,o){return this.interpolationType?ms.interpolationFactor(this.interpolationType,e,i,o):0}}function Yc(r,e,i,o){if((r=Ll(r,e,i,o)).result==="error")return r;const l=r.value.expression,d=Hc(l);if(!d&&!Eh(e))return ks([new Us("","data expressions not supported")]);const f=Pl(l,["zoom","pitch","distance-from-center"]);if(!f&&!Af(e))return ks([new Us("","zoom expressions not supported")]);const g=Pl(l,["measure-light"]);if(!g&&!Jm(e))return ks([new Us("","measure-light expression not supported")]);const x=Pl(l,["line-progress"]);if(!x&&!function(I){return Ef(I.expression,"line-progress")}(e))return ks([new Us("","line-progress expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,A=Mh(l);return A||f||w?A instanceof Us?ks([A]):A instanceof ms&&!Ah(e)?ks([new Us("",'"interpolate" expressions cannot be used with this property')]):Ym(A?new zl(d&&x?"camera":"composite",r.value,A.labels,A instanceof ms?A.interpolation:void 0,g,x):new $a(d&&x?"constant":"source",r.value,g,x)):ks([new Us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Jc{constructor(e,i){this._parameters=e,this._specification=i,Oc(this,Ch(this._parameters,this._specification))}static deserialize(e){return new Jc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Mh(r){let e=null;if(r instanceof vh)e=Mh(r.result);else if(r instanceof yh){for(const i of r.args)if(e=Mh(i),e)break}else(r instanceof qc||r instanceof ms)&&r.input instanceof Xn&&r.input.name==="zoom"&&(e=r);return e instanceof Us||r.eachChild(i=>{const o=Mh(i);o instanceof Us?e=o:e&&o&&e!==o&&(e=new Us("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Cf,Rh,Pf=function(){if(Rh)return Cf;Rh=1,Cf=e;var r=3;function e(i,o,l){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var g=0;g<this.d*this.d;g++){var x=f[r+g],w=f[r+g+1];d.push(x===w?null:f.subarray(x,w))}var A=f[r+d.length+1];this.keys=f.subarray(f[r+d.length],A),this.bboxes=f.subarray(A),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var I=0;I<this.d*this.d;I++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=l,this.scale=o/i,this.uid=0;var P=l/o*i;this.min=-P,this.max=i+P}return e.prototype.insert=function(i,o,l,d,f){this._forEachCell(o,l,d,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,l,d,f,g){this.cells[f].push(g)},e.prototype.query=function(i,o,l,d,f){var g=this.min,x=this.max;if(i<=g&&o<=g&&x<=l&&x<=d&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(i,o,l,d,this._queryCell,w,{},f),w},e.prototype._queryCell=function(i,o,l,d,f,g,x,w){var A=this.cells[f];if(A!==null)for(var I=this.keys,P=this.bboxes,L=0;L<A.length;L++){var z=A[L];if(x[z]===void 0){var B=4*z;(w?w(P[B+0],P[B+1],P[B+2],P[B+3]):i<=P[B+2]&&o<=P[B+3]&&l>=P[B+0]&&d>=P[B+1])?(x[z]=!0,g.push(I[z])):x[z]=!1}}},e.prototype._forEachCell=function(i,o,l,d,f,g,x,w){for(var A=this._convertToCellCoord(i),I=this._convertToCellCoord(o),P=this._convertToCellCoord(l),L=this._convertToCellCoord(d),z=A;z<=P;z++)for(var B=I;B<=L;B++){var H=this.d*B+z;if((!w||w(this._convertFromCellCoord(z),this._convertFromCellCoord(B),this._convertFromCellCoord(z+1),this._convertFromCellCoord(B+1)))&&f.call(this,i,o,l,d,H,g,x,w))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=r+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=o,x=0;x<i.length;x++){var w=i[x];f[r+x]=g,f.set(w,g),g+=w.length}return f[r+i.length]=g,f.set(this.keys,g),f[r+i.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer},Cf}(),Ol=fo(Pf);const Qc={};function It(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Qc[e]={klass:r,omit:i.omit||[]}}It(Object,"Object"),Ol.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ol.deserialize=function(r){return new Ol(r.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),It(Ol,"Grid"),typeof DOMMatrix<"u"&&It(DOMMatrix,"DOMMatrix"),It(Ji,"Color"),It(Error,"Error"),It(ns,"Formatted"),It(nh,"FormattedSection"),It(Ju,"AJAXError"),It(ps,"ResolvedImage"),It(Jc,"StylePropertyFunction"),It(If,"StyleExpression",{omit:["_evaluator"]}),It(bs,"ImageId"),It(Qs,"ImageVariant"),It(zl,"ZoomDependentExpression"),It($a,"ZoomConstantExpression"),It(Xn,"CompoundExpression",{omit:["_evaluate"]});for(const r in Va)Qc[Va[r]._classRegistryKey]||It(Va[r],`Expression${r}`);function eu(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Ga(r){return self.ImageBitmap&&r instanceof ImageBitmap}function la(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(eu(r)||Ga(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const o of r)i.push(la(o,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[o,l]of r.entries())i.entries.push(la(o),la(l,e));return i}if(r instanceof Set){const i={$name:"Set"};let o=0;for(const l of r.values())i[++o]=la(l);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const l of o)i[l]=r[l];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const l=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const d in r)r.hasOwnProperty(d)&&(Qc[o].omit.indexOf(d)>=0||(l[d]=la(r[d],e)));r instanceof Error&&(l.message=r.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof r)}function ca(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||eu(r)||Ga(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ca);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const l=r.entries||[],d=new Map;for(let f=0;f<l.length;f+=2)d.set(ca(l[f]),ca(l[f+1]));return d}if(e==="Set"){const l=new Set;for(const d of Object.keys(r))d!=="$name"&&l.add(ca(r[d]));return l}if(e==="DOMMatrix"){let l;return l=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(l)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Qc[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const l of Object.keys(r))l!=="$name"&&(o[l]=ca(r[l]));return o}throw new Error("can't deserialize object of type "+typeof r)}const Qt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Mf(r){for(const e of r)if(tu(e.charCodeAt(0)))return!0;return!1}function Hy(r){for(const e of r)if(!t_(e.charCodeAt(0)))return!1;return!0}function t_(r){return!(Qt.Arabic(r)||Qt["Arabic Supplement"](r)||Qt["Arabic Extended-A"](r)||Qt["Arabic Presentation Forms-A"](r)||Qt["Arabic Presentation Forms-B"](r))}function tu(r){return!(r!==746&&r!==747&&(r<4352||!(Qt["Bopomofo Extended"](r)||Qt.Bopomofo(r)||Qt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Qt["CJK Compatibility Ideographs"](r)||Qt["CJK Compatibility"](r)||Qt["CJK Radicals Supplement"](r)||Qt["CJK Strokes"](r)||!(!Qt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Qt["CJK Unified Ideographs Extension A"](r)||Qt["CJK Unified Ideographs"](r)||Qt["Enclosed CJK Letters and Months"](r)||Qt["Hangul Compatibility Jamo"](r)||Qt["Hangul Jamo Extended-A"](r)||Qt["Hangul Jamo Extended-B"](r)||Qt["Hangul Jamo"](r)||Qt["Hangul Syllables"](r)||Qt.Hiragana(r)||Qt["Ideographic Description Characters"](r)||Qt.Kanbun(r)||Qt["Kangxi Radicals"](r)||Qt["Katakana Phonetic Extensions"](r)||Qt.Katakana(r)&&r!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Qt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](r)||Qt["Unified Canadian Aboriginal Syllabics Extended"](r)||Qt["Vertical Forms"](r)||Qt["Yijing Hexagram Symbols"](r)||Qt["Yi Syllables"](r)||Qt["Yi Radicals"](r))))}function i_(r){return!(tu(r)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function qy(r){return Qt.Arabic(r)||Qt["Arabic Supplement"](r)||Qt["Arabic Extended-A"](r)||Qt["Arabic Presentation Forms-A"](r)||Qt["Arabic Presentation Forms-B"](r)}function r_(r){return r>=1424&&r<=2303||Qt["Arabic Presentation Forms-A"](r)||Qt["Arabic Presentation Forms-B"](r)}function Wy(r,e){return!(!e&&r_(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Qt.Khmer(r))}function Zy(r){for(const e of r)if(r_(e.charCodeAt(0)))return!0;return!1}const Rf="deferred",Df="loading",kf="loaded";let Lf=null,ws="unavailable",ua=null;const Ha=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ws="error"),Lf&&Lf(r)};function Dh(){kh.fire(new Qo("pluginStateChange",{pluginStatus:ws,pluginURL:ua}))}const kh=new Ra,Fl=function(){return ws},n_=function(){if(ws!==Rf||!ua)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws=Df,Dh(),ua&&gl({url:ua},r=>{r?Ha(r):(ws=kf,Dh())})},$s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ws===kf||$s.applyArabicShaping!=null,isLoading:()=>ws===Df,setState(r){ws=r.pluginStatus,ua=r.pluginURL},isParsed:()=>$s.applyArabicShaping!=null&&$s.processBidirectionalText!=null&&$s.processStyledBidirectionalText!=null,getPluginURL:()=>ua};class cr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const l of i)if(!Wy(l.charCodeAt(0),o))return!1;return!0}(e,$s.isLoaded())}}class iu{constructor(e,i,o,l){this.property=e,this.value=i,this.expression=function(d,f,g,x){if(Ih(d))return new Jc(d,f);if(Ph(d)||Array.isArray(d)&&d.length>0){const w=Yc(d,f,g,x);if(w.result==="error")throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));return w.value}{let w=d;return typeof d=="string"&&f.type==="color"&&(w=Ji.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>w}}}(i===void 0?e.specification.default:i,e.specification,o,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ha{constructor(e,i,o){this.property=e,this.value=new iu(e,void 0,i,o)}transitioned(e,i){return new o_(this.property,this.value,i,Be({},e.transition,this.transition),e.now)}untransitioned(){return new o_(this.property,this.value,null,{},0)}}class s_{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ri(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property,this._scope,this._options)),this._values[e].value=new iu(this._values[e].property,i===null?void 0:Ri(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const l in e){const d=e[l];if(l.endsWith("-transition")){const f=l.slice(0,-11);o[f]&&this.setTransition(f,d)}else o.hasOwnProperty(l)&&this.setValue(l,d)}}getTransition(e){return Ri(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property)),this._values[e].transition=Ri(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const o=new a_(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,i._values[l]);return o}untransitioned(){const e=new a_(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class o_{constructor(e,i,o,l,d){const f=l.delay||0,g=l.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const l=e.now||0,d=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,i,o);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),d,ve(g))}}return d}}class a_{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const l=new qa(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xy{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ri(this._values[e].value)}setValue(e,i){this._values[e]=new iu(this._values[e].property,i===null?void 0:Ri(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const l=new qa(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}}class Bl{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,l){return this.property.evaluate(this.value,this.parameters,e,i,o,l)}}class qa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const l=rh[this.specification.type];return l?l(e,i,o):e}}class At{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,l){return new Bl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,l)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Bl(this,{kind:"constant",value:void 0},e.parameters);const l=rh[this.specification.type];return l?new Bl(this,{kind:"constant",value:l(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,l,d,f){return e.kind==="constant"?e.value:e.evaluate(i,o,l,d,f)}}class Wa{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,l){return!!e.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class Jr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new cr(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new iu(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new ha(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(i)}}}It(At,"DataDrivenProperty"),It(pt,"DataConstantProperty"),It(Wa,"ColorRampProperty");var De=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function to(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Lh(r){if(Array.isArray(r))return r.map(Lh);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Lh(r[i]);return e}return to(r)}function zh(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!zh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function zf(r,e="",i=null,o="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zh(r)||(r=Oh(r));const l=r;let d=!0;try{d=function(A){if(!Nl(A))return A;let I=Lh(A);return c_(I),I=l_(I),I}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let f=null,g=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){g=De[`filter_${o}`];const A=Ll(d,g,e,i);if(A.result==="error")throw new Error(A.value.map(I=>`${I.key}: ${I.message}`).join(", "));f=(I,P,L)=>A.value.evaluate(I,P,{},L)}let x=null,w=null;if(d!==l){const A=Ll(l,g,e,i);if(A.result==="error")throw new Error(A.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,P,L,z,B)=>A.value.evaluate(I,P,{},L,void 0,void 0,z,B),w=!Hc(A.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:u_(d),needFeature:!!w}}function l_(r){if(!Array.isArray(r))return r;const e=function(i){if(Ky.has(i[0])){for(let o=1;o<i.length;o++)if(Nl(i[o]))return!0}return i}(r);return e===!0?e:e.map(i=>l_(i))}function c_(r){let e=!1;const i=[];if(r[0]==="case"){for(let o=1;o<r.length-1;o+=2)e=e||Nl(r[o]),i.push(r[o+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Nl(r[1]);for(let o=2;o<r.length-1;o+=2)i.push(r[o+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Nl(r[1]);for(let o=1;o<r.length-1;o+=2)i.push(r[o+1])}e&&(r.length=0,r.push("any",...i));for(let o=1;o<r.length;o++)c_(r[o])}function Nl(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Nl(r[i]))return!0;return!1}const Ky=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Yy(r,e){return r<e?-1:r>e?1:0}function u_(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(u_(r[e]))return!0;return!1}function Oh(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Of(r[1],r[2],"=="):e==="!="?Fh(Of(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Of(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Oh))):e==="all"?["all"].concat(r.slice(1).map(Oh)):e==="none"?["all"].concat(r.slice(1).map(Oh).map(Fh)):e==="in"?Ff(r[1],r.slice(2)):e==="!in"?Fh(Ff(r[1],r.slice(2))):e==="has"?h_(r[1]):e!=="!has"||Fh(h_(r[1]));var i}function Of(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Ff(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Yy)]]:["filter-in-small",r,["literal",e]]}}function h_(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Fh(r){return["!",r]}const ru="";function Za(r,e){return e?`${r}${ru}${e}`:r}const Bf="-transition",da=new Set(["fill","line","background","hillshade","raster"]);class ls extends Ra{constructor(e,i,o,l,d){if(super(),this.id=e.id,this.fqid=Za(this.id,o),this.type=e.type,this.scope=o,this.lut=l,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Ll(this.filter,De[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Xy(i.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new s_(i.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qa(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&da.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Bf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,l=o._properties.properties;if(e.endsWith(Bf)){const I=e.slice(0,-11);return l[I]&&o.setTransition(I,i||void 0),!1}if(!l[e])return!1;const d=o._values[e],f=d.value.isDataDriven(),g=d.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const x=o._values[e].value,w=x.isDataDriven(),A=e.endsWith("pattern")||e==="line-dasharray";return w||f||A||this._handleOverridablePaintPropertyUpdate(e,g,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Ii({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Bl&&Eh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=zf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,l,d,f,g,x,w){}}const Jy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ki(r,e=1){let i=0,o=0;return{members:r.map(l=>{const d=Jy[l.type].BYTES_PER_ELEMENT,f=i=Nf(i,Math.max(e,d)),g=l.components||1;return o=Math.max(o,d),i+=d*g,{name:l.name,type:l.type,components:g,offset:f}}),size:Nf(i,Math.max(o,e)),alignment:e}}function Nf(r,e){return Math.ceil(r/e)*e}class Fo extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=o,e}}Fo.prototype.bytesPerElement=4,It(Fo,"StructArrayLayout2i4");class Bh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}Bh.prototype.bytesPerElement=6,It(Bh,"StructArrayLayout3i6");class Xa extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=d,e}}Xa.prototype.bytesPerElement=8,It(Xa,"StructArrayLayout4i8");class Ul extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ul.prototype.bytesPerElement=4,It(Ul,"StructArrayLayout1f4");class Nh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e,f=2*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.float32[f+1]=l,e}}Nh.prototype.bytesPerElement=8,It(Nh,"StructArrayLayout2i1f8");class Vl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}Vl.prototype.bytesPerElement=8,It(Vl,"StructArrayLayout3i8");class Uf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=l,this.int16[g+3]=d,this.int16[g+4]=f,e}}Uf.prototype.bytesPerElement=10,It(Uf,"StructArrayLayout5i10");class Vf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const w=6*e,A=12*e,I=3*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.uint8[A+4]=l,this.uint8[A+5]=d,this.uint8[A+6]=f,this.uint8[A+7]=g,this.float32[I+2]=x,e}}Vf.prototype.bytesPerElement=12,It(Vf,"StructArrayLayout2i4ub1f12");class _o extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=l,e}}_o.prototype.bytesPerElement=12,It(_o,"StructArrayLayout3f12");class Bo extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=6*e,x=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=l,this.uint16[g+3]=d,this.float32[x+2]=f,e}}Bo.prototype.bytesPerElement=12,It(Bo,"StructArrayLayout4ui1f12");class Uh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}Uh.prototype.bytesPerElement=8,It(Uh,"StructArrayLayout4ui8");class Ka extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=g,e}}Ka.prototype.bytesPerElement=12,It(Ka,"StructArrayLayout6i12");class jl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,o,l,d,f,g,x,w,A,I,P)}emplace(e,i,o,l,d,f,g,x,w,A,I,P,L){const z=12*e;return this.int16[z+0]=i,this.int16[z+1]=o,this.int16[z+2]=l,this.int16[z+3]=d,this.uint16[z+4]=f,this.uint16[z+5]=g,this.uint16[z+6]=x,this.uint16[z+7]=w,this.int16[z+8]=A,this.int16[z+9]=I,this.int16[z+10]=P,this.int16[z+11]=L,e}}jl.prototype.bytesPerElement=24,It(jl,"StructArrayLayout4i4ui4i24");class _s extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=10*e,w=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=g,e}}_s.prototype.bytesPerElement=20,It(_s,"StructArrayLayout3i3f20");class go extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=d,e}}go.prototype.bytesPerElement=16,It(go,"StructArrayLayout4f16");class jf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}jf.prototype.bytesPerElement=4,It(jf,"StructArrayLayout1ul4");class fa extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,e}}fa.prototype.bytesPerElement=4,It(fa,"StructArrayLayout2ui4");class $f extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I,P,L){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,o,l,d,f,g,x,w,A,I,P,L)}emplace(e,i,o,l,d,f,g,x,w,A,I,P,L,z){const B=20*e,H=10*e;return this.int16[B+0]=i,this.int16[B+1]=o,this.int16[B+2]=l,this.int16[B+3]=d,this.int16[B+4]=f,this.float32[H+3]=g,this.float32[H+4]=x,this.float32[H+5]=w,this.float32[H+6]=A,this.int16[B+14]=I,this.uint32[H+8]=P,this.uint16[B+18]=L,this.uint16[B+19]=z,e}}$f.prototype.bytesPerElement=40,It($f,"StructArrayLayout5i4f1i1ul2ui40");class Vh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=l,this.int16[w+4]=d,this.int16[w+5]=f,this.int16[w+6]=g,this.int16[w+7]=x,e}}Vh.prototype.bytesPerElement=16,It(Vh,"StructArrayLayout3i2i2i16");class su extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=4*e,x=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=l,this.int16[x+6]=d,this.int16[x+7]=f,e}}su.prototype.bytesPerElement=16,It(su,"StructArrayLayout2f1f2i16");class Gf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=20*e,w=5*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[w+1]=l,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=g,e}}Gf.prototype.bytesPerElement=20,It(Gf,"StructArrayLayout2ub4f20");class Mn extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=l,e}}Mn.prototype.bytesPerElement=6,It(Mn,"StructArrayLayout3ui6");class Hf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X)}emplace(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X,ee){const ne=30*e,me=15*e,xe=60*e;return this.int16[ne+0]=i,this.int16[ne+1]=o,this.int16[ne+2]=l,this.float32[me+2]=d,this.float32[me+3]=f,this.uint16[ne+8]=g,this.uint16[ne+9]=x,this.uint32[me+5]=w,this.uint32[me+6]=A,this.uint32[me+7]=I,this.uint16[ne+16]=P,this.uint16[ne+17]=L,this.uint16[ne+18]=z,this.float32[me+10]=B,this.float32[me+11]=H,this.uint8[xe+48]=Z,this.uint8[xe+49]=te,this.uint8[xe+50]=J,this.uint32[me+13]=U,this.int16[ne+28]=X,this.uint8[xe+58]=ee,e}}Hf.prototype.bytesPerElement=60,It(Hf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X,ee,ne,me,xe,Se,Pe,He,nt,et,rt,lt,je){const it=this.length;return this.resize(it+1),this.emplace(it,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X,ee,ne,me,xe,Se,Pe,He,nt,et,rt,lt,je)}emplace(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J,U,X,ee,ne,me,xe,Se,Pe,He,nt,et,rt,lt,je,it){const Ne=20*e,Ge=40*e,ut=80*e;return this.float32[Ne+0]=i,this.float32[Ne+1]=o,this.int16[Ge+4]=l,this.int16[Ge+5]=d,this.int16[Ge+6]=f,this.int16[Ge+7]=g,this.int16[Ge+8]=x,this.int16[Ge+9]=w,this.int16[Ge+10]=A,this.int16[Ge+11]=I,this.int16[Ge+12]=P,this.uint16[Ge+13]=L,this.uint16[Ge+14]=z,this.uint16[Ge+15]=B,this.uint16[Ge+16]=H,this.uint16[Ge+17]=Z,this.uint16[Ge+18]=te,this.uint16[Ge+19]=J,this.uint16[Ge+20]=U,this.uint16[Ge+21]=X,this.uint16[Ge+22]=ee,this.uint16[Ge+23]=ne,this.uint16[Ge+24]=me,this.uint16[Ge+25]=xe,this.uint16[Ge+26]=Se,this.uint16[Ge+27]=Pe,this.uint32[Ne+14]=He,this.float32[Ne+15]=nt,this.float32[Ne+16]=et,this.float32[Ne+17]=rt,this.float32[Ne+18]=lt,this.uint8[ut+76]=je,this.uint16[Ge+39]=it,e}}qf.prototype.bytesPerElement=80,It(qf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class pa extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=l,this.float32[g+3]=d,this.float32[g+4]=f,e}}pa.prototype.bytesPerElement=20,It(pa,"StructArrayLayout5f20");class ou extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const w=7*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=l,this.float32[w+3]=d,this.float32[w+4]=f,this.float32[w+5]=g,this.float32[w+6]=x,e}}ou.prototype.bytesPerElement=28,It(ou,"StructArrayLayout7f28");class Wf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,l,d,f,g,x,w,A,I)}emplace(e,i,o,l,d,f,g,x,w,A,I,P){const L=11*e;return this.float32[L+0]=i,this.float32[L+1]=o,this.float32[L+2]=l,this.float32[L+3]=d,this.float32[L+4]=f,this.float32[L+5]=g,this.float32[L+6]=x,this.float32[L+7]=w,this.float32[L+8]=A,this.float32[L+9]=I,this.float32[L+10]=P,e}}Wf.prototype.bytesPerElement=44,It(Wf,"StructArrayLayout11f44");class jh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,o,l,d,f,g,x,w)}emplace(e,i,o,l,d,f,g,x,w,A){const I=9*e;return this.float32[I+0]=i,this.float32[I+1]=o,this.float32[I+2]=l,this.float32[I+3]=d,this.float32[I+4]=f,this.float32[I+5]=g,this.float32[I+6]=x,this.float32[I+7]=w,this.float32[I+8]=A,e}}jh.prototype.bytesPerElement=36,It(jh,"StructArrayLayout9f36");class Ya extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=o,e}}Ya.prototype.bytesPerElement=8,It(Ya,"StructArrayLayout2f8");class Zf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=d,e}}Zf.prototype.bytesPerElement=12,It(Zf,"StructArrayLayout1ul3ui12");class au extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}au.prototype.bytesPerElement=2,It(au,"StructArrayLayout1ui2");class $l extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H)}emplace(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z){const te=16*e;return this.float32[te+0]=i,this.float32[te+1]=o,this.float32[te+2]=l,this.float32[te+3]=d,this.float32[te+4]=f,this.float32[te+5]=g,this.float32[te+6]=x,this.float32[te+7]=w,this.float32[te+8]=A,this.float32[te+9]=I,this.float32[te+10]=P,this.float32[te+11]=L,this.float32[te+12]=z,this.float32[te+13]=B,this.float32[te+14]=H,this.float32[te+15]=Z,e}}$l.prototype.bytesPerElement=64,It($l,"StructArrayLayout16f64");class lu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const w=10*e,A=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=o,this.uint16[w+2]=l,this.uint16[w+3]=d,this.float32[A+2]=f,this.float32[A+3]=g,this.float32[A+4]=x,e}}lu.prototype.bytesPerElement=20,It(lu,"StructArrayLayout4ui3f20");class Xf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Xf.prototype.bytesPerElement=2,It(Xf,"StructArrayLayout1i2");class $h extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}$h.prototype.bytesPerElement=1,It($h,"StructArrayLayout1ub1");class d_ extends nu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}d_.prototype.size=40;class Gh extends $f{get(e){return new d_(this,e)}}It(Gh,"CollisionBoxArray");class f_ extends nu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}f_.prototype.size=60;class p_ extends Hf{get(e){return new f_(this,e)}}It(p_,"PlacedSymbolArray");class m_ extends nu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}m_.prototype.size=80;class __ extends qf{get(e){return new m_(this,e)}}It(__,"SymbolInstanceArray");class Kf extends Ul{getoffsetX(e){return this.float32[1*e+0]}}It(Kf,"GlyphOffsetArray");class g_ extends Fo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}It(g_,"SymbolLineVertexArray");class y_ extends nu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}y_.prototype.size=12;class v_ extends Zf{get(e){return new y_(this,e)}}It(v_,"FeatureIndexArray");class x_ extends fa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}It(x_,"FillExtrusionCentroidArray");class b_ extends nu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}b_.prototype.size=6;class w_ extends Bh{get(e){return new b_(this,e)}}It(w_,"FillExtrusionWallArray");const Qy=Ki([{name:"a_pos",components:2,type:"Int16"}],4),ev=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $r{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,l){let d=this.segments[this.segments.length-1];return e>$r.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>$r.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}prepareSegment(e,i,o,l){return this._prepareSegment(e,i.length,o.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,l){return new $r([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function T_(r,e){return 256*(r=Ae(Math.floor(r),0,255))+Ae(Math.floor(e),0,255)}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It($r,"SegmentVector");const tv=Ki([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Gl=Ki([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),iv=Ki([{name:"a_dash",components:4,type:"Uint16"}]);class Hl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,l){this.ids.push(S_(e)),this.positions.push(i,o,l)}eachPosition(e,i){const o=S_(e);let l=0,d=this.ids.length-1;for(;l<d;){const f=l+d>>1;this.ids[f]>=o?d=f:l=f+1}for(;this.ids[l]===o;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Hh(o,l,0,o.length-1),i&&(i.add(o.buffer),i.add(l.buffer)),{ids:o,positions:l}}static deserialize(e){const i=new Hl;let o;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==o&&i.uniqueIds.push(l),o=l;return i.indexed=!0,i}}function S_(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:xs(String(r))}function Hh(r,e,i,o){for(;i<o;){const l=r[i+o>>1];let d=i-1,f=o+1;for(;;){do d++;while(r[d]<l);do f--;while(r[f]>l);if(d>=f)break;cu(r,d,f),cu(e,3*d,3*f),cu(e,3*d+1,3*f+1),cu(e,3*d+2,3*f+2)}f-i<o-f?(Hh(r,e,i,f),i=f+1):(Hh(r,e,f+1,o),o=f)}}function cu(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}It(Hl,"FeaturePositionMap");class yo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qh extends yo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class an extends yo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class io extends yo{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class uu extends yo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Wh extends yo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class E_ extends yo{constructor(e){super(e),this.current=Ji.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const rv=new Float32Array(16);class hu extends yo{constructor(e){super(e),this.current=rv}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const A_=new Float32Array(9),Yf=new Float32Array(4);class Gs extends yo{constructor(e){super(e),this.current=Yf}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function du(r){return[T_(255*r.r,255*r.g),T_(255*r.b,255*r.a)]}class fu{constructor(e,i,o,l){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=o,this.context=l}setUniform(e,i,o,l,d){const f=l.constantOr(this.value);i.set(e,d,f instanceof Ji?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new E_(e):new an(e)}}class ql{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,l,d){let f=null;d!=="u_pattern"&&d!=="u_dash"||(f=this.pattern),d==="u_pattern_b"&&(f=this.patternTransition),d==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Wh(e):new an(e)}}class No{constructor(e,i,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,o,l,d,f,g){const x=this.paintVertexArray.length,w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new cr(0,{brightness:f}),i,{},d,l,g):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new cr(0,{brightness:f}),i,{},d,l,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(x,e,w,A?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,g){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g},o,l,void 0,d):this.expression.kind==="constant"&&this.expression.value,w=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new cr(0,{brightness:g}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,w?null:this.context.lut)}_setPaintValue(e,i,o,l){if(this.type==="color"){const d=du(o.toRenderColor(l));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ro{constructor(e,i,o,l,d,f){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=l,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,l,d,f,g){const x=this.expression.evaluate(new cr(this.context.zoom,{brightness:f}),i,{},d,l,g),w=this.expression.evaluate(new cr(this.context.zoom+1,{brightness:f}),i,{},d,l,g),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new cr(0,{brightness:f}),i,{},d,l,g):this.lutExpression.value)==="none",I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,x,w,A?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,g){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,l,void 0,d),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,l,void 0,d),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new cr(0,{brightness:g}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,w,A?null:this.context.lut)}_setPaintValue(e,i,o,l,d){if(this.type==="color"){const f=du(o.toRenderColor(d)),g=du(o.toRenderColor(d));for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,l,d){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Ae(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,g)}getBinding(e,i){return new an(e)}}class no{constructor(e,i,o,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(o==="array"?iv:tv).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new l,this.paintTransitionVertexArray=new Bo}populatePaintArray(e,i,o,l){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,l,d,f,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,l){if(!l||!o)return;const d=l[o[0]],f=l[o[1]];if(d){if(d){const{tl:g,br:x,pixelRatio:w}=d;for(let A=e;A<i;A++)this.paintVertexArray.emplace(A,g[0],g[1],x[0],x[1],w)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:x,pixelRatio:w}=f;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,g[0],g[1],x[0],x[1],w)}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Gl.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ma{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const l=[];for(const d in e.paint._values){const f=e.paint.get(d);if(d.endsWith("-use-theme")||!o(d)||!(f instanceof Bl&&Eh(f.property.specification)))continue;const g=t(d,e.type),x=f.value,w=f.property.specification.type,A=!!f.property.useIntegerZoom,I=d==="line-dasharray"||d.endsWith("pattern"),P=e.paint.get(`${d}-use-theme`),L=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(x.kind!=="constant"||L)if(x.kind==="source"||L||I){const z=p(d,w,"source");this.binders[d]=I?new no(x,g,w,z,e.id):new No(x,g,w,z),l.push(`/a_${d}`)}else{const z=p(d,w,"composite");this.binders[d]=new ro(x,g,w,A,i,z),l.push(`/z_${d}`)}else this.binders[d]=I?new ql(x.value,g):new fu(x.value,g,w,i),l.push(`/u_${d}`);P&&(this.binders[d].lutExpression=P.value)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof No||i instanceof ro?i.maxValue:0}populatePaintArrays(e,i,o,l,d,f,g){for(const x in this.binders){const w=this.binders[x];w.context=this.context,(w instanceof No||w instanceof ro||w instanceof no)&&w.populatePaintArray(e,i,o,l,d,f,g)}}setConstantPatternPositions(e,i){for(const o in this.binders){const l=this.binders[o];l instanceof ql&&l.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof no?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,l,d,f,g,x,w){let A=!1;const I=Object.keys(e),P=I.length!==0&&!x,L=P?I:i.uniqueIds;this.context.lut=d.lut;for(const z in this.binders){const B=this.binders[z];if(B.context=this.context,(B instanceof No||B instanceof ro||B instanceof no)&&B.expression&&B.expression.kind&&B.expression.kind!=="constant"&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const H=d.paint.get(z);B.expression=H.value;for(const Z of L){const te=e[Z.toString()];i.eachPosition(Z,(J,U,X)=>{const ee=l.feature(J);B.updatePaintArray(U,X,ee,te,f,g,w)})}if(!P)for(const Z of o.uniqueIds){const te=e[Z.toString()];o.eachPosition(Z,(J,U,X)=>{const ee=l.feature(J);B.updatePaintArray(U,X,ee,te,f,g,w)})}A=!0}}return A}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof fu||o instanceof ql)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof No||o instanceof ro||o instanceof no)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name);if(o instanceof no)for(let l=0;l<Gl.members.length;l++)e.push(Gl.members[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof fu||o instanceof ql||o instanceof ro)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof fu||l instanceof ql||l instanceof ro)for(const d of l.uniformNames)i.push({name:d,property:o,binding:l.getBinding(e,d)})}return i}setUniforms(e,i,o,l,d){for(const{name:f,property:g,binding:x}of o)this.binders[g].setUniform(e,x,d,l.get(g),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof No||i instanceof ro||i instanceof no)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof no&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof No||o instanceof ro||o instanceof no)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof No||i instanceof ro||i instanceof no)&&i.destroy()}}}class Ja{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new ma(l,i,o);this.needsUpload=!1,this._featureMap=new Hl,this._featureMapWithoutIds=new Hl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,l,d,f,g,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,l,d,f,g,x);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,l,d,f,g){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,l,d,f,g||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const u={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function t(r,e){return u[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const s={"line-pattern":{source:Bo,composite:Bo},"fill-pattern":{source:Bo,composite:Bo},"fill-extrusion-pattern":{source:Bo,composite:Bo},"line-dasharray":{source:Uh,composite:Uh}},h={color:{source:Ya,composite:go},number:{source:Ul,composite:Ya}};function p(r,e,i){const o=s[r];return o&&o[i]||h[e][i]}It(fu,"ConstantBinder"),It(ql,"PatternConstantBinder"),It(No,"SourceExpressionBinder"),It(no,"PatternCompositeBinder"),It(ro,"CompositeExpressionBinder"),It(ma,"ProgramConfiguration",{omit:["_buffers"]}),It(Ja,"ProgramConfigurationSet");const _=vt/Math.PI/2,v=5,b=6,E=16383,C=64,R=[C,32,16],k=-_,D=_;function O(r,e,i,o=_){return i=G(i),[r*Math.sin(i)*o,-e*o,r*Math.cos(i)*o]}function j(r,e,i){return O(Math.cos(G(r)),Math.sin(G(r)),e,i)}const V=63710088e-1,q=2*Math.PI*V;class ${constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,l=e.lat*i,d=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return V*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Q({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return j(this.lat,this.lng,_+e*_/V)}static convert(e){if(e instanceof $)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new $(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new $(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Q{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof $?new $(e.lng,e.lat):$.convert(e),this}setSouthWest(e){return this._sw=e instanceof $?new $(e.lng,e.lat):$.convert(e),this}extend(e){const i=this._sw,o=this._ne;let l,d;if(e instanceof $)l=e,d=e;else{if(!(e instanceof Q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Q.convert(e)):this.extend($.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend($.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return i||o?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new $(l.lng,l.lat),this._ne=new $(d.lng,d.lat)),this}getCenter(){return new $((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $(this.getWest(),this.getNorth())}getSouthEast(){return new $(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=$.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){if(e)return e instanceof Q?e:new Q(e)}}const re=0,oe=25.5;function fe(r){return q*Math.cos(r*Math.PI/180)}function ue(r){return(180+r)/360}function he(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ae(r,e){return r/fe(e)}function _e(r){return 360*r-180}function ge(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Oe(r,e){return r*fe(ge(e))}const Re=85.051129;function Je(r){return Math.cos(G(Ae(r,-85.051129,Re)))}function Xe(r,e){const i=Ae(e,re,oe),o=Math.pow(2,i);return Je(r)*q/(512*o)}function ft(r){return 1/Math.cos(r*Math.PI/180)}function Me(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/vt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/vt/(1<<r.z)}class Fe{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=$.convert(e);return new Fe(ue(o.lng),he(o.lat),ae(i,o.lat))}toLngLat(){return new $(_e(this.x),ge(this.y))}toAltitude(){return Oe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/q*ft(ge(this.y))}}function Ce(r,e,i,o,l,d,f,g,x){const w=(e+o)/2,A=(i+l)/2,I=new gt(w,A);g(I),function(P,L,z,B,H,Z){const te=z-H,J=B-Z;return Math.abs((B-L)*te-(z-P)*J)/Math.hypot(te,J)}(I.x,I.y,d.x,d.y,f.x,f.y)>=x?(Ce(r,e,i,w,A,d,I,g,x),Ce(r,w,A,o,l,I,f,g,x)):r.push(f)}function tt(r,e,i){let o=r[0],l=o.x,d=o.y;e(o);const f=[o];for(let g=1;g<r.length;g++){const x=r[g],{x:w,y:A}=x;e(x),Ce(f,l,d,w,A,o,x,e,i),l=w,d=A,o=x}return f}function Ve(r,e,i,o){if(o(e,i)){const l=e.add(i)._mult(.5);Ve(r,e,l,o),Ve(r,l,i,o)}else r.push(i)}function st(r,e){let i=r[0];const o=[i];for(let l=1;l<r.length;l++){const d=r[l];Ve(o,i,d,e),i=d}return o}const Qe=Math.pow(2,14)-1,ot=-Qe-1;function at(r,e){const i=Math.round(r.x*e),o=Math.round(r.y*e);return r.x=Ae(i,ot,Qe),r.y=Ae(o,ot,Qe),(i<r.x||i>r.x+1||o<r.y||o>r.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Rt(r,e,i){const o=r.loadGeometry(),l=r.extent,d=vt/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x,y:w,projection:A}=i,I=P=>{const L=_e((e.x+P.x/l)/f),z=ge((e.y+P.y/l)/f),B=A.project(L,z);P.x=(B.x*g-x)*l,P.y=(B.y*g-w)*l};for(let P=0;P<o.length;P++)if(r.type!==1)o[P]=tt(o[P],I,1);else{const L=[];for(const z of o[P])z.x<0||z.x>=l||z.y<0||z.y>=l||(I(z),L.push(z));o[P]=L}}for(const f of o)for(const g of f)at(g,d);return o}function Ut(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Rt(r):[]}}function Ct(r,e,i,o,l){r.emplaceBack(2*e+(o+1)/2,2*i+(l+1)/2)}function Vt(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Lt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fo,this.indexArray=new Mn,this.segments=new $r,this.programConfigurations=new Ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,l){const d=this.layers[0],f=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:w,id:A,index:I,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,z=Ut(w,L);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),z,o))continue;const B=g?g.evaluate(z,{},o):void 0,H={id:A,properties:w.properties,type:w.type,sourceLayerIndex:P,index:I,geometry:L?z.geometry:Rt(w,o,l),patterns:{},sortKey:B};f.push(H)}g&&f.sort((w,A)=>w.sortKey-A.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Ka,x=l.projection);for(const w of f){const{geometry:A,index:I,sourceLayerIndex:P}=w,L=e[I].feature;this.addFeature(w,A,I,i.availableImages,o,x,i.brightness),i.featureIndex.insert(L,A,I,P,this.index)}}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ev.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,l,d,f,g){for(const x of i)for(const w of x){const A=w.x,I=w.y;if(A<0||A>=vt||I<0||I>=vt)continue;if(f){const z=f.projectTilePoint(A,I,d),B=f.upVector(d,A,I),H=this.globeExtVertexArray;Vt(H,z,B),Vt(H,z,B),Vt(H,z,B),Vt(H,z,B)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=P.vertexLength;Ct(this.layoutVertexArray,A,I,-1,-1),Ct(this.layoutVertexArray,A,I,1,-1),Ct(this.layoutVertexArray,A,I,1,1),Ct(this.layoutVertexArray,A,I,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,d,g)}}function ei(r,e){for(let i=0;i<r.length;i++)if(hr(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(hr(r,e[i]))return!0;return!!sr(r,e)}function ui(r,e,i){return!!hr(r,e)||!!gi(e,r,i)}function Di(r,e){if(r.length===1)return Zi(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let l=0;l<o.length;l++)if(hr(r,o[l]))return!0}for(let i=0;i<r.length;i++)if(Zi(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(sr(r,e[i]))return!0;return!1}function ur(r,e,i){if(r.length>1){if(sr(r,e))return!0;for(let o=0;o<e.length;o++)if(gi(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(gi(r[o],e,i))return!0;return!1}function sr(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],l=r[i+1];for(let d=0;d<e.length-1;d++)if(Li(o,l,e[d],e[d+1]))return!0}return!1}function Li(r,e,i,o){return vr(r,i,o)!==vr(e,i,o)&&vr(r,e,i)!==vr(r,e,o)}function Xr(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Ur(r,e,i,o){const l=Xr(r,e,o),d=Xr(r,e,i);if(Math.sign(l)===Math.sign(d))return;const f=Xr(i,o,r),g=f+d-l;return Math.sign(f)!==Math.sign(g)?[f/(f-g),d/(d-l)]:void 0}function gi(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(Vi(r,e[l-1],e[l])<o)return!0;return!1}function Vi(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const l=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function Zi(r,e){let i,o,l,d=!1;for(let f=0;f<r.length;f++){i=r[f];for(let g=0,x=i.length-1;g<i.length;x=g++)o=i[g],l=i[x],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(d=!d)}return d}function hr(r,e){let i=!1;for(let o=0,l=r.length-1;o<r.length;l=o++){const d=r[o],f=r[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function un(r,e,i,o,l){for(const f of r)if(e<=f.x&&i<=f.y&&o>=f.x&&l>=f.y)return!0;const d=[new gt(e,i),new gt(e,l),new gt(o,l),new gt(o,i)];if(r.length>2){for(const f of d)if(hr(r,f))return!0}for(let f=0;f<r.length-1;f++)if(Qr(r[f],r[f+1],d))return!0;return!1}function Qr(r,e,i){const o=i[0],l=i[2];if(r.x<o.x&&e.x<o.x||r.x>l.x&&e.x>l.x||r.y<o.y&&e.y<o.y||r.y>l.y&&e.y>l.y)return!1;const d=vr(r,e,i[0]);return d!==vr(r,e,i[1])||d!==vr(r,e,i[2])||d!==vr(r,e,i[3])}function ln(r,e,i,o,l,d){let f=e.y-r.y,g=r.x-e.x;if(d=d||0){const x=f*f+g*g;if(x===0)return!0;const w=Math.sqrt(x);f/=w,g/=w}return!((i.x-r.x)*f+(i.y-r.y)*g-d<0||(o.x-r.x)*f+(o.y-r.y)*g-d<0||(l.x-r.x)*f+(l.y-r.y)*g-d<0)}function Br(r,e,i,o,l,d,f){return!(ln(r,e,o,l,d,f)||ln(e,i,o,l,d,f)||ln(i,r,o,l,d,f)||ln(o,l,r,e,i,f)||ln(l,d,r,e,i,f)||ln(d,o,r,e,i,f))}function wi(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function kr(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Hi(r,e,i,o,l){if(!e[0]&&!e[1])return r;const d=gt.convert(e)._mult(l);i==="viewport"&&d._rotate(-o);const f=[];for(let g=0;g<r.length;g++)f.push(r[g].sub(d));return f}function Lr(r,e,i,o){const l=gt.convert(r)._mult(o);return e==="viewport"&&l._rotate(-i),l}let Qi,Nr;function Rn(r,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}It(Lt,"CircleBucket",{omit:["layers"]});class Ar{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Nn(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(d,f,g){var x=Rn(256*d,256*(f=Math.pow(2,g)-f-1),g),w=Rn(256*(d+1),256*(f+1),g);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),l=function(d,f,g){let x,w="";for(let A=d;A>0;A--)x=1<<A-1,w+=(f&x?1:0)+(g&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zn{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Nn(e,i.z,i.z,i.x,i.y)}}class on{constructor(e,i,o,l,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Ar(o,+l,+d),this.key=i===0&&e===o?this.canonical.key:Nn(i,e,o,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new on(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new on(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Nn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Nn(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new on(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new on(i,this.wrap,i,o,l),new on(i,this.wrap,i,o+1,l),new on(i,this.wrap,i,o,l+1),new on(i,this.wrap,i,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new on(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new on(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Nn(r,e,i,o,l){const d=1<<Math.min(i,22);let f=d*(l%d)+o%d;return r&&i<22&&(f+=d*d*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const so=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new on(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new on(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new on(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new on(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];It(Ar,"CanonicalTileID"),It(on,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Uo=Ki([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ts}=Uo,Hs=Ki([{name:"a_pos_3",components:3,type:"Int16"}]);var vo=Ki([{name:"a_pos",type:"Int16",components:2}]);class xo{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=Mr(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,!0}}class oo{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=tr(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,o){if(function(L,z){var B=L[0],H=L[1],Z=L[2],te=z[0],J=z[1],U=z[2];return Math.abs(B-te)<=F*Math.max(1,Math.abs(B),Math.abs(te))&&Math.abs(H-J)<=F*Math.max(1,Math.abs(H),Math.abs(J))&&Math.abs(Z-U)<=F*Math.max(1,Math.abs(Z),Math.abs(U))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[l,d,f]=this.dir,g=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],A=l*l+d*d+f*f,I=2*(g*l+x*d+w*f),P=I*I-4*A*(g*g+x*x+w*w-i*i);if(P<0){const L=Math.max(-I/2,0),z=g+l*L,B=x+d*L,H=w+f*L,Z=Math.hypot(z,B,H);return o[0]=z*i/Z,o[1]=B*i/Z,o[2]=H*i/Z,!1}{const L=(-I-Math.sqrt(P))/(2*A);if(L<0){const z=Math.hypot(g,x,w);return o[0]=g*i/z,o[1]=x*i/z,o[2]=w*i/z,!1}return o[0]=g+l*L,o[1]=x+d*L,o[2]=w+f*L,!0}}}class Wl{constructor(e,i,o,l,d){this.TL=e,this.TR=i,this.BR=o,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,i,o){const l=[-1,1,1],d=[1,1,1],f=[1,-1,1],g=[-1,-1,1],x=$t(l,l,e),w=$t(d,d,e),A=$t(f,f,e),I=$t(g,g,e);return new Wl(x,w,A,I,i/o)}}function Qa(r,e,i){let o=1/0,l=-1/0;const d=[];for(const f of r){we(d,f,e);const g=tr(d,i);o=Math.min(o,g),l=Math.max(l,g)}return[o,l]}function Zh(r,e){let i=!0;for(let o=0;o<r.planes.length;o++){const l=r.planes[o];let d=0;for(let f=0;f<e.length;f++)d+=tr(l,e[f])+l[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Xh(r,e){for(const i of r.projections){const o=Qa(e,r.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Kh(r,e){let i=0;const o=[0,0,0,0];for(let f=0;f<r.length;f++)o[0]=r[f][0],o[1]=r[f][1],o[2]=r[f][2],o[3]=1,(l=o)[0]*(d=e)[0]+l[1]*d[1]+l[2]*d[2]+l[3]*d[3]>=0&&i++;var l,d;return i}class pu{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=zr.fromPoints(this.points),this.projections=[],this.frustumEdges=[we([],this.points[2],this.points[3]),we([],this.points[0],this.points[3]),we([],this.points[4],this.points[0]),we([],this.points[5],this.points[1]),we([],this.points[6],this.points[2]),we([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const l=[0,-o[2],o[1]],d=[o[2],0,-o[0]];this.projections.push({axis:l,projection:Qa(this.points,this.points[0],l)}),this.projections.push({axis:d,projection:Qa(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,o,l){const d=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const A=Jt([],w,e),I=1/A[3]/i*d;return(P=A)[0]=(L=A)[0]*(z=[I,I,l?1/A[3]:I,I])[0],P[1]=L[1]*z[1],P[2]=L[2]*z[2],P[3]=L[3]*z[3],P;var P,L,z}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const A=gr([],_t([],we([],f[w[0]],f[w[1]]),we([],f[w[2]],f[w[1]]))),I=-tr(A,f[w[1]]);return A.concat(I)}),x=[];for(let w=0;w<f.length;w++)x.push([f[w][0],f[w][1],f[w][2]]);return new pu(x,g)}intersectsPrecise(e,i,o){for(let l=0;l<i.length;l++)if(!Kh(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Kh(e,this.planes[l]))return 0;for(const l of o)for(const d of this.frustumEdges){const f=_t([],l,d),g=di(f);if(g===0)continue;Yi(f,f,1/g);const x=Qa(this.points,this.points[0],f),w=Qa(e,this.points[0],f);if(x[0]>w[1]||w[0]>x[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(tr([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class zr{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const l of e)mi(i,i,l),Yr(o,o,l);return new zr(i,o)}static fromTileIdAndHeight(e,i,o){const l=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new zr([d/l,f/l,i],[(d+1)/l,(f+1)/l,o])}static applyTransform(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)$t(o[l],o[l],i);return zr.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],l=[...o];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const g=i[4*f+d],x=g*e.min[f],w=g*e.max[f];o[d]+=Math.min(x,w),l[d]+=Math.max(x,w)}return new zr(o,l)}static projectAabbCorners(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)$t(o[l],o[l],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Yi([],Ni([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=qt(this.min),l=qt(this.max);for(let d=0;d<i.length;d++)o[d]=i[d]?this.min[d]:this.center[d],l[d]=i[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new zr(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Zh(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Zh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Xh(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Xh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Zl(r){return r*_/V}It(zr,"Aabb");const Jf=[new zr([k,k,k],[D,D,D]),new zr([k,k,k],[0,0,D]),new zr([0,k,k],[D,0,D]),new zr([k,0,k],[0,D,D]),new zr([0,0,k],[D,D,D])];function gb(r,e,i,o=!0){const l=Yi([],r._camera.position,r.worldSize),d=[e,i,1,1];Jt(d,d,r.pixelMatrixInverse),Tt(d,d,1/d[3]);const f=gr([],we([],d,l)),g=r.globeMatrix,x=[g[12],g[13],g[14]],w=we([],x,l),A=di(w),I=gr([],w),P=r.worldSize/(2*Math.PI),L=tr(I,f),z=Math.asin(P/A);if(z<Math.acos(L)){if(!o)return null;const Se=[],Pe=[];Yi(Se,f,A/L),gr(Pe,we(Pe,Se,w)),gr(f,Ni(f,w,Yi(f,Pe,Math.tan(z)*A)))}const B=[];new oo(l,f).closestPointOnSphere(x,P,B);const H=gr([],Pn(g,0)),Z=gr([],Pn(g,1)),te=gr([],Pn(g,2)),J=tr(H,B),U=tr(Z,B),X=tr(te,B),ee=K(Math.asin(-U/P));let ne=K(Math.atan2(J,X));ne=r.center.lng+function(Se,Pe){const He=(Pe-Se+180)%360-180;return He<-180?He+360:He}(r.center.lng,ne);const me=ue(ne),xe=Ae(he(ee),0,1);return new Fe(me,xe)}class qI{constructor(e,i,o){this.a=we([],e,o),this.b=we([],i,o),this.center=o;const l=gr([],this.a),d=gr([],this.b);this.angle=Math.acos(tr(l,d))}}function nv(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(o,l,d,f){const g=Math.sin(d);return o*(Math.sin((1-f)*d)/g)+l*(Math.sin(f*d)/g)}(r.a[e],r.b[e],r.angle,Ae(i,0,1))+r.center[e]}function _a(r){if(r.z<=1)return Jf[r.z+2*r.y+r.x];const e=sv(I_(r));return zr.fromPoints(e)}function el(r,e,i){return Yi(r,r,1-i),vn(r,r,e,i)}function yb(r,e,i){for(const o of r)$t(o,o,e),Yi(o,o,i)}function vb(r,e,i,o){const l=e/r.worldSize,d=r.globeMatrix;if(i.z<=1){const xe=_a(i).getCorners();return yb(xe,d,l),zr.fromPoints(xe)}const f=I_(i,o),g=sv(f,_+Zl(r._tileCoverLift));yb(g,d,l);const x=Number.MAX_VALUE,w=[-x,-x,-x],A=[x,x,x];if(f.contains(r.center)){for(const Pe of g)mi(A,A,Pe),Yr(w,w,Pe);w[2]=0;const xe=r.point,Se=[xe.x*l,xe.y*l,0];return mi(A,A,Se),Yr(w,w,Se),new zr(A,w)}if(r._tileCoverLift>0){for(const xe of g)mi(A,A,xe),Yr(w,w,xe);return new zr(A,w)}const I=[d[12]*l,d[13]*l,d[14]*l],P=f.getCenter(),L=Ae(r.center.lat,-85.051129,Re),z=Ae(P.lat,-85.051129,Re),B=ue(r.center.lng),H=he(L);let Z=B-ue(P.lng);const te=H-he(z);Z>.5?Z-=1:Z<-.5&&(Z+=1);let J=0;Math.abs(Z)>Math.abs(te)?J=Z>=0?1:3:(J=te>=0?0:2,vn(I,I,[d[4]*l,d[5]*l,d[6]*l],-Math.sin(G(te>=0?f.getSouth():f.getNorth()))*_));const U=g[J],X=g[(J+1)%4],ee=new qI(U,X,I),ne=[nv(ee,0)||U[0],nv(ee,1)||U[1],nv(ee,2)||U[2]],me=Xl(r.zoom);if(me>0){const xe=function({x:Pe,y:He,z:nt},et,rt,lt,je){const it=1/(1<<nt);let Ne=Pe*it,Ge=Ne+it,ut=He*it,dt=ut+it,Nt=0;const Mt=(Ne+Ge)/2-lt;return Mt>.5?Nt=-1:Mt<-.5&&(Nt=1),Ne=((Ne+Nt)*et-(lt*=et))*rt+lt,Ge=((Ge+Nt)*et-lt)*rt+lt,ut=(ut*et-(je*=et))*rt+je,dt=(dt*et-je)*rt+je,[[Ne,dt,0],[Ge,dt,0],[Ge,ut,0],[Ne,ut,0]]}(i,e,r._pixelsPerMercatorPixel,B,H);for(let Pe=0;Pe<g.length;Pe++)el(g[Pe],xe[Pe],me);const Se=Ni([],xe[J],xe[(J+1)%4]);Yi(Se,Se,.5),el(ne,Se,me)}for(const xe of g)mi(A,A,xe),Yr(w,w,xe);return A[2]=Math.min(U[2],X[2]),mi(A,A,ne),Yr(w,w,ne),new zr(A,w)}function I_({x:r,y:e,z:i},o=!1){const l=1/(1<<i),d=new $(_e(r*l),e===(1<<i)-1&&o?-90:ge((e+1)*l)),f=new $(_e((r+1)*l),e===0&&o?90:ge(e*l));return new Q(d,f)}function sv(r,e=_){const i=G(r.getNorth()),o=G(r.getSouth()),l=Math.cos(i),d=Math.cos(o),f=Math.sin(i),g=Math.sin(o),x=r.getWest(),w=r.getEast();return[O(d,g,x,e),O(d,g,w,e),O(l,f,w,e),O(l,f,x,e)]}function Qf(r,e,i,o){const l=1<<i.z,d=(r/vt+i.x)/l;return j(ge((e/vt+i.y)/l),_e(d),o)}function C_({min:r,max:e}){return E/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const xb=new Float64Array(16);function P_(r){const e=C_(r),i=kt(xb,[e,e,e]);return ze(i,i,ys([],r.min))}function ov(r){const e=(o=r.min,(i=xb)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const l=1/C_(r);return be(e,e,[l,l,l])}function av(r){const e=vt/(2*Math.PI);return r/(2*Math.PI)/e}function bb(r,e){return vt/(512*Math.pow(2,r))*C_(_a(e))}function wb(r,e,i,o,l){const d=av(i),f=[r,e,-i/(2*Math.PI)],g=pe(new Float64Array(16));return ze(g,g,f),be(g,g,[d,d,d]),ke(g,g,G(-l)),Ke(g,g,G(-o)),g}function Xl(r){return Ie(v,b,r)}function Tb(r,e){const i=j(e.lat,e.lng),o=function(z){const B=j(z._center.lat,z._center.lng);let H=_t([],vi(0,1,0),B);const Z=hi([],-z.angle,B);H=$t(H,H,Z),hi(Z,-z._pitch,H);const te=gr([],B);return Yi(te,te,Zl(z.cameraToCenterDistance/z.pixelsPerMeter)),$t(te,te,Z),Ni([],B,te)}(r);return f=(l=si([],o,i))[0],g=l[1],x=l[2],w=(d=i)[0],A=d[1],I=d[2],L=(P=Math.sqrt(f*f+g*g+x*x)*Math.sqrt(w*w+A*A+I*I))&&tr(l,d)/P,Math.acos(Math.min(Math.max(L,-1),1));var l,d,f,g,x,w,A,I,P,L}function lv(r,e){return Tb(r,e)>Math.PI/2*1.01}const Sb=G(85),WI=Math.cos(Sb),ZI=Math.sin(Sb),XI=Te(),Eb=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ab(r,e,i,o,l,d,f,g,x){if(d&&r.queryGeometry.isAboveHorizon)return!1;d&&(x*=r.pixelToTileUnitsFactor);const w=r.tileID.canonical,A=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const I of e)for(const P of I){const L=P.add(g),z=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,B=i.projection.projectTilePoint(L.x,L.y,w);if(z>0){const J=i.projection.upVector(w,L.x,L.y);B.x+=J[0]*A*z,B.y+=J[1]*A*z,B.z+=J[2]*A*z}const H=d?L:KI(B.x,B.y,B.z,o),Z=d?r.tilespaceRays.map(J=>JI(J,z)):r.queryGeometry.screenGeometry,te=Jt([],[B.x,B.y,B.z,1],o);if(!f&&d?x*=te[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/te[3]),d){const J=ge((P.y/vt+w.y)/(1<<w.z));x/=i.projection.pixelsPerMeter(J,1)/ae(1,J)}if(ui(Z,H,x))return!0}return!1}function KI(r,e,i,o){const l=Jt([],[r,e,i,1],o);return new gt(l[0]/l[3],l[1]/l[3])}const Ib=vi(0,0,0),YI=vi(0,0,1);function JI(r,e){const i=ni();return Ib[2]=e,r.intersectsPlane(Ib,YI,i),new gt(i[0],i[1])}class Cb extends Lt{}let Pb,Mb,Rb,Db;function kb(r,{width:e,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=l,r}function Lb(r,e,i){const{width:o,height:l}=e;o===r.width&&l===r.height||(cv(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,o),height:Math.min(r.height,l)},i,null),r.width=o,r.height=l,r.data=e.data)}function cv(r,e,i,o,l,d,f,g){if(l.width===0||l.height===0)return e;if(l.width>r.width||l.height>r.height||i.x>r.width-l.width||i.y>r.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const x=r.data,w=e.data,A=d===4&&g;for(let I=0;I<l.height;I++){const P=((i.y+I)*r.width+i.x)*d,L=((o.y+I)*e.width+o.x)*d;if(A)for(let z=0;z<l.width;z++){const B=P+z*d+3,H=L+z*d;w[H+0]=255,w[H+1]=255,w[H+2]=255,w[H+3]=x[B]}else if(f)for(let z=0;z<l.width;z++){const B=P+z*d,H=L+z*d,Z=x[B+3],te=new Ji(x[B+0]/255*Z,x[B+1]/255*Z,x[B+2]/255*Z,Z).toRenderColor(f).toArray();w[H+0]=te[0],w[H+1]=te[1],w[H+2]=te[2],w[H+3]=te[3]}else for(let z=0;z<l.width*d;z++)w[L+z]=x[P+z]}return e}It(Cb,"HeatmapBucket",{omit:["layers"]});class Kl{constructor(e,i){kb(this,e,1,i)}resize(e){Lb(this,new Kl(e),1)}clone(){return new Kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d){cv(e,i,o,l,d,1,null)}}class jn{constructor(e,i){kb(this,e,4,i)}resize(e){Lb(this,new jn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new jn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d,f,g){cv(e,i,o,l,d,4,f,g)}}class zb{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function ep(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,l=r.image||new jn({width:i,height:o}),d=(f,g,x)=>{e[r.evaluationKey]=x;const w=r.expression.evaluate(e);w&&(l.data[f+g+0]=Math.floor(255*w.r/w.a),l.data[f+g+1]=Math.floor(255*w.g/w.a),l.data[f+g+2]=Math.floor(255*w.b/w.a),l.data[f+g+3]=Math.floor(255*w.a))};if(r.clips)for(let f=0,g=0;f<o;++f,g+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const A=x/(i-1),{start:I,end:P}=r.clips[f];d(g,w,I*(1-A)+P*A)}else for(let f=0,g=0;f<i;f++,g+=4)d(0,g,f/(i-1));return l}It(Kl,"AlphaImage"),It(jn,"RGBAImage");const QI=Ki([{name:"a_pos",components:2,type:"Int16"}],4),eC=Ki([{name:"a_road_z_offset",components:1,type:"Float32"}],4),tC=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),iC=Ki([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function tp(r,e,i=2){const o=e&&e.length,l=o?e[0]*i:r.length;let d=Ob(r,0,l,i,!0);const f=[];if(!d||d.next===d.prev)return f;let g,x,w;if(o&&(d=function(A,I,P,L){const z=[];for(let B=0,H=I.length;B<H;B++){const Z=Ob(A,I[B]*L,B<H-1?I[B+1]*L:A.length,L,!1);Z===Z.next&&(Z.steiner=!0),z.push(uC(Z))}z.sort(aC);for(let B=0;B<z.length;B++)P=lC(z[B],P);return P}(r,e,d,i)),r.length>80*i){g=1/0,x=1/0;let A=-1/0,I=-1/0;for(let P=i;P<l;P+=i){const L=r[P],z=r[P+1];L<g&&(g=L),z<x&&(x=z),L>A&&(A=L),z>I&&(I=z)}w=Math.max(A-g,I-x),w=w!==0?32767/w:0}return ip(d,f,i,g,x,w,0),f}function Ob(r,e,i,o,l){let d;if(l===function(f,g,x,w){let A=0;for(let I=g,P=x-w;I<x;I+=w)A+=(f[P]-f[I])*(f[I+1]+f[P+1]),P=I;return A}(r,e,i,o)>0)for(let f=e;f<i;f+=o)d=Ub(f/o|0,r[f],r[f+1],d);else for(let f=i-o;f>=e;f-=o)d=Ub(f/o|0,r[f],r[f+1],d);return d&&Yh(d,d.next)&&(sp(d),d=d.next),d}function mu(r,e){if(!r)return r;e||(e=r);let i,o=r;do if(i=!1,o.steiner||!Yh(o,o.next)&&Dn(o.prev,o,o.next)!==0)o=o.next;else{if(sp(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function ip(r,e,i,o,l,d,f){if(!r)return;!f&&d&&function(x,w,A,I){let P=x;do P.z===0&&(P.z=uv(P.x,P.y,w,A,I)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==x);P.prevZ.nextZ=null,P.prevZ=null,function(L){let z,B=1;do{let H,Z=L;L=null;let te=null;for(z=0;Z;){z++;let J=Z,U=0;for(let ee=0;ee<B&&(U++,J=J.nextZ,J);ee++);let X=B;for(;U>0||X>0&&J;)U!==0&&(X===0||!J||Z.z<=J.z)?(H=Z,Z=Z.nextZ,U--):(H=J,J=J.nextZ,X--),te?te.nextZ=H:L=H,H.prevZ=te,te=H;Z=J}te.nextZ=null,B*=2}while(z>1)}(P)}(r,o,l,d);let g=r;for(;r.prev!==r.next;){const x=r.prev,w=r.next;if(d?nC(r,o,l,d):rC(r))e.push(x.i,r.i,w.i),sp(r),r=w.next,g=w.next;else if((r=w)===g){f?f===1?ip(r=sC(mu(r),e),e,i,o,l,d,2):f===2&&oC(r,e,i,o,l,d):ip(mu(r),e,i,o,l,d,1);break}}}function rC(r){const e=r.prev,i=r,o=r.next;if(Dn(e,i,o)>=0)return!1;const l=e.x,d=i.x,f=o.x,g=e.y,x=i.y,w=o.y,A=Math.min(l,d,f),I=Math.min(g,x,w),P=Math.max(l,d,f),L=Math.max(g,x,w);let z=o.next;for(;z!==e;){if(z.x>=A&&z.x<=P&&z.y>=I&&z.y<=L&&rp(l,g,d,x,f,w,z.x,z.y)&&Dn(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function nC(r,e,i,o){const l=r.prev,d=r,f=r.next;if(Dn(l,d,f)>=0)return!1;const g=l.x,x=d.x,w=f.x,A=l.y,I=d.y,P=f.y,L=Math.min(g,x,w),z=Math.min(A,I,P),B=Math.max(g,x,w),H=Math.max(A,I,P),Z=uv(L,z,e,i,o),te=uv(B,H,e,i,o);let J=r.prevZ,U=r.nextZ;for(;J&&J.z>=Z&&U&&U.z<=te;){if(J.x>=L&&J.x<=B&&J.y>=z&&J.y<=H&&J!==l&&J!==f&&rp(g,A,x,I,w,P,J.x,J.y)&&Dn(J.prev,J,J.next)>=0||(J=J.prevZ,U.x>=L&&U.x<=B&&U.y>=z&&U.y<=H&&U!==l&&U!==f&&rp(g,A,x,I,w,P,U.x,U.y)&&Dn(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;J&&J.z>=Z;){if(J.x>=L&&J.x<=B&&J.y>=z&&J.y<=H&&J!==l&&J!==f&&rp(g,A,x,I,w,P,J.x,J.y)&&Dn(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;U&&U.z<=te;){if(U.x>=L&&U.x<=B&&U.y>=z&&U.y<=H&&U!==l&&U!==f&&rp(g,A,x,I,w,P,U.x,U.y)&&Dn(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function sC(r,e){let i=r;do{const o=i.prev,l=i.next.next;!Yh(o,l)&&Bb(o,i,i.next,l)&&np(o,l)&&np(l,o)&&(e.push(o.i,i.i,l.i),sp(i),sp(i.next),i=r=l),i=i.next}while(i!==r);return mu(i)}function oC(r,e,i,o,l,d){let f=r;do{let g=f.next.next;for(;g!==f.prev;){if(f.i!==g.i&&hC(f,g)){let x=Nb(f,g);return f=mu(f,f.next),x=mu(x,x.next),ip(f,e,i,o,l,d,0),void ip(x,e,i,o,l,d,0)}g=g.next}f=f.next}while(f!==r)}function aC(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function lC(r,e){const i=function(l,d){let f=d;const g=l.x,x=l.y;let w,A=-1/0;if(Yh(l,f))return f;do{if(Yh(l,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const B=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(B<=g&&B>A&&(A=B,w=f.x<f.next.x?f:f.next,B===g))return w}f=f.next}while(f!==d);if(!w)return null;const I=w,P=w.x,L=w.y;let z=1/0;f=w;do{if(g>=f.x&&f.x>=P&&g!==f.x&&Fb(x<L?g:A,x,P,L,x<L?A:g,x,f.x,f.y)){const B=Math.abs(x-f.y)/(g-f.x);np(f,l)&&(B<z||B===z&&(f.x>w.x||f.x===w.x&&cC(w,f)))&&(w=f,z=B)}f=f.next}while(f!==I);return w}(r,e);if(!i)return e;const o=Nb(i,r);return mu(o,o.next),mu(i,i.next)}function cC(r,e){return Dn(r.prev,r,e.prev)<0&&Dn(e.next,r,r.next)<0}function uv(r,e,i,o,l){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*l|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function uC(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Fb(r,e,i,o,l,d,f,g){return(l-f)*(e-g)>=(r-f)*(d-g)&&(r-f)*(o-g)>=(i-f)*(e-g)&&(i-f)*(d-g)>=(l-f)*(o-g)}function rp(r,e,i,o,l,d,f,g){return!(r===f&&e===g)&&Fb(r,e,i,o,l,d,f,g)}function hC(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&Bb(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1}(r,e)&&(np(r,e)&&np(e,r)&&function(i,o){let l=i,d=!1;const f=(i.x+o.x)/2,g=(i.y+o.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&f<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d}(r,e)&&(Dn(r.prev,r,e.prev)||Dn(r,e.prev,e))||Yh(r,e)&&Dn(r.prev,r,r.next)>0&&Dn(e.prev,e,e.next)>0)}function Dn(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Yh(r,e){return r.x===e.x&&r.y===e.y}function Bb(r,e,i,o){const l=R_(Dn(r,e,i)),d=R_(Dn(r,e,o)),f=R_(Dn(i,o,r)),g=R_(Dn(i,o,e));return l!==d&&f!==g||!(l!==0||!M_(r,i,e))||!(d!==0||!M_(r,o,e))||!(f!==0||!M_(i,r,o))||!(g!==0||!M_(i,e,o))}function M_(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function R_(r){return r>0?1:r<0?-1:0}function np(r,e){return Dn(r.prev,r,r.next)<0?Dn(r,e,r.next)>=0&&Dn(r,r.prev,e)>=0:Dn(r,e,r.prev)<0||Dn(r,r.next,e)<0}function Nb(r,e){const i=hv(r.i,r.x,r.y),o=hv(e.i,e.x,e.y),l=r.next,d=e.prev;return r.next=e,e.prev=r,i.next=l,l.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function Ub(r,e,i,o){const l=hv(r,e,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function sp(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function hv(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function D_(r,e){const i=r.length;if(i<=1)return[r];const o=[];let l,d;for(let f=0;f<i;f++){const g=Xi(r[f]);g!==0&&(r[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(l&&o.push(l),l=[r[f]]):l.push(r[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(ra(o[f],e,1,o[f].length-1,dC),o[f]=o[f].slice(0,e));return o}function dC(r,e){return e.area-r.area}function Vb(r,e,i=1){if(!r)return null;const o=typeof r=="string"?ps.from(r).getPrimary():r.getPrimary(),l=typeof r=="string"?null:r.getSecondary();for(const d of[o,l]){if(!d)continue;const f=d.id.toString();e.has(f)||e.set(f,[]),d.scaleSelf(i),e.get(f).push(d)}return{primary:o.toString(),secondary:l?l.toString():null}}function dv(r,e,i,o){const l=o.patternDependencies;let d=!1;for(const f of e){const g=f.paint.get(`${r}-pattern`);g.isConstant()||(d=!0),Vb(g.constantOr(null),l,i)&&(d=!0)}return d}function fv(r,e,i,o,l,d){const f=d.patternDependencies;for(const g of e){const x=g.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:o},i,{},d.availableImages);w=w&&w.name?w.name:w;const A=Vb(w,f,l);if(!A)continue;const{primary:I,secondary:P}=A;I&&(i.patterns[g.id]=[I,P].filter(Boolean))}}return i}var pv,jb,mv,$b,_v,Gb,Hb,k_={};function qb(){if(jb)return pv;jb=1;var r=Ic();function e(l,d,f,g,x){this.properties={},this.extent=f,this.type=0,this._pbf=l,this._geometry=-1,this._keys=g,this._values=x,l.readFields(i,this,d)}function i(l,d,f){l==1?d.id=f.readVarint():l==2?function(g,x){for(var w=g.readVarint()+g.pos;g.pos<w;){var A=x._keys[g.readVarint()],I=x._values[g.readVarint()];x.properties[A]=I}}(f,d):l==3?d.type=f.readVarint():l==4&&(d._geometry=f.pos)}function o(l){for(var d,f,g=0,x=0,w=l.length,A=w-1;x<w;A=x++)g+=((f=l[A]).x-(d=l[x]).x)*(d.y+f.y);return g}return pv=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var d,f=l.readVarint()+l.pos,g=1,x=0,w=0,A=0,I=[];l.pos<f;){if(x<=0){var P=l.readVarint();g=7&P,x=P>>3}if(x--,g===1||g===2)w+=l.readSVarint(),A+=l.readSVarint(),g===1&&(d&&I.push(d),d=[]),d.push(new r(w,A));else{if(g!==7)throw new Error("unknown command "+g);d&&d.push(d[0].clone())}}return d&&I.push(d),I},e.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var d=l.readVarint()+l.pos,f=1,g=0,x=0,w=0,A=1/0,I=-1/0,P=1/0,L=-1/0;l.pos<d;){if(g<=0){var z=l.readVarint();f=7&z,g=z>>3}if(g--,f===1||f===2)(x+=l.readSVarint())<A&&(A=x),x>I&&(I=x),(w+=l.readSVarint())<P&&(P=w),w>L&&(L=w);else if(f!==7)throw new Error("unknown command "+f)}return[A,P,I,L]},e.prototype.toGeoJSON=function(l,d,f){var g,x,w=this.extent*Math.pow(2,f),A=this.extent*l,I=this.extent*d,P=this.loadGeometry(),L=e.types[this.type];function z(Z){for(var te=0;te<Z.length;te++){var J=Z[te];Z[te]=[360*(J.x+A)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+I)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(g=0;g<P.length;g++)B[g]=P[g][0];z(P=B);break;case 2:for(g=0;g<P.length;g++)z(P[g]);break;case 3:for(P=function(Z){var te=Z.length;if(te<=1)return[Z];for(var J,U,X=[],ee=0;ee<te;ee++){var ne=o(Z[ee]);ne!==0&&(U===void 0&&(U=ne<0),U===ne<0?(J&&X.push(J),J=[Z[ee]]):J.push(Z[ee]))}return J&&X.push(J),X}(P),g=0;g<P.length;g++)for(x=0;x<P[g].length;x++)z(P[g][x])}P.length===1?P=P[0]:L="Multi"+L;var H={type:"Feature",geometry:{type:L,coordinates:P},properties:this.properties};return"id"in this&&(H.id=this.id),H},pv}function Wb(){if($b)return mv;$b=1;var r=qb();function e(o,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,l),this.length=this._features.length}function i(o,l,d){o===15?l.version=d.readVarint():o===1?l.name=d.readString():o===5?l.extent=d.readVarint():o===2?l._features.push(d.pos):o===3?l._keys.push(d.readString()):o===4&&l._values.push(function(f){for(var g=null,x=f.readVarint()+f.pos;f.pos<x;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(d))}return mv=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var l=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,l,this.extent,this._keys,this._values)},mv}function Zb(){return Hb||(Hb=1,k_.VectorTile=function(){if(Gb)return _v;Gb=1;var r=Wb();function e(i,o,l){if(i===3){var d=new r(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}return _v=function(i,o){this.layers=i.readFields(e,{},o)},_v}(),k_.VectorTileFeature=qb(),k_.VectorTileLayer=Wb()),k_}var Yl=Zb();const _u="3d_elevation_id",Xb="level";class fC{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,l){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?o(l?l(d):d):i&&(this._valid=!1),this}}class Kb{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const pC=new Kb((r,e,i)=>r.reset(e).require(_u,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},gu.decodeRelativeHeight).geometry(o=>{i.bounds=o},tf).success(),(r,e,i)=>r.reset(e).require(_u,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},gu.decodeRelativeHeight).geometry(o=>{i.position=o},gu.getPoint).success()),mC=new Kb((r,e,i)=>r.reset(e).require(_u,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},gu.decodeMetricHeight).geometry(o=>{i.bounds=o},tf).success(),(r,e,i)=>r.reset(e).require(_u,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},gu.decodeMetricHeight).geometry(o=>{i.position=o},gu.getPoint).success());class gu{static getPoint(e){return Fn(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],o=[],l=e.length,d=new fC;for(let g=0;g<l;g++){const x=e.feature(g),w=x.properties.hasOwnProperty("version")?String(x.properties.version):void 0,A=(f=w)?f==="1.0.1"?mC:void 0:pC;if(A===void 0){ki(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const I=x.properties.hasOwnProperty("type")?x.properties.type:void 0;if(I){if(Yl.VectorTileFeature.types[x.type]==="Point"&&I==="curve_point"){const P={};A.parseVertex(d,x,P)&&i.push(P)}else if(Yl.VectorTileFeature.types[x.type]==="Polygon"&&I==="curve_meta"){const P={};A.parseFeature(d,x,P)&&o.push(P)}}}var f;return{vertices:i,features:o}}}class Yb{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],l=-i[0],d=(e.extent+1)*this.metersToTile;return[new gt(Math.trunc(e.position[0]+o*d),Math.trunc(e.position[1]+l*d)),new gt(Math.trunc(e.position[0]-o*d),Math.trunc(e.position[1]-l*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class gv{constructor(e,i,o,l,d,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||l.length!==0)){this.vertices=l,this.edges=d,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((x=this.vertices[g.a].position)[0]===(w=this.vertices[g.b].position)[0]&&x[1]===w[1]);var x,w}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:Fn(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const x=this.vertices[g.a].position,w=this.vertices[g.b].position,A=es(qr(),w,x),I=Cn(A),P=ho(qr(),A,1/I);this.edgeProps.push({vec:A,dir:P,len:I});const L=this.vertexProps[g.a].dir,z=this.vertexProps[g.b].dir;Tn(L,L,P),Tn(z,z,P)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||ts(g.dir,g.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,l]=i;return((d,f,g)=>(1-g)*d+g*f)(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,l)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,l=0;const d=Fn(e.x,e.y);for(let f=0;f<this.edges.length;f++){const g=this.edges[f],x=this.edgeProps[f].dir,w=new xo(d,this.edgeProps[f].dir),A=this.vertices[g.a].position,I=this.vertices[g.b].position,P=qr(),L=qr(),z=w.intersectsPlane(A,this.vertexProps[g.a].dir,P),B=w.intersectsPlane(I,this.vertexProps[g.b].dir,L);if(!z||!B)continue;const H=es(qr(),L,P),Z=es(qr(),d,P),te=Mr(H,H),J=te>0?Mr(Z,H)/te:0,U=Ae(J,0,1),X=Math.abs((J-U)*this.edgeProps[f].len),ee=es(qr(),d,A),ne=X+Math.abs(Mr(ee,Fn(x[1],-x[0])));ne<o&&(i=f,o=ne,l=U)}return[i,l]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const o=this.edges[i].a,l=this.edges[i].b,{position:d,height:f,extent:g}=this.vertices[o],{position:x,height:w,extent:A}=this.vertices[l],I=this.vertexProps[o].dir,P=this.vertexProps[l].dir,L=vi(d[0]/e,d[1]/e,f),z=vi(x[0]/e,x[1]/e,w),B=vi(I[1],-I[0],0);Yi(B,B,g);const H=vi(P[1],-P[0],0);if(Yi(H,H,A),this.distSqLines(vi(L[0]+.5*B[0],L[1]+.5*B[1],L[2]+.5*B[2]),vi(z[0]-.5*H[0],z[1]-.5*H[1],z[2]-.5*H[2]),vi(L[0]-.5*B[0],L[1]-.5*B[1],L[2]-.5*B[2]),vi(z[0]+.5*H[0],z[1]+.5*H[1],z[2]+.5*H[2]))<=.0025000000000000005)continue;const Z=this.vertices.length,te=Tn(qr(),d,x);this.vertices.push({position:ho(te,te,.5),height:.5*(f+w),extent:.5*(g+A)});const J=Tn(qr(),I,P);this.vertexProps.push({dir:ts(J,J)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:o,b:Z}),this.edges.push({a:Z,b:l});const U=es(qr(),this.vertices[Z].position,d),X=Cn(U),ee={vec:U,dir:ho(qr(),U,1/X),len:X};this.edgeProps.push(ee),this.edgeProps.push(ee)}}distSqLines(e,i,o,l){const d=si(ni(),i,e),f=si(ni(),l,o),g=si(ni(),e,o),x=tr(d,d),w=tr(d,f),A=tr(d,g),I=tr(f,f),P=tr(f,g),L=x*I-w*w;if(L===0){const H=tr(g,f)/tr(f,f);return In(fi(ni(),o,l,H),e)}const z=(w*P-A*I)/L,B=(x*P-w*A)/L;return In(fi(ni(),e,i,z),fi(ni(),o,l,B))}}class yv{static parseFrom(e,i){const o=gu.parse(e);if(!o)return[];let{vertices:l,features:d}=o;const f=1/Me(i);d.sort((A,I)=>A.id-I.id),l.sort((A,I)=>A.id-I.id||A.idx-I.idx),l=l.filter((A,I,P)=>I===P.findIndex(L=>L.id===A.id&&L.idx===A.idx));const g=new Array;let x=0;const w=l.length;for(const A of d){if(A.constantHeight){g.push(new gv(A.id,A.bounds,A.constantHeight));continue}for(;x!==w&&l[x].id<A.id;)x++;if(x===w||l[x].id!==A.id)continue;const I=new Array,P=new Array,L=x;for(;x!==w&&l[x].id===A.id;){const z=l[x];if(I.push({position:z.position,height:z.height,extent:z.extent}),x!==L&&l[x-1].idx===z.idx-1){const B=x-L;P.push({a:B-1,b:B})}x++}g.push(new gv(A.id,A.bounds,void 0,I,P,f))}return g}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[_u];return Number.isNaN(o)?void 0:i.find(l=>l.id===o)}}class Jb{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*vt,this.yOffset=(e.y*this.zScale-i.y)*vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const l=this.constantElevation(i,o);return l??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*Ie(0,i,e>=0?e:Math.abs(.5*e))}}It(gv,"ElevationFeature");class Qb{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class yu{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new yu;let i=[];for(const w of e)i.push(...w.portals);if(i.length===0)return new yu;const o=(w,A)=>w<=0&&A<=0||w>=vt&&A>=vt;for(const w of i){const A=w.va,I=w.vb;(o(A.x,I.x)||o(A.y,I.y))&&(w.type="border")}const l=i.filter(w=>w.type!=="unevaluated"),d=i.filter(w=>w.type==="unevaluated");if(d.length===0)return new yu;d.sort((w,A)=>w.hash===A.hash?w.isTunnel===A.isTunnel?0:w.isTunnel?-1:1:w.hash<A.hash?1:-1),i=l.concat(d);let f=l.length,g=f,x=f;do if(g++,g===i.length||i[f].hash!==i[g].hash){if(g-f==2){x<f&&(i[x]=i[f],i[f]=null);const w=i[x],A=i[g-1];w.type=w.isTunnel!==A.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:A.connection.a},x++}f=g}while(f!==i.length);return i.splice(x),i.sort((w,A)=>w.hash<A.hash?1:-1),{portals:i}}}It(yu,"ElevationPortalGraph"),It(Qb,"ElevationPolygons");class _C{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,o){let l=e[2];o!=null&&(l*=o);const d=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),f=this.vertexLookup.get(d);if(f!=null)return f;const g=this.outPositions.length;this.vertexLookup.set(d,g);const x=Math.trunc(16384*i[0]),w=Math.trunc(16384*i[1]),A=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],l),this.outNormals.emplaceBack(x,w,A),g}addVertices(e,i,...o){const l=[];for(const d of o){const f=this.addVertex(d,e,i);l.push(f)}return l}addTriangles(e,i,o){if(i&&o){const l=o.length===1,d=vi(0,0,0);for(let f=0;f<e.length;f+=3){const g=i[e[f+0]],x=i[e[f+1]],w=i[e[f+2]],A=l?o[0]:o[e[f+1]],I=l?o[0]:o[e[f+2]],P=this.addVertex(vi(g.x,g.y,l?o[0]:o[e[f+0]]),d),L=this.addVertex(vi(x.x,x.y,A),d),z=this.addVertex(vi(w.x,w.y,I),d);this.outIndices.emplaceBack(P,L,z)}}else for(let l=0;l<e.length;l+=3)this.outIndices.emplaceBack(e[l+0],e[l+1],e[l+2])}addQuad(e,i){const o=this.addVertices(i,void 0,...e.map(x=>vi(x.coord.x,x.coord.y,x.height))),[l,d,f,g]=o;this.addTriangles([l,d,f,f,g,l])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class qs{constructor(e){this.unevaluatedPortals=new yu,this.portalPolygons=new Qb,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Nh,this.vertexNormals=new Vl,this.indexArray=new Mn,this.tileToMeters=Me(e)}addVertices(e,i){const o=this.unevalVertices.length;for(let l=0;l<e.length;l++)this.unevalVertices.push(e[l]),this.unevalHeights.push(i[l]);return o}addTriangles(e,i,o){const l=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)l.push(d+i)}addRenderableRing(e,i,o,l,d){const f=[new gt(d.min.x,d.min.y),new gt(d.max.x,d.min.y),new gt(d.max.x,d.max.y),new gt(d.min.x,d.max.y)];for(let g=0;g<o-1;g++){const x=i+g,w=x+1,A=this.unevalVertices[x],I=this.unevalVertices[w];if(!(A.x>=d.min.x&&A.x<=d.max.x&&A.y>=d.min.y&&A.y<=d.max.y||I.x>=d.min.x&&I.x<=d.max.x&&I.y>=d.min.y&&I.y<=d.max.y||Qr(A,I,f))||this.isOnBorder(A.x,I.x)||this.isOnBorder(A.y,I.y))continue;const P=qs.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[w]);let L,z=this.vertexHashLookup.get(qs.computePosHash(A));z!=null?L=z.next:(z=this.vertexHashLookup.get(qs.computePosHash(I)),L=z!=null?z.prev:P),this.unevalEdges.push({polygonIdx:e,a:x,b:w,hash:P,portalHash:L,isTunnel:l,type:"unevaluated"})}}addPortalCandidates(e,i,o,l,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const f=i[0];this.vertexHashLookup.clear();let g=qs.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let x=0;x<f.length-1;x++){const w=f[x+0],A=f[x+1],I=Fn(A.x-w.x,A.y-w.y),P=Cn(I);if(P===0)continue;let L="unevaluated";const z=l.pointElevation(w),B=l.pointElevation(A);Math.abs(z)<.01&&Math.abs(B)<.01?L="entrance":(this.isOnBorder(w.x,A.x)||this.isOnBorder(w.y,A.y))&&(L="border");const H=qs.computeEdgeHash(w,A);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:w,vb:A,vab:I,length:P,hash:H,isTunnel:o,type:L});const Z=qs.computePosHash(w);this.vertexHashLookup.set(Z,{prev:g,next:H}),g=H}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=I=>{I.primitiveLength=this.indexArray.length-I.primitiveOffset},l=new _C(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),f=i(),g=i(),x=(I,P)=>{I.sort((z,B)=>z.type===P&&B.type!==P?-1:z.type!==P&&B.type===P?1:0);const L=I.findIndex(z=>z.type!==P);return L>=0?L:I.length};let w=0;this.unevalEdges.length>0&&(w=x(this.unevalEdges,"none"),this.constructBridgeStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},this.tileToMeters));const A=i();if(this.unevalEdges.length>0){const I=this.unevalEdges.splice(w),P=x(I,"tunnel")+w;this.unevalEdges.push(...I),this.constructTunnelStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},{min:w,max:P})}o(g),l.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(A),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(f),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(d),this.maskSegments=$r.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=$r.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=$r.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.shadowCasterSegments=$r.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,tC.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,iC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,o,l,d){const f=new Map;for(let g=l;g<d;g++){const x=o[g],w=x.a,A=x.b,I=qs.computePosHash(e[w]),P=qs.computePosHash(e[A]);f.has(I)||f.set(I,{}),f.has(P)||f.set(P,{});const L=f.get(I),z=f.get(P);i[w]<=0&&i[A]<=0||(L.to=A,z.from=w)}return f}constructBridgeStructures(e,i,o,l,d,f){const g=this.computeVertexConnections(i,o,l,d.min,d.max),x=1/f,w=.5*x,A=P=>vi(i[P].x,i[P].y,o[P]*x),I=P=>{const L=g.get(qs.computePosHash(i[P])),z=L.from,B=L.to;if(!z||!B)return;const H=A(z),Z=A(P),te=A(B),J=vi(0,0,0);if(!Sr(H,Z)){const X=we(ni(),Z,H);Ni(J,J,gr(X,X))}if(!Sr(te,Z)){const X=we(ni(),te,Z);Ni(J,J,gr(X,X))}const U=ht(J);return U>0?Yi(J,J,1/U):void 0};for(let P=d.min;P<d.max;P++){const L=l[P],z=this.prepareEdgePoints(i,o,L,(ct,ci)=>ct>ci);if(z==null)continue;const B=z[0],H=z[1],Z=vi(B.coord.x,B.coord.y,x*B.height),te=vi(H.coord.x,H.coord.y,x*H.height);if(Sr(Z,te))continue;const J=we(ni(),te,Z);gr(J,J);const U=ct=>gr(ct,ct),X=I(L.a)||J,ee=I(L.b)||J,ne=U(vi(X[1],-X[0],0)),me=U(vi(ee[1],-ee[0],0)),xe=U(_t(ni(),ne,X)),Se=U(_t(ni(),me,ee)),Pe=ni(),He=[Ni(ni(),Z,Yi(Pe,we(Pe,ne,xe),w)),Ni(ni(),Z,Yi(Pe,Ni(Pe,ne,xe),w)),Ni(ni(),Z,Yi(Pe,xe,w)),Z],nt=[Ni(ni(),te,Yi(Pe,we(Pe,me,Se),w)),Ni(ni(),te,Yi(Pe,Ni(Pe,me,Se),w)),Ni(ni(),te,Yi(Pe,Se,w)),te],[et,rt]=e.addVertices(ne,f,He[0],He[1]),[lt,je]=e.addVertices(me,f,nt[0],nt[1]);e.addTriangles([et,rt,lt,rt,je,lt]);const[it,Ne]=e.addVertices(xe,f,He[1],He[2]),[Ge,ut]=e.addVertices(Se,f,nt[1],nt[2]);e.addTriangles([it,Ne,Ge,Ne,ut,Ge]);const[dt,Nt]=e.addVertices(ys(ne,ne),f,He[2],He[3]),[Mt,xt]=e.addVertices(ys(me,me),f,nt[2],nt[3]);e.addTriangles([dt,Nt,Mt,Nt,xt,Mt])}}constructTunnelStructures(e,i,o,l,d,f){const g=x=>gr(x,x);for(let x=d.min;x<d.max;x++){const w=this.prepareEdgePoints(i,o,l[x],(L,z)=>L<z);if(w==null)continue;const[A,I]=w,P=g(vi(I.coord.y-A.coord.y,-(I.coord.x-A.coord.x),0));e.addQuad([A,I,{coord:I.coord,height:l[x].isTunnel?-.1:0},{coord:A.coord,height:l[x].isTunnel?-.1:0}],P)}for(let x=f.min;x<f.max;x++){const w=l[x],A=i[w.a],I=i[w.b],P=g(vi(I.y-A.y,-(I.x-A.x),0));e.addQuad([{coord:I,height:0},{coord:A,height:0},{coord:A,height:o[w.a]+4},{coord:I,height:o[w.b]+4}],P),e.addQuad([{coord:A,height:0},{coord:I,height:0},{coord:I,height:o[w.b]+4},{coord:A,height:o[w.a]+4}],P)}}prepareEdgePoints(e,i,o,l){let d=i[o.a],f=i[o.b];const g=l(d,0),x=l(f,0);if(g&&x)return[{coord:e[o.a],height:d},{coord:e[o.b],height:f}];if(!g&&!x)return;const w=e[o.a].clone(),A=e[o.b].clone();if(g){if(!x){const I=f/(f-d);A.x=Kt(A.x,w.x,I),A.y=Kt(A.y,w.y,I),f=Kt(f,d,I)}}else{const I=d/(d-f);w.x=Kt(w.x,A.x,I),w.y=Kt(w.y,A.y,I),d=Kt(d,f,I)}return[{coord:w,height:d},{coord:A,height:f}]}prepareEdges(e,i){if(i.length===0)return;i.sort((g,x)=>g.hash===x.hash?x.polygonIdx-g.polygonIdx:x.hash>g.hash?1:-1);let o=0,l=0,d=0,f=i[o].polygonIdx;do l++,(l===i.length||i[o].hash!==i[l].hash)&&((l-o==1||i[l-1].polygonIdx!==f)&&(d<o&&(i[d]=i[o],i[o]=null),i[d].type="none",d++),o=l,o!==i.length&&(f=i[o].polygonIdx));while(o!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((w,A)=>w.portalHash<A.portalHash?1:-1);let g=0,x=0;for(;g!==i.length&&x!==e.length;){const w=i[g],A=e[x];w.portalHash>A.hash?g++:A.hash>w.portalHash?x++:(w.type=A.type,g++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=vt&&i>=vt}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(qs.computePosHash(e))<<32n|BigInt(qs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var e1,t1={exports:{}},i1=(e1||(e1=1,function(r,e){(function(i){function o(ie,se){return ie>se?1:ie<se?-1:0}var l=function(ie,se){ie===void 0&&(ie=o),se===void 0&&(se=!1),this._compare=ie,this._root=null,this._size=0,this._noDuplicates=!!se},d={size:{configurable:!0}};function f(ie,se,Ze,mt,wt){var bt=wt-mt;if(bt>0){var Ft=mt+Math.floor(bt/2),ri={key:se[Ft],data:Ze[Ft],parent:ie};return ri.left=f(ri,se,Ze,mt,Ft),ri.right=f(ri,se,Ze,Ft+1,wt),ri}return null}function g(ie,se,Ze,mt,wt){if(!(Ze>=mt)){for(var bt=ie[Ze+mt>>1],Ft=Ze-1,ri=mt+1;;){do Ft++;while(wt(ie[Ft],bt)<0);do ri--;while(wt(ie[ri],bt)>0);if(Ft>=ri)break;var zi=ie[Ft];ie[Ft]=ie[ri],ie[ri]=zi,zi=se[Ft],se[Ft]=se[ri],se[ri]=zi}g(ie,se,Ze,ri,wt),g(ie,se,ri+1,mt,wt)}}l.prototype.rotateLeft=function(ie){var se=ie.right;se&&(ie.right=se.left,se.left&&(se.left.parent=ie),se.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.left=ie),ie.parent=se},l.prototype.rotateRight=function(ie){var se=ie.left;se&&(ie.left=se.right,se.right&&(se.right.parent=ie),se.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.right=ie),ie.parent=se},l.prototype._splay=function(ie){for(;ie.parent;){var se=ie.parent;se.parent?se.left===ie&&se.parent.left===se?(this.rotateRight(se.parent),this.rotateRight(se)):se.right===ie&&se.parent.right===se?(this.rotateLeft(se.parent),this.rotateLeft(se)):se.left===ie&&se.parent.right===se?(this.rotateRight(se),this.rotateLeft(se)):(this.rotateLeft(se),this.rotateRight(se)):se.left===ie?this.rotateRight(se):this.rotateLeft(se)}},l.prototype.splay=function(ie){for(var se,Ze,mt,wt,bt;ie.parent;)(Ze=(se=ie.parent).parent)&&Ze.parent?((mt=Ze.parent).left===Ze?mt.left=ie:mt.right=ie,ie.parent=mt):(ie.parent=null,this._root=ie),wt=ie.left,bt=ie.right,ie===se.left?(Ze&&(Ze.left===se?(se.right?(Ze.left=se.right,Ze.left.parent=Ze):Ze.left=null,se.right=Ze,Ze.parent=se):(wt?(Ze.right=wt,wt.parent=Ze):Ze.right=null,ie.left=Ze,Ze.parent=ie)),bt?(se.left=bt,bt.parent=se):se.left=null,ie.right=se,se.parent=ie):(Ze&&(Ze.right===se?(se.left?(Ze.right=se.left,Ze.right.parent=Ze):Ze.right=null,se.left=Ze,Ze.parent=se):(bt?(Ze.left=bt,bt.parent=Ze):Ze.left=null,ie.right=Ze,Ze.parent=ie)),wt?(se.right=wt,wt.parent=se):se.right=null,ie.left=se,se.parent=ie)},l.prototype.replace=function(ie,se){ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.parent=ie.parent)},l.prototype.minNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.left;)ie=ie.left;return ie},l.prototype.maxNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.right;)ie=ie.right;return ie},l.prototype.insert=function(ie,se){var Ze=this._root,mt=null,wt=this._compare;if(this._noDuplicates)for(;Ze;){if(mt=Ze,wt(Ze.key,ie)===0)return;Ze=wt(Ze.key,ie)<0?Ze.right:Ze.left}else for(;Ze;)mt=Ze,Ze=wt(Ze.key,ie)<0?Ze.right:Ze.left;return Ze={key:ie,data:se,left:null,right:null,parent:mt},mt?wt(mt.key,Ze.key)<0?mt.right=Ze:mt.left=Ze:this._root=Ze,this.splay(Ze),this._size++,Ze},l.prototype.find=function(ie){for(var se=this._root,Ze=this._compare;se;){var mt=Ze(se.key,ie);if(mt<0)se=se.right;else{if(!(mt>0))return se;se=se.left}}return null},l.prototype.contains=function(ie){for(var se=this._root,Ze=this._compare;se;){var mt=Ze(ie,se.key);if(mt===0)return!0;se=mt<0?se.left:se.right}return!1},l.prototype.remove=function(ie){var se=this.find(ie);if(!se)return!1;if(this.splay(se),se.left)if(se.right){var Ze=this.minNode(se.right);Ze.parent!==se&&(this.replace(Ze,Ze.right),Ze.right=se.right,Ze.right.parent=Ze),this.replace(se,Ze),Ze.left=se.left,Ze.left.parent=Ze}else this.replace(se,se.left);else this.replace(se,se.right);return this._size--,!0},l.prototype.removeNode=function(ie){if(!ie)return!1;if(this.splay(ie),ie.left)if(ie.right){var se=this.minNode(ie.right);se.parent!==ie&&(this.replace(se,se.right),se.right=ie.right,se.right.parent=se),this.replace(ie,se),se.left=ie.left,se.left.parent=se}else this.replace(ie,ie.left);else this.replace(ie,ie.right);return this._size--,!0},l.prototype.erase=function(ie){var se=this.find(ie);if(se){this.splay(se);var Ze=se.left,mt=se.right,wt=null;Ze&&(Ze.parent=null,wt=this.maxNode(Ze),this.splay(wt),this._root=wt),mt&&(Ze?wt.right=mt:this._root=mt,mt.parent=wt),this._size--}},l.prototype.pop=function(){var ie=this._root,se=null;if(ie){for(;ie.left;)ie=ie.left;se={key:ie.key,data:ie.data},this.remove(ie.key)}return se},l.prototype.next=function(ie){var se=ie;if(se)if(se.right)for(se=se.right;se&&se.left;)se=se.left;else for(se=ie.parent;se&&se.right===ie;)ie=se,se=se.parent;return se},l.prototype.prev=function(ie){var se=ie;if(se)if(se.left)for(se=se.left;se&&se.right;)se=se.right;else for(se=ie.parent;se&&se.left===ie;)ie=se,se=se.parent;return se},l.prototype.forEach=function(ie){for(var se=this._root,Ze=[],mt=!1,wt=0;!mt;)se?(Ze.push(se),se=se.left):Ze.length>0?(ie(se=Ze.pop(),wt++),se=se.right):mt=!0;return this},l.prototype.range=function(ie,se,Ze,mt){for(var wt=[],bt=this._compare,Ft=this._root;wt.length!==0||Ft;)if(Ft)wt.push(Ft),Ft=Ft.left;else{if(bt((Ft=wt.pop()).key,se)>0)break;if(bt(Ft.key,ie)>=0&&Ze.call(mt,Ft))return this;Ft=Ft.right}return this},l.prototype.keys=function(){for(var ie=this._root,se=[],Ze=[],mt=!1;!mt;)ie?(se.push(ie),ie=ie.left):se.length>0?(ie=se.pop(),Ze.push(ie.key),ie=ie.right):mt=!0;return Ze},l.prototype.values=function(){for(var ie=this._root,se=[],Ze=[],mt=!1;!mt;)ie?(se.push(ie),ie=ie.left):se.length>0?(ie=se.pop(),Ze.push(ie.data),ie=ie.right):mt=!0;return Ze},l.prototype.at=function(ie){for(var se=this._root,Ze=[],mt=!1,wt=0;!mt;)if(se)Ze.push(se),se=se.left;else if(Ze.length>0){if(se=Ze.pop(),wt===ie)return se;wt++,se=se.right}else mt=!0;return null},l.prototype.load=function(ie,se,Ze){if(ie===void 0&&(ie=[]),se===void 0&&(se=[]),Ze===void 0&&(Ze=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var mt=ie.length;return Ze&&g(ie,se,0,mt-1,this._compare),this._root=f(null,ie,se,0,mt),this._size=mt,this},l.prototype.min=function(){var ie=this.minNode(this._root);return ie?ie.key:null},l.prototype.max=function(){var ie=this.maxNode(this._root);return ie?ie.key:null},l.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},l.createTree=function(ie,se,Ze,mt,wt){return new l(Ze,wt).load(ie,se,mt)},Object.defineProperties(l.prototype,d);var x=0,w=1,A=2,I=3,P=0,L=1,z=2,B=3;function H(ie,se,Ze){se===null?(ie.inOut=!1,ie.otherInOut=!0):(ie.isSubject===se.isSubject?(ie.inOut=!se.inOut,ie.otherInOut=se.otherInOut):(ie.inOut=!se.otherInOut,ie.otherInOut=se.isVertical()?!se.inOut:se.inOut),se&&(ie.prevInResult=!Z(se,Ze)||se.isVertical()?se.prevInResult:se));var mt=Z(ie,Ze);ie.resultTransition=mt?function(wt,bt){var Ft,ri=!wt.inOut,zi=!wt.otherInOut;switch(bt){case P:Ft=ri&&zi;break;case L:Ft=ri||zi;break;case B:Ft=ri^zi;break;case z:Ft=wt.isSubject?ri&&!zi:zi&&!ri}return Ft?1:-1}(ie,Ze):0}function Z(ie,se){switch(ie.type){case x:switch(se){case P:return!ie.otherInOut;case L:return ie.otherInOut;case z:return ie.isSubject&&ie.otherInOut||!ie.isSubject&&!ie.otherInOut;case B:return!0}break;case A:return se===P||se===L;case I:return se===z;case w:return!1}return!1}var te=function(ie,se,Ze,mt,wt){this.left=se,this.point=ie,this.otherEvent=Ze,this.isSubject=mt,this.type=wt||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},J={inResult:{configurable:!0}};function U(ie,se){return ie[0]===se[0]&&ie[1]===se[1]}te.prototype.isBelow=function(ie){var se=this.point,Ze=this.otherEvent.point;return this.left?(se[0]-ie[0])*(Ze[1]-ie[1])-(Ze[0]-ie[0])*(se[1]-ie[1])>0:(Ze[0]-ie[0])*(se[1]-ie[1])-(se[0]-ie[0])*(Ze[1]-ie[1])>0},te.prototype.isAbove=function(ie){return!this.isBelow(ie)},te.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},J.inResult.get=function(){return this.resultTransition!==0},te.prototype.clone=function(){var ie=new te(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ie.contourId=this.contourId,ie.resultTransition=this.resultTransition,ie.prevInResult=this.prevInResult,ie.isExteriorRing=this.isExteriorRing,ie.inOut=this.inOut,ie.otherInOut=this.otherInOut,ie},Object.defineProperties(te.prototype,J);var X=11102230246251565e-32,ee=134217729,ne=(3+8*X)*X;function me(ie,se,Ze,mt,wt){var bt,Ft,ri,zi,Oi=se[0],Si=mt[0],or=0,br=0;Si>Oi==Si>-Oi?(bt=Oi,Oi=se[++or]):(bt=Si,Si=mt[++br]);var Fi=0;if(or<ie&&br<Ze)for(Si>Oi==Si>-Oi?(ri=bt-((Ft=Oi+bt)-Oi),Oi=se[++or]):(ri=bt-((Ft=Si+bt)-Si),Si=mt[++br]),bt=Ft,ri!==0&&(wt[Fi++]=ri);or<ie&&br<Ze;)Si>Oi==Si>-Oi?(ri=bt-((Ft=bt+Oi)-(zi=Ft-bt))+(Oi-zi),Oi=se[++or]):(ri=bt-((Ft=bt+Si)-(zi=Ft-bt))+(Si-zi),Si=mt[++br]),bt=Ft,ri!==0&&(wt[Fi++]=ri);for(;or<ie;)ri=bt-((Ft=bt+Oi)-(zi=Ft-bt))+(Oi-zi),Oi=se[++or],bt=Ft,ri!==0&&(wt[Fi++]=ri);for(;br<Ze;)ri=bt-((Ft=bt+Si)-(zi=Ft-bt))+(Si-zi),Si=mt[++br],bt=Ft,ri!==0&&(wt[Fi++]=ri);return bt===0&&Fi!==0||(wt[Fi++]=bt),Fi}function xe(ie){return new Float64Array(ie)}var Se=33306690738754716e-32,Pe=22204460492503146e-32,He=11093356479670487e-47,nt=xe(4),et=xe(8),rt=xe(12),lt=xe(16),je=xe(4);function it(ie,se,Ze){var mt=function(wt,bt,Ft,ri,zi,Oi){var Si=(bt-Oi)*(Ft-zi),or=(wt-zi)*(ri-Oi),br=Si-or;if(Si===0||or===0||Si>0!=or>0)return br;var Fi=Math.abs(Si+or);return Math.abs(br)>=Se*Fi?br:-function(Gr,Cr,rr,en,Rr,wr,Pr){var ar,Pi,dr,Hr,ii,$i,Dr,Kr,Or,mn,mr,hn,Ss,$n,Un,Es,va,_n,En=Gr-Rr,Gn=rr-Rr,cs=Cr-wr,Kn=en-wr;nt[0]=(Un=(Kr=En-(Dr=($i=ee*En)-($i-En)))*(mn=Kn-(Or=($i=ee*Kn)-($i-Kn)))-(($n=En*Kn)-Dr*Or-Kr*Or-Dr*mn))-((mr=Un-(va=(Kr=cs-(Dr=($i=ee*cs)-($i-cs)))*(mn=Gn-(Or=($i=ee*Gn)-($i-Gn)))-((Es=cs*Gn)-Dr*Or-Kr*Or-Dr*mn)))+(ii=Un-mr))+(ii-va),nt[1]=(Ss=$n-((hn=$n+mr)-(ii=hn-$n))+(mr-ii))-((mr=Ss-Es)+(ii=Ss-mr))+(ii-Es),nt[2]=hn-((_n=hn+mr)-(ii=_n-hn))+(mr-ii),nt[3]=_n;var rc=function(SN,oS){for(var aS=oS[0],w0=1;w0<4;w0++)aS+=oS[w0];return aS}(0,nt),kp=Pe*Pr;if(rc>=kp||-rc>=kp||(ar=Gr-(En+(ii=Gr-En))+(ii-Rr),dr=rr-(Gn+(ii=rr-Gn))+(ii-Rr),Pi=Cr-(cs+(ii=Cr-cs))+(ii-wr),Hr=en-(Kn+(ii=en-Kn))+(ii-wr),ar===0&&Pi===0&&dr===0&&Hr===0)||(kp=He*Pr+ne*Math.abs(rc),(rc+=En*Hr+Kn*ar-(cs*dr+Gn*Pi))>=kp||-rc>=kp))return rc;je[0]=(Un=(Kr=ar-(Dr=($i=ee*ar)-($i-ar)))*(mn=Kn-(Or=($i=ee*Kn)-($i-Kn)))-(($n=ar*Kn)-Dr*Or-Kr*Or-Dr*mn))-((mr=Un-(va=(Kr=Pi-(Dr=($i=ee*Pi)-($i-Pi)))*(mn=Gn-(Or=($i=ee*Gn)-($i-Gn)))-((Es=Pi*Gn)-Dr*Or-Kr*Or-Dr*mn)))+(ii=Un-mr))+(ii-va),je[1]=(Ss=$n-((hn=$n+mr)-(ii=hn-$n))+(mr-ii))-((mr=Ss-Es)+(ii=Ss-mr))+(ii-Es),je[2]=hn-((_n=hn+mr)-(ii=_n-hn))+(mr-ii),je[3]=_n;var eR=me(4,nt,4,je,et);je[0]=(Un=(Kr=En-(Dr=($i=ee*En)-($i-En)))*(mn=Hr-(Or=($i=ee*Hr)-($i-Hr)))-(($n=En*Hr)-Dr*Or-Kr*Or-Dr*mn))-((mr=Un-(va=(Kr=cs-(Dr=($i=ee*cs)-($i-cs)))*(mn=dr-(Or=($i=ee*dr)-($i-dr)))-((Es=cs*dr)-Dr*Or-Kr*Or-Dr*mn)))+(ii=Un-mr))+(ii-va),je[1]=(Ss=$n-((hn=$n+mr)-(ii=hn-$n))+(mr-ii))-((mr=Ss-Es)+(ii=Ss-mr))+(ii-Es),je[2]=hn-((_n=hn+mr)-(ii=_n-hn))+(mr-ii),je[3]=_n;var tR=me(eR,et,4,je,rt);je[0]=(Un=(Kr=ar-(Dr=($i=ee*ar)-($i-ar)))*(mn=Hr-(Or=($i=ee*Hr)-($i-Hr)))-(($n=ar*Hr)-Dr*Or-Kr*Or-Dr*mn))-((mr=Un-(va=(Kr=Pi-(Dr=($i=ee*Pi)-($i-Pi)))*(mn=dr-(Or=($i=ee*dr)-($i-dr)))-((Es=Pi*dr)-Dr*Or-Kr*Or-Dr*mn)))+(ii=Un-mr))+(ii-va),je[1]=(Ss=$n-((hn=$n+mr)-(ii=hn-$n))+(mr-ii))-((mr=Ss-Es)+(ii=Ss-mr))+(ii-Es),je[2]=hn-((_n=hn+mr)-(ii=_n-hn))+(mr-ii),je[3]=_n;var iR=me(tR,rt,4,je,lt);return lt[iR-1]}(wt,bt,Ft,ri,zi,Oi,Fi)}(ie[0],ie[1],se[0],se[1],Ze[0],Ze[1]);return mt>0?-1:mt<0?1:0}function Ne(ie,se){var Ze=ie.point,mt=se.point;return Ze[0]>mt[0]?1:Ze[0]<mt[0]?-1:Ze[1]!==mt[1]?Ze[1]>mt[1]?1:-1:function(wt,bt,Ft,ri){return wt.left!==bt.left?wt.left?1:-1:it(Ft,wt.otherEvent.point,bt.otherEvent.point)!==0?wt.isBelow(bt.otherEvent.point)?-1:1:!wt.isSubject&&bt.isSubject?1:-1}(ie,se,Ze)}function Ge(ie,se,Ze){var mt=new te(se,!1,ie,ie.isSubject),wt=new te(se,!0,ie.otherEvent,ie.isSubject);return U(ie.point,ie.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ie),mt.contourId=wt.contourId=ie.contourId,Ne(wt,ie.otherEvent)>0&&(ie.otherEvent.left=!0,wt.left=!1),ie.otherEvent.otherEvent=wt,ie.otherEvent=mt,Ze.push(wt),Ze.push(mt),Ze}function ut(ie,se){return ie[0]*se[1]-ie[1]*se[0]}function dt(ie,se){return ie[0]*se[0]+ie[1]*se[1]}function Nt(ie,se,Ze){var mt=function(zi,Oi,Si,or,br){var Fi=[Oi[0]-zi[0],Oi[1]-zi[1]],Gr=[or[0]-Si[0],or[1]-Si[1]];function Cr($i,Dr,Kr){return[$i[0]+Dr*Kr[0],$i[1]+Dr*Kr[1]]}var rr=[Si[0]-zi[0],Si[1]-zi[1]],en=ut(Fi,Gr),Rr=en*en,wr=dt(Fi,Fi);if(Rr>0){var Pr=ut(rr,Gr)/en;if(Pr<0||Pr>1)return null;var ar=ut(rr,Fi)/en;return ar<0||ar>1?null:Pr===0||Pr===1?[Cr(zi,Pr,Fi)]:ar===0||ar===1?[Cr(Si,ar,Gr)]:[Cr(zi,Pr,Fi)]}if((Rr=(en=ut(rr,Fi))*en)>0)return null;var Pi=dt(Fi,rr)/wr,dr=Pi+dt(Fi,Gr)/wr,Hr=Math.min(Pi,dr),ii=Math.max(Pi,dr);return Hr<=1&&ii>=0?Hr===1?[Cr(zi,Hr>0?Hr:0,Fi)]:ii===0?[Cr(zi,ii<1?ii:1,Fi)]:[Cr(zi,Hr>0?Hr:0,Fi),Cr(zi,ii<1?ii:1,Fi)]:null}(ie.point,ie.otherEvent.point,se.point,se.otherEvent.point),wt=mt?mt.length:0;if(wt===0||wt===1&&(U(ie.point,se.point)||U(ie.otherEvent.point,se.otherEvent.point))||wt===2&&ie.isSubject===se.isSubject)return 0;if(wt===1)return U(ie.point,mt[0])||U(ie.otherEvent.point,mt[0])||Ge(ie,mt[0],Ze),U(se.point,mt[0])||U(se.otherEvent.point,mt[0])||Ge(se,mt[0],Ze),1;var bt=[],Ft=!1,ri=!1;return U(ie.point,se.point)?Ft=!0:Ne(ie,se)===1?bt.push(se,ie):bt.push(ie,se),U(ie.otherEvent.point,se.otherEvent.point)?ri=!0:Ne(ie.otherEvent,se.otherEvent)===1?bt.push(se.otherEvent,ie.otherEvent):bt.push(ie.otherEvent,se.otherEvent),Ft&&ri||Ft?(se.type=w,ie.type=se.inOut===ie.inOut?A:I,Ft&&!ri&&Ge(bt[1].otherEvent,bt[0].point,Ze),2):ri?(Ge(bt[0],bt[1].point,Ze),3):bt[0]!==bt[3].otherEvent?(Ge(bt[0],bt[1].point,Ze),Ge(bt[1],bt[2].point,Ze),3):(Ge(bt[0],bt[1].point,Ze),Ge(bt[3].otherEvent,bt[2].point,Ze),3)}function Mt(ie,se){if(ie===se)return 0;if(it(ie.point,ie.otherEvent.point,se.point)!==0||it(ie.point,ie.otherEvent.point,se.otherEvent.point)!==0)return U(ie.point,se.point)?ie.isBelow(se.otherEvent.point)?-1:1:ie.point[0]===se.point[0]?ie.point[1]<se.point[1]?-1:1:Ne(ie,se)===1?se.isAbove(ie.point)?-1:1:ie.isBelow(se.point)?-1:1;if(ie.isSubject!==se.isSubject)return ie.isSubject?-1:1;var Ze=ie.point,mt=se.point;return Ze[0]===mt[0]&&Ze[1]===mt[1]?(Ze=ie.otherEvent.point)[0]===(mt=se.otherEvent.point)[0]&&Ze[1]===mt[1]?0:ie.contourId>se.contourId?1:-1:Ne(ie,se)===1?1:-1}var xt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ct(ie,se,Ze,mt){var wt,bt=ie+1,Ft=se[ie].point,ri=se.length;for(bt<ri&&(wt=se[bt].point);bt<ri&&wt[0]===Ft[0]&&wt[1]===Ft[1];){if(!Ze[bt])return bt;++bt<ri&&(wt=se[bt].point)}for(bt=ie-1;Ze[bt]&&bt>mt;)bt--;return bt}xt.prototype.isExterior=function(){return this.holeOf==null};var ci=Ot,zt=Ot;function Ot(ie,se){if(!(this instanceof Ot))return new Ot(ie,se);if(this.data=ie||[],this.length=this.data.length,this.compare=se||oi,this.length>0)for(var Ze=(this.length>>1)-1;Ze>=0;Ze--)this._down(Ze)}function oi(ie,se){return ie<se?-1:ie>se?1:0}Ot.prototype={push:function(ie){this.data.push(ie),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ie=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ie}},peek:function(){return this.data[0]},_up:function(ie){for(var se=this.data,Ze=this.compare,mt=se[ie];ie>0;){var wt=ie-1>>1,bt=se[wt];if(Ze(mt,bt)>=0)break;se[ie]=bt,ie=wt}se[ie]=mt},_down:function(ie){for(var se=this.data,Ze=this.compare,mt=this.length>>1,wt=se[ie];ie<mt;){var bt=1+(ie<<1),Ft=bt+1,ri=se[bt];if(Ft<this.length&&Ze(se[Ft],ri)<0&&(bt=Ft,ri=se[Ft]),Ze(ri,wt)>=0)break;se[ie]=ri,ie=bt}se[ie]=wt}},ci.default=zt;var yi=Math.max,bi=Math.min,Mi=0;function Ai(ie,se,Ze,mt,wt,bt){var Ft,ri,zi,Oi,Si,or;for(Ft=0,ri=ie.length-1;Ft<ri;Ft++)if(Oi=ie[Ft+1],Si=new te(zi=ie[Ft],!1,void 0,se),or=new te(Oi,!1,Si,se),Si.otherEvent=or,zi[0]!==Oi[0]||zi[1]!==Oi[1]){Si.contourId=or.contourId=Ze,bt||(Si.isExteriorRing=!1,or.isExteriorRing=!1),Ne(Si,or)>0?or.left=!0:Si.left=!0;var br=zi[0],Fi=zi[1];wt[0]=bi(wt[0],br),wt[1]=bi(wt[1],Fi),wt[2]=yi(wt[2],br),wt[3]=yi(wt[3],Fi),mt.push(Si),mt.push(or)}}var Ti=[];function pr(ie,se,Ze){typeof ie[0][0][0]=="number"&&(ie=[ie]),typeof se[0][0][0]=="number"&&(se=[se]);var mt=function(Fi,Gr,Cr){var rr=null;return Fi.length*Gr.length==0&&(Cr===P?rr=Ti:Cr===z?rr=Fi:Cr!==L&&Cr!==B||(rr=Fi.length===0?Gr:Fi)),rr}(ie,se,Ze);if(mt)return mt===Ti?null:mt;var wt=[1/0,1/0,-1/0,-1/0],bt=[1/0,1/0,-1/0,-1/0],Ft=function(Fi,Gr,Cr,rr,en){var Rr,wr,Pr,ar,Pi,dr,Hr=new ci(null,Ne);for(Pr=0,ar=Fi.length;Pr<ar;Pr++)for(Pi=0,dr=(Rr=Fi[Pr]).length;Pi<dr;Pi++)(wr=Pi===0)&&Mi++,Ai(Rr[Pi],!0,Mi,Hr,Cr,wr);for(Pr=0,ar=Gr.length;Pr<ar;Pr++)for(Pi=0,dr=(Rr=Gr[Pr]).length;Pi<dr;Pi++)wr=Pi===0,en===z&&(wr=!1),wr&&Mi++,Ai(Rr[Pi],!1,Mi,Hr,rr,wr);return Hr}(ie,se,wt,bt,Ze);if(mt=function(Fi,Gr,Cr,rr,en){var Rr=null;return(Cr[0]>rr[2]||rr[0]>Cr[2]||Cr[1]>rr[3]||rr[1]>Cr[3])&&(en===P?Rr=Ti:en===z?Rr=Fi:en!==L&&en!==B||(Rr=Fi.concat(Gr))),Rr}(ie,se,wt,bt,Ze))return mt===Ti?null:mt;for(var ri=function(Fi){var Gr,Cr,rr=function(Pr){var ar,Pi,dr,Hr,ii=[];for(Pi=0,dr=Pr.length;Pi<dr;Pi++)((ar=Pr[Pi]).left&&ar.inResult||!ar.left&&ar.otherEvent.inResult)&&ii.push(ar);for(var $i=!1;!$i;)for($i=!0,Pi=0,dr=ii.length;Pi<dr;Pi++)Pi+1<dr&&Ne(ii[Pi],ii[Pi+1])===1&&(Hr=ii[Pi],ii[Pi]=ii[Pi+1],ii[Pi+1]=Hr,$i=!1);for(Pi=0,dr=ii.length;Pi<dr;Pi++)(ar=ii[Pi]).otherPos=Pi;for(Pi=0,dr=ii.length;Pi<dr;Pi++)(ar=ii[Pi]).left||(Hr=ar.otherPos,ar.otherPos=ar.otherEvent.otherPos,ar.otherEvent.otherPos=Hr);return ii}(Fi),en={},Rr=[],wr=function(){if(!en[Gr]){var Pr=Rr.length,ar=function(ii,$i,Dr){var Kr=new xt;if(ii.prevInResult!=null){var Or=ii.prevInResult,mn=Or.outputContourId;if(Or.resultTransition>0){var mr=$i[mn];if(mr.holeOf!=null){var hn=mr.holeOf;$i[hn].holeIds.push(Dr),Kr.holeOf=hn,Kr.depth=$i[mn].depth}else $i[mn].holeIds.push(Dr),Kr.holeOf=mn,Kr.depth=$i[mn].depth+1}else Kr.holeOf=null,Kr.depth=$i[mn].depth}else Kr.holeOf=null,Kr.depth=0;return Kr}(rr[Gr],Rr,Pr),Pi=function(ii){en[ii]=!0,ii<rr.length&&rr[ii]&&(rr[ii].outputContourId=Pr)},dr=Gr,Hr=Gr;for(ar.points.push(rr[Gr].point);Pi(dr),Pi(dr=rr[dr].otherPos),ar.points.push(rr[dr].point),!((dr=ct(dr,rr,en,Hr))==Hr||dr>=rr.length)&&rr[dr];);Rr.push(ar)}};for(Gr=0,Cr=rr.length;Gr<Cr;Gr++)wr();return Rr}(function(Fi,Gr,Cr,rr,en,Rr){for(var wr,Pr,ar,Pi=new l(Mt),dr=[],Hr=Math.min(rr[2],en[2]);Fi.length!==0;){var ii=Fi.pop();if(dr.push(ii),Rr===P&&ii.point[0]>Hr||Rr===z&&ii.point[0]>rr[2])break;if(ii.left){Pr=wr=Pi.insert(ii),wr=wr!==(ar=Pi.minNode())?Pi.prev(wr):null,Pr=Pi.next(Pr);var $i=wr?wr.key:null;if(H(ii,$i,Rr),Pr&&Nt(ii,Pr.key,Fi)===2&&(H(ii,$i,Rr),H(Pr.key,ii,Rr)),wr&&Nt(wr.key,ii,Fi)===2){var Dr=wr;H($i,(Dr=Dr!==ar?Pi.prev(Dr):null)?Dr.key:null,Rr),H(ii,$i,Rr)}}else Pr=wr=Pi.find(ii=ii.otherEvent),wr&&Pr&&(wr=wr!==ar?Pi.prev(wr):null,Pr=Pi.next(Pr),Pi.remove(ii),Pr&&wr&&Nt(wr.key,Pr.key,Fi))}return dr}(Ft,0,0,wt,bt,Ze)),zi=[],Oi=0;Oi<ri.length;Oi++){var Si=ri[Oi];if(Si.isExterior()){for(var or=[Si.points],br=0;br<Si.holeIds.length;br++)or.push(ri[Si.holeIds[br]].points);zi.push(or)}}return zi}var Ir={UNION:L,DIFFERENCE:z,INTERSECTION:P,XOR:B};i.diff=function(ie,se){return pr(ie,se,z)},i.intersection=function(ie,se){return pr(ie,se,P)},i.operations=Ir,i.union=function(ie,se){return pr(ie,se,L)},i.xor=function(ie,se){return pr(ie,se,B)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,t1.exports)),t1.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function L_(r,e,i,o){const l=[],d=o===0?(f,g,x,w,A,I)=>{f.push(new gt(I,x+(I-g)/(w-g)*(A-x)))}:(f,g,x,w,A,I)=>{f.push(new gt(g+(I-x)/(A-x)*(w-g),I))};for(const f of r){const g=[];for(const x of f){if(x.length<=2)continue;const w=[];for(let P=0;P<x.length-1;P++){const L=x[P].x,z=x[P].y,B=x[P+1].x,H=x[P+1].y,Z=o===0?L:z,te=o===0?B:H;Z<e?te>e&&d(w,L,z,B,H,e):Z>i?te<i&&d(w,L,z,B,H,i):w.push(x[P]),te<e&&Z>=e&&d(w,L,z,B,H,e),te>i&&Z<=i&&d(w,L,z,B,H,i)}let A=x[x.length-1];const I=o===0?A.x:A.y;I>=e&&I<=i&&w.push(A),w.length&&(A=w[w.length-1],w[0].x===A.x&&w[0].y===A.y||w.push(w[0]),g.push(w))}g.length&&l.push(g)}return l}function gC(r,e){const i=vv(r),o=vv([e]),l=i1.intersection(i,o);return l==null?[]:r1(l)}function yC(r,e){let o=vv(r,65536);for(;e.valid();e.next()){const[l,d]=e.get(),f=l.x*65536,g=l.y*65536,x=d.x*65536,w=d.y*65536,A=x-f,I=w-g,P=Math.hypot(A,I),L=Math.trunc(I/P*3),z=-Math.trunc(A/P*3);o=i1.diff(o,[[[f,g],[x,w],[x+L,w+z],[f+L,g+z],[f,g]]])}return r1(o,1/65536)}function vv(r,e=1){return[r.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function r1(r,e=1){return r.map(i=>i.map((o,l)=>{const d=o.map(f=>new gt(f[0]*e,f[1]*e).round());return l>0&&d.reverse(),d}))}class xv{constructor(e,i){this.layoutVertexArray=new Fo,this.indexArray=new Mn,this.lineIndexArray=new fa,this.triangleSegments=new $r,this.lineSegments=new $r,this.programConfigurations=new Ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ul)}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,QI.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,eC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,l,d,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,d,f)}}class bv{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new xv(e,!1),this.elevationBufferData=new xv(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=dv("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:x,index:w,sourceLayerIndex:A}of e){const I=this.layers[0]._featureFilter.needGeometry,P=Ut(g,I);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),P,o))continue;const L=d?d.evaluate(P,{},o,i.availableImages):void 0,z={id:x,properties:g.properties,type:g.type,sourceLayerIndex:A,index:w,geometry:I?P.geometry:Rt(g,o,l),patterns:{},sortKey:L};f.push(z)}d&&f.sort((g,x)=>g.sortKey-x.sortKey);for(const g of f){const{geometry:x,index:w,sourceLayerIndex:A}=g;if(this.hasPattern){const I=fv("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(I)}else this.addFeature(g,x,w,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[w].feature,x,w,A,this.index)}}update(e,i,o,l,d,f,g){this.bufferData.update(e,i,o,l,d,f,g),this.elevationBufferData.update(e,i,o,l,d,f,g)}addFeatures(e,i,o,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,l,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,l,d,f=[],g,x){const w=D_(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,w,l,o,x):this.addGeometry(w,this.bufferData),this.bufferData.populatePaintArrays(e,o,d,f,l,g),this.elevationBufferData.populatePaintArrays(e,o,d,f,l,g)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,o,l,d){const f=new Array,g=yv.getElevationFeature(e,d);if(g){{const x=this.clipPolygonsToTile(i,1);x.length>0&&f.push({polygons:x,elevationFeature:g,elevationTileID:o})}for(const x of f)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new qs(x.elevationTileID));const A=x.elevationFeature.isTunnel();let I=0;e.properties.hasOwnProperty(Xb)&&(I=+e.properties[Xb]);for(const P of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,P,A,x.elevationFeature,I)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const w=new Jb(o,x.elevationTileID);this.addElevatedGeometry(x.polygons,w,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,l)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,o,l,d){const f={elevation:o,elevationSampler:i,bias:l,index:d},[g,x]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:g,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,g),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,i,o){let l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=null;o&&(f=o.elevationSampler.constantElevation(o.elevation,o.bias),f!=null&&(l=f,d=f));const g=(x,w,A)=>{if(o!=null)if(w.push(x),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),A.push(f);else{const I=o.elevationSampler.pointElevation(x,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(I),A.push(I),l=Math.min(l,I),d=Math.max(d,I)}};for(const x of e){let w=0;for(const J of x)w+=J.length;const A=i.triangleSegments.prepareSegment(w,i.layoutVertexArray,i.indexArray),I=A.vertexLength,P=[],L=[],z=[],B=[],H=[],Z=i.layoutVertexArray.length;for(const J of x){if(J.length===0)continue;J!==x[0]&&L.push(P.length/2);const U=i.lineSegments.prepareSegment(J.length,i.layoutVertexArray,i.lineIndexArray),X=U.vertexLength;o&&H.push(i.layoutVertexArray.length-Z),g(J[0],z,B),i.layoutVertexArray.emplaceBack(J[0].x,J[0].y),i.lineIndexArray.emplaceBack(X+J.length-1,X),P.push(J[0].x),P.push(J[0].y);for(let ee=1;ee<J.length;ee++)g(J[ee],z,B),i.layoutVertexArray.emplaceBack(J[ee].x,J[ee].y),i.lineIndexArray.emplaceBack(X+ee-1,X+ee),P.push(J[ee].x),P.push(J[ee].y);U.vertexLength+=J.length,U.primitiveLength+=J.length}const te=tp(P,L);for(let J=0;J<te.length;J+=3)i.indexArray.emplaceBack(I+te[J],I+te[J+1],I+te[J+2]);if(te.length>0&&o&&this.elevationMode==="hd-road-base"){const J=o.elevation.isTunnel(),U=o.elevation.safeArea,X=this.elevatedStructures.addVertices(z,B);this.elevatedStructures.addTriangles(te,X,J);const ee=H.length;if(ee>0){for(let ne=0;ne<ee-1;ne++)this.elevatedStructures.addRenderableRing(o.index,H[ne]+X,H[ne+1]-H[ne],J,U);this.elevatedStructures.addRenderableRing(o.index,H[ee-1]+X,z.length-H[ee-1],J,U)}}A.vertexLength+=w,A.primitiveLength+=te.length/3}return[l,d]}prepareElevatedPolygons(e,i,o){const l=1/Me(o),d=[];for(const f of e){const g=yC(f,new Yb(i,l));d.push(...g)}return d}clipPolygonsToTile(e,i){const o=-i,l=-i,d=vt+i,f=vt+i;let g=0;const x=[],w=[];for(;g<e.length;g++){const P=e[g],L=tf(P);(L.min.x>=o&&L.max.x<=d&&L.min.y>=l&&L.max.y<=f?x:w).push(P)}if(x.length===e.length)return e;const A=[new gt(o,l),new gt(d,l),new gt(d,f),new gt(o,f),new gt(o,l)],I=x;for(const P of w)I.push(...gC(P,A));return I}}let n1,s1,o1,a1;It(bv,"FillBucket",{omit:["layers","patternFeatures"]}),It(xv,"FillBufferData"),It(qs,"ElevatedStructures");class wv{constructor(e,i,o,l){if(this.triangleCount=i.length/3,this.min=new gt(0,0),this.max=new gt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){const P=e[I];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),f.x=Math.max(f.x,P.x),f.y=Math.max(f.y,P.y)}if(l){const I=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/l);o=Math.max(o,I)}if(o===0)return;this.min=d,this.max=f;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const x=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/x)),this.cellsY=Math.max(1,Math.ceil(g.y/x)),this.xScale=1/x,this.yScale=1/x;const w=[];for(let I=0;I<this.triangleCount;I++){const P=e[i[3*I+0]].sub(this.min),L=e[i[3*I+1]].sub(this.min),z=e[i[3*I+2]].sub(this.min),B=ga(Math.floor(Math.min(P.x,L.x,z.x)),this.xScale,this.cellsX),H=ga(Math.floor(Math.max(P.x,L.x,z.x)),this.xScale,this.cellsX),Z=ga(Math.floor(Math.min(P.y,L.y,z.y)),this.yScale,this.cellsY),te=ga(Math.floor(Math.max(P.y,L.y,z.y)),this.yScale,this.cellsY),J=new gt(0,0),U=new gt(0,0),X=new gt(0,0),ee=new gt(0,0);for(let ne=Z;ne<=te;++ne){J.y=U.y=ne*x,X.y=ee.y=(ne+1)*x;for(let me=B;me<=H;++me)J.x=X.x=me*x,U.x=ee.x=(me+1)*x,(Br(P,L,z,J,U,ee)||Br(P,L,z,J,ee,X))&&w.push({cellIdx:ne*this.cellsX+me,triIdx:I})}}if(w.length===0)return;w.sort((I,P)=>I.cellIdx-P.cellIdx||I.triIdx-P.triIdx);let A=0;for(;A<w.length;){const I=w[A].cellIdx,P={start:this.payload.length,len:0};for(;A<w.length&&w[A].cellIdx===I;)++P.len,this.payload.push(w[A++].triIdx);this.cells[I]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=ga(e.x-this.min.x,this.xScale,this.cellsX),l=ga(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[l*this.cellsX+o];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const g=this.payload[d.start+f],x=Math.floor(g/8),w=1<<g%8;if(!(this.lookup[x]&w)&&(this.lookup[x]|=w,i.push(g),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const l=ga(e.x-this.min.x,this.xScale,this.cellsX),d=ga(i.x-this.min.x,this.xScale,this.cellsX),f=ga(e.y-this.min.y,this.yScale,this.cellsY),g=ga(i.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=g;x++)for(let w=l;w<=d;w++){const A=this.cells[x*this.cellsX+w];if(A)for(let I=0;I<A.len;I++){const P=this.payload[A.start+I],L=Math.floor(P/8),z=1<<P%8;if(!(this.lookup[L]&z)&&(this.lookup[L]|=z,o.push(P),o.length===this.triangleCount))return}}}}function ga(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}It(wv,"TriangleGridIndex");class l1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,l){const d=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const A=this.layers[0]._featureFilter.needGeometry,I=Ut(f,A);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),I,o))continue;const P={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:A?I.geometry:Rt(f,o,l),patterns:{}};d.push(P)}for(const f of d){const{geometry:g,index:x,sourceLayerIndex:w}=f;this.addFeature(f,g,x,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[x].feature,g,x,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,l,d,f,g){}destroy(){}addFeature(e,i,o,l,d,f=[],g){for(const x of D_(i,2)){const w=[],A=[],I=[],P=new gt(1/0,1/0),L=new gt(-1/0,-1/0);for(const H of x)if(H.length!==0){H!==x[0]&&I.push(A.length/2);for(let Z=0;Z<H.length;Z++)A.push(H[Z].x),A.push(H[Z].y),w.push(H[Z]),P.x=Math.min(P.x,H[Z].x),P.y=Math.min(P.y,H[Z].y),L.x=Math.max(L.x,H[Z].x),L.y=Math.max(L.y,H[Z].y)}const z=tp(A,I),B=new wv(w,z,8,256);this.footprints.push({vertices:w,indices:z,grid:B,min:P,max:L})}}}It(l1,"ClipBucket",{omit:["layers"]});const vC=Ki([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xC=Ki([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),bC=Ki([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wC=Ki([{name:"a_join_normal_inside",components:3,type:"Int16"}]),TC=Ki([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),SC=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:EC}=vC,z_=Number.MAX_SAFE_INTEGER;function c1(r,e,i,o){return r.order<e||r.order===z_||!(r.clipMask&i)||function(l,d){return d.length!==0&&d.find(f=>f===l)===void 0}(o,r.clipScope)}function O_(r,e){return r.x-e.x||r.y-e.y}function u1(r,e){return O_(r.min,e.min)===0&&O_(r.max,e.max)===0}function Tv(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Sv(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!u1(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!Po(r[i].clipScope,e[i].clipScope))return!1;return!0}function h1(r,e,i){const o=1/vt,l=1/(1<<i.canonical.z),d=(e.x*o+i.canonical.x)*l+i.wrap,f=(e.y*o+i.canonical.y)*l;return{min:new gt((r.x*o+i.canonical.x)*l+i.wrap,(r.y*o+i.canonical.y)*l),max:new gt(d,f)}}function AC(r,e,i){const o=1<<i.canonical.z,l=((e.x-i.wrap)*o-i.canonical.x)*vt,d=(e.y*o-i.canonical.y)*vt;return{min:new gt(((r.x-i.wrap)*o-i.canonical.x)*vt,(r.y*o-i.canonical.y)*vt),max:new gt(l,d)}}function d1(r,e,i,o,l,d,f){const g=r.indices,x=r.vertices,w=[];for(let A=o;A<o+l;A+=3){const I=e[i[A+0]+d],P=e[i[A+1]+d],L=e[i[A+2]+d],z=Math.min(I.x,P.x,L.x),B=Math.max(I.x,P.x,L.x),H=Math.min(I.y,P.y,L.y),Z=Math.max(I.y,P.y,L.y);w.length=0,r.grid.query(new gt(z,H),new gt(B,Z),w);for(let te=0;te<w.length;te++){const J=w[te];if(Br(x[g[3*J+0]],x[g[3*J+1]],x[g[3*J+2]],I,P,L,f))return!0}}return!1}function f1(r,e,i,o){if(!r||!i)return!1;let l=r.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<r.vertices.length)return f1(i,o,r,e);const d=e.canonical,f=o.canonical,g=Math.pow(2,f.z-d.z);l=r.vertices.map(x=>new gt((x.x+d.x*vt)*g-f.x*vt,(x.y+d.y*vt)*g-f.y*vt))}return d1(i,l,r.indices,0,r.indices.length,0,0)}function p1(r,e,i,o){const l=Math.pow(2,o.z-i.z);return new gt((r+i.x*vt)*l-o.x*vt,(e+i.y*vt)*l-o.y*vt)}function m1(r,e){const i=[];e.grid.queryPoint(r,i);const o=e.indices,l=e.vertices;for(let d=0;d<i.length;d++){const f=i[d];if(hr([l[o[3*f+0]],l[o[3*f+1]],l[o[3*f+2]]],r))return!0}return!1}const Ev=[new gt(0,0),new gt(vt,0),new gt(vt,vt),new gt(0,vt)];function _1(r,e){const i=[];let o=[];if(!e||r.length<2)return[r];if(r.length===2)return Qr(r[0],r[1],Ev)?[r]:[];for(let l=0;l<r.length+2;l++){const d=r[l%r.length],f=r[(l+1)%r.length],g=Qr(l===0?r[r.length-1]:r[(l-1)%r.length],d,Ev),x=Qr(d,f,Ev),w=g||x;w&&o.push(d),w&&x||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const Av=Yl.VectorTileFeature.types,IC=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],CC=["fill-extrusion-flood-light-ground-radius"],PC=Math.pow(2,13),MC=Math.pow(2,15)-1,g1=new gt(0,1),Jl=2147483648;function op(r,e,i,o,l,d,f,g){r.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(o*PC)<<1)+l,Math.round(g))}function ap(r,e,i){r.emplaceBack(e.x*vt,e.y*vt,i?1:0)}function F_(r,e,i,o,l,d){r.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+l,d)}function lp(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class y1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class v1{constructor(){this.centroidXY=new gt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new gt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new gt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new gt(this.max.x-this.min.x,this.max.y-this.min.y)}}class x1{constructor(){this.acc=new gt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===vt)&&i.x===o.x)!=((i.y===0||i.y===vt)&&i.y===o.y)&&this.processBorderOverlap(i,o),l&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Kt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>vt!=e.x>vt&&this.addBorderIntersection(1,Kt(i.y,e.y,(vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Kt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>vt!=e.y>vt&&this.addBorderIntersection(3,Kt(i.x,e.x,(vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new gt(0,0):new gt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function b1(r,e){const i=r.add(e)._unit(),o=Ae(r.x*i.x+r.y*i.y,-1,1);var l,d,f;return l=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(l)))/4*MC*((d=r).x*(f=e).y-d.y*f.x<0?-1:1)}const RC=[r=>r.x<0,r=>r.x>vt,r=>r.y<0,r=>r.y>vt];function DC(r,e,i,o){const l=[4];if(o===0)return l;i._mult(o);const d=r.sub(i),f=e.sub(i),g=[r,e,d,f];for(let x=0;x<4;x++)for(const w of g)if(RC[x](w)){l.push(x);break}return l}class w1{constructor(e){this.vertexArray=new Uf,this.indexArray=new Mn,this.programConfigurations=new Ja(e.layers,{zoom:e.zoom,lut:e.lut},i=>CC.includes(i)),this._segments=new $r,this.hiddenByLandmarkVertexArray=new $h,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $r}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,l=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const w=e[0],A=e[1];x=b1(w.sub(e[d-1])._perp()._unit(),A.sub(w)._perp()._unit())}for(let w=0;w<d;w++){const A=w===d-1?0:w+1,I=e[w],P=e[A],L=e[A===d-1?0:A+1],z=P.sub(I)._perp()._unit(),B=b1(z,L.sub(P)._perp()._unit()),H=x,Z=B;if(Iv(I,P,i)||l&&E1(I,i)&&E1(P,i)){x=B;continue}const te=g.vertexLength;F_(this.vertexArray,I,P,1,1,H),F_(this.vertexArray,I,P,1,0,H),F_(this.vertexArray,I,P,0,1,Z),F_(this.vertexArray,I,P,0,0,Z),g.vertexLength+=4;const J=DC(I,P,z,o);for(const U of J)this._segmentToGroundQuads[f].push({id:te,region:U}),this._segmentToRegionTriCounts[f][U]+=2,g.primitiveLength+=2;x=B}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((l,d)=>l.region-d.region);for(let o=0;o<i;o++){const l=this._segmentToGroundQuads[o],d=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((x,w)=>x+w,0);let g=0;for(let x=0;x<=4;x++){const w=f[x];if(w!==0){let A=this.regionSegments[x];A||(A=this.regionSegments[x]=new $r);const I={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+g,vertexLength:d.vertexLength,primitiveLength:w};A.get().push(I)}g+=w}for(let x=0;x<l.length;x++){const w=l[x].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,l,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,l,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,xC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,l,d,f,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,l,d,f,g)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Jl?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,TC.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class B_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Mn,this.footprintVertices=new Fo,this.footprintSegments=[],this.layoutVertexArray=new Xa,this.centroidVertexArray=new x_,this.wallVertexArray=new w_,this.indexArray=new Mn,this.programConfigurations=new Ja(e.layers,{zoom:e.zoom,lut:e.lut},i=>IC.includes(i)),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new w1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,l){this.features=[],this.hasPattern=dv("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Me(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:f,index:g,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,A=Ut(d,w);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),A,o))continue;const I={id:f,sourceLayerIndex:x,index:g,geometry:w?A.geometry:Rt(d,o,l),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,L=Av[I.type]==="Polygon";if(this.hasPattern)this.features.push(fv("fill-extrusion",this.layers,I,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const z of I.geometry)for(const B of _1(z,L))this.addFeature(I,[B],g,o,{},i.availableImages,l,i.brightness);else this.addFeature(I,I.geometry,g,o,{},i.availableImages,l,i.brightness);i.featureIndex.insert(d,I.geometry,g,x,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,l,d,f){for(const g of this.features){const x=Av[g.type]==="Polygon",{geometry:w}=g;if(this.wallMode)for(const A of w)for(const I of _1(A,x))this.addFeature(g,[I],g.index,i,o,l,d,f);else this.addFeature(g,w,g.index,i,o,l,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g),this.groundEffect.update(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EC),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,wC.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,SC.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,bC.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,l,d,f,g,x){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,A=[new gt(0,0),new gt(vt,vt)],I=g.projection,P=I.name==="globe",L=this.wallMode||Av[e.type]==="Polygon",z=new x1;z.centroidDataIndex=this.centroidData.length;const B=new v1,H=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,Z=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);let te;if(B.height=Z,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ka),this.wallMode){if(P)return void ki("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;te=function(Se){const Pe=Se[0].x===Se[Se.length-1].x&&Se[0].y===Se[Se.length-1].y;(function(xt){let ct=0;const ci=xt.length;for(let zt=0;zt<ci;zt++)ct+=(xt[(zt+1)%ci].x-xt[zt].x)*(xt[(zt+1)%ci].y+xt[zt].y);return ct>=0})(Se)||(Se=Se.reverse());const nt={geometry:[],joinNormals:[],indices:[]},et=[],rt=[],lt=[];let je=Se.length;for(;je>=2&&Se[je-1].equals(Se[je-2]);)je--;if(je<(Pe?3:2))return nt;let it,Ne,Ge,ut,dt,Nt=0;for(;Nt<je-1&&Se[Nt].equals(Se[Nt+1]);)Nt++;Pe&&(it=Se[je-2],dt=Se[Nt].sub(it)._unit()._perp());for(let xt=Nt;xt<je;xt++){if(Ge=xt===je-1?Pe?Se[Nt+1]:void 0:Se[xt+1],Ge&&Se[xt].equals(Ge))continue;dt&&(ut=dt),it&&(Ne=it),it=Se[xt],dt=Ge?Ge.sub(it)._unit()._perp():ut,ut=ut||dt;let ct=ut.add(dt);ct.x===0&&ct.y===0||ct._unit();const ci=ct.x*dt.x+ct.y*dt.y,zt=ci!==0?1/ci:1/0,Ot=ut.x*dt.y-ut.y*dt.x>0;let oi="miter";const yi=2;oi==="miter"&&zt>yi&&(oi="bevel"),oi==="bevel"&&(zt>100&&(oi="flipbevel"),zt<yi&&(oi="miter"));const bi=(Mi,Ai,Ti,pr)=>{const Ir=new gt(Mi.x,Mi.y),ie=new gt(Mi.x,Mi.y);Ir.x+=Ai.x*pr,Ir.y+=Ai.y*pr,ie.x-=Ai.x*Math.max(Ti,1),ie.y-=Ai.y*Math.max(Ti,1),lt.push(Ai),et.push(Ir),rt.push(ie)};if(oi==="miter")ct._mult(zt),bi(it,ct,0,0);else if(oi==="flipbevel")ct=dt.mult(-1),bi(it,ct,0,0),bi(it,ct.mult(-1),0,0);else{const Mi=-Math.sqrt(zt*zt-1),Ai=Ot?Mi:0,Ti=Ot?0:Mi;Ne&&bi(it,ut,Ai,Ti),Ge&&bi(it,dt,Ai,Ti)}}nt.geometry=[...et,...rt.reverse(),et[0]],nt.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]];const Mt=nt.geometry.length-1;for(let xt=0;xt<Mt/2;xt++)if(xt+1<Mt/2){let ct=xt,ci=xt+1,zt=Mt-1-xt,Ot=Mt-2-xt;ct=ct===0?Mt-1:ct-1,ci=ci===0?Mt-1:ci-1,zt=zt===0?Mt-1:zt-1,Ot=Ot===0?Mt-1:Ot-1,nt.indices.push(zt),nt.indices.push(ci),nt.indices.push(ct),nt.indices.push(zt),nt.indices.push(Ot),nt.indices.push(ci)}return nt}(i[0]),i=[te.geometry]}const J=(Se,Pe)=>Se<(Pe.length-1)/2||Se===Pe.length-1,U=this.wallMode?[i]:D_(i,500);for(let Se=U.length-1;Se>=0;Se--){const Pe=U[Se];(Pe.length===0||(X=Pe[0]).every(He=>He.x<=0)||X.every(He=>He.x>=vt)||X.every(He=>He.y<=0)||X.every(He=>He.y>=vt))&&U.splice(Se,1)}var X;let ee;if(P)ee=P1(U,A,l);else{ee=[];for(const Se of U)ee.push({polygon:Se,bounds:A})}const ne=L?this.edgeRadius:0,me=ne>0&&this.zoom<17,xe=(Se,Pe)=>{if(Se.length===0)return!1;const He=Se[Se.length-1];return Pe.x===He.x&&Pe.y===He.y};for(const{polygon:Se,bounds:Pe}of ee){let He=0,nt=0;for(const je of Se)L&&!je[0].equals(je[je.length-1])&&je.push(je[0]),nt+=L?je.length-1:je.length;const et=this.segments.prepareSegment((L?5:4)*nt,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new y1;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],L){const je=[],it=[];He=et.vertexLength;for(let Ge=0;Ge<Se.length;Ge++){const ut=Se[Ge];ut.length&&Ge!==0&&it.push(je.length/2);const dt=[];let Nt,Mt;Nt=ut[1].sub(ut[0])._perp()._unit(),lt.ringIndices.push(ut.length-1);for(let xt=1;xt<ut.length;xt++){const ct=ut[xt],ci=ut[xt===ut.length-1?1:xt+1],zt=ct.clone();if(ne){Mt=ci.sub(ct)._perp()._unit();const Ot=Nt.add(Mt)._unit(),oi=ne*Math.min(4,1/(Nt.x*Ot.x+Nt.y*Ot.y));zt.x+=oi*Ot.x,zt.y+=oi*Ot.y,zt.x=Math.round(zt.x),zt.y=Math.round(zt.y),Nt=Mt}if(!H||ne!==0&&!me||xe(dt,zt)||dt.push(zt),op(this.layoutVertexArray,zt.x,zt.y,0,0,1,1,0),this.wallMode){const Ot=J(xt,ut);ap(this.wallVertexArray,te.joinNormals[xt],!Ot)}et.vertexLength++,this.footprintVertices.emplaceBack(ct.x,ct.y),je.push(ct.x,ct.y),P&&lp(this.layoutVertexExtArray,I.projectTilePoint(zt.x,zt.y,l),I.upVector(l,zt.x,zt.y))}H&&(ne===0||me)&&(dt.length!==0&&xe(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Pe,w))}const Ne=this.wallMode?te.indices:tp(je,it);for(let Ge=0;Ge<Ne.length;Ge+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+Ne[Ge+0],lt.vertexOffset+Ne[Ge+1],lt.vertexOffset+Ne[Ge+2]),this.indexArray.emplaceBack(He+Ne[Ge],He+Ne[Ge+2],He+Ne[Ge+1]),et.primitiveLength++;lt.indexCount+=Ne.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let je=0;je<Se.length;je++){const it=Se[je];z.startRing(B,it[0]);let Ne=it.length>4&&A1(it[it.length-2],it[0],it[1]),Ge=ne?kC(it[it.length-2],it[0],it[1],ne):0;const ut=[];let dt,Nt,Mt;Nt=it[1].sub(it[0])._perp()._unit();let xt=!0;for(let ct=1,ci=0;ct<it.length;ct++){let zt=it[ct-1],Ot=it[ct];const oi=it[ct===it.length-1?1:ct+1];if(z.appendEdge(B,Ot,zt),Iv(Ot,zt,Pe)){ne&&(Nt=oi.sub(Ot)._perp()._unit(),xt=!xt);continue}const yi=Ot.sub(zt)._perp(),bi=yi.x/(Math.abs(yi.x)+Math.abs(yi.y)),Mi=yi.y>0?1:0,Ai=zt.dist(Ot);if(ci+Ai>32768&&(ci=0),ne){Mt=oi.sub(Ot)._perp()._unit();let ie=S1(zt,Ot,oi,T1(Nt,Mt),ne);isNaN(ie)&&(ie=0);const se=Ot.sub(zt)._unit();zt=zt.add(se.mult(Ge))._round(),Ot=Ot.add(se.mult(-ie))._round(),Ge=ie,Nt=Mt,H&&this.zoom>=17&&(xe(ut,zt)||ut.push(zt),xe(ut,Ot)||ut.push(Ot))}const Ti=et.vertexLength,pr=it.length>4&&A1(zt,Ot,oi);let Ir=I1(ci,Ne,xt);if(op(this.layoutVertexArray,zt.x,zt.y,bi,Mi,0,0,Ir),op(this.layoutVertexArray,zt.x,zt.y,bi,Mi,0,1,Ir),this.wallMode){const ie=J(ct-1,it),se=te.joinNormals[ct-1];ap(this.wallVertexArray,se,ie),ap(this.wallVertexArray,se,ie)}if(ci+=Ai,Ir=I1(ci,pr,!xt),Ne=pr,op(this.layoutVertexArray,Ot.x,Ot.y,bi,Mi,0,0,Ir),op(this.layoutVertexArray,Ot.x,Ot.y,bi,Mi,0,1,Ir),this.wallMode){const ie=J(ct,it),se=te.joinNormals[ct];ap(this.wallVertexArray,se,ie),ap(this.wallVertexArray,se,ie)}if(et.vertexLength+=4,this.indexArray.emplaceBack(Ti+0,Ti+1,Ti+2),this.indexArray.emplaceBack(Ti+1,Ti+3,Ti+2),et.primitiveLength+=2,ne){const ie=He+(ct===1?it.length-2:ct-2),se=ct===1?He:ie+1;if(this.indexArray.emplaceBack(Ti+1,ie,Ti+3),this.indexArray.emplaceBack(ie,se,Ti+3),et.primitiveLength+=2,dt===void 0&&(dt=Ti),!Iv(oi,it[ct],Pe)){const Ze=ct===it.length-1?dt:et.vertexLength;this.indexArray.emplaceBack(Ti+2,Ti+3,Ze),this.indexArray.emplaceBack(Ti+3,Ze+1,Ze),this.indexArray.emplaceBack(Ti+3,se,Ze+1),et.primitiveLength+=3}xt=!xt}if(P){const ie=this.layoutVertexExtArray,se=I.projectTilePoint(zt.x,zt.y,l),Ze=I.projectTilePoint(Ot.x,Ot.y,l),mt=I.upVector(l,zt.x,zt.y),wt=I.upVector(l,Ot.x,Ot.y);lp(ie,se,mt),lp(ie,se,mt),lp(ie,Ze,wt),lp(ie,Ze,wt)}}L&&(He+=it.length-1),H&&ne&&this.zoom>=17&&(ut.length!==0&&xe(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,Pe,w,ne>0))}this.footprintSegments.push(lt),rt.triangleCount=this.indexArray.length-rt.triangleArrayOffset,this.polygonSegments.push(rt),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=z.borders?g1:this.encodeCentroid(z,B),this.centroidData.push(B),z.borders){this.featuresOnBorder.push(z);const Se=this.featuresOnBorder.length-1;for(let Pe=0;Pe<z.borders.length;Pe++)z.borders[Pe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Pe].push(Se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,x),this.groundEffect.addPaintPropertiesData(e,o,d,f,l,x),this.maxHeight=Math.max(this.maxHeight,Z)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const x=this.centroidData[g],w=+(x.min.y+x.max.y>vt),A=2*w+(+(x.min.x+x.max.x>vt)^w);for(let I=0;I<x.polygonSegLen;I++){const P=x.polygonSegIdx+I;e.push({centroidIdx:g,subtile:A,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new Mn;e.sort((g,x)=>g.triangleSegmentIdx===x.triangleSegmentIdx?g.subtile-x.subtile:g.triangleSegmentIdx-x.triangleSegmentIdx);let o=0,l=0,d=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;d++}const f=e.length;for(;l!==e.length;){o=e[l].triangleSegmentIdx;let g=0,x=l,w=l;for(let A=x;A<d&&e[A].subtile===g;A++)w++;for(;x!==d;){const A=e[x];g=A.subtile;const I=this.centroidData[A.centroidIdx].min.clone(),P=this.centroidData[A.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=x;z<w;z++){const B=e[z],H=this.polygonSegments[B.polygonSegmentIdx],Z=this.centroidData[B.centroidIdx].min,te=this.centroidData[B.centroidIdx].max,J=this.indexArray.uint16;for(let U=H.triangleArrayOffset;U<H.triangleArrayOffset+H.triangleCount;U++)i.emplaceBack(J[3*U],J[3*U+1],J[3*U+2]);L.primitiveLength+=H.triangleCount,I.x=Math.min(I.x,Z.x),I.y=Math.min(I.y,Z.y),P.x=Math.max(P.x,te.x),P.y=Math.max(P.y,te.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:I,max:P}),x=w;for(let z=x;z<d&&e[z].subtile===e[x].subtile;z++)w++}l=d;for(let A=l;A<f&&e[A].triangleSegmentIdx===e[l].triangleSegmentIdx;A++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const l=new $r;if(this.wallMode){for(const B of this.triangleSubSegments)l.segments.push(B.segment);return l}let d=0,f=0;const g=1<<e.canonical.z;if(i){const B=i.getMinMaxForTile(e);B&&(d=B.min,f=B.max)}f+=this.maxHeight;const x=e.toUnwrapped();let w;const A=[x.canonical.x/g+x.wrap,x.canonical.y/g],I=[(x.canonical.x+1)/g+x.wrap,(x.canonical.y+1)/g],P=(B,H,Z)=>[B[0]*(1-Z[0])+H[0]*Z[0],B[1]*(1-Z[1])+H[1]*Z[1]],L=[],z=[];for(const B of this.triangleSubSegments){L[0]=B.min.x/vt,L[1]=B.min.y/vt,z[0]=B.max.x/vt,z[1]=B.max.y/vt;const H=P(A,I,L),Z=P(A,I,z);if(new zr([H[0],H[1],d],[Z[0],Z[1],f]).intersectsPrecise(o)===0){w&&(l.segments.push(w),w=void 0);continue}const te=B.segment;w&&w.vertexOffset!==te.vertexOffset&&(l.segments.push(w),w=void 0),w?(w.vertexLength+=te.vertexLength,w.primitiveLength+=te.primitiveLength):w={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&l.segments.push(w),l}encodeCentroid(e,i){const o=e.centroid(),l=i.span(),d=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new gt(Ae(o.x,1,vt-1)<<3|d,Ae(o.y,1,vt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new gt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const l=i[0][0]!==o?0:1;return new gt(6|(i[0][0]!==o?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==o?2:3;return new gt((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Jl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,l=e.flags&Jl?g1:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||d!==l.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(Sv(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<o)continue;const g=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const x of this.centroidData)if(!(x.flags&Jl||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let w=0;w<x.footprintSegLen;w++){const A=this.footprintSegments[x.footprintSegIdx+w];if(d.length=0,LC(this.footprintVertices,A.vertexOffset,A.vertexCount,f.footprintTileId.canonical,e.canonical,d),d1(f.footprint,d,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-g)){x.flags|=Jl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let l=!1;for(let d=0;d<o.footprintSegLen;d++){const f=this.footprintSegments[o.footprintSegIdx+d];let g=0;for(const x of f.ringIndices){for(let w=g,A=x+g-1;w<x+g;A=w++){const I=this.footprintVertices.int16[2*(w+f.vertexOffset)+0],P=this.footprintVertices.int16[2*(w+f.vertexOffset)+1],L=this.footprintVertices.int16[2*(A+f.vertexOffset)+1];P>i!=L>i&&e<(this.footprintVertices.int16[2*(A+f.vertexOffset)+0]-I)*(i-P)/(L-P)+I&&(l=!l)}g=x}}return l}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,l=!0;const d=4*(e+vt)*vt+(i+vt);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&Jl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[d]=f,l=!!(f.flags&Jl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:l};this.partLookup[d]=void 0}}function T1(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function kC(r,e,i,o){const l=e.sub(r)._perp()._unit(),d=i.sub(e)._perp()._unit();return S1(r,e,i,T1(l,d),o)}function S1(r,e,i,o,l){const d=Math.sqrt(1-o*o);return Math.min(r.dist(e)/3,e.dist(i)/3,l*d/o)}function Iv(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function E1(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function A1(r,e,i){if(r.x<0||r.x>=vt||e.x<0||e.x>=vt||i.x<0||i.x>=vt)return!1;const o=i.sub(e),l=o.perp(),d=r.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function I1(r,e,i){const o=e?2|r:-3&r;return i?1|o:-2&o}function C1(){const r=Math.PI/32,e=Math.tan(r),i=V;return i*Math.sqrt(1+2*e*e)-i}function P1(r,e,i){const o=1<<i.z,l=_e(i.x/o),d=_e((i.x+1)/o),f=ge(i.y/o),g=ge((i.y+1)/o);return function(x,w,A,I,P=0,L){const z=[];if(!x.length||!A||!I)return z;const B=(ee,ne)=>{for(const me of ee)z.push({polygon:me,bounds:ne})},H=Math.ceil(Math.log2(A)),Z=Math.ceil(Math.log2(I)),te=H-Z,J=[];for(let ee=0;ee<Math.abs(te);ee++)J.push(te>0?0:1);for(let ee=0;ee<Math.min(H,Z);ee++)J.push(0),J.push(1);let U=x;if(U=L_(U,w[0].y-P,w[1].y+P,1),U=L_(U,w[0].x-P,w[1].x+P,0),!U.length)return z;const X=[];for(J.length?X.push({polygons:U,bounds:w,depth:0}):B(U,w);X.length;){const ee=X.pop(),ne=ee.depth,me=J[ne],xe=ee.bounds[0],Se=ee.bounds[1],Pe=me===0?xe.x:xe.y,He=me===0?Se.x:Se.y,nt=L?L(me,Pe,He):.5*(Pe+He),et=L_(ee.polygons,Pe-P,nt+P,me),rt=L_(ee.polygons,nt-P,He+P,me);if(et.length){const lt=[xe,new gt(me===0?nt:Se.x,me===1?nt:Se.y)];J.length>ne+1?X.push({polygons:et,bounds:lt,depth:ne+1}):B(et,lt)}if(rt.length){const lt=[new gt(me===0?nt:xe.x,me===1?nt:xe.y),Se];J.length>ne+1?X.push({polygons:rt,bounds:lt,depth:ne+1}):B(rt,lt)}}return z}(r,e,Math.ceil((d-l)/11.25),Math.ceil((f-g)/11.25),1,(x,w,A)=>{if(x===0)return .5*(w+A);{const I=ge((i.y+w/vt)/o);return(he(.5*(ge((i.y+A/vt)/o)+I))*o-i.y)*vt}})}function LC(r,e,i,o,l,d){const f=Math.pow(2,o.z-l.z);for(let g=0;g<i;g++){let x=r.int16[2*(g+e)+0],w=r.int16[2*(g+e)+1];x=(x+l.x*vt)*f-o.x*vt,w=(w+l.y*vt)*f-o.y*vt,d.push(new gt(x,w))}}let M1,R1;It(B_,"FillExtrusionBucket",{omit:["layers","features"]}),It(v1,"PartData"),It(y1,"FootprintSegment"),It(x1,"BorderCentroidData"),It(w1,"GroundEffect");class vu extends gt{constructor(e,i,o){super(e,i),this.z=o}}class D1 extends vu{constructor(e,i,o,l){super(e,i,o),this.w=l}}function k1(r,e,i,o){const l=i==="x"?"y":"x",d=(o-r[i])/(e[i]-r[i]);r[l]=Math.round(r[l]+(e[l]-r[l])*d),r[i]=o,r.hasOwnProperty("z")&&(r.z=Kt(r.z,e.z,d)),r.hasOwnProperty("w")&&(r.w=Kt(r.w,e.w,d))}function L1(r,e,i,o){const l=i,d=o;for(const f of["x","y"]){let g=r,x=e;g[f]>=x[f]&&(g=e,x=r),g[f]<l&&x[f]>l&&k1(g,x,f,l),g[f]<d&&x[f]>d&&k1(x,g,f,d)}}function N_(r,e,i,o,l,d){const f=[];for(let g=0;g<r.length;g++){const x=r[g];let w;const A=f.length;let I=0;for(let P=0;P<x.length-1;P++){let L=x[P],z=x[P+1],B=0;const H=I;let Z,te;d&&(B=Math.hypot(z.x-L.x,z.y-L.y),I+=B,Z=L,te=z),L.x<e&&z.x<e||(L.x<e?L=new gt(e,L.y+(e-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<e&&(z=new gt(e,L.y+(e-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<i&&z.y<i||(L.y<i?L=new gt(L.x+(i-L.y)/(z.y-L.y)*(z.x-L.x),i)._round():z.y<i&&(z=new gt(L.x+(i-L.y)/(z.y-L.y)*(z.x-L.x),i)._round()),L.x>=o&&z.x>=o||(L.x>=o?L=new gt(o,L.y+(o-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=o&&(z=new gt(o,L.y+(o-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=l&&z.y>=l||(L.y>=l?L=new gt(L.x+(l-L.y)/(z.y-L.y)*(z.x-L.x),l)._round():z.y>=l&&(z=new gt(L.x+(l-L.y)/(z.y-L.y)*(z.x-L.x),l)._round()),w&&L.equals(w[w.length-1])||(w=[L],f.push(w),d&&d.push({progress:{min:H+z1(Z,te,L)*B,max:1},parentIndex:g,prevPoint:Z,nextPoint:te})),w.push(z),d&&(d[d.length-1].progress.max=H+z1(Z,te,z)*B,d[d.length-1].nextPoint=te)))))}if(d&&I>0)for(let P=A;P<f.length;P++)d[P].progress.min/=I,d[P].progress.max/=I}return f}function zC(r,e,i,o,l){if(r.length<2)return void o.push(r);const d=[];for(;e.valid();){const[w,A]=e.get();for(let I=0;I<r.length-1;I++){const P=r[I],L=r[I+1],z=Ur(P,L,w,A);if(z){const[B]=z,H=new gt(Kt(P.x,L.x,B),Kt(P.y,L.y,B));d.push({t:I+B,distance:0,point:H})}}e.next()}if(d.length===0)return void o.push(r);d.sort((w,A)=>w.t-A.t);let f=0,g=0,x=[];for(o.push(x);f!==r.length;){if(g===d.length){for(;f!==r.length;)x.length!==0&&x[x.length-1].equals(r[f])||x.push(r[f]),f++;break}d[g].t<=f?(x.length!==0&&x[x.length-1].equals(d[g].point)||x.push(d[g].point),Math.trunc(d[g].t),g++):(x.length!==0&&x[x.length-1].equals(r[f])||x.push(r[f]),f++)}}function z1(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function cp(r,e){return r.x*e.x+r.y*e.y}function O1(r,e){if(r.length===1){let i=0;const o=e[i++];let l;for(;!l||o.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const d=e[i],f=r[0],g=l.sub(o),x=d.sub(o),w=f.sub(o),A=cp(g,g),I=cp(g,x),P=cp(x,x),L=cp(w,g),z=cp(w,x),B=A*P-I*I,H=(P*L-I*z)/B,Z=(A*z-I*L)/B,te=o.z*(1-H-Z)+l.z*H+d.z*Z;if(isFinite(te))return te}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function F1(r,e,i,o,l,d,f,g){const x=f*l.getElevationAt(r,e,!0,!0),w=d[0]!==0,A=w?d[1]===0?f*(d[0]/7-450):f*function(I,P,L){const z=Math.floor(P[0]/8),B=Math.floor(P[1]/8),H=10*(P[0]-8*z),Z=10*(P[1]-8*B),te=I.getElevationAt(z,B,!0,!0),J=I.getMeterToDEM(L),U=Math.floor(.5*(H*J-1)),X=Math.floor(.5*(Z*J-1)),ee=I.tileCoordToPixel(z,B),ne=2*U+1,me=2*X+1,xe=function(rt,lt,je,it,Ne){return[rt.getElevationAtPixel(lt,je,!0),rt.getElevationAtPixel(lt+Ne,je,!0),rt.getElevationAtPixel(lt,je+Ne,!0),rt.getElevationAtPixel(lt+it,je+Ne,!0)]}(I,ee.x-U,ee.y-X,ne,me),Se=Math.abs(xe[0]-xe[1]),Pe=Math.abs(xe[2]-xe[3]),He=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),nt=Math.min(.25,.5*J*(Se+Pe)/ne),et=Math.min(.25,.5*J*He/me);return te+Math.max(nt*H,et*Z)}(l,d,g):x;return{base:x+(i===0?-1:i),top:w?Math.max(A+o,x+i+2):x+o}}const OC=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),FC=Ki([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:BC}=OC,NC=Ki([{name:"a_packed",components:3,type:"Float32"}]),{members:UC}=NC,VC=Ki([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:jC}=VC;class B1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Kl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Bt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const l=[];let d=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,g=!0;l.push({left:d,right:f,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){g=!g;const A=e[w];d=x*o,x+=A,f=x*o,l.push({left:d,right:f,isDash:g,zeroLength:A===0})}return l}addRoundDash(e,i,o){const l=i/2;for(let d=-o;d<=o;d++){const f=this.width*(this.nextRow+o+d);let g=0,x=e[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++g]);const A=Math.abs(w-x.left),I=Math.abs(w-x.right),P=Math.min(A,I);let L;const z=d/o*(l+1);if(x.isDash){const B=l-Math.abs(z);L=Math.sqrt(P*P+B*B)}else L=l-Math.sqrt(P*P+z*z);this.image.data[f+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const w=e[x],A=e[x+1];w.zeroLength?e.splice(x,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(x,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const d=this.width*this.nextRow;let f=0,g=e[f];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++f]);const w=Math.abs(x-g.left),A=Math.abs(x-g.right),I=Math.min(w,A);this.image.data[d+x]=Math.max(0,Math.min(255,(g.isDash?I:-I)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const l=i==="round",d=l?7:0,f=2*d+1;if(this.nextRow+f>this.height)return ki("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let A=0;A<e.length;A++)e[A]<0&&(ki("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),g+=e[A];if(g!==0){const A=this.width/g,I=this.getDashRanges(e,this.width,A);l?this.addRoundDash(I,A,d):this.addRegularDash(I,i==="square"?.5*A:0)}const x=this.nextRow+d;this.nextRow+=f;const w={tl:[x,d],br:[g,0]};return this.positions[o]=w,w}}It(B1,"LineAtlas");const $C=Yl.VectorTileFeature.types,GC=Math.cos(Math.PI/180*37.5),HC=Math.cos(Math.PI/180*5);class Cv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Vf,this.layoutVertexArray2=new _o,this.patternVertexArray=new _o,this.indexArray=new Mn,this.programConfigurations=new Ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $r,this.maxLineLength=0,this.zOffsetVertexArray=new _o,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=dv("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Me(o);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const P=this.layers[0].layout.get("line-z-offset"),L=P.isConstant()&&!P.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&f==="none"&&ki(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const x=[];for(const{feature:P,id:L,index:z,sourceLayerIndex:B}of e){const H=this.layers[0]._featureFilter.needGeometry,Z=Ut(P,H);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),Z,o))continue;const te=d?d.evaluate(Z,{},o):void 0,J={id:L,properties:P.properties,type:P.type,sourceLayerIndex:B,index:z,geometry:H?Z.geometry:Rt(P,o,l),patterns:{},sortKey:te};x.push(J)}d&&x.sort((P,L)=>P.sortKey-L.sortKey);const{lineAtlas:w,featureIndex:A}=i,I=this.addConstantDashes(w);for(const P of x){const{geometry:L,index:z,sourceLayerIndex:B}=P;if(I&&this.addFeatureDashes(P,w),this.hasPattern){const H=fv("line",this.layers,P,this.zoom,this.pixelRatio,i);this.patternFeatures.push(H)}else this.addFeature(P,L,z,o,w.positions,i.availableImages,i.brightness,i.elevationFeatures);A.insert(e[z].feature,L,z,B,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,g=l.value;if(!g)continue;e.addDash(g,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let g,x;if(d.kind==="constant"){if(g=d.value,!g)continue}else g=d.evaluate({zoom:o},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(g,x),e.patterns[l.id]=[i.getKey(g,x)]}}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}addFeatures(e,i,o,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,UC)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,jC)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,FC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BC),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,l,d,f,g,x){const w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),I=w.get("line-cap").evaluate(e,{}),P=w.get("line-miter-limit"),L=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const z=this.layers[0].paint.get("line-width").value;if(z.kind!=="constant"&&z.isLineProgressConstant===!1&&(this.variableWidthValue=z),this.elevationType==="road"){const B=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,l,x,A,I,P,L)){const[H,Z]=this.clipRuntimeLinesToTile(i,1);for(let te=0;te<H.length;te++){const J=H[te],U=Z[te],X={progress:{min:U.progress.min,max:U.progress.max},nextDir:this.computeSegNextDir(U,J),prevDir:this.computeSegPrevDir(U,J)};this.addLine(J,e,l,A,I,P,L,X)}this.fillNonElevatedRoadSegment(B)}}else for(const B of i)this.addLine(B,e,l,A,I,P,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,g)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return N_(e,-i,-i,vt+i,vt+i)}clipRuntimeLinesToTile(e,i){const o=[];return[N_(e,-i,-i,vt+i,vt+i,o),o]}addElevatedRoadFeature(e,i,o,l,d,f,g,x){const w=[],A=yv.getElevationFeature(e,l);if(A){const I=this.clipLinesToTile(i,1),P=this.prepareElevatedLines(I,A,o);for(const L of P)w.push({geometry:L,elevation:A,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(w.length===0)return!1;for(const I of w){const P=this.layoutVertexArray.length;this.addLine(I.geometry,e,o,d,f,g,x);const L=new Jb(o,I.elevationTileID);if(I.elevation)for(let z=P;z<this.layoutVertexArray.length;z++){const B=new gt(this.layoutVertexArray.int16[6*z]>>1,this.layoutVertexArray.int16[6*z+1]>>1),H=L.pointElevation(B,I.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(P)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const l=[],d=1/Me(o);for(const f of e)zC(f,new Yb(i,d),0,l);return l}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,l,d,f,g,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=l==="none";this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const A=x&&x.progress.min>0,I=x&&x.progress.max<1;if(this.lineClips){let me={min:this.lineClips.start,max:this.lineClips.end},xe=1;if(x){const He=this.lineClips.end-this.lineClips.start;me=function(nt,et,rt){return{min:Ln(nt.min,et,rt),max:Ln(nt.max,et,rt)}}(x.progress,{min:0,max:1},me),He>0&&(xe=(me.max-me.min)/He)}const Se=+i.properties.mapbox_clip_feature_len,Pe=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Se)||Number.isNaN(Pe)){for(let nt=0;nt<e.length-1;nt++)this.totalDistance+=e[nt].dist(e[nt+1]);const He=this.totalDistance/(me.max-me.min);this.totalFeatureLength=Number.isFinite(He)?He:0,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Se,this.distance=Pe*xe,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const P=$C[i.type]==="Polygon";let L=e.length;for(;L>=2&&e[L-1].equals(e[L-2]);)L--;let z=0;for(;z<L-1&&e[z].equals(e[z+1]);)z++;if(L<(P?3:2))return;l==="bevel"&&(f=1.05);const B=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let H,Z,te,J,U,X,ee,ne;x&&x.prevDir&&(X=x.prevDir.perp()),x&&x.nextDir&&(ee=x.nextDir.perp()),this.e1=this.e2=-1,P&&(H=e[L-2],U=e[z].sub(H)._unit()._perp());for(let me=z;me<L;me++){if(te=me===L-1?P?e[z+1]:void 0:e[me+1],te&&e[me].equals(te))continue;U&&(J=U),H&&(Z=H),H=e[me],ne=this.evaluateLineProgressFeatures(Z?Z.dist(H):0),U=te?te.sub(H)._unit()._perp():J,J=J||U;const xe=Z&&te;let Se=xe?l:P||w?"butt":d;const Pe=J.x*U.x+J.y*U.y;if(w){const Ne=function(Ge){if(Ge.patternJoinNone){const ut=Ge.segmentPoints.length/2,dt=Ge.lineSoFar-Ge.segmentStart;for(let Nt=0;Nt<ut;++Nt){const Mt=Ge.segmentPoints[2*Nt+1],xt=Math.round(Ge.segmentPoints[2*Nt])+.5+.25*Mt;Ge.patternVertexArray.emplaceBack(xt,dt,Ge.segmentStart),Ge.patternVertexArray.emplaceBack(xt,dt,Ge.segmentStart)}Ge.segmentPoints.length=0}Ge.e1=Ge.e2=-1};if(xe&&Pe<HC){this.updateDistance(Z,H),this.addCurrentVertex(H,J,1,1,B,ne),Ne(this),this.addCurrentVertex(H,U,-1,-1,B,ne);continue}if(Z){if(!te){this.updateDistance(Z,H),this.addCurrentVertex(H,J,1,1,B,ne),Ne(this);continue}Se="miter"}}let He=J.add(U);He.x===0&&He.y===0||He._unit();const nt=He.x*U.x+He.y*U.y,et=nt!==0?1/nt:1/0,rt=2*Math.sqrt(2-2*nt),lt=nt<GC&&Z&&te,je=J.x*U.y-J.y*U.x>0,it=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(xe&&Se==="round"){if(et<g)Se="miter";else if(et<=2){const Ne=Pv(H,-10,vt+10);Se=this.elevationType==="offset"&&(Ne||this.hasCrossSlope)?"miter":"fakeround"}}if(Se==="miter"&&et>f&&(Se="bevel"),Se==="bevel"&&(et>2&&(Se="flipbevel"),et<f&&(Se="miter")),Z&&!(Se==="miter"&&lt)&&this.updateDistance(Z,H),Se==="miter")if(lt){const Ne=H.dist(Z);if(Ne>2*it){const ut=H.sub(H.sub(Z)._mult(it/Ne)._round());this.updateDistance(Z,ut),this.addCurrentVertex(ut,J,0,0,B,ne),Z=ut}this.updateDistance(Z,H),He._mult(et),this.addCurrentVertex(H,He,0,0,B,ne);const Ge=H.dist(te);if(Ge>2*it){const ut=H.add(te.sub(H)._mult(it/Ge)._round());this.updateDistance(H,ut),this.addCurrentVertex(ut,U,0,0,B,ne),H=ut}}else He._mult(et),this.addCurrentVertex(H,He,0,0,B,ne);else if(Se==="flipbevel"){if(et>100)He=U.mult(-1);else{const Ne=et*J.add(U).mag()/J.sub(U).mag();He._perp()._mult(Ne*(je?-1:1))}this.addCurrentVertex(H,He,0,0,B,ne),this.addCurrentVertex(H,He.mult(-1),0,0,B,ne)}else if(Se==="bevel"||Se==="fakeround"){ne!=null&&Z&&this.addCurrentVertex(H,ee||J,-1,-1,B,ne);const Ne=H.dist(Z)<=2*it&&Se!=="bevel",Ge=He.mult(je?1:-1);Ge._mult(et);const ut=U.mult(je?-1:1),dt=J.mult(je?-1:1),Nt=this.evaluateLineProgressFeatures(this.distance);if(ne==null&&(this.addHalfVertex(H,Ge.x,Ge.y,!1,!je,0,B,Nt),Ne||this.addHalfVertex(H,Ge.x+2*dt.x,Ge.y+2*dt.y,!1,je,0,B,Nt)),Se==="fakeround"){const Mt=Math.round(180*rt/Math.PI/20);this.addHalfVertex(H,dt.x,dt.y,!1,je,0,B,Nt);for(let xt=0;xt<Mt;xt++){let ct=xt/Mt;if(ct!==.5){const zt=ct-.5;ct+=ct*zt*(ct-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*zt*zt+(.848013+Pe*(.215638*Pe-1.06021)))}const ci=ut.sub(dt)._mult(ct)._add(dt)._unit();this.addHalfVertex(H,ci.x,ci.y,!1,je,0,B,Nt)}this.addHalfVertex(H,ut.x,ut.y,!1,je,0,B,Nt)}Ne||ne!=null||this.addHalfVertex(H,Ge.x+2*ut.x,Ge.y+2*ut.y,!1,je,0,B,Nt),ne!=null&&te&&this.addCurrentVertex(H,X||U,1,1,B,ne)}else if(Se==="butt")this.addCurrentVertex(H,He,0,0,B,ne);else if(Se==="square"){if(!Z){const Ne=A?0:-1;this.addCurrentVertex(H,He,Ne,Ne,B,ne)}if(this.addCurrentVertex(H,He,0,0,B,ne),Z){const Ne=I?0:1;this.addCurrentVertex(H,He,Ne,Ne,B,ne)}}else if(Se==="round"){if(Z){const Ne=!xe&&ee?ee:J;this.addCurrentVertex(H,Ne,0,0,B,ne),!xe&&I||this.addCurrentVertex(H,Ne,1,1,B,ne,!0)}if(te){const Ne=!xe&&X?X:U;!xe&&A||this.addCurrentVertex(H,Ne,-1,-1,B,ne,!0),this.addCurrentVertex(H,Ne,0,0,B,ne)}}}}addVerticesTo(e,i,o,l,d,f,g,x,w,A){const I=(i.w-e.w)/this.tessellationStep|0;let P=0;const L=this.scaledDistance;if(I>1){this.lineSoFar=e.w;const B=(i.x-e.x)/I,H=(i.y-e.y)/I,Z=(i.z-e.z)/I,te=(i.w-e.w)/I;for(let J=1;J<I;++J){e.x+=B,e.y+=H,e.z+=Z,this.lineSoFar+=te,P+=te;const U=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(e,o,l,A,!1,g,w,U),this.addHalfVertex(e,d,f,A,!0,-x,w,U)}}this.lineSoFar=i.w,this.scaledDistance=L;const z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,l,A,!1,g,w,z),this.addHalfVertex(i,d,f,A,!0,-x,w,z)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ki(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,l,d,f,g=!1){const x=i.x+i.y*o,w=i.y-i.x*o,A=i.y*l-i.x,I=-i.y-i.x*l;if(f!=null){const P=this.elevationType==="offset",L=-10,z=vt+10,B=f.zOffset,H=new D1(e.x,e.y,B,this.lineSoFar),Z=!!P&&Pv(e,L,z),te=this.lineSoFar,J=this.distance;if(this.currentVertex)if(Z){const U=this.currentVertexIsOutside,X=this.currentVertex,ee=new D1(e.x,e.y,B,this.lineSoFar);if(L1(X,ee,L,z),!Pv(ee,L,z)){if(U){this.e1=this.e2=-1,this.distance-=X.dist(H),this.lineSoFar=X.w;const ne=this.evaluateLineProgressFeatures(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,x,w,g,!1,o,d,ne),this.addHalfVertex(X,A,I,g,!0,-l,d,ne),this.prevDistance=this.distance}this.distance=this.prevDistance+X.dist(ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(X,ee,x,w,A,I,o,l,d,g),this.distance=J,this.scaledDistance=this.distance/this.totalDistance}}else{const U=this.currentVertex;if(this.currentVertexIsOutside){L1(U,H,L,z),this.e1=this.e2=-1,this.distance-=U.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=U.w;const X=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,x,w,g,!1,o,d,X),this.addHalfVertex(U,A,I,g,!0,-l,d,X),this.prevDistance=this.distance,this.distance=J,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(U,H,x,w,A,I,o,l,d,g)}else Z||(this.addHalfVertex(e,x,w,g,!1,o,d,f),this.addHalfVertex(e,A,I,g,!0,-l,d,f));this.currentVertex=H,this.currentVertexIsOutside=Z,this.lineSoFar=te}else this.addHalfVertex(e,x,w,g,!1,o,d,f),this.addHalfVertex(e,A,I,g,!0,-l,d,f)}addHalfVertex({x:e,y:i},o,l,d,f,g,x,w){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const I=Kt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,I)}const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),x.primitiveLength++),f?this.e2=A:this.e1=A,w!=null&&this.zOffsetVertexArray.emplaceBack(w.zOffset,w.variableWidth,w.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Pv(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let N1,U1;function V1(r,e,i){return e*(vt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}It(Cv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const j1=(r,e,i)=>(1-i)*r+i*e;function $1(r,e){return 1/V1(r,1,e.tileZoom)}function G1(r,e,i,o){return r.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const H1=r=>{const e=[];q1(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=r.layout.get("line-join").constantOr("miter")==="none",l=!!r.paint.get("line-pattern").constantOr(1);return o&&l&&e.push("LINE_JOIN_NONE"),e};function q1(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Mv;const W1=()=>Mv||(Mv={layout:N1||(N1=new Jr({"line-cap":new At(De.layout_line["line-cap"]),"line-join":new At(De.layout_line["line-join"]),"line-miter-limit":new pt(De.layout_line["line-miter-limit"]),"line-round-limit":new pt(De.layout_line["line-round-limit"]),"line-sort-key":new At(De.layout_line["line-sort-key"]),"line-z-offset":new At(De.layout_line["line-z-offset"]),"line-elevation-reference":new pt(De.layout_line["line-elevation-reference"]),"line-cross-slope":new pt(De.layout_line["line-cross-slope"]),visibility:new pt(De.layout_line.visibility),"line-width-unit":new pt(De.layout_line["line-width-unit"])})),paint:U1||(U1=new Jr({"line-opacity":new At(De.paint_line["line-opacity"]),"line-color":new At(De.paint_line["line-color"]),"line-translate":new pt(De.paint_line["line-translate"]),"line-translate-anchor":new pt(De.paint_line["line-translate-anchor"]),"line-width":new At(De.paint_line["line-width"]),"line-gap-width":new At(De.paint_line["line-gap-width"]),"line-offset":new At(De.paint_line["line-offset"]),"line-blur":new At(De.paint_line["line-blur"]),"line-dasharray":new At(De.paint_line["line-dasharray"]),"line-pattern":new At(De.paint_line["line-pattern"]),"line-pattern-cross-fade":new pt(De.paint_line["line-pattern-cross-fade"]),"line-gradient":new Wa(De.paint_line["line-gradient"]),"line-trim-offset":new pt(De.paint_line["line-trim-offset"]),"line-trim-fade-range":new pt(De.paint_line["line-trim-fade-range"]),"line-trim-color":new pt(De.paint_line["line-trim-color"]),"line-emissive-strength":new pt(De.paint_line["line-emissive-strength"]),"line-border-width":new At(De.paint_line["line-border-width"]),"line-border-color":new At(De.paint_line["line-border-color"]),"line-occlusion-opacity":new pt(De.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},Mv);class qC extends At{possiblyEvaluate(e,i){return i=new cr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,l){return i=Be({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,l)}}let up;function Z1(r,e){return e>0?e+2*r:r}const WC=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ZC=Ki([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),XC=Ki([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const KC=Ki([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),YC=Ki([{name:"a_texb",components:2,type:"Uint16"}]),JC=Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),QC=Ki([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const X1=Ki([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eP=Ki([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ki([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var On=24;function tP(r,e,i){return r.sections.forEach(o=>{o.text=function(l,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),$s.applyArabicShaping&&(l=$s.applyArabicShaping(l)),l}(o.text,e,i)}),r}const hp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function iP(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function rP(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}var K1,Rv,Y1,Dv={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function nP(){return K1||(K1=1,Dv.read=function(r,e,i,o,l){var d,f,g=8*l-o-1,x=(1<<g)-1,w=x>>1,A=-7,I=i?l-1:0,P=i?-1:1,L=r[e+I];for(I+=P,d=L&(1<<-A)-1,L>>=-A,A+=g;A>0;d=256*d+r[e+I],I+=P,A-=8);for(f=d&(1<<-A)-1,d>>=-A,A+=o;A>0;f=256*f+r[e+I],I+=P,A-=8);if(d===0)d=1-w;else{if(d===x)return f?NaN:1/0*(L?-1:1);f+=Math.pow(2,o),d-=w}return(L?-1:1)*f*Math.pow(2,d-o)},Dv.write=function(r,e,i,o,l,d){var f,g,x,w=8*d-l-1,A=(1<<w)-1,I=A>>1,P=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=o?0:d-1,z=o?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=A):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+I>=1?P/x:P*Math.pow(2,1-I))*x>=2&&(f++,x/=2),f+I>=A?(g=0,f=A):f+I>=1?(g=(e*x-1)*Math.pow(2,l),f+=I):(g=e*Math.pow(2,I-1)*Math.pow(2,l),f=0));l>=8;r[i+L]=255&g,L+=z,g/=256,l-=8);for(f=f<<l|g,w+=l;w>0;r[i+L]=255&f,L+=z,f/=256,w-=8);r[i+L-z]|=128*B}),Dv}function J1(){if(Y1)return Rv;Y1=1,Rv=e;var r=nP();function e(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,l=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(U){return U.type===e.Bytes?U.readVarint()+U.pos:U.pos+1}function f(U,X,ee){return ee?4294967296*X+(U>>>0):4294967296*(X>>>0)+(U>>>0)}function g(U,X,ee){var ne=X<=16383?1:X<=2097151?2:X<=268435455?3:Math.floor(Math.log(X)/(7*Math.LN2));ee.realloc(ne);for(var me=ee.pos-1;me>=U;me--)ee.buf[me+ne]=ee.buf[me]}function x(U,X){for(var ee=0;ee<U.length;ee++)X.writeVarint(U[ee])}function w(U,X){for(var ee=0;ee<U.length;ee++)X.writeSVarint(U[ee])}function A(U,X){for(var ee=0;ee<U.length;ee++)X.writeFloat(U[ee])}function I(U,X){for(var ee=0;ee<U.length;ee++)X.writeDouble(U[ee])}function P(U,X){for(var ee=0;ee<U.length;ee++)X.writeBoolean(U[ee])}function L(U,X){for(var ee=0;ee<U.length;ee++)X.writeFixed32(U[ee])}function z(U,X){for(var ee=0;ee<U.length;ee++)X.writeSFixed32(U[ee])}function B(U,X){for(var ee=0;ee<U.length;ee++)X.writeFixed64(U[ee])}function H(U,X){for(var ee=0;ee<U.length;ee++)X.writeSFixed64(U[ee])}function Z(U,X){return(U[X]|U[X+1]<<8|U[X+2]<<16)+16777216*U[X+3]}function te(U,X,ee){U[ee]=X,U[ee+1]=X>>>8,U[ee+2]=X>>>16,U[ee+3]=X>>>24}function J(U,X){return(U[X]|U[X+1]<<8|U[X+2]<<16)+(U[X+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(U,X,ee){for(ee=ee||this.length;this.pos<ee;){var ne=this.readVarint(),me=ne>>3,xe=this.pos;this.type=7&ne,U(me,X,this),this.pos===xe&&this.skip(ne)}return X},readMessage:function(U,X){return this.readFields(U,X,this.readVarint()+this.pos)},readFixed32:function(){var U=Z(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=J(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=Z(this.buf,this.pos)+Z(this.buf,this.pos+4)*i;return this.pos+=8,U},readSFixed64:function(){var U=Z(this.buf,this.pos)+J(this.buf,this.pos+4)*i;return this.pos+=8,U},readFloat:function(){var U=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var X,ee,ne=this.buf;return X=127&(ee=ne[this.pos++]),ee<128?X:(X|=(127&(ee=ne[this.pos++]))<<7,ee<128?X:(X|=(127&(ee=ne[this.pos++]))<<14,ee<128?X:(X|=(127&(ee=ne[this.pos++]))<<21,ee<128?X:function(me,xe,Se){var Pe,He,nt=Se.buf;if(Pe=(112&(He=nt[Se.pos++]))>>4,He<128||(Pe|=(127&(He=nt[Se.pos++]))<<3,He<128)||(Pe|=(127&(He=nt[Se.pos++]))<<10,He<128)||(Pe|=(127&(He=nt[Se.pos++]))<<17,He<128)||(Pe|=(127&(He=nt[Se.pos++]))<<24,He<128)||(Pe|=(1&(He=nt[Se.pos++]))<<31,He<128))return f(me,Pe,xe);throw new Error("Expected varint not more than 10 bytes")}(X|=(15&(ee=ne[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,X=this.pos;return this.pos=U,U-X>=12&&l?function(ee,ne,me){return l.decode(ee.subarray(ne,me))}(this.buf,X,U):function(ee,ne,me){for(var xe="",Se=ne;Se<me;){var Pe,He,nt,et=ee[Se],rt=null,lt=et>239?4:et>223?3:et>191?2:1;if(Se+lt>me)break;lt===1?et<128&&(rt=et):lt===2?(192&(Pe=ee[Se+1]))==128&&(rt=(31&et)<<6|63&Pe)<=127&&(rt=null):lt===3?(He=ee[Se+2],(192&(Pe=ee[Se+1]))==128&&(192&He)==128&&((rt=(15&et)<<12|(63&Pe)<<6|63&He)<=2047||rt>=55296&&rt<=57343)&&(rt=null)):lt===4&&(He=ee[Se+2],nt=ee[Se+3],(192&(Pe=ee[Se+1]))==128&&(192&He)==128&&(192&nt)==128&&((rt=(15&et)<<18|(63&Pe)<<12|(63&He)<<6|63&nt)<=65535||rt>=1114112)&&(rt=null)),rt===null?(rt=65533,lt=1):rt>65535&&(rt-=65536,xe+=String.fromCharCode(rt>>>10&1023|55296),rt=56320|1023&rt),xe+=String.fromCharCode(rt),Se+=lt}return xe}(this.buf,X,U)},readBytes:function(){var U=this.readVarint()+this.pos,X=this.buf.subarray(this.pos,U);return this.pos=U,X},readPackedVarint:function(U,X){if(this.type!==e.Bytes)return U.push(this.readVarint(X));var ee=d(this);for(U=U||[];this.pos<ee;)U.push(this.readVarint(X));return U},readPackedSVarint:function(U){if(this.type!==e.Bytes)return U.push(this.readSVarint());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==e.Bytes)return U.push(this.readBoolean());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==e.Bytes)return U.push(this.readFloat());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==e.Bytes)return U.push(this.readDouble());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed32());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed32());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed64());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed64());var X=d(this);for(U=U||[];this.pos<X;)U.push(this.readSFixed64());return U},skip:function(U){var X=7&U;if(X===e.Varint)for(;this.buf[this.pos++]>127;);else if(X===e.Bytes)this.pos=this.readVarint()+this.pos;else if(X===e.Fixed32)this.pos+=4;else{if(X!==e.Fixed64)throw new Error("Unimplemented type: "+X);this.pos+=8}},writeTag:function(U,X){this.writeVarint(U<<3|X)},realloc:function(U){for(var X=this.length||16;X<this.pos+U;)X*=2;if(X!==this.length){var ee=new Uint8Array(X);ee.set(this.buf),this.buf=ee,this.length=X}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),te(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),te(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),te(this.buf,-1&U,this.pos),te(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),te(this.buf,-1&U,this.pos),te(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(X,ee){var ne,me;if(X>=0?(ne=X%4294967296|0,me=X/4294967296|0):(me=~(-X/4294967296),4294967295^(ne=~(-X%4294967296))?ne=ne+1|0:(ne=0,me=me+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ee.realloc(10),function(xe,Se,Pe){Pe.buf[Pe.pos++]=127&xe|128,xe>>>=7,Pe.buf[Pe.pos++]=127&xe|128,xe>>>=7,Pe.buf[Pe.pos++]=127&xe|128,xe>>>=7,Pe.buf[Pe.pos++]=127&xe|128,Pe.buf[Pe.pos]=127&(xe>>>=7)}(ne,0,ee),function(xe,Se){var Pe=(7&xe)<<4;Se.buf[Se.pos++]|=Pe|((xe>>>=3)?128:0),xe&&(Se.buf[Se.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Se.buf[Se.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Se.buf[Se.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Se.buf[Se.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Se.buf[Se.pos++]=127&xe)))))}(me,ee)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var X=this.pos;this.pos=function(ne,me,xe){for(var Se,Pe,He=0;He<me.length;He++){if((Se=me.charCodeAt(He))>55295&&Se<57344){if(!Pe){Se>56319||He+1===me.length?(ne[xe++]=239,ne[xe++]=191,ne[xe++]=189):Pe=Se;continue}if(Se<56320){ne[xe++]=239,ne[xe++]=191,ne[xe++]=189,Pe=Se;continue}Se=Pe-55296<<10|Se-56320|65536,Pe=null}else Pe&&(ne[xe++]=239,ne[xe++]=191,ne[xe++]=189,Pe=null);Se<128?ne[xe++]=Se:(Se<2048?ne[xe++]=Se>>6|192:(Se<65536?ne[xe++]=Se>>12|224:(ne[xe++]=Se>>18|240,ne[xe++]=Se>>12&63|128),ne[xe++]=Se>>6&63|128),ne[xe++]=63&Se|128)}return xe}(this.buf,U,this.pos);var ee=this.pos-X;ee>=128&&g(X,ee,this),this.pos=X-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(U){this.realloc(4),r.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),r.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var X=U.length;this.writeVarint(X),this.realloc(X);for(var ee=0;ee<X;ee++)this.buf[this.pos++]=U[ee]},writeRawMessage:function(U,X){this.pos++;var ee=this.pos;U(X,this);var ne=this.pos-ee;ne>=128&&g(ee,ne,this),this.pos=ee-1,this.writeVarint(ne),this.pos+=ne},writeMessage:function(U,X,ee){this.writeTag(U,e.Bytes),this.writeRawMessage(X,ee)},writePackedVarint:function(U,X){X.length&&this.writeMessage(U,x,X)},writePackedSVarint:function(U,X){X.length&&this.writeMessage(U,w,X)},writePackedBoolean:function(U,X){X.length&&this.writeMessage(U,P,X)},writePackedFloat:function(U,X){X.length&&this.writeMessage(U,A,X)},writePackedDouble:function(U,X){X.length&&this.writeMessage(U,I,X)},writePackedFixed32:function(U,X){X.length&&this.writeMessage(U,L,X)},writePackedSFixed32:function(U,X){X.length&&this.writeMessage(U,z,X)},writePackedFixed64:function(U,X){X.length&&this.writeMessage(U,B,X)},writePackedSFixed64:function(U,X){X.length&&this.writeMessage(U,H,X)},writeBytesField:function(U,X){this.writeTag(U,e.Bytes),this.writeBytes(X)},writeFixed32Field:function(U,X){this.writeTag(U,e.Fixed32),this.writeFixed32(X)},writeSFixed32Field:function(U,X){this.writeTag(U,e.Fixed32),this.writeSFixed32(X)},writeFixed64Field:function(U,X){this.writeTag(U,e.Fixed64),this.writeFixed64(X)},writeSFixed64Field:function(U,X){this.writeTag(U,e.Fixed64),this.writeSFixed64(X)},writeVarintField:function(U,X){this.writeTag(U,e.Varint),this.writeVarint(X)},writeSVarintField:function(U,X){this.writeTag(U,e.Varint),this.writeSVarint(X)},writeStringField:function(U,X){this.writeTag(U,e.Bytes),this.writeString(X)},writeFloatField:function(U,X){this.writeTag(U,e.Fixed32),this.writeFloat(X)},writeDoubleField:function(U,X){this.writeTag(U,e.Fixed64),this.writeDouble(X)},writeBooleanField:function(U,X){this.writeVarintField(U,!!X)}},Rv}var U_=fo(J1());const kv=3;function sP(r,e,i){e.glyphs=[],r===1&&i.readMessage(oP,e)}function oP(r,e,i){if(r===3){const{id:o,bitmap:l,width:d,height:f,left:g,top:x,advance:w}=i.readMessage(aP,{});e.glyphs.push({id:o,bitmap:new Kl({width:d+2*kv,height:f+2*kv},l),metrics:{width:d,height:f,left:g,top:x,advance:w}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function aP(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const lP=kv,Ls={horizontal:1,vertical:2,horizontalOnly:3};class dp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new dp;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new dp;return i.image=e,i}}class Jh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const l=new Jh;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?l.addImageSection(f,o):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let l="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,g=i.charCodeAt(d-1)||null;l+=!o&&(f&&i_(f)&&!hp[i[d+1]]||g&&i_(g)&&!hp[i[d-1]])||!hp[i[d]]?i[d]:hp[i[d]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&V_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&V_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Jh;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(dp.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void ki("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(dp.forImage(o)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lv(r,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B=1){const H=Jh.fromFeature(r,l,B);I===Ls.vertical&&H.verticalizePunctuation(P);let Z=[];const te=function(ne,me,xe,Se,Pe,He){if(!ne)return[];const nt=[],et=function(it,Ne,Ge,ut,dt,Nt){let Mt=0;for(let xt=0;xt<it.length();xt++){const ct=it.getSection(xt);Mt+=Q1(it.getCodePoint(xt),ct,ut,dt,Ne,Nt)}return Mt/Math.max(1,Math.ceil(Mt/Ge))}(ne,me,xe,Se,Pe,He),rt=ne.text.indexOf("")>=0;let lt=0;for(let it=0;it<ne.length();it++){const Ne=ne.getSection(it),Ge=ne.getCodePoint(it);if(V_[Ge]||(lt+=Q1(Ge,Ne,Se,Pe,me,He)),it<ne.length()-1){const ut=!((je=Ge)<11904||!(Qt["Bopomofo Extended"](je)||Qt.Bopomofo(je)||Qt["CJK Compatibility Forms"](je)||Qt["CJK Compatibility Ideographs"](je)||Qt["CJK Compatibility"](je)||Qt["CJK Radicals Supplement"](je)||Qt["CJK Strokes"](je)||Qt["CJK Symbols and Punctuation"](je)||Qt["CJK Unified Ideographs Extension A"](je)||Qt["CJK Unified Ideographs"](je)||Qt["Enclosed CJK Letters and Months"](je)||Qt["Halfwidth and Fullwidth Forms"](je)||Qt.Hiragana(je)||Qt["Ideographic Description Characters"](je)||Qt["Kangxi Radicals"](je)||Qt["Katakana Phonetic Extensions"](je)||Qt.Katakana(je)||Qt["Vertical Forms"](je)||Qt["Yi Radicals"](je)||Qt["Yi Syllables"](je)));(cP[Ge]||ut||Ne.image)&&nt.push(tw(it+1,lt,et,nt,uP(Ge,ne.getCodePoint(it+1),ut&&rt),!1))}}var je;return iw(tw(ne.length(),lt,et,nt,0,!0))}(H,w,d,e,o,L),{processBidirectionalText:J,processStyledBidirectionalText:U}=$s;if(J&&H.sections.length===1){const ne=J(H.toString(),te);for(const me of ne){const xe=new Jh;xe.text=me,xe.sections=H.sections;for(let Se=0;Se<me.length;Se++)xe.sectionIndex.push(0);Z.push(xe)}}else if(U){const ne=U(H.text,H.sectionIndex,te);for(const me of ne){const xe=new Jh;xe.text=me[0],xe.sectionIndex=me[1],xe.sections=H.sections,Z.push(xe)}}else Z=function(ne,me){const xe=[],Se=ne.text;let Pe=0;for(const He of me)xe.push(ne.substring(Pe,He)),Pe=He;return Pe<Se.length&&xe.push(ne.substring(Pe,Se.length)),xe}(H,te);const X=[],ee={positionedLines:X,text:H.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ne,me,xe,Se,Pe,He,nt,et,rt,lt,je,it){let Ne=0,Ge=0,ut=0;const dt=et==="right"?1:et==="left"?0:.5;let Nt=!1;for(const Ot of Pe){const oi=Ot.getSections();for(const yi of oi){if(yi.image)continue;const bi=me[yi.fontStack];if(bi&&(Nt=bi.ascender!==void 0&&bi.descender!==void 0,!Nt))break}if(!Nt)break}let Mt=0;for(const Ot of Pe){Ot.trim();const oi=Ot.getMaxScale(),yi=(oi-1)*On,bi={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Mt]=bi;const Mi=bi.positionedGlyphs;let Ai=0;if(!Ot.length()){Ge+=He,++Mt;continue}let Ti=0,pr=0;for(let ie=0;ie<Ot.length();ie++){const se=Ot.getSection(ie),Ze=Ot.getSectionIndex(ie),mt=Ot.getCodePoint(ie);let wt=se.scale,bt=null,Ft=null,ri=null,zi=On,Oi=0;rt===Ls.vertical&&((xt=mt)===12312||xt===12313||xt===12316||xt===12540||xt===12448)&&(rt=Ls.horizontal);const Si=!(rt===Ls.horizontal||!je&&!tu(mt)||je&&(V_[mt]||qy(mt)));if(se.image){const or=Se.get(se.image.toString());if(!or)continue;ri=se.image,ne.iconsInText=ne.iconsInText||!0,Ft=or.paddedRect;const br=or.displaySize;wt=wt*On/it,bt={width:br[0],height:br[1],left:0,top:-3,advance:Si?br[1]:br[0],localGlyph:!1},Oi=Nt?-bt.height*wt:oi*On-17-br[1]*wt,zi=bt.advance;const Fi=(Si?br[0]:br[1])*wt-On*oi;Fi>0&&Fi>Ai&&(Ai=Fi)}else{const or=xe[se.fontStack];if(!or)continue;or[mt]&&(Ft=or[mt]);const br=me[se.fontStack];if(!br)continue;const Fi=br.glyphs[mt];if(!Fi)continue;if(bt=Fi.metrics,zi=mt!==8203?On:0,Nt){const Gr=br.ascender!==void 0?Math.abs(br.ascender):0,Cr=br.descender!==void 0?Math.abs(br.descender):0,rr=(Gr+Cr)*wt;Ti<rr&&(Ti=rr,pr=(Gr-Cr)/2*wt),Oi=-Gr*wt}else Oi=(oi-wt)*On-17}Si?(ne.verticalizable=!0,Mi.push({glyph:mt,image:ri,x:Ne,y:Ge+Oi,vertical:Si,scale:wt,localGlyph:bt.localGlyph,fontStack:se.fontStack,sectionIndex:Ze,metrics:bt,rect:Ft}),Ne+=zi*wt+lt):(Mi.push({glyph:mt,image:ri,x:Ne,y:Ge+Oi,vertical:Si,scale:wt,localGlyph:bt.localGlyph,fontStack:se.fontStack,sectionIndex:Ze,metrics:bt,rect:Ft}),Ne+=bt.advance*wt+lt)}Mi.length!==0&&(ut=Math.max(Ne-lt,ut),Nt?rw(Mi,dt,Ai,pr,He*oi/2):rw(Mi,dt,Ai,0,He/2)),Ne=0;const Ir=He*oi+Ai;bi.lineOffset=Math.max(Ai,yi),Ge+=Ir,++Mt}var xt;const ct=Ge,{horizontalAlign:ci,verticalAlign:zt}=zv(nt);(function(Ot,oi,yi,bi,Mi,Ai){const Ti=(oi-yi)*Mi,pr=-Ai*bi;for(const Ir of Ot)for(const ie of Ir.positionedGlyphs)ie.x+=Ti,ie.y+=pr})(ne.positionedLines,dt,ci,zt,ut,ct),ne.top+=-zt*ct,ne.bottom=ne.top+ct,ne.left+=-ci*ut,ne.right=ne.left+ut,ne.hasBaseline=Nt}(ee,e,i,o,Z,f,g,x,I,w,P,z),!function(ne){for(const me of ne)if(me.positionedGlyphs.length!==0)return!1;return!0}(X))return ee}const V_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Q1(r,e,i,o,l,d){if(e.image){const f=o.get(e.image.toString());return f?f.displaySize[0]*e.scale*On/d+l:0}{const f=i[e.fontStack],g=f&&f.glyphs[r];return g?g.metrics.advance*e.scale+l:0}}function ew(r,e,i,o){const l=Math.pow(r-e,2);return o?r<e?l/2:2*l:l+Math.abs(i)*i}function uP(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function tw(r,e,i,o,l,d){let f=null,g=ew(e,i,l,d);for(const x of o){const w=ew(e-x.x,i,l,d)+x.badness;w<=g&&(f=x,g=w)}return{index:r,x:e,priorBreak:f,badness:g}}function iw(r){return r?iw(r.priorBreak).concat(r.index):[]}function zv(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function rw(r,e,i,o,l){if(!(e||i||o||l))return;const d=r.length-1,f=r[d],g=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)r[x].x-=g,r[x].y+=i+o+l}function nw(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function hP(r,e,i,o){const{horizontalAlign:l,verticalAlign:d}=zv(o),f=i[0]-r.displaySize[0]*l,g=i[1]-r.displaySize[1]*d;return{imagePrimary:r,imageSecondary:e,top:g,bottom:g+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function sw(r,e,i,o,l,d){const f=r.imagePrimary;let g;if(f.content){const H=f.content,Z=f.pixelRatio||1;g=[H[0]/Z,H[1]/Z,f.displaySize[0]-H[2]/Z,f.displaySize[1]-H[3]/Z]}const x=e.left*d,w=e.right*d;let A,I,P,L;i==="width"||i==="both"?(L=l[0]+x-o[3],I=l[0]+w+o[1]):(L=l[0]+(x+w-f.displaySize[0])/2,I=L+f.displaySize[0]);const z=e.top*d,B=e.bottom*d;return i==="height"||i==="both"?(A=l[1]+z-o[0],P=l[1]+B+o[2]):(A=l[1]+(z+B-f.displaySize[1])/2,P=A+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:A,right:I,bottom:P,left:L,collisionPadding:g}}function ow(r){return!r.imagePrimary.stretchX}function aw(r){return!r.imagePrimary.stretchY}function lw(r){return{width:r.right-r.left,height:r.bottom-r.top}}const ya=128;function cw(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new cr(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let d=0;for(;d<o.length&&o[d]<=r;)d++;d=Math.max(0,d-1);let f=d;for(;f<o.length&&o[f]<r+1;)f++;f=Math.min(o.length-1,f);const g=o[d],x=o[f];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:x,minSize:i.evaluate(new cr(g)),maxSize:i.evaluate(new cr(x)),interpolationType:l}}}function Ov(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:l}){return r.kind==="source"?o/ya:r.kind==="composite"?Kt(o/ya,l/ya,i):e}function fp(r,e,i=1){let o=0,l=0;if(r.kind==="constant")l=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:g}=r,x=d?Ae(ms.interpolationFactor(d,e,f,g),0,1):0;r.kind==="camera"?l=Kt(r.minSize,r.maxSize,x)*i:o=x*i}return{uSizeT:o,uSize:l}}class tl extends gt{constructor(e,i,o,l,d){super(e,i),this.angle=l,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new tl(this.x,this.y,this.z,this.angle,this.segment)}}function uw(r,e,i,o,l){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-i/2;){if(f--,f<0)return!1;g-=r[f].dist(d),d=r[f]}g+=r[f].dist(r[f+1]),f++;const x=[];let w=0;for(;g<i/2;){const A=r[f],I=r[f+1];if(!I)return!1;let P=r[f-1].angleTo(A)-A.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:P}),w+=P;g-x[0].distance>o;)w-=x.shift().angleDelta;if(w>l)return!1;f++,g+=A.dist(I)}return!0}function hw(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function dw(r,e,i){return r?.6*e*i:0}function fw(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function dP(r,e,i,o,l,d){const f=dw(i,l,d),g=fw(i,o)*d;let x=0;const w=hw(r)/2;for(let A=0;A<r.length-1;A++){const I=r[A],P=r[A+1],L=I.dist(P);if(x+L>w){const z=(w-x)/L,B=Kt(I.x,P.x,z),H=Kt(I.y,P.y,z),Z=new tl(B,H,0,P.angleTo(I),A);return!f||uw(r,Z,g,f,e)?Z:void 0}x+=L}}function fP(r,e,i,o,l,d,f,g,x){const w=dw(o,d,f),A=fw(o,l),I=A*f,P=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return e-I<e/4&&(e=I+e/4),pw(r,P?e/2*g%e:(A/2+2*d)*f*g%e,e,w,i,I,P,!1,x)}function pw(r,e,i,o,l,d,f,g,x){const w=d/2,A=hw(r);let I=0,P=e-i,L=[];for(let z=0;z<r.length-1;z++){const B=r[z],H=r[z+1],Z=B.dist(H),te=H.angleTo(B);for(;P+i<I+Z;){P+=i;const J=(P-I)/Z,U=Kt(B.x,H.x,J),X=Kt(B.y,H.y,J);if(U>=0&&U<x&&X>=0&&X<x&&P-w>=0&&P+w<=A){const ee=new tl(U,X,0,te,z);o&&!uw(r,ee,d,o,l)||L.push(ee)}}I+=Z}return g||L.length||f||(L=pw(r,I/2,i,o,l,d,f,!0,x)),L}function mw(r){let e=0,i=0;for(const f of r)e+=f.w*f.h,i=Math.max(i,f.w);r.sort((f,g)=>g.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,d=0;for(const f of r)for(let g=o.length-1;g>=0;g--){const x=o[g];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===x.w&&f.h===x.h){const w=o.pop();g<o.length&&(o[g]=w)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(o.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}It(tl,"Anchor");const xu=1;class pp{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const l=e.options.transform;return{x:l.a,y:l.d}}return{x:o,y:o}}constructor(e,i,o,l){this.paddedRect=e;const{pixelRatio:d,version:f,stretchX:g,stretchY:x,content:w,sdf:A,usvg:I}=i;this.pixelRatio=d,this.stretchX=g,this.stretchY=x,this.content=w,this.version=f,this.padding=o,this.sdf=A,this.scale=pp.getImagePositionScale(l,I,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Fv(r,e,i){const o=Qs.parse(r),l=function(d,f,g=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*g[0])+2*f,h:(d.data?d.data.height:d.height*g[1])+2*f}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:l,imagePosition:new pp(l,e,i,o),imageVariant:o}}class _w{constructor(e,i,o){const l=new Map,d=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,xu,f),this.addImages(i,d,2,f);const{w:g,h:x}=mw(f),w=new jn({width:g||1,height:x||1});for(const[A,I]of e.entries()){const P=l.get(A).paddedRect;jn.copy(I.data,w,{x:0,y:0},{x:P.x+xu,y:P.y+xu},I.data,o,I.sdf)}for(const[A,I]of i.entries()){const P=d.get(A),L=P.paddedRect;let z=P.padding;const B=L.x+z,H=L.y+z,Z=I.data.width,te=I.data.height;z=z>1?z-1:z,jn.copy(I.data,w,{x:0,y:0},{x:B,y:H},I.data,o),jn.copy(I.data,w,{x:0,y:te-z},{x:B,y:H-z},{width:Z,height:z},o),jn.copy(I.data,w,{x:0,y:0},{x:B,y:H+te},{width:Z,height:z},o),jn.copy(I.data,w,{x:Z-z,y:0},{x:B-z,y:H},{width:z,height:te},o),jn.copy(I.data,w,{x:0,y:0},{x:B+Z,y:H},{width:z,height:te},o),jn.copy(I.data,w,{x:Z-z,y:te-z},{x:B-z,y:H-z},{width:z,height:z},o),jn.copy(I.data,w,{x:0,y:te-z},{x:B+Z,y:H-z},{width:z,height:z},o),jn.copy(I.data,w,{x:0,y:0},{x:B+Z,y:H+te},{width:z,height:z},o),jn.copy(I.data,w,{x:Z-z,y:0},{x:B-z,y:H+te},{width:z,height:z},o)}this.lut=o,this.image=w,this.iconPositions=l,this.patternPositions=d}addImages(e,i,o,l){for(const[d,f]of e.entries()){const{bin:g,imagePosition:x,imageVariant:w}=Fv(d,f,o);i.set(d,x),l.push(g),f.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const l of e.getUpdatedImages(o)){for(const d of this.iconPositions.keys()){const f=Qs.parse(d);if(bs.isEqual(f.id,l)){const g=e.getImage(l,o);this.patchUpdatedImage(this.iconPositions.get(d),g,i)}}for(const d of this.patternPositions.keys()){const f=Qs.parse(d);if(bs.isEqual(f.id,l)){const g=e.getImage(l,o);this.patchUpdatedImage(this.patternPositions.get(d),g,i)}}}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,d]=e.tl,f=e.sdf;if(this.lut||f){const g={width:i.data.width,height:i.data.height},x=new jn(g);jn.copy(i.data,x,{x:0,y:0},{x:0,y:0},g,this.lut,f),o.update(x,{position:{x:l,y:d}})}else o.update(i.data,{position:{x:l,y:d}})}}It(pp,"ImagePosition"),It(_w,"ImageAtlas");const j_=1e20;function gw(r,e,i,o,l,d,f,g,x){for(let w=e;w<e+o;w++)yw(r,i*d+w,d,l,f,g,x);for(let w=i;w<i+l;w++)yw(r,w*d+e,1,o,f,g,x)}function yw(r,e,i,o,l,d,f){d[0]=0,f[0]=-1e20,f[1]=j_,l[0]=r[e];for(let g=1,x=0,w=0;g<o;g++){l[g]=r[e+g*i];const A=g*g;do{const I=d[x];w=(l[g]-l[I]+A-I*I)/(g-I)/2}while(w<=f[x]&&--x>-1);x++,d[x]=g,f[x]=w,f[x+1]=j_}for(let g=0,x=0;g<o;g++){for(;f[x+1]<g;)x++;const w=d[x],A=g-w;r[e+g*i]=l[w]+A*A}}const Vo=2,Bv={none:0,ideographs:1,all:2};class Qh{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const l=[],d=this.urls[i]||Vn.GLYPHS_URL;for(const f in e)for(const g of e[f])l.push({stack:f,id:g});Ye(l,({stack:f,id:g},x)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=w.glyphs[g];if(A!==void 0)return void x(null,{stack:f,id:g,glyph:A});if(A=this._tinySDF(w,f,g),A)return w.glyphs[g]=A,void x(null,{stack:f,id:g,glyph:A});const I=Math.floor(g/256);if(256*I>65535)return ki("glyphs > 65535 not supported"),void x(null,{stack:f,id:g,glyph:A});if(w.ranges[I])return void x(null,{stack:f,id:g,glyph:A});let P=w.requests[I];P||(P=w.requests[I]=[],Qh.loadGlyphRange(f,I,d,this.requestManager,(L,z)=>{if(z){w.ascender=z.ascender,w.descender=z.descender;for(const B in z.glyphs)this._doesCharSupportLocalGlyph(+B)||(w.glyphs[+B]=z.glyphs[+B]);w.ranges[I]=!0}for(const B of P)B(L,z);delete w.requests[I]})),P.push((L,z)=>{L?x(L):z&&x(null,{stack:f,id:g,glyph:z.glyphs[g]||null})})},(f,g)=>{if(f)o(f);else if(g){const x={};for(const{stack:w,id:A,glyph:I}of g)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[A]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;o(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bv.none&&(this.localGlyphMode===Bv.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,i,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),d=e.tinySDF=new Qh.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*Vo,buffer:3*Vo,radius:8*Vo}),d.fontWeight=B}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const f=String.fromCodePoint(o),{data:g,width:x,height:w,glyphWidth:A,glyphHeight:I,glyphLeft:P,glyphTop:L,glyphAdvance:z}=d.draw(f);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new Kl({width:x,height:w},g),metrics:{width:A/Vo,height:I/Vo,left:P/Vo,top:L/Vo-27,advance:z/Vo,localGlyph:!0}}}}Qh.loadGlyphRange=function(r,e,i,o,l){const d=256*e,f=d+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${d}-${f}`),Yu.Glyphs);gl(g,(x,w)=>{if(x)l(x);else if(w){const A={},I=function(P){return new U_(P).readFields(sP,{})}(w);for(const P of I.glyphs)A[P.id]=P;l(null,{glyphs:A,ascender:I.ascender,descender:I.descender})}})},Qh.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const g=this.size=r+4*e,x=this._createCanvas(g),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${d} ${r}px ${l}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(r),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),w=g+2*this.buffer,A=x+2*this.buffer,I=Math.max(w*A,0),P=new Uint8ClampedArray(I),L={data:P,width:w,height:A,glyphWidth:g,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return L;const{ctx:z,buffer:B,gridInner:H,gridOuter:Z}=this;z.clearRect(B,B,g,x),z.fillText(r,B,B+f);const te=z.getImageData(B,B,g,x);Z.fill(j_,0,I),H.fill(0,0,I);for(let J=0;J<x;J++)for(let U=0;U<g;U++){const X=te.data[4*(J*g+U)+3]/255;if(X===0)continue;const ee=(J+B)*w+U+B;if(X===1)Z[ee]=0,H[ee]=j_;else{const ne=.5-X;Z[ee]=ne>0?ne*ne:0,H[ee]=ne<0?ne*ne:0}}gw(Z,0,0,w,A,w,this.f,this.v,this.z),gw(H,B,B,g,x,w,this.f,this.v,this.z);for(let J=0;J<I;J++){const U=Math.sqrt(Z[J])-Math.sqrt(H[J]);P[J]=Math.round(255-255*(U/this.radius+this.cutoff))}return L}};const bu=xu;function vw(r,e){return r+e[1]-e[0]}function xw(r,e,i,o,l=1){const d=[],f=r.imagePrimary,g=f.pixelRatio,x=f.paddedRect.w-2*bu,w=f.paddedRect.h-2*bu,A=(r.right-r.left)*l,I=(r.bottom-r.top)*l,P=f.stretchX||[[0,x]],L=f.stretchY||[[0,w]],z=P.reduce(vw,0),B=L.reduce(vw,0),H=x-z,Z=w-B;let te=0,J=z,U=0,X=B,ee=0,ne=H,me=0,xe=Z;if(f.content&&o){const Pe=f.content;te=$_(P,0,Pe[0]),U=$_(L,0,Pe[1]),J=$_(P,Pe[0],Pe[2]),X=$_(L,Pe[1],Pe[3]),ee=Pe[0]-te,me=Pe[1]-U,ne=Pe[2]-Pe[0]-J,xe=Pe[3]-Pe[1]-X}const Se=(Pe,He,nt,et)=>{const rt=G_(Pe.stretch-te,J,A,r.left*l),lt=H_(Pe.fixed-ee,ne,Pe.stretch,z),je=G_(He.stretch-U,X,I,r.top*l),it=H_(He.fixed-me,xe,He.stretch,B),Ne=G_(nt.stretch-te,J,A,r.left*l),Ge=H_(nt.fixed-ee,ne,nt.stretch,z),ut=G_(et.stretch-U,X,I,r.top*l),dt=H_(et.fixed-me,xe,et.stretch,B),Nt=new gt(rt,je),Mt=new gt(Ne,je),xt=new gt(Ne,ut),ct=new gt(rt,ut),ci=new gt(lt/g,it/g),zt=new gt(Ge/g,dt/g),Ot=e*Math.PI/180;if(Ot){const Ti=Math.sin(Ot),pr=Math.cos(Ot),Ir=[pr,-Ti,Ti,pr];Nt._matMult(Ir),Mt._matMult(Ir),ct._matMult(Ir),xt._matMult(Ir)}const oi=Pe.stretch+Pe.fixed,yi=nt.stretch+nt.fixed,bi=He.stretch+He.fixed,Mi=et.stretch+et.fixed,Ai=r.imageSecondary;return{tl:Nt,tr:Mt,bl:ct,br:xt,texPrimary:{x:f.paddedRect.x+bu+oi,y:f.paddedRect.y+bu+bi,w:yi-oi,h:Mi-bi},texSecondary:Ai?{x:Ai.paddedRect.x+bu+oi,y:Ai.paddedRect.y+bu+bi,w:yi-oi,h:Mi-bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ci,pixelOffsetBR:zt,minFontScaleX:ne/g/A,minFontScaleY:xe/g/I,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Pe=bw(P,H,z),He=bw(L,Z,B);for(let nt=0;nt<Pe.length-1;nt++){const et=Pe[nt],rt=Pe[nt+1];for(let lt=0;lt<He.length-1;lt++)d.push(Se(et,He[lt],rt,He[lt+1]))}}else d.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return d}function $_(r,e,i){let o=0;for(const l of r)o+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return o}function bw(r,e,i){const o=[{fixed:-1,stretch:0}];for(const[l,d]of r){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return o.push({fixed:e+bu,stretch:i}),o}function G_(r,e,i,o){return r/e*i+o}function H_(r,e,i,o){return r-e*i/o}function pP(r,e,i,o){const l=e+r.positionedLines[o].lineOffset;return o===0?i+l/2:i+(l+(e+r.positionedLines[o-1].lineOffset))/2}function mP(r,e=1,i=!1){let o=1/0,l=1/0,d=-1/0,f=-1/0;const g=r[0];for(let L=0;L<g.length;L++){const z=g[L];(!L||z.x<o)&&(o=z.x),(!L||z.y<l)&&(l=z.y),(!L||z.x>d)&&(d=z.x),(!L||z.y>f)&&(f=z.y)}const x=Math.min(d-o,f-l);let w=x/2;const A=new lh([],_P);if(x===0)return new gt(o,l);for(let L=o;L<d;L+=x)for(let z=l;z<f;z+=x)A.push(new ed(L+w,z+w,w,r));let I=function(L){let z=0,B=0,H=0;const Z=L[0];for(let te=0,J=Z.length,U=J-1;te<J;U=te++){const X=Z[te],ee=Z[U],ne=X.x*ee.y-ee.x*X.y;B+=(X.x+ee.x)*ne,H+=(X.y+ee.y)*ne,z+=3*ne}return new ed(B/z,H/z,0,L)}(r),P=A.length;for(;A.length;){const L=A.pop();(L.d>I.d||!I.d)&&(I=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,P)),L.max-I.d<=e||(w=L.h/2,A.push(new ed(L.p.x-w,L.p.y-w,w,r)),A.push(new ed(L.p.x+w,L.p.y-w,w,r)),A.push(new ed(L.p.x-w,L.p.y+w,w,r)),A.push(new ed(L.p.x+w,L.p.y+w,w,r)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function _P(r,e){return e.max-r.max}class ed{constructor(e,i,o,l){this.p=new gt(e,i),this.h=o,this.d=function(d,f){let g=!1,x=1/0;for(let w=0;w<f.length;w++){const A=f[w];for(let I=0,P=A.length,L=P-1;I<P;L=I++){const z=A[I],B=A[L];z.y>d.y!=B.y>d.y&&d.x<(B.x-z.x)*(d.y-z.y)/(B.y-z.y)+z.x&&(g=!g),x=Math.min(x,Vi(d,z,B))}}return(g?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const gP=Object.keys,Nv=Number.POSITIVE_INFINITY,yP=Math.sqrt(2);function ww(r,[e,i]){let o=0,l=0;if(i===Nv){e<0&&(e=0);const d=e/yP;switch(r){case"top-right":case"top-left":l=d-7;break;case"bottom-right":case"bottom-left":l=7-d;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(r){case"top-right":case"bottom-right":o=-d;break;case"top-left":case"bottom-left":o=d;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(r){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,l]}function q_(r,e,i,o,l,d,f,g,x){if(!e||!e.usvg)return;const w=lw(o),A=lw(l),I=d!=="both"&&d!=="width"||!ow(o)?1:Math.max(1,A.width/w.width),P=d!=="both"&&d!=="height"||!aw(o)?1:Math.max(1,A.height/w.height);i.scaleSelf(I,P);const L=i.toString();f.set(L,i),g.set(L,e);const{imagePosition:z}=Fv(L,e,xu);x.set(L,z)}function Tw(r,e,i,o,l,d,f,g){if(!r)return;const x=function(w,A,I,P,L){if(w.kind==="camera")return w.maxSize;if(w.kind==="composite"){const z=A.possiblyEvaluate(new cr(w.maxZoom),I).evaluate(L,{},I),B=A.possiblyEvaluate(new cr(w.minZoom),I).evaluate(L,{},I);return Math.max(z,B)}return A.possiblyEvaluate(new cr(P)).evaluate(L,{},I)}(e,i,o,l,d);return r.scaleSelf(x*g*f)}function Sw(r,e,i,o,l,d,f,g){return{iconPrimary:Tw(r.getPrimary(),e,i,o,l,d,f,g),iconSecondary:Tw(r.getSecondary(),e,i,o,l,d,f,g)}}function Ew(r,e,i,o){if(!r)return;const l=e.get(i.toString());if(r.imagePrimary=l,o){const d=e.get(o.toString());r.imageSecondary=d}}function vP(r,e){for(const i in r.horizontal)Aw(r.horizontal[i],e);Aw(r.vertical,e)}function Aw(r,e){if(r){for(const i of r.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const l=o.image.toString();o.rect=e.get(l).paddedRect}}}function Uv(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xP(r,e,i,o,l,d,f,g,x){const w=Vv(d.horizontal)||d.vertical,A=i.get("icon-text-fit-padding").evaluate(o,{},l);let I,P=e;return e&&x!=="none"&&(r.allowVerticalPlacement&&d.vertical&&(I=sw(e,d.vertical,x,A,g,f)),w&&(P=sw(e,w,x,A,g,f))),{defaultShapedIcon:P,verticallyShapedIcon:I}}function bP(r,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z,te,J){let U=f.textMaxSize.evaluate(e,{},P);U===void 0?U=g*f.textScaleFactor:U*=f.textScaleFactor;const X=r.layers[0].layout,ee=Vv(i.horizontal)||i.vertical,ne=L.name==="globe",me=On,xe=r.tilePixelRatio*U/me,Se=(lt=r.overscaling,r.zoom>18&&lt>2&&(lt>>=1),Math.max(vt/(512*lt),1)*X.get("symbol-spacing")),Pe=X.get("text-padding")*r.tilePixelRatio,He=X.get("icon-padding")*r.tilePixelRatio,nt=G(X.get("text-max-angle")),et=X.get("icon-rotation-alignment")==="map"&&J!=="point",rt=Se/2;var lt;r.hasAnyIconTextFit===!1&&H!=="none"&&(r.hasAnyIconTextFit=!0);const je=e.properties?+e.properties[_u]:null,it=je&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(je):65535,Ne=(Ge,ut,dt)=>{if(ut.x<0||ut.x>=vt||ut.y<0||ut.y>=vt)return;let Nt=null;if(ne){const{x:Mt,y:xt,z:ct}=L.projectTilePoint(ut.x,ut.y,dt);Nt={anchor:new tl(Mt,xt,ct,0,void 0),up:L.upVector(dt,ut.x,ut.y)}}(function(Mt,xt,ct,ci,zt,Ot,oi,yi,bi,Mi,Ai,Ti,pr,Ir,ie,se,Ze,mt,wt,bt,Ft,ri,zi,Oi,Si,or,br,Fi,Gr){const Cr=Mt.addToLineVertexArray(xt,ci);let rr,en,Rr,wr,Pr,ar,Pi,dr=0,Hr=0,ii=0,$i=0,Dr=-1,Kr=-1;const Or={};let mn=xs("");const mr=ct?ct.anchor:xt,hn=Fi!=="none";let Ss=0,$n=0;if(bi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _n=bi.layout.get("text-offset").evaluate(Ft,{},Si);Ss=_n[0]*On,$n=_n[1]*On}else Ss=bi.layout.get("text-radial-offset").evaluate(Ft,{},Si)*On,$n=Nv;if(Mt.allowVerticalPlacement&&zt.vertical){const _n=zt.vertical;if(ie)ar=jv(_n),yi&&(Pi=jv(yi));else{const En=bi.layout.get("text-rotate").evaluate(Ft,{},Si)+90;Rr=W_(Mi,mr,xt,Ai,Ti,pr,_n,Ir,En,se),yi&&(wr=W_(Mi,mr,xt,Ai,Ti,pr,yi,mt,En))}}if(Ot){const _n=Mt.iconSizeData,En=bi.layout.get("icon-rotate").evaluate(Ft,{},Si),Gn=xw(Ot,En,zi,hn,ri.iconScaleFactor),cs=yi?xw(yi,En,zi,hn,ri.iconScaleFactor):void 0;en=W_(Mi,mr,xt,Ai,Ti,pr,Ot,mt,En,null),dr=4*Gn.length;let Kn=null;_n.kind==="source"?(Kn=[ya*bi.layout.get("icon-size").evaluate(Ft,{},Si)*ri.iconScaleFactor],Kn[0]>Ql&&ki(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${mp}. Reduce your "icon-size".`)):_n.kind==="composite"&&(Kn=[ya*ri.compositeIconSizes[0].evaluate(Ft,{},Si)*ri.iconScaleFactor,ya*ri.compositeIconSizes[1].evaluate(Ft,{},Si)*ri.iconScaleFactor],(Kn[0]>Ql||Kn[1]>Ql)&&ki(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${mp}. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,Gn,Kn,bt,wt,Ft,void 0,ct,xt,Cr.lineStartIndex,Cr.lineLength,-1,Oi,Si,or,br),Dr=Mt.icon.placedSymbolArray.length-1,cs&&(Hr=4*cs.length,Mt.addSymbols(Mt.icon,cs,Kn,bt,wt,Ft,Ls.vertical,ct,xt,Cr.lineStartIndex,Cr.lineLength,-1,Oi,Si,or,br),Kr=Mt.icon.placedSymbolArray.length-1)}for(const _n in zt.horizontal){const En=_n,Gn=zt.horizontal[En];rr||(mn=xs(Gn.text),ie?Pr=jv(Gn):rr=W_(Mi,mr,xt,Ai,Ti,pr,Gn,Ir,bi.layout.get("text-rotate").evaluate(Ft,{},Si),se));const cs=Gn.positionedLines.length===1;if(ii+=Iw(Mt,ct,xt,Gn,oi,bi,ie,Ft,se,Cr,zt.vertical?Ls.horizontal:Ls.horizontalOnly,cs?gP(zt.horizontal):[En],Or,Dr,ri,Oi,Si,or),cs)break}zt.vertical&&($i+=Iw(Mt,ct,xt,zt.vertical,oi,bi,ie,Ft,se,Cr,Ls.vertical,["vertical"],Or,Kr,ri,Oi,Si,or));let Un=-1;const Es=(_n,En)=>_n?Math.max(_n,En):En;Un=Es(Pr,Un),Un=Es(ar,Un),Un=Es(Pi,Un);const va=Un>-1?1:0;Mt.glyphOffsetArray.length>=65535&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ft.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,Ft.sortKey),Mt.symbolInstances.emplaceBack(xt.x,xt.y,mr.x,mr.y,mr.z,Or.right>=0?Or.right:-1,Or.center>=0?Or.center:-1,Or.left>=0?Or.left:-1,Or.vertical>=0?Or.vertical:-1,Dr,Kr,mn,rr!==void 0?rr:Mt.collisionBoxArray.length,rr!==void 0?rr+1:Mt.collisionBoxArray.length,Rr!==void 0?Rr:Mt.collisionBoxArray.length,Rr!==void 0?Rr+1:Mt.collisionBoxArray.length,en!==void 0?en:Mt.collisionBoxArray.length,en!==void 0?en+1:Mt.collisionBoxArray.length,wr||Mt.collisionBoxArray.length,wr?wr+1:Mt.collisionBoxArray.length,Ai,ii,$i,dr,Hr,va,0,Ss,$n,Un,0,hn?1:0,Gr)})(r,ut,Nt,Ge,i,o,d,l,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Pe,te,w,0,He,et,Z,e,f,A,I,P,z,B,H,it)};if(J==="line")for(const Ge of N_(e.geometry,0,0,vt,vt)){const ut=fP(Ge,Se,nt,i.vertical||ee,o,me,xe,r.overscaling,vt);for(const dt of ut)ee&&wP(r,ee.text,rt,dt)||Ne(Ge,dt,P)}else if(J==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const ut=dP(Ge,nt,i.vertical||ee,o,me,xe);ut&&Ne(Ge,ut,P)}}else if(e.type==="Polygon")for(const Ge of D_(e.geometry,0)){const ut=mP(Ge,16);Ne(Ge[0],new tl(ut.x,ut.y,0,0,void 0),P)}else if(e.type==="LineString")for(const Ge of e.geometry)Ne(Ge,new tl(Ge[0].x,Ge[0].y,0,0,void 0),P);else if(e.type==="Point")for(const Ge of e.geometry)for(const ut of Ge)Ne([ut],new tl(ut.x,ut.y,0,0,void 0),P)}const mp=255,Ql=mp*ya;function Iw(r,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H,Z){const te=function(X,ee,ne,me,xe,Se,Pe,He){const nt=[];if(ee.positionedLines.length===0)return nt;const et=me.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,rt=function(Ge){const ut=Ge[0],dt=Ge[1],Nt=ut*dt;return Nt>0?[ut,-dt]:Nt<0?[-ut,dt]:ut===0?[dt,ut]:[dt,-ut]}(ne);let lt=Math.abs(ee.top-ee.bottom);for(const Ge of ee.positionedLines)lt-=Ge.lineOffset;const je=ee.positionedLines.length,it=lt/je;let Ne=ee.top-ne[1];for(let Ge=0;Ge<je;++Ge){const ut=ee.positionedLines[Ge];Ne=pP(ee,it,Ne,Ge);for(const dt of ut.positionedGlyphs){if(!dt.rect)continue;const Nt=dt.rect||{};let Mt=lP+1,xt=!0,ct=1,ci=0;if(dt.image){const Ft=Pe.get(dt.image.toString());if(!Ft)continue;if(Ft.sdf){ki("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,ct=Ft.pixelRatio,Mt=xu/ct}const zt=(xe||He)&&dt.vertical,Ot=dt.metrics.advance*dt.scale/2,oi=dt.metrics,yi=dt.rect;if(yi===null)continue;He&&ee.verticalizable&&(ci=dt.image?Ot-dt.metrics.width*dt.scale/2:0);const bi=xe?[dt.x+Ot,dt.y]:[0,0];let Mi=[0,0],Ai=[0,0],Ti=!1;xe||(zt?(Ai=[dt.x+Ot+rt[0],dt.y+rt[1]-ci],Ti=!0):Mi=[dt.x+Ot+ne[0],dt.y+ne[1]-ci]);const pr=yi.w*dt.scale/(ct*(dt.localGlyph?Vo:1)),Ir=yi.h*dt.scale/(ct*(dt.localGlyph?Vo:1));let ie,se,Ze,mt;if(zt){const Ft=dt.y-Ne,ri=new gt(-Ot,Ot-Ft),zi=-Math.PI/2,Oi=new gt(...Ai);ie=new gt(-Ot+Mi[0],Mi[1]),ie._rotateAround(zi,ri)._add(Oi),ie.x+=-Ft+Ot,ie.y-=(oi.left-Mt)*dt.scale;const Si=dt.image?oi.advance*dt.scale:On*dt.scale,or=String.fromCodePoint(dt.glyph);iP(or)?ie.x+=(1-Mt)*dt.scale:rP(or)?ie.x+=Si-oi.height*dt.scale+(-Mt-1)*dt.scale:ie.x+=dt.image||oi.width+2*Mt===yi.w&&oi.height+2*Mt===yi.h?(Si-Ir)/2:(Si-(oi.height+2*Mt)*dt.scale)/2,se=new gt(ie.x,ie.y-pr),Ze=new gt(ie.x+Ir,ie.y),mt=new gt(ie.x+Ir,ie.y-pr)}else{const Ft=(oi.left-Mt)*dt.scale-Ot+Mi[0],ri=(-oi.top-Mt)*dt.scale+Mi[1],zi=Ft+pr,Oi=ri+Ir;ie=new gt(Ft,ri),se=new gt(zi,ri),Ze=new gt(Ft,Oi),mt=new gt(zi,Oi)}if(et){let Ft;Ft=xe?new gt(0,0):Ti?new gt(rt[0],rt[1]):new gt(ne[0],ne[1]),ie._rotateAround(et,Ft),se._rotateAround(et,Ft),Ze._rotateAround(et,Ft),mt._rotateAround(et,Ft)}const wt=new gt(0,0),bt=new gt(0,0);nt.push({tl:ie,tr:se,bl:Ze,br:mt,texPrimary:Nt,texSecondary:void 0,writingMode:ee.writingMode,glyphOffset:bi,sectionIndex:dt.sectionIndex,isSDF:xt,pixelOffsetTL:wt,pixelOffsetBR:bt,minFontScaleX:0,minFontScaleY:0})}}return nt}(0,o,x,d,f,g,l,r.allowVerticalPlacement),J=r.textSizeData;let U=null;J.kind==="source"?(U=[ya*d.layout.get("text-size").evaluate(g,{},H)*z.textScaleFactor],U[0]>Ql&&ki(`${r.layerIds[0]}: Value for "text-size" is >= ${mp}. Reduce your "text-size".`)):J.kind==="composite"&&(U=[ya*z.compositeTextSizes[0].evaluate(g,{},H)*z.textScaleFactor,ya*z.compositeTextSizes[1].evaluate(g,{},H)*z.textScaleFactor],(U[0]>Ql||U[1]>Ql)&&ki(`${r.layerIds[0]}: Value for "text-size" is >= ${mp}. Reduce your "text-size".`)),r.addSymbols(r.text,te,U,x,f,g,A,e,i,w.lineStartIndex,w.lineLength,L,B,H,Z,!1);for(const X of I)P[X]=r.text.placedSymbolArray.length-1;return 4*te.length}function Vv(r){for(const e in r)return r[e];return null}function W_(r,e,i,o,l,d,f,g,x,w){let A=f.top,I=f.bottom,P=f.left,L=f.right;if(nw(f)&&f.collisionPadding){const z=f.collisionPadding;P-=z[0],A-=z[1],L+=z[2],I+=z[3]}if(x){const z=new gt(P,A),B=new gt(L,A),H=new gt(P,I),Z=new gt(L,I),te=G(x);let J=new gt(0,0);w&&(J=new gt(w[0],w[1])),z._rotateAround(te,J),B._rotateAround(te,J),H._rotateAround(te,J),Z._rotateAround(te,J),P=Math.min(z.x,B.x,H.x,Z.x),L=Math.max(z.x,B.x,H.x,Z.x),A=Math.min(z.y,B.y,H.y,Z.y),I=Math.max(z.y,B.y,H.y,Z.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,A,L,I,g,o,l,d),r.length-1}function jv(r){nw(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function wP(r,e,i,o){const l=r.compareText;if(e in l){const d=l[e];for(let f=d.length-1;f>=0;f--)if(o.dist(d[f])<i)return!0}else l[e]=[];return l[e].push(o),!1}function Cw(r,e){const i=r.fovAboveCenter,o=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,l=(r._camera.position[2]*r.worldSize-o)/Math.cos(r._pitch),d=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let f=Math.sin(r._pitch)*d+l;const g=l*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let x=Math.max(r.zoom-17,0);r.isOrthographic&&(x/=10),f*=1+x}return Math.min(1.01*f,g)}function _p(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),o=r.x*i,l=(r.x+1)*i,d=r.y*i,f=(r.y+1)*i,g=_e(o),x=_e(l),w=ge(d),A=ge(f),I=e.project(g,w),P=e.project(x,w),L=e.project(x,A),z=e.project(g,A);let B=Math.min(I.x,P.x,L.x,z.x),H=Math.min(I.y,P.y,L.y,z.y),Z=Math.max(I.x,P.x,L.x,z.x),te=Math.max(I.y,P.y,L.y,z.y);const J=i/16;function U(ee,ne,me,xe,Se,Pe){const He=(me+Se)/2,nt=(xe+Pe)/2,et=e.project(_e(He),ge(nt)),rt=Math.max(0,B-et.x,H-et.y,et.x-Z,et.y-te);B=Math.min(B,et.x),Z=Math.max(Z,et.x),H=Math.min(H,et.y),te=Math.max(te,et.y),rt>J&&(U(ee,et,me,xe,He,nt),U(et,ne,He,nt,Se,Pe))}U(I,P,o,d,l,d),U(P,L,l,d,l,f),U(L,z,l,f,o,f),U(z,I,o,f,o,d),B-=J,H-=J,Z+=J,te+=J;const X=1/Math.max(Z-B,te-H);return{scale:X,x:B*X,y:H*X,x2:Z*X,y2:te*X,projection:e}}function Pw(r,{x:e,y:i},o=0){return new gt(((e-o)*r.scale-r.x)*vt,(i*r.scale-r.y)*vt)}const TP=pe(new Float32Array(16));class ec{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new $(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,l=!0){return e._coordinatePoint(e.locationCoordinate(i,o),l)}pixelsPerMeter(e,i){return ae(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return Cw(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,l){const d=e.horizonLineFromTop(!1),f=new gt(i,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,i,o){const l=new gt(i,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return TP}createTileMatrix(e,i,o){let l,d,f;const g=o.canonical,x=pe(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=_p(g,this);l=1,d=w.x+o.wrap*w.scale,f=w.y,be(x,x,[l/w.scale,l/w.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*o.wrap)*l,f=g.y*l;return ze(x,x,[d,f,0]),be(x,x,[l/vt,l/vt,1]),x}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class SP extends ec{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(G(i));this.n=(l+Math.sin(G(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:l,r0:d}=this,f=G(e-this.center[0]),g=G(i),x=Math.sqrt(l-2*o*Math.sin(g))/o;return{x:x*Math.sin(f*o),y:x*Math.cos(f*o)-d,z:0}}unproject(e,i){const{n:o,c:l,r0:d}=this,f=d+i;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const x=G(this.center[0])*o;g=Ue(g,-Math.PI-x,Math.PI-x);const w=Ae(K(g/o)+this.center[0],-180,180),A=Math.asin(Ae((l-(e*e+f*f)*o*o)/(2*o),-1,1)),I=Ae(K(A),-85.051129,Re);return new $(w,I)}}const gp=1.340264,yp=-.081106,vp=893e-6,xp=.003796,Z_=Math.sqrt(3)/2;class EP extends ec{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Z_*Math.sin(i)),l=o*o,d=l*l*l;return{x:.5*(e*Math.cos(o)/(Z_*(gp+3*yp*l+d*(7*vp+9*xp*l)))/Math.PI+.5),y:1-.5*(o*(gp+yp*l+d*(vp+xp*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=o*o,d=l*l*l;for(let A,I,P,L=0;L<12&&(I=o*(gp+yp*l+d*(vp+xp*l))-i,P=gp+3*yp*l+d*(7*vp+9*xp*l),A=I/P,o=Ae(o-A,-Math.PI/3,Math.PI/3),l=o*o,d=l*l*l,!(Math.abs(A)<1e-12));++L);const f=Z_*e*(gp+3*yp*l+d*(7*vp+9*xp*l))/Math.cos(o),g=Math.asin(Math.sin(o)/Z_),x=Ae(180*f/Math.PI,-180,180),w=Ae(180*g/Math.PI,-85.051129,Re);return new $(x,w)}}class AP extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),l=Ae(360*(.5-i),-85.051129,Re);return new $(o,l)}}const td=Math.PI/2;function X_(r){return Math.tan((td+r)/2)}class IP extends ec{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let l=G(i),d=G(o);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);const f=Math.cos(l),g=X_(l);this.n=l===d?Math.sin(l):Math.log(f/Math.cos(d))/Math.log(X_(d)/g),this.f=f*Math.pow(X_(l),this.n)/this.n}project(e,i){i=G(i),this.southernCenter&&(i=-i),e=G(e-this.center[0]);const o=1e-6,{n:l,f:d}=this;d>0?i<-td+o&&(i=-td+o):i>td-o&&(i=td-o);const f=d/Math.pow(X_(i),l);let g=f*Math.sin(l*e),x=d-f*Math.cos(l*e);return g=.5*(g/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:g,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:l}=this,d=l-i,f=Math.sign(d),g=Math.sign(o)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*o<0&&(x-=Math.PI*Math.sign(e)*f);const w=Ae(K(x/o)+this.center[0],-180,180),A=Ae(K(2*Math.atan(Math.pow(l/g,1/o))-td),-85.051129,Re);return new $(w,this.southernCenter?-A:A)}}class Mw extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ue(e),y:he(i),z:0}}unproject(e,i){const o=_e(e),l=ge(i);return new $(o,l)}}const Rw=G(Re);class CP extends ec{project(e,i){const o=(i=G(i))*i,l=o*o;return{x:.5*((e=G(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=25,d=0,f=o*o;do{f=o*o;const w=f*f;d=(o*(1.007226+f*(.015085+w*(.028874*f-.044475-.005916*w)))-i)/(1.007226+f*(.045255+w*(.259866*f-.311325-.005916*11*w))),o=Ae(o-d,-Rw,Rw)}while(Math.abs(d)>1e-6&&--l>0);f=o*o;const g=Ae(K(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=K(o);return new $(g,x)}}const Dw=G(Re);class PP extends ec{project(e,i){i=G(i),e=G(e);const o=Math.cos(i),l=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),f=Math.sin(d)/d,g=.5*(e*l+2*o*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let g=0,x=0;do{const w=Math.cos(l),A=Math.sin(l),I=2*A*w,P=A*A,L=w*w,z=Math.cos(o/2),B=Math.sin(o/2),H=2*z*B,Z=B*B,te=1-L*z*z,J=te?1/te:0,U=te?Math.acos(w*z)*Math.sqrt(1/te):0,X=.5*(2*U*w*B+2*o/Math.PI)-e,ee=.5*(U*A+l)-i,ne=.5*J*(L*Z+U*w*z*P)+1/Math.PI,me=J*(H*I/4-U*A*B),xe=.125*J*(I*B-U*A*L*H),Se=.5*J*(P*z+U*Z*w)+.5,Pe=me*xe-Se*ne;g=(ee*me-X*Se)/Pe,x=(X*xe-ee*ne)/Pe,o=Ae(o-g,-Math.PI,Math.PI),l=Ae(l-x,-Dw,Dw)}while((Math.abs(g)>f||Math.abs(x)>f)&&--d>0);return new $(K(o),K(l))}}class kw extends ec{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(G(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:l}=this;return{x:G(e)*l*o+.5,y:-Math.sin(G(i))/l*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:l}=this,d=-(i-.5)/o,f=Ae(K((e-.5)/o)/l,-180,180),g=Math.asin(Ae(d*l,-1,1)),x=Ae(K(g),-85.051129,Re);return new $(f,x)}}class MP extends Mw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const l=Qf(e,i,o);return $t(l,l,P_(_a(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i,o){const l=j(i.lat,i.lng),d=gr([],l),f=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;vn(l,l,d,ae(1,0)*vt*f);const g=pe(new Float64Array(16));return $e(g,e.pixelMatrix,e.globeMatrix),$t(l,l,g),new gt(l[0],l[1])}pixelsPerMeter(e,i){return ae(1,0)*i}pixelSpaceConversion(e,i,o){const l=ae(1,e)*i,d=Kt(ae(1,45)*i,l,o);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,o){const l=ov(_a(o.canonical));return $e(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:o}=e,l=P_(_a(i));return Ke(l,l,G(o.lng)),ke(l,l,G(o.lat)),be(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,o,l){return gb(e,i,o,!0)||new Fe(0,0)}pointCoordinate3D(e,i,o){const l=this.pointCoordinate(e,i,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!gb(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,d){const f=l.cameraToCenterDistance,g=l._centerAltitude*d,x=l._camera,w=l._camera.forward(),A=Ni([],Yi([],w,-f),[0,0,g]),I=l.worldSize/(2*Math.PI),P=[0,0,-I],L=l.width/l.height,z=Math.tan(l.fovAboveCenter),B=Yi([],x.up(),z),H=Yi([],x.right(),z*L),Z=gr([],Ni([],Ni([],w,B),H)),te=[];let J;if(new oo(A,Z).closestPointOnSphere(P,I,te)){const U=Ni([],te,P),X=we([],U,A);J=Math.cos(l.fovAboveCenter)*di(X)}else{const U=we([],A,P),X=we([],P,A);gr(X,X);const ee=di(U)-I;J=Math.sqrt(ee*(ee+2*I));const ne=Math.acos(J/(I+ee))-Math.acos(tr(w,X));J*=Math.cos(ne)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Xl(e.zoom);if(o>0){const l=Cw(e,ae(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Kt(i,l+d*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return Qf(i,o,e,1)}upVectorScale(e){return{metersToTile:Zl(C_(_a(e)))}}}function Lw(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Mw(r);case"equirectangular":return new AP(r);case"naturalEarth":return new CP(r);case"equalEarth":return new EP(r);case"winkelTripel":return new PP(r);case"albers":return i?new kw(r):new SP(r);case"lambertConformalConic":return i?new kw(r):new IP(r);case"globe":return new MP(r)}throw new Error(`Invalid projection name: ${r.name}`)}const RP=Yl.VectorTileFeature.types,DP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function K_(r,e,i,o,l,d,f,g,x,w,A,I,P){const L=g?Math.min(Ql,Math.round(g[0])):0,z=g?Math.min(Ql,Math.round(g[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*l),d,f,(L<<1)+(x?1:0),z,16*w,16*A,256*I,256*P)}function Y_(r,e,i){r.emplaceBack(e,i)}function J_(r,e,i,o,l,d,f){r.emplaceBack(e,i,o,l,d,f)}function Q_(r,e,i,o,l){r.emplaceBack(e,i,o,l),r.emplaceBack(e,i,o,l),r.emplaceBack(e,i,o,l),r.emplaceBack(e,i,o,l)}function kP(r){for(const e of r.sections)if(Zy(e.text))return!0;return!1}class $v{constructor(e){this.layoutVertexArray=new jl,this.indexArray=new Mn,this.programConfigurations=e,this.segments=new $r,this.dynamicLayoutVertexArray=new go,this.opacityVertexArray=new jf,this.placedSymbolArray=new p_,this.iconTransitioningVertexArray=new fa,this.globeExtVertexArray=new _s,this.zOffsetVertexArray=new Ul}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,l,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,XC.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,DP,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,YC.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ZC.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,KC.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}It($v,"SymbolBuffers");class Gv{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new $r,this.collisionVertexArray=new Gf,this.collisionVertexArrayExt=new go}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,JC.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,QC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}It(Gv,"CollisionBuffers");class eg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pe([]),this.placementViewportMatrix=pe([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cw(this.zoom,i["text-size"]),this.iconSizeData=cw(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Ls[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new $v(new Ja(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new $v(new Ja(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Kf,this.lineVertexArray=new g_,this.symbolInstances=new __}calculateGlyphDependencies(e,i,o,l,d){for(const f of e){const g=f.codePointAt(0);if(g===void 0)break;if(i[g]=!0,l&&d&&g<=65535){const x=hp[f];x&&(i[x.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Sv(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,l){const d=this.layers[0],f=d.layout,g=this.projection.name==="globe",x=f.get("text-font"),w=f.get("text-field"),A=f.get("icon-image"),[I,P]=f.get("icon-size-scale-range"),L=Ae(i.scaleFactor||1,I,P),z=(w.value.kind!=="constant"||w.value.value instanceof ns&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,H=f.get("symbol-sort-key");if(this.features=[],!z&&!B)return;const Z=i.iconDependencies,te=i.glyphDependencies,J=i.availableImages,U=new cr(this.zoom);for(const{feature:X,id:ee,index:ne,sourceLayerIndex:me}of e){const xe=d._featureFilter.needGeometry,Se=Ut(X,xe);if(!d._featureFilter.filter(U,Se,o))continue;if(xe||(Se.geometry=Rt(X,o,l)),g&&X.type!==1&&o.z<=5){const rt=Se.geometry,lt=.98078528056,je=(it,Ne)=>tr(Qf(it.x,it.y,o,1),Qf(Ne.x,Ne.y,o,1))<lt;for(let it=0;it<rt.length;it++)rt[it]=st(rt[it],je)}let Pe,He;if(z){const rt=d.getValueAndResolveTokens("text-field",Se,o,J),lt=ns.factory(rt);kP(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fl()==="unavailable"||this.hasRTLText&&$s.isParsed())&&(Pe=tP(lt,d,Se))}if(B){const rt=d.getValueAndResolveTokens("icon-image",Se,o,J);He=typeof rt=="string"?ps.build(rt):rt}if(!Pe&&!He)continue;const nt=this.sortFeaturesByKey?H.evaluate(Se,{},o):void 0,et={id:ee,text:Pe,icon:He,index:ne,sourceLayerIndex:me,geometry:Se.geometry,properties:X.properties,type:RP[X.type],sortKey:nt};if(this.features.push(et),He){const rt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:lt,iconSecondary:je}=Sw(He,this.iconSizeData,rt["icon-size"],o,this.zoom,et,this.pixelRatio,L),it=lt.id.toString();if(Z.has(it)?Z.get(it).push(lt):Z.set(it,[lt]),je){const Ne=je.id.toString();Z.has(Ne)?Z.get(Ne).push(je):Z.set(Ne,[je])}}if(Pe){const rt=x.evaluate(Se,{},o).join(","),lt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ls.vertical)>=0;for(const je of Pe.sections)if(je.image){const it=je.image.getPrimary().scaleSelf(this.pixelRatio),Ne=it.id.toString(),Ge=Z.get(Ne)||[];Ge.push(it),Z.set(Ne,Ge)}else{const it=Mf(Pe.toString()),Ne=je.fontStack||rt,Ge=te[Ne]=te[Ne]||{};this.calculateGlyphDependencies(je.text,Ge,lt,this.allowVerticalPlacement,it)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(X){const ee={},ne={},me=[];let xe=0;function Se(et){me.push(X[et]),xe++}function Pe(et,rt,lt){const je=ne[et];return delete ne[et],ne[rt]=je,me[je].geometry[0].pop(),me[je].geometry[0]=me[je].geometry[0].concat(lt[0]),je}function He(et,rt,lt){const je=ee[rt];return delete ee[rt],ee[et]=je,me[je].geometry[0].shift(),me[je].geometry[0]=lt[0].concat(me[je].geometry[0]),je}function nt(et,rt,lt){const je=lt?rt[0][rt[0].length-1]:rt[0][0];return`${et}:${je.x}:${je.y}`}for(let et=0;et<X.length;et++){const rt=X[et],lt=rt.geometry,je=rt.text?rt.text.toString():null;if(!je){Se(et);continue}const it=nt(je,lt),Ne=nt(je,lt,!0);if(it in ne&&Ne in ee&&ne[it]!==ee[Ne]){const Ge=He(it,Ne,lt),ut=Pe(it,Ne,me[Ge].geometry);delete ee[it],delete ne[Ne],ne[nt(je,me[ut].geometry,!0)]=ut,me[Ge].geometry=null}else it in ne?Pe(it,Ne,lt):Ne in ee?He(it,Ne,lt):(Se(et),ee[it]=xe-1,ne[Ne]=xe-1)}return me.filter(et=>et.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const X of i.elevationFeatures)this.elevationFeatureIdToIndex.set(X.id,this.elevationFeatures.length),this.elevationFeatures.push(X)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((X,ee)=>X.sortKey-ee.sortKey)}update(e,i,o,l,d,f,g){this.text.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g),this.icon.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);if(o.elevationFeatureIndex===65535)continue;const l=this.elevationFeatures[o.elevationFeatureIndex];if(l){const d=.05+l.pointElevation(new gt(o.tileAnchorX,o.tileAnchorY));o.zOffset!==d&&(e=!0,o.zOffset=d)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,f,g)=>{o+=f,o>d.length&&d.resize(o);for(let x=-f;x<0;x++)d.emplace(x+o,g)},i=(d,f,g)=>{l+=f,l>d.length&&d.resize(l);for(let x=-f;x<0;x++)d.emplace(x+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,l=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:x,numIconVertices:w}=f,A=f.zOffset,I=w>0;if((g>0||x>0)&&(e(this.text.zOffsetVertexArray,g,A),e(this.text.zOffsetVertexArray,x,A)),I){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:L}=f;P>=0&&i(this.icon.zOffsetVertexArray,w,A),L>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Lw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:d}of i)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,l,d,f,g,x,w,A,I,P,L,z,B,H){const Z=e.indexArray,te=e.layoutVertexArray,J=e.globeExtVertexArray,U=e.segments.prepareSegment(4*i.length,te,Z,this.canOverlap?f.sortKey:void 0),X=this.glyphOffsetArray.length,ee=U.vertexLength,ne=this.allowVerticalPlacement&&g===Ls.vertical?Math.PI/2:0,me=f.text&&f.text.sections;for(let Se=0;Se<i.length;Se++){const{tl:Pe,tr:He,bl:nt,br:et,texPrimary:rt,texSecondary:lt,pixelOffsetTL:je,pixelOffsetBR:it,minFontScaleX:Ne,minFontScaleY:Ge,glyphOffset:ut,isSDF:dt,sectionIndex:Nt}=i[Se],Mt=U.vertexLength,xt=ut[1];if(K_(te,w.x,w.y,Pe.x,xt+Pe.y,rt.x,rt.y,o,dt,je.x,je.y,Ne,Ge),K_(te,w.x,w.y,He.x,xt+He.y,rt.x+rt.w,rt.y,o,dt,it.x,je.y,Ne,Ge),K_(te,w.x,w.y,nt.x,xt+nt.y,rt.x,rt.y+rt.h,o,dt,je.x,it.y,Ne,Ge),K_(te,w.x,w.y,et.x,xt+et.y,rt.x+rt.w,rt.y+rt.h,o,dt,it.x,it.y,Ne,Ge),x){const{x:ct,y:ci,z:zt}=x.anchor,[Ot,oi,yi]=x.up;J_(J,ct,ci,zt,Ot,oi,yi),J_(J,ct,ci,zt,Ot,oi,yi),J_(J,ct,ci,zt,Ot,oi,yi),J_(J,ct,ci,zt,Ot,oi,yi),Q_(e.dynamicLayoutVertexArray,ct,ci,zt,ne)}else Q_(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ne);if(H){const ct=lt||rt;Y_(e.iconTransitioningVertexArray,ct.x,ct.y),Y_(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),Y_(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),Y_(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}Z.emplaceBack(Mt,Mt+1,Mt+2),Z.emplaceBack(Mt+1,Mt+2,Mt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),Se!==i.length-1&&Nt===i[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,f,f.index,{},L,z,B,me&&me[Nt])}const xe=x?x.anchor:w;e.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,w.x,w.y,X,this.glyphOffsetArray.length-X,ee,A,I,w.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],g,0,0,0,P,0)}_commitLayoutVertex(e,i,o,l,d,f,g){e.emplaceBack(i,o,l,d,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,l,d,f,g){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),w=x.vertexLength,A=g.tileAnchorX,I=g.tileAnchorY;for(let L=0;L<4;L++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,A,I,new gt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,A,I,new gt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,A,I,new gt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,A,I,new gt(e.x1,e.y2)),x.vertexLength+=4;const P=o.indexArray;P.emplaceBack(w,w+1),P.emplaceBack(w+1,w+2),P.emplaceBack(w+2,w+3),P.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,l,d,f){for(let g=l;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceTextSize(e,f,i,g);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,l,d,f){for(let g=l;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gv(Vh,X1.members,fa),this.iconCollisionBox=new Gv(Vh,X1.members,fa);const l=fp(this.iconSizeData,e),d=fp(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(d,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(d,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,o,l){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),f=Ov(this.textSizeData,e,d)/On;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const l=this.icon.placedSymbolArray.get(o),d=Ov(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,o,l){e.emplaceBack(i,-o,-o,l),e.emplaceBack(i,o,-o,l),e.emplaceBack(i,o,o,l),e.emplaceBack(i,-o,o,l)}_updateTextDebugCollisionBoxes(e,i,o,l,d,f,g){for(let x=l;x<d;x++){const w=o.get(x),A=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,w.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,l,d,f,g){for(let x=l;x<d;x++){const w=o.get(x),A=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,w.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=fp(this.iconSizeData,e,l),f=fp(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x,o),this._updateTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,o),this._updateIconDebugCollisionBoxes(d,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x,l),this._updateIconDebugCollisionBoxes(d,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,l,d,f,g,x,w){const A={};if(i<o){const{x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U,featureIndex:X}=e.get(i);A.textBox={x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U},A.textFeatureIndex=X}if(l<d){const{x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U,featureIndex:X}=e.get(l);A.verticalTextBox={x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U},A.verticalTextFeatureIndex=X}if(f<g){const{x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U,featureIndex:X}=e.get(f);A.iconBox={x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U},A.iconFeatureIndex=X}if(x<w){const{x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U,featureIndex:X}=e.get(x);A.verticalIconBox={x1:I,y1:P,x2:L,y2:z,padding:B,projectedAnchorX:H,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:J,tileAnchorY:U},A.verticalIconFeatureIndex=X}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),l=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const x=this.symbolInstances.get(g);l.push(0|Math.round(i*x.tileAnchorX+o*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((g,x)=>l[g]-l[x]||d[x]-d[g]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=o;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zw,Ow,Hv;It(eg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),eg.addDynamicAttributes=Q_;class Fw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ea,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It(Fw,"FormatSectionOverride",{omit:["defaultValue"]});const qv=()=>Hv||(Hv={layout:zw||(zw=new Jr({"symbol-placement":new pt(De.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(De.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pt(De.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new pt(De.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new pt(De.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pt(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(De.layout_symbol["icon-size"]),"icon-size-scale-range":new pt(De.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new At(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(De.layout_symbol["icon-image"]),"icon-rotate":new At(De.layout_symbol["icon-rotate"]),"icon-padding":new pt(De.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(De.layout_symbol["icon-keep-upright"]),"icon-offset":new At(De.layout_symbol["icon-offset"]),"icon-anchor":new At(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(De.layout_symbol["text-rotation-alignment"]),"text-field":new At(De.layout_symbol["text-field"]),"text-font":new At(De.layout_symbol["text-font"]),"text-size":new At(De.layout_symbol["text-size"]),"text-size-scale-range":new pt(De.layout_symbol["text-size-scale-range"]),"text-max-width":new At(De.layout_symbol["text-max-width"]),"text-line-height":new At(De.layout_symbol["text-line-height"]),"text-letter-spacing":new At(De.layout_symbol["text-letter-spacing"]),"text-justify":new At(De.layout_symbol["text-justify"]),"text-radial-offset":new At(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(De.layout_symbol["text-variable-anchor"]),"text-anchor":new At(De.layout_symbol["text-anchor"]),"text-max-angle":new pt(De.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(De.layout_symbol["text-writing-mode"]),"text-rotate":new At(De.layout_symbol["text-rotate"]),"text-padding":new pt(De.layout_symbol["text-padding"]),"text-keep-upright":new pt(De.layout_symbol["text-keep-upright"]),"text-transform":new At(De.layout_symbol["text-transform"]),"text-offset":new At(De.layout_symbol["text-offset"]),"text-allow-overlap":new pt(De.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pt(De.layout_symbol["text-ignore-placement"]),"text-optional":new pt(De.layout_symbol["text-optional"]),visibility:new pt(De.layout_symbol.visibility)})),paint:Ow||(Ow=new Jr({"icon-opacity":new At(De.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new At(De.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new At(De.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new At(De.paint_symbol["text-emissive-strength"]),"icon-color":new At(De.paint_symbol["icon-color"]),"icon-halo-color":new At(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(De.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(De.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pt(De.paint_symbol["icon-image-cross-fade"]),"text-opacity":new At(De.paint_symbol["text-opacity"]),"text-occlusion-opacity":new At(De.paint_symbol["text-occlusion-opacity"]),"text-color":new At(De.paint_symbol["text-color"],{runtimeType:fs,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new At(De.paint_symbol["text-halo-color"]),"text-halo-width":new At(De.paint_symbol["text-halo-width"]),"text-halo-blur":new At(De.paint_symbol["text-halo-blur"]),"text-translate":new pt(De.paint_symbol["text-translate"]),"text-translate-anchor":new pt(De.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pt(De.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pt(De.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pt(De.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pt(De.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new At(De.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},Hv);class tg extends ls{constructor(e,i,o,l){super(e,qv(),i,o,l),this._colorAdjustmentMatrix=pe([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const d of o)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(d,f,g,x){d=Zn(d),f=Wn(f);const w=Te(),A=d/3,I=1-2*A,P=[I,A,A,0,A,I,A,0,A,A,I,0,0,0,0,1],L=.5-.5*f,z=x-g;return $e(w,[z,0,0,0,0,z,0,0,0,0,z,0,g,g,g,1],[f,0,0,0,0,f,0,0,0,0,f,0,L,L,L,1]),$e(w,w,P),w}(e,i,o,l),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,l){const d=this.layout.get(e).evaluate(i,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ph(f.value)||!d?d:function(g,x){return x.replace(/{([^{}]+)}/g,(w,A)=>A in g?String(g[A]):"")}(i.properties,d)}createBucket(e){return new eg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of qv().paint.overridableProperties){if(!tg.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Fw(i),l=new If(o,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new $a("source",l):new zl("composite",l,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Bl(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&tg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),l=qv().paint.properties[i];let d=!1;const f=g=>{for(const x of g)if(l.overrides&&l.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ns)f(o.value.value.sections);else if(o.value.kind==="source"){const g=w=>{d||(w instanceof Ci&&Sn(w.value)===Fc?f(w.value.sections):w instanceof La?f(w.sections):w.eachChild(g))},x=o.value;x._styleExpression&&g(x._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new ma(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Bw,Nw,Uw,Vw;var Wv=Ki([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Zv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Xv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Kv{constructor(e,i,o,l){this.context=e,this.format=o,this.useMipmap=l&&l.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:l&&l.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,l=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:f}=d,{x:g,y:x}=i&&i.position?i.position:{x:0,y:0},w=g+o,A=x+l;!this.size||this.size[0]===w&&this.size[1]===A||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const I=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&w>0&&A>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(w,A)))+1:1;f.texStorage2D(f.TEXTURE_2D,P,this.format,w,A),this.size=[w,A]}if(this.size)if(I)f.texSubImage2D(f.TEXTURE_2D,0,g,x,Zv(this.format),Xv(this.format),e);else{const P=e.data;P&&f.texSubImage2D(f.TEXTURE_2D,0,g,x,o,l,Zv(this.format),Xv(this.format),P)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,l){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),l!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ig{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function rg(r,e,i,o,l,d,f,g){const x=[r,e,1,i,o,1,l,d,1],w=[f,g,1],A=le([],x),[I,P,L]=Ei(w,w,A);return de(x,x,[I,0,0,0,P,0,0,0,L])}function jw(r,e,i,o,l,d,f,g){const x=function(w,A,I,P,L,z,B,H){const Z=rg(0,0,1,0,1,1,0,1),te=rg(w,A,I,P,L,z,B,H);return de(te,te,le([],Z))}(r,e,i,o,l,d,f,g);return[x[2]/x[8]/vt,x[5]/x[8]/vt]}function ng(r){return[r[0],Math.min(Math.max(r[1],-85.051129),Re)]}class $w extends Ra{constructor(e,i,o,l){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Qo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=yl(this.map._requestManager.transformRequest(this.url,Yu.Image),(o,l)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Kd(o)):l&&(this.image=l instanceof HTMLImageElement?Ks.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ig(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Qo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ig||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const d of e)d[1]>o&&(o=d[1]),d[1]<i&&(i=d[1]);const l=(o+i)/2;if(l>Re?this.onNorthPole=!0:l<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Fe.fromLngLat);this.tileID=function(f){let g=1/0,x=1/0,w=-1/0,A=-1/0;for(const B of f)g=Math.min(g,B.x),x=Math.min(x,B.y),w=Math.max(w,B.x),A=Math.max(A,B.y);const I=Math.max(w-g,A-x),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,P);let z=Math.floor((g+w)/2*L);return z>1&&(z-=1),new Ar(P,z,Math.floor((x+A)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Qo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Z in this.tiles){const te=this.tiles[Z];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=_p(new Ar(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Z){const te=Z[1].x-Z[0].x,J=Z[1].y-Z[0].y,U=Z[2].x-Z[1].x,X=Z[2].y-Z[1].y,ee=Z[3].x-Z[2].x,ne=Z[3].y-Z[2].y,me=Z[0].x-Z[3].x,xe=Z[0].y-Z[3].y,Se=te*X-U*J,Pe=U*ne-ee*X,He=ee*xe-me*ne,nt=me*J-te*xe;return Se>0&&Pe>0&&He>0&&nt>0||Se<0&&Pe<0&&He<0&&nt<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=_p(this.tileID,this.map.transform.projection),[d,f,g,x]=this.coordinates.map(Z=>{const te=l.projection.project(Z[0],Z[1]);return Pw(l,te)._round()});this.perspectiveTransform=jw(d.x,d.y,f.x,f.y,g.x,g.y,x.x,x.y);const w=this._boundsArray=new Xa;w.emplaceBack(d.x,d.y,0,0),w.emplaceBack(f.x,f.y,vt,0),w.emplaceBack(x.x,x.y,0,vt),w.emplaceBack(g.x,g.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,Wv.members),this.boundsSegments=$r.simpleSegment(0,0,4,2);const A=[],I=[ng((P=this.coordinates)[0]),ng(P[1]),ng(P[2]),ng(P[3])];var P;const[L,z,B,H]=function(Z){let te=Z[0][0],J=te,U=Z[0][1],X=U;for(let ee=1;ee<Z.length;ee++)Z[ee][0]<te?te=Z[ee][0]:Z[ee][0]>J&&(J=Z[ee][0]),Z[ee][1]<U?U=Z[ee][1]:Z[ee][1]>X&&(X=Z[ee][1]);return[te,U,J-te,X-U]}(I);{const Z=new Xa,[te,J,U,X]=function(je){let it=je[0].x,Ne=it,Ge=je[0].y,ut=Ge;for(let dt=1;dt<je.length;dt++)je[dt].x<it?it=je[dt].x:je[dt].x>Ne&&(Ne=je[dt].x),je[dt].y<Ge?Ge=je[dt].y:je[dt].y>ut&&(ut=je[dt].y);return[it,Ge,Ne-it,ut-Ge]}(o),ee=je=>[(je.x-te)/U,(je.y-J)/X],[ne,me,xe,Se]=o.map(ee),Pe=function(je,it,Ne,Ge,ut,dt,Nt,Mt){const xt=rg(0,0,1,0,1,1,0,1);return de(xt,xt,le([],rg(je,it,Ne,Ge,ut,dt,Nt,Mt)))}(ne[0],ne[1],me[0],me[1],xe[0],xe[1],Se[0],Se[1]);this.elevatedGlobePerspectiveTransform=jw(ne[0],ne[1],me[0],me[1],xe[0],xe[1],Se[0],Se[1]);const He=(je,it)=>{A.push(je.lng);const Ne=Math.round((je.lng-L)/B*vt),Ge=Math.round((je.lat-z)/H*vt),ut=ee(it),dt=Ei([],[ut[0],ut[1],1],Pe),Nt=Math.round(dt[0]/dt[2]*vt),Mt=Math.round(dt[1]/dt[2]*vt);Z.emplaceBack(Ne,Ge,Nt,Mt)},nt=o[3].x-o[0].x,et=o[3].y-o[0].y,rt=o[2].x-o[1].x,lt=o[2].y-o[1].y;for(let je=0;je<65;je++){const it=je/64,Ne=[o[0].x+it*nt,o[0].y+it*et],Ge=[o[1].x+it*rt,o[1].y+it*lt],ut=Ge[0]-Ne[0],dt=Ge[1]-Ne[1];for(let Nt=0;Nt<65;Nt++){const Mt=Nt/64,xt={x:Ne[0]+ut*Mt,y:Ne[1]+dt*Mt};He(i.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Z,Wv.members)}{this.maxLongitudeTriangleSize=0;let Z=[],te=new Mn;const J=(U,X,ee)=>{te.emplaceBack(U,X,ee);const ne=A[U],me=A[X],xe=A[ee],Se=Math.min(Math.min(ne,me),xe),Pe=Math.max(Math.max(ne,me),xe)-Se;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),Z.push(Se+Pe/2)};for(let U=0;U<64;U++)for(let X=0;X<64;X++){const ee=65*U+X,ne=ee+1,me=ee+65,xe=me+1;J(ee,me,ne),J(ne,me,xe)}[Z,te]=function(U,X){const ee=Array.from({length:U.length},(xe,Se)=>Se);ee.sort((xe,Se)=>U[xe]-U[Se]);const ne=[],me=new Mn;for(let xe=0;xe<ee.length;xe++){const Se=ee[xe];ne.push(U[Se]);const Pe=3*Se,He=Pe+1;me.emplaceBack(X.uint16[Pe],X.uint16[He],X.uint16[He+1])}return[ne,me]}(Z,te),this.elevatedGlobeTrianglesCenterLongitudes=Z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(te)}this.elevatedGlobeSegments=$r.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/vt,0,H/vt,0,0,z,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof ig||(this.texture?this.texture.update(this.image):(this.texture=new Kv(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let l=(d=e+180)+360*Math.round((o[0]-d)/360);var d;const f=new $r,g=(I,P)=>{f.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:i.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-l)<=x){const I=Mo(o,0,o.length,l+x);return I===o.length||g(I,Bn(o,I+1,o.length,l+360-x)-I),f}l<o[0]&&(l+=360);const w=Bn(o,0,o.length,l-x);if(w===o.length)return g(0,o.length),f;g(0,w-0);const A=Mo(o,w+1,o.length,l+x);return A!==o.length&&g(A,o.length-A),f}}const LP=(Math.pow(256,2)-1)/16907520;class Gw extends ls{constructor(e,i,o,l){super(e,{layout:Uw||(Uw=new Jr({visibility:new pt(De.layout_raster.visibility)})),paint:Vw||(Vw=new Jr({"raster-opacity":new pt(De.paint_raster["raster-opacity"]),"raster-color":new Wa(De.paint_raster["raster-color"]),"raster-color-mix":new pt(De.paint_raster["raster-color-mix"]),"raster-color-range":new pt(De.paint_raster["raster-color-range"]),"raster-hue-rotate":new pt(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(De.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(De.paint_raster["raster-saturation"]),"raster-contrast":new pt(De.paint_raster["raster-contrast"]),"raster-resampling":new pt(De.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(De.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pt(De.paint_raster["raster-emissive-strength"]),"raster-array-band":new pt(De.paint_raster["raster-array-band"]),"raster-elevation":new pt(De.paint_raster["raster-elevation"]),"raster-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof $w&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(l)||o===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=ep({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,l])}}let Hw,qw,Ww,Zw,Xw;class Kw extends ls{constructor(e,i,o,l){super(e,{layout:Hw||(Hw=new Jr({visibility:new pt(De["layout_raster-particle"].visibility)})),paint:qw||(qw=new Jr({"raster-particle-array-band":new pt(De["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pt(De["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Wa(De["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pt(De["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pt(De["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pt(De["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pt(De["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new pt(De["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this._updateColorRamp(),this.lastInvalidatedAt=Ks.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ep({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ks.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class zP extends ls{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Yv(r,e,i){const o=[0,0,1],l=Yt([]);return Bi(l,l,i?-G(r)+Math.PI:G(r)),Gt(l,l,-G(e)),yr(o,o,l),gr(o,o)}function Yw(r,e){const i=sg(r.projection,r.zoom,r.width,r.height),o=function(d,f,g,x,w){const A=new $(g.lng-180*tc,g.lat),I=new $(g.lng+180*tc,g.lat),P=d.project(A.lng,A.lat),L=d.project(I.lng,I.lat),z=-Math.atan2(L.y-P.y,L.x-P.x),B=Fe.fromLngLat(g);B.y=Ae(B.y,-1+tc,1-tc);const H=B.toLngLat(),Z=d.project(H.lng,H.lat),te=Fe.fromLngLat(H);te.x+=tc;const J=te.toLngLat(),U=d.project(J.lng,J.lat),X=Qw(U.x-Z.x,U.y-Z.y,z),ee=Fe.fromLngLat(H);ee.y+=tc;const ne=ee.toLngLat(),me=d.project(ne.lng,ne.lat),xe=Qw(me.x-Z.x,me.y-Z.y,z),Se=Math.abs(X.x)/Math.abs(xe.y),Pe=pe([]);St(Pe,Pe,-z*(1-(w?0:x)));const He=pe([]);return be(He,He,[1,1-(1-Se)*x,1]),He[4]=-xe.x/xe.y*x,St(He,He,z),$e(He,Pe,He),He}(r.projection,0,r.center,i,e),l=Jw(r);return be(o,o,[l,l,1]),o}function Jw(r){const e=r.projection,i=sg(r.projection,r.zoom,r.width,r.height),o=Jv(e,r.center),l=Jv(e,$.convert(e.center));return Math.pow(2,o*i+(1-i)*l)}function sg(r,e,i,o,l=1/0){const d=r.range;if(!d)return 0;const f=Math.min(l,Math.max(i,o)),g=Math.log(f/1024)/Math.LN2;return Ie(d[0]+g,d[1]+g,e)}const tc=1/4e4;function Jv(r,e){const i=Ae(e.lat,-85.051129,Re),o=new $(e.lng-180*tc,i),l=new $(e.lng+180*tc,i),d=r.project(o.lng,i),f=r.project(l.lng,i),g=Fe.fromLngLat(o),x=Fe.fromLngLat(l),w=f.x-d.x,A=f.y-d.y,I=x.x-g.x,P=x.y-g.y,L=Math.sqrt((I*I+P*P)/(w*w+A*A));return Math.log(L)/Math.LN2}function Qw(r,e,i){const o=Math.cos(i),l=Math.sin(i);return{x:r*o-e*l,y:r*l+e*o}}function eT(r,e,i){pe(r),St(r,r,G(e[2])),ke(r,r,G(e[0])),Ke(r,r,G(e[1])),be(r,r,i),$e(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function og(r,e,i,o,l,d,f,g){const x=[i[0]-e[0],i[1]-e[1],0],w=[o[0]-e[0],o[1]-e[1],0];if(di(x)<1e-12||di(w)<1e-12)return Yt(r);const A=_t([],x,w);gr(A,A),si(w,o,e),x[2]=(d-l)*g,w[2]=(f-l)*g;const I=x;return _t(I,x,w),gr(I,I),xn(r,A,I)}function Qv(r,e,i=!1){const o=Xl(e.zoom),l=function(d,f,g){const x=f.worldSize,w=[d[12],d[13],d[14]],A=ge(w[1]/x),I=_e(w[0]/x),P=pe([]),L=ae(1,A)*x,z=ae(1,0)*x*Xe(A,f.zoom),B=1/av(x);let H=z*B;if(g){const U=sg(f.projection,f.zoom,f.width,f.height,1024);H=B*f.projection.pixelSpaceConversion(f.center.lat,x,U)}const Z=j(A,I);Ni(Z,Z,Yi([],gr([],Z),L*H*w[2]));const te=function(U){const X=[U[0],U[1],U[2]];let ee=[0,1,0];const ne=_t([],ee,X);return _t(ee,X,ne),Rs(ee)===0&&(ee=[0,1,0],_t(ne,X,ee)),gr(ne,ne),gr(ee,ee),gr(X,X),[ne[0],ne[1],ne[2],0,ee[0],ee[1],ee[2],0,X[0],X[1],X[2],0,U[0],U[1],U[2],1]}(Z);be(P,P,[H,H,H*L]),ze(P,P,[-w[0],-w[1],-w[2]]);const J=$e([],f.globeMatrix,te);return $e(J,J,P),$e(J,J,d),J}(r,e,i);if(o>0){const d=function(f,g){const x=g.worldSize,w=ae(1,0)*x*Xe(g.center.lat,g.zoom)/av(x),A=ae(1,g.center.lat)*x,I=pe([]);return Ke(I,I,G(g.center.lng)),ke(I,I,G(g.center.lat)),ze(I,I,[0,0,_]),be(I,I,[w,w,w*A]),ze(I,I,[g.point.x-.5*x,g.point.y-.5*x,0]),$e(I,I,f),$e(I,g.globeMatrix,I)}(r,e);return function(f,g,x){const w=(z,B,H)=>{const Z=di(z),te=di(B),J=el(z,B,H);return Yi(J,J,1/di(J)*Kt(Z,te,H))},A=w([f[0],f[1],f[2]],[g[0],g[1],g[2]],x),I=w([f[4],f[5],f[6]],[g[4],g[5],g[6]],x),P=w([f[8],f[9],f[10]],[g[8],g[9],g[10]],x),L=el([f[12],f[13],f[14]],[g[12],g[13],g[14]],x);return[A[0],A[1],A[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],0,L[0],L[1],L[2],1]}(l,d,o)}return l}function tT(r,e,i,o){const l=zr.projectAabbCorners(o,i);let d=Number.MAX_VALUE,f=-1;for(let w=0;w<l.length;++w){const A=l[w];A[0]=(.5*A[0]+.5)*e.width,A[1]=(.5-.5*A[1])*e.height,A[2]<d&&(f=w,d=A[2])}const g=w=>new gt(l[w][0],l[w][1]);let x;switch(f){case 0:case 6:x=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:x=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:x=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:x=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(ei(r,x))return d}const OP=Ki([{name:"a_pos_3f",components:3,type:"Float32"}]),FP=Ki([{name:"a_color_3f",components:3,type:"Float32"}]),BP=Ki([{name:"a_color_4f",components:4,type:"Float32"}]),NP=Ki([{name:"a_uv_2f",components:2,type:"Float32"}]),UP=Ki([{name:"a_normal_3f",components:3,type:"Float32"}]),VP=Ki([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),jP=Ki([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),iT={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class ag{constructor(e,i,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function e0(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class rT{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class nT{constructor(){this.instancedDataArray=new $l,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class t0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,l){this.tileToMeter=Me(o);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const A=g??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),I=Ut(f,d);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),I,o))continue;const P={id:A,sourceLayerIndex:w,index:x,geometry:d?I.geometry:Rt(f,o,l),properties:f.properties,type:f.type,patterns:{}},L=this.addFeature(P,P.geometry,I);L&&i.featureIndex.insert(f,P.geometry,x,w,this.index,this.instancesPerModel[L].instancedDataArray.length,vt/32)}this.lookup=null}update(e,i,o,l){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const g in e)f.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(f.features[f.idToFeaturesIndex[g]],e[g],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const l of o.features){const d=this.layers[0],f=l.feature,g=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},g),w=d.paint.get("model-scale").evaluate(f,{},g),A=d.paint.get("model-translation").evaluate(f,{},g);Sr(l.rotation,x)&&Sr(l.scale,w)&&Sr(l.translation,A)||(this.evaluate(l,l.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,l){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Sv(this.activeReplacements,d))return!1;this.activeReplacements=d;let f=!1;for(const g in this.instancesPerModel){const x=this.instancesPerModel[g],w=x.instancedDataArray;for(const A of x.features){const I=A.instancedDataOffset,P=A.instancedDataCount;for(let L=0;L<P;L++){const z=16*(L+I);let B=w.float32[z+0];const H=B>vt;B=H?B-vt:B;const Z=Math.floor(B),te=w.float32[z+1];let J=!1;for(const U of this.activeReplacements)if(!c1(U,o,iT.Model,l)&&!(U.min.x>Z||Z>U.max.x||U.min.y>te||te>U.max.y)&&(J=m1(p1(Z,te,e.canonical,U.footprintTileId.canonical),U.footprint),J))break;w.float32[z]=J?B+vt:B,f=f||J!==H}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,VP.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const l=this.layers[0],d=l.layout.get("model-id").evaluate(o,{},this.canonical);if(!d)return ki(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),d;(e0(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new nT);const f=this.instancesPerModel[d],g=f.instancedDataArray,x=new rT(o,g.length);for(const w of i)for(const A of w){if(A.x<0||A.x>=vt||A.y<0||A.y>=vt)continue;const I=(this.lookupDim-1)/vt,P=this.lookupDim*(A.y*I|0)+A.x*I|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const L=g.length;g.resize(L+1),f.instancesEvaluatedElevation.push(0),g.float32[16*L]=A.x,g.float32[16*L+1]=A.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,o,l){const d=this.layers[0],f=e.feature,g=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,i,g),w=e.scale=d.paint.get("model-scale").evaluate(f,i,g),A=e.translation=d.paint.get("model-translation").evaluate(f,i,g),I=d.paint.get("model-color").evaluate(f,i,g);I.a=d.paint.get("model-color-mix-intensity").evaluate(f,i,g);const P=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),eT(P,x,w);const L=Math.round(100*I.a)+I.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const B=e.instancedDataOffset+z,H=16*B,Z=o.instancedDataArray.float32;let te=0;l&&(te=Z[H+6]-o.instancesEvaluatedElevation[B]);const J=0|Z[H+1];Z[H]=(0|Z[H])+I.r/1.05,Z[H+1]=J+I.g/1.05,Z[H+2]=L,Z[H+3]=1/(g.z>10?this.tileToMeter:Me(g,J)),Z[H+4]=A[0],Z[H+5]=A[1],Z[H+6]=A[2]+te,Z[H+7]=P[0],Z[H+8]=P[1],Z[H+9]=P[2],Z[H+10]=P[4],Z[H+11]=P[5],Z[H+12]=P[6],Z[H+13]=P[8],Z[H+14]=P[9],Z[H+15]=P[10],o.instancesEvaluatedElevation[B]=A[2]}}}let sT,oT;It(t0,"ModelBucket",{omit:["layers"]}),It(nT,"PerModelAttributes"),It(rT,"ModelFeature");const wu=64,id={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function aT(r,e,i,o,l,d,f,g,x,w=!1){const A=i.zoom,I=i.project(o),P=Xe(o.lat,A),L=1/P;pe(r),ze(r,r,[I.x+f[0]*L,I.y+f[1]*L,f[2]]);let z=1,B=1;const H=i.worldSize;if(w){if(i.projection.name==="mercator"){let U=0;i.elevation&&(U=i.elevation.getAtPointOrZero(new Fe(I.x/H,I.y/H),0));const X=Jt([],[I.x,I.y,U,1],i.projMatrix)[3]/i.cameraToCenterDistance;z=X,B=X*Xe(i.center.lat,A)}else if(i.projection.name==="globe"){const U=Qv(r,i),X=[0,0,0,1];Jt(X,X,$e([],i.projMatrix,U));const ee=X[3]/i.cameraToCenterDistance,ne=Xl(A),me=i.projection.pixelsPerMeter(o.lat,H)*Xe(o.lat,A),xe=i.projection.pixelsPerMeter(i.center.lat,H)*Xe(i.center.lat,A);z=ee/Kt(me,Je(i.center.lat),ne),B=ee*P/me,z*=xe,B*=xe}}else z=L;be(r,r,[z,z,B]);const Z=[...r],te=e.orientation,J=[];if(eT(J,[te[0]+l[0],te[1]+l[1],te[2]+l[2]],d),$e(r,Z,J),g&&i.elevation){let U=0;const X=[];if(x&&i.elevation){U=function(ne,me,xe,Se,Pe){const He=me.elevation;if(!He)return 0;const nt=zr.projectAabbCorners(xe,Se),et=ae(1,Pe.lat)*me.worldSize,rt=function(ct,ci){const zt=[0,0,1],Ot=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const oi of Ot){const yi=ct[oi.corners[0]],bi=ct[oi.corners[1]],Mi=ct[oi.corners[2]],Ai=[bi[0]-yi[0],bi[1]-yi[1],ci*(bi[2]-yi[2])],Ti=_t(Ai,Ai,[Mi[0]-yi[0],Mi[1]-yi[1],ci*(Mi[2]-yi[2])]);gr(Ti,Ti),oi.dotProductWithUp=tr(Ti,zt)}return Ot.sort((oi,yi)=>oi.dotProductWithUp-yi.dotProductWithUp),Ot[0].corners}(nt,et),lt=nt[rt[0]],je=nt[rt[1]],it=nt[rt[2]],Ne=nt[rt[3]],Ge=He.getAtPointOrZero(new Fe(lt[0]/me.worldSize,lt[1]/me.worldSize),0),ut=He.getAtPointOrZero(new Fe(je[0]/me.worldSize,je[1]/me.worldSize),0),dt=He.getAtPointOrZero(new Fe(it[0]/me.worldSize,it[1]/me.worldSize),0),Nt=He.getAtPointOrZero(new Fe(Ne[0]/me.worldSize,Ne[1]/me.worldSize),0),Mt=(Ge+Nt)/2,xt=(ut+dt)/2;return Mt>xt?ut<dt?og(ne,je,Ne,lt,ut,Nt,Ge,et):og(ne,it,lt,Ne,dt,Ge,Nt,et):Ge<Nt?og(ne,lt,je,it,Ge,ut,dt,et):og(ne,Ne,it,je,Nt,dt,ut,et),Math.max(Mt,xt)}(X,i,e.aabb,r,o);const ee=$e([],Wt([],X),J);$e(r,Z,ee)}else U=i.elevation.getAtPointOrZero(new Fe(I.x/H,I.y/H),0);U!==0&&(r[14]+=U)}}function bp(r,e,i=!1){r.uploaded||(r.gfxTexture=new Kv(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function $P(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,OP.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,UP.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,NP.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?FP:BP).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,jP.members,!0)),r.segments=$r.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const o=r.material;o.pbrMetallicRoughness.baseColorTexture&&bp(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&bp(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&bp(o.normalTexture,e),o.occlusionTexture&&bp(o.occlusionTexture,e,i),o.emissionTexture&&bp(o.emissionTexture,e)}function i0(r,e,i){if(r.meshes)for(const o of r.meshes)$P(o,e,i);if(r.children)for(const o of r.children)i0(o,e,i)}function lg(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)lg(e)}function r0(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)r0(i)}class rd{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const l=o||e.findDEMTileFor(i);if(!l||!l.dem)return;const d=l.dem,f=l.tileID,g=1<<i.canonical.z-f.canonical.z;return new rd(l,d.dim/vt/g,[(i.canonical.x/g-f.canonical.x)*d.dim,(i.canonical.y/g-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new gt(l,d)}getElevationAt(e,i,o,l){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],g=Math.floor(d),x=Math.floor(f),w=this._dem;return l=!!l,o?Kt(Kt(w.get(g,x,l),w.get(g,x+1,l),f-x),Kt(w.get(g+1,x,l),w.get(g+1,x+1,l),f-x),d-g):w.get(g,x,l)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ae(1,e)*this._dem.stride}}const n0=new Float32Array(262144),Tu=new Uint8Array(262144);function lT(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,lT(i));return e}function cT(r,e,i){if(r.meshes)for(const o of r.meshes){if(o.aabb.min[0]===1/0)continue;const l=zr.applyTransform(o.aabb,r.matrix);i.insert(e,l.min[0],l.min[1],l.max[0],l.max[1])}if(r.children)for(const o of r.children)cT(o,e,i)}const uT=["","wall","door","roof","window","lamp","logo"];class hT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:lT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new zr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new zr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=zr.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class cg{constructor(e,i,o,l,d,f,g){this.id=o,this.layers=e,this.layerIds=this.layers.map(x=>x.fqid),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.modelTraits|=id.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=id.HasMapboxMeshFeatures),d&&(this.modelTraits|=id.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of i)this.nodesInfo.push(new hT(x)),cT(x,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const l=o.node;l.footprint&&i.push({footprint:l.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!Po(e,this.states))for(const l of o)this.evaluate(l,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const l=o.node;this.uploaded?this.updatePbrBuffer(l):i0(l,e,!0)}for(const o of i)lg(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const l=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;if(!this.uploaded||this.dirty||l.name!==this.projection.name||wp(o.paint.get("model-color").value,f)||wp(o.paint.get("model-color-mix-intensity").value,f)||wp(o.paint.get("model-roughness").value,f)||wp(o.paint.get("model-emissive-strength").value,f)||wp(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=l,this.brightness=d;const g=this.getNodesInfo();for(const x of g)x.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),l=this.id.canonical;for(const d of o){const f=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e,i){const o=this.getNodesInfo();for(const l of o){if(!l.node.meshes)continue;const d=l.feature,f=i&&i[d.id];if(Po(f,l.state))continue;l.state=structuredClone(f);const g=l.node.meshes&&l.node.meshes[0].featureData,x=l.evaluatedColor[2],w=l.evaluatedRMEA[2],A=this.id.canonical;if(l.hasTranslucentParts=!1,g){for(let I=0;I<uT.length;I++){const P=uT[I];P.length&&(d.properties.part=P);const L=e.paint.get("model-color").evaluate(d,f,A).toRenderColor(null),z=e.paint.get("model-color-mix-intensity").evaluate(d,f,A);l.evaluatedColor[I]=[L.r,L.g,L.b,z],l.evaluatedRMEA[I][0]=e.paint.get("model-roughness").evaluate(d,f,A),l.evaluatedRMEA[I][2]=e.paint.get("model-emissive-strength").evaluate(d,f,A),l.evaluatedRMEA[I][3]=L.a,l.emissionHeightBasedParams[I]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,f,A),!l.hasTranslucentParts&&L.a<1&&(l.hasTranslucentParts=!0)}delete d.properties.part,HP(l,x!==l.evaluatedColor[2]||w!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,f,A);l.evaluatedScale=e.paint.get("model-scale").evaluate(d,f,A),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,l){const d=e.findDEMTileFor(o);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=rd.create(e,o,d);if(!f)return;this.modelTraits&id.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,l);for(const g of this.getNodesInfo()){const x=g.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const w=x.footprint.vertices;let A=f.getElevationAt(w[0].x,w[0].y,!0,!0);for(let I=1;I<w.length;I++)A=Math.min(A,f.getElevationAt(w[I].x,w[I].y,!0,!0));x.elevation=A}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,l){let d=i._dem._modifiedForSources[l];if(d===void 0&&(i._dem._modifiedForSources[l]=[],d=i._dem._modifiedForSources[l]),d.includes(o.canonical))return;const f=i._dem.dim;d.push(o.canonical);let g=!1;for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.grid)continue;const A=w.footprint.grid,I=i.tileCoordToPixel(A.min.x,A.min.y),P=i.tileCoordToPixel(A.max.x,A.max.y),L=Math.min(Math.min(f-P.y,I.x),Math.min(I.y,f-P.x));if(L<0)continue;const z=Ae(L,2,5);let B=Math.max(0,I.x-z),H=Math.max(0,I.y-z),Z=Math.min(P.x+z,f-1),te=Math.min(P.y+z,f-1);for(let ee=H;ee<=te;++ee)for(let ne=B;ne<=Z;++ne)Tu[ee*f+ne]=255;let J=0,U=0;for(let ee=0;ee<A.cellsY;++ee)for(let ne=0;ne<A.cellsX;++ne){if(!A.cells[ee*A.cellsX+ne])continue;const me=i.tileCoordToPixel(A.min.x+ne/A.xScale,A.min.y+ee/A.yScale),xe=i.tileCoordToPixel(A.min.x+(ne+1)/A.xScale,A.min.y+(ee+1)/A.yScale);for(let Se=me.y;Se<=Math.min(xe.y+1,f-1);++Se)for(let Pe=me.x;Pe<=Math.min(xe.x+1,f-1);++Pe)Tu[Se*f+Pe]===255&&(Tu[Se*f+Pe]=0,J+=i.getElevationAtPixel(Pe,Se),U++)}const X=J/U;B=Math.max(1,I.x-z),H=Math.max(1,I.y-z),Z=Math.min(P.x+z,f-2),te=Math.min(P.y+z,f-2),g=!0;for(let ee=H;ee<=te;++ee)for(let ne=B;ne<=Z;++ne)Tu[ee*f+ne]===0&&(n0[ee*f+ne]=i._dem.set(ne,ee,X));for(let ee=1;ee<z;++ee){B=Math.max(1,I.x-ee),H=Math.max(1,I.y-ee),Z=Math.min(P.x+ee,f-2),te=Math.min(P.y+ee,f-2);for(let ne=H;ne<=te;++ne)for(let me=B;me<=Z;++me){const xe=ne*f+me;if(Tu[xe]===255){let Se=0,Pe=0,He=-1,nt=-1;for(let et=-1;et<=1;++et)for(let rt=-1;rt<=1;++rt){const lt=(ne+et)*f+me+rt;if(Tu[lt]>=ee)continue;const je=n0[lt],it=Math.abs(je);it>Pe&&(Se=je,Pe=it,He=rt,nt=et)}if(Pe>.1){const et=1-(ee+.5*Math.abs(He*nt))/z;let rt=i._dem.get(me,ne)+Se*et;const lt=i._dem.get(me+He,ne+nt),je=i._dem.get(me-He,ne-nt,!0);(rt-lt)*(rt-je)>0&&(rt=(lt+je)/2),n0[xe]=i._dem.set(me,ne,rt),Tu[xe]=ee}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ks.now())}setFilter(e){this.filter=e?zf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new cr(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)lg(i.node),r0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const f=l[d].node;l[d].hiddenByReplacement=!!f.footprint&&!o.find(g=>g.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),l=[],d=[0,0,0],f=pe([]);for(let g=0;g<this.nodesInfo.length;g++){const x=o[g],w=x.node.meshes[0],A=w.transformedAabb;if(e<A.min[0]||i<A.min[1]||e>A.max[0]||i>A.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};qe(f,x.node.matrix),d[0]=e,d[1]=i,$t(d,d,f);const I=(d[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*wu|0,P=Math.min(63,(d[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*wu|0)*wu+Math.min(63,I),L=w.heightmap[P];if(!(L<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:L,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new gt(e,i),new gt(e,i),l),l.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function wp(r,e){return r instanceof $a&&!r.isLightConstant&&e}function GP(r,e,i,o,l,d,f,g){let x=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,A=240&e|(240&e)>>4;i[3]>0&&(x=Kt(x,255*i[0],i[3]),w=Kt(w,255*i[1],i[3]),A=Kt(A,255*i[2],i[3]));const I=x<<8|w,P=A<<8|Math.floor(255*o[3]),L=function(ee){const ne=Ae(ee,0,2);return Math.min(Math.round(.5*ne*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],z=Ae(l[0],0,1),B=Ae(l[1],0,1),H=Ae(l[2],0,1),Z=Ae(l[3],0,1);let te,J,U,X;if(z!==B&&f!==d&&B!==z){const ee=f-d;J=1/(ee*(B-z)),U=-(d+ee*z)/(ee*(B-z));const ne=Ae(l[4],-1,1);X=Math.pow(10,ne),te=255*H<<8|255*Z}else te=65535,J=0,U=1,X=1;if(r.emplaceBack(I,P,L,te,J,U,X),g){const ee=g.length;g.clear();for(let ne=0;ne<ee;ne++)g.emplaceBack(I,P,L,te,J,U,X)}}function HP(r,e,i){const o=r.node;let l=0;const d=i&id.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new lu,f.featureArray.reserve(f.featureData.length);let g=e;for(const x of f.featureData){const w=d?65535&x:x>>16&65535,A=d?x>>16&65535:65535&x,I=(15&A)<8?15&A:0,P=r.evaluatedRMEA[I],L=r.evaluatedColor[I],z=r.emissionHeightBasedParams[I];let B;if(g&&I===2&&o.lights&&(B=new lu,B.resize(10*o.lights.length)),GP(f.featureArray,w,L,P,z,f.aabb.min[2],f.aabb.max[2],B),B&&g){g=!1;const H=o.meshes[o.lightMeshIndex];H.featureArray=B,H.featureArray._trim()}}f.featureArray._trim(),l++}}function dT(r,e,i,o){const l=1<<r.z;e.lat=ge((o/vt+r.y)/l),e.lng=_e((i/vt+r.x)/l)}It(cg,"Tiled3dModelBucket",{omit:["layers"]}),It(hT,"Tiled3dModelFeature");const qP={circle:class extends ls{constructor(r,e,i,o){super(r,{layout:Qi||(Qi=new Jr({"circle-sort-key":new At(De.layout_circle["circle-sort-key"]),"circle-elevation-reference":new pt(De.layout_circle["circle-elevation-reference"]),visibility:new pt(De.layout_circle.visibility)})),paint:Nr||(Nr=new Jr({"circle-radius":new At(De.paint_circle["circle-radius"]),"circle-color":new At(De.paint_circle["circle-color"]),"circle-blur":new At(De.paint_circle["circle-blur"]),"circle-opacity":new At(De.paint_circle["circle-opacity"]),"circle-translate":new pt(De.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(De.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pt(De.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(r){return new Lt(r)}queryRadius(r){const e=r;return wi("circle-radius",this,e)+wi("circle-stroke-width",this,e)+kr(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,o,l,d,f,g){const x=Lr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ab(r,o,d,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const o=Eb(this);return{config:new ma(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ls{createBucket(r){return new Cb(r)}constructor(r,e,i,o){super(r,{layout:Pb||(Pb=new Jr({visibility:new pt(De.layout_heatmap.visibility)})),paint:Mb||(Mb=new Jr({"heatmap-radius":new At(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wa(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(De.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return wi("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,o,l,d,f,g){const x=this.paint.get("heatmap-radius").evaluate(e,i);return Ab(r,o,d,f,g,!0,!0,new gt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new ma(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ls{constructor(r,e,i,o){super(r,{layout:Rb||(Rb=new Jr({visibility:new pt(De.layout_hillshade.visibility)})),paint:Db||(Db=new Jr({"hillshade-illumination-direction":new pt(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(De.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pt(De.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends ls{constructor(r,e,i,o){super(r,{layout:n1||(n1=new Jr({"fill-sort-key":new At(De.layout_fill["fill-sort-key"]),visibility:new pt(De.layout_fill.visibility),"fill-elevation-reference":new pt(De.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new At(De.layout_fill["fill-construct-bridge-guard-rail"])})),paint:s1||(s1=new Jr({"fill-antialias":new pt(De.paint_fill["fill-antialias"]),"fill-opacity":new At(De.paint_fill["fill-opacity"]),"fill-color":new At(De.paint_fill["fill-color"]),"fill-outline-color":new At(De.paint_fill["fill-outline-color"]),"fill-translate":new pt(De.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new At(De.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new pt(De.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new pt(De.paint_fill["fill-emissive-strength"]),"fill-z-offset":new At(De.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new At(De.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new At(De.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new ma(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new bv(r)}queryRadius(){return kr(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,o,l,d){return!r.queryGeometry.isAboveHorizon&&Di(Hi(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ls{constructor(r,e,i,o){super(r,{layout:M1||(M1=new Jr({visibility:new pt(De["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pt(De["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:R1||(R1=new Jr({"fill-extrusion-opacity":new pt(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new At(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new pt(De["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new At(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new pt(De["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new pt(De["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new pt(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pt(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pt(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pt(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pt(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pt(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pt(De["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pt(De["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new At(De["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new At(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pt(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pt(De["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pt(De["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pt(De["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new At(De["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new At(De["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new pt(De["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new B_(r)}queryRadius(){return kr(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,o,l,d,f,g,x){const w=Lr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],L=g&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,B=r.tile.getBucket(this);if(L&&B instanceof B_){const U=B.centroidVertexArray,X=x+1;X<U.length&&(P[0]=U.geta_centroid_pos0(X),P[1]=U.geta_centroid_pos1(X))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(o=P1([o],[new gt(0,0),new gt(vt,vt)],r.tileID.canonical).map(U=>U.polygon).flat());const H=L?g:null,[Z,te]=function(U,X,ee,ne,me,xe,Se,Pe,He,nt,et){return U.projection.name==="globe"?function(rt,lt,je,it,Ne,Ge,ut,dt,Nt,Mt,xt){const ct=[],ci=[],zt=rt.projection.upVectorScale(xt,rt.center.lat,rt.worldSize).metersToTile,Ot=[0,0,0,1],oi=[0,0,0,1],yi=(Mi,Ai,Ti,pr)=>{Mi[0]=Ai,Mi[1]=Ti,Mi[2]=pr,Mi[3]=1},bi=C1();je>0&&(je+=bi),it+=bi;for(const Mi of lt){const Ai=[],Ti=[];for(const pr of Mi){const Ir=pr.x+Ne.x,ie=pr.y+Ne.y,se=rt.projection.projectTilePoint(Ir,ie,xt),Ze=rt.projection.upVector(xt,pr.x,pr.y);let mt=je,wt=it;if(ut){const bt=F1(Ir,ie,je,it,ut,dt,Nt,Mt);mt+=bt.base,wt+=bt.top}je!==0?yi(Ot,se.x+Ze[0]*zt*mt,se.y+Ze[1]*zt*mt,se.z+Ze[2]*zt*mt):yi(Ot,se.x,se.y,se.z),yi(oi,se.x+Ze[0]*zt*wt,se.y+Ze[1]*zt*wt,se.z+Ze[2]*zt*wt),$t(Ot,Ot,Ge),$t(oi,oi,Ge),Ai.push(new vu(Ot[0],Ot[1],Ot[2])),Ti.push(new vu(oi[0],oi[1],oi[2]))}ct.push(Ai),ci.push(Ti)}return[ct,ci]}(U,X,ee,ne,me,xe,Se,Pe,He,nt,et):Se?function(rt,lt,je,it,Ne,Ge,ut,dt,Nt){const Mt=[],xt=[],ct=[0,0,0,1];for(const ci of rt){const zt=[],Ot=[];for(const oi of ci){const yi=oi.x+it.x,bi=oi.y+it.y,Mi=F1(yi,bi,lt,je,Ge,ut,dt,Nt);ct[0]=yi,ct[1]=bi,ct[2]=Mi.base,ct[3]=1,Jt(ct,ct,Ne),ct[3]=Math.max(ct[3],1e-5);const Ai=new vu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=yi,ct[1]=bi,ct[2]=Mi.top,ct[3]=1,Jt(ct,ct,Ne),ct[3]=Math.max(ct[3],1e-5);const Ti=new vu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);zt.push(Ai),Ot.push(Ti)}Mt.push(zt),xt.push(Ot)}return[Mt,xt]}(X,ee,ne,me,xe,Se,Pe,He,nt):function(rt,lt,je,it,Ne){const Ge=[],ut=[],dt=Ne[8]*lt,Nt=Ne[9]*lt,Mt=Ne[10]*lt,xt=Ne[11]*lt,ct=Ne[8]*je,ci=Ne[9]*je,zt=Ne[10]*je,Ot=Ne[11]*je;for(const oi of rt){const yi=[],bi=[];for(const Mi of oi){const Ai=Mi.x+it.x,Ti=Mi.y+it.y,pr=Ne[0]*Ai+Ne[4]*Ti+Ne[12],Ir=Ne[1]*Ai+Ne[5]*Ti+Ne[13],ie=Ne[2]*Ai+Ne[6]*Ti+Ne[14],se=Ne[3]*Ai+Ne[7]*Ti+Ne[15],Ze=pr+dt,mt=Ir+Nt,wt=ie+Mt,bt=Math.max(se+xt,1e-5),Ft=pr+ct,ri=Ir+ci,zi=ie+zt,Oi=Math.max(se+Ot,1e-5);yi.push(new vu(Ze/bt,mt/bt,wt/bt)),bi.push(new vu(Ft/Oi,ri/Oi,zi/Oi))}Ge.push(yi),ut.push(bi)}return[Ge,ut]}(X,ee,ne,me,xe)}(d,o,I,A,w,f,H,P,z,d.center.lat,r.tileID.canonical),J=r.queryGeometry;return function(U,X,ee){let ne=1/0;Di(ee,X)&&(ne=O1(ee,X[0]));for(let me=0;me<X.length;me++){const xe=X[me],Se=U[me];for(let Pe=0;Pe<xe.length-1;Pe++){const He=xe[Pe],nt=[He,xe[Pe+1],Se[Pe+1],Se[Pe],He];ei(ee,nt)&&(ne=Math.min(ne,O1(ee,nt)))}}return ne!==1/0&&ne}(Z,te,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends ls{constructor(r,e,i,o){const l=W1();super(r,l,e,i,o),l.layout&&(this.layout=new qa(l.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof qc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(up)return up;const i=W1();return up=new qC(i.paint.properties["line-width"].specification),up.useIntegerZoom=!0,up})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Cv(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const o=H1(this);return{config:new ma(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(r){const e=r,i=Z1(wi("line-width",this,e),wi("line-gap-width",this,e)),o=wi("line-offset",this,e);return i/2+Math.abs(o)+kr(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,o,l,d){if(r.queryGeometry.isAboveHorizon)return!1;const f=Hi(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*Z1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(o=function(w,A){const I=[],P=new gt(0,0);for(let L=0;L<w.length;L++){const z=w[L],B=[];for(let H=0;H<z.length;H++){const Z=z[H],te=z[H+1],J=H===0?P:Z.sub(z[H-1])._unit()._perp(),U=H===z.length-1?P:te.sub(Z)._unit()._perp(),X=J._add(U)._unit();X._mult(1/(X.x*U.x+X.y*U.y)),B.push(X._mult(A)._add(Z))}I.push(B)}return I}(o,x*r.pixelToTileUnitsFactor)),function(w,A,I){for(let P=0;P<A.length;P++){const L=A[P];if(w.length>=3){for(let z=0;z<L.length;z++)if(hr(w,L[z]))return!0}if(ur(w,L,I))return!0}return!1}(f,o,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:tg,background:class extends ls{constructor(r,e,i,o){super(r,{layout:Bw||(Bw=new Jr({visibility:new pt(De.layout_background.visibility)})),paint:Nw||(Nw=new Jr({"background-pitch-alignment":new pt(De.paint_background["background-pitch-alignment"]),"background-color":new pt(De.paint_background["background-color"]),"background-pattern":new pt(De.paint_background["background-pattern"]),"background-opacity":new pt(De.paint_background["background-opacity"]),"background-emissive-strength":new pt(De.paint_background["background-emissive-strength"]),"background-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Gw,"raster-particle":Kw,sky:class extends ls{constructor(r,e,i,o){super(r,{layout:Ww||(Ww=new Jr({visibility:new pt(De.layout_sky.visibility)})),paint:Zw||(Zw=new Jr({"sky-type":new pt(De.paint_sky["sky-type"]),"sky-atmosphere-sun":new pt(De.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pt(De.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pt(De.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pt(De.paint_sky["sky-gradient-radius"]),"sky-gradient":new Wa(De.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pt(De.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pt(De.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pt(De.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,d=r.style.light,f=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Yv(f.azimuthal,90-f.polar,e):Yv(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return Yv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends ls{constructor(r,e,i,o){super(r,{paint:Xw||(Xw=new Jr({}))},e,null)}},model:class extends ls{constructor(r,e,i,o){super(r,{layout:sT||(sT=new Jr({visibility:new pt(De.layout_model.visibility),"model-id":new At(De.layout_model["model-id"])})),paint:oT||(oT=new Jr({"model-opacity":new At(De.paint_model["model-opacity"]),"model-rotation":new At(De.paint_model["model-rotation"]),"model-scale":new At(De.paint_model["model-scale"]),"model-translation":new At(De.paint_model["model-translation"]),"model-color":new At(De.paint_model["model-color"]),"model-color-mix-intensity":new At(De.paint_model["model-color-mix-intensity"]),"model-type":new pt(De.paint_model["model-type"]),"model-cast-shadows":new pt(De.paint_model["model-cast-shadows"]),"model-receive-shadows":new pt(De.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pt(De.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new At(De.paint_model["model-emissive-strength"]),"model-roughness":new At(De.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new At(De.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pt(De.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pt(De.paint_model["model-front-cutoff"]),"model-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new t0(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof cg?vt-1:0}queryIntersectsFeature(r,e,i,o,l,d){if(!this.modelManager)return!1;const f=this.modelManager,g=r.tile.getBucket(this);if(!(g&&g instanceof t0))return!1;for(const x in g.instancesPerModel){const w=g.instancesPerModel[x],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(A)){const I=w.features[w.idToFeaturesIndex[A]],P=f.getModel(x,this.scope);if(!P)return!1;let L=Te();const z=new $(0,0),B=g.canonical;let H=Number.MAX_VALUE;for(let Z=0;Z<I.instancedDataCount;++Z){const te=16*(I.instancedDataOffset+Z),J=w.instancedDataArray.float32,U=[J[te+4],J[te+5],J[te+6]];dT(B,z,J[te],0|J[te+1]),aT(L,P,d,z,I.rotation,I.scale,U,!1,!1,!1),d.projection.name==="globe"&&(L=Qv(L,d));const X=$e([],d.projMatrix,L),ee=r.queryGeometry,ne=tT(ee.isPointQuery()?ee.screenBounds:ee.screenGeometry,d,X,P.aabb);ne!=null&&(H=Math.min(ne,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof zl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ls{constructor(r,e,i,o){super(r,{layout:o1||(o1=new Jr({"clip-layer-types":new pt(De.layout_clip["clip-layer-types"]),"clip-layer-scope":new pt(De.layout_clip["clip-layer-scope"])})),paint:a1||(a1=new Jr({}))},e,i,o)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new l1(r)}is3D(r){return!0}}};class WP{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZP{constructor(){this.tasks={},this.taskQueue=[],pi(["process"],this),this.invoker=new WP(this.process),this.nextId=0}add(e,i){const o=this.nextId++,l=function({type:d,isSymbolTile:f,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-g:d==="maybePrepare"&&f?400-g:500:200-g:100-g}(i);if(l===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const d=this.tasks[this.taskQueue[l]];d.priority<i&&(i=d.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class fT{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},pi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZP}send(e,i,o,l,d=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[g]=o);const x=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:la(i,x)},x),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(i.mustQueue||Er(self)){const l=this.callbacks[o],d=this.scheduler.add(()=>this.processTask(o,i),l&&l.metadata||{type:"message"});d&&(this.cancelCallbacks[o]=d)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(ca(i.error)):o(null,ca(i.data)))}else{const o=new Set,l=i.hasCallback?(f,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?la(f):null,data:la(g,o)},o)}:()=>{},d=ca(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,l);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:g,scope:x}=d;this.parent.getWorkerSource(i.sourceMapId,f[0],g,x)[f[1]](d,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Tp={workerUrl:"",workerClass:null,workerParams:void 0};const s0="mapboxgl_preloaded_worker_pool";class Su{constructor(){this.active={}}acquire(e,i=Su.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Tp.workerClass!=null?new Tp.workerClass:new self.Worker(Tp.workerUrl,Tp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[s0]}numActive(){return Object.keys(this.active).length}}Su.workerCount=2;class nd{constructor(e,i,o="Worker",l=Su.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Et();const d=this.workerPool.acquire(this.id,l);for(let f=0;f<d.length;f++){const g=new nd.Actor(d[f],i,this.id);g.name=`${o} ${f}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Ye(this.actors,(l,d)=>{l.send(e,i,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Sp,o0;function ug(){return Sp||(Sp=new Su),Sp}nd.Actor=fT;const a0=new Ji(0,0,0),l0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},c0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},hg={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},XP={PAINT_ORDER_FILL_AND_STROKE:1},Ep={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},pT={MASK_TYPE_LUMINANCE:1};function KP(r,e,i){r===1&&e.icons.push(function(o,l){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:f}=d;if(f.content_area){const{content_area:g}=f;g.top==null&&(g.top=g.left),g.width==null&&(g.width=d.usvg_tree.width),g.height==null&&(g.height=g.width)}return f.stretch_x&&f.stretch_x.length&&mT(f,"x"),f.stretch_y&&f.stretch_y.length&&mT(f,"y"),d}(o.readFields(YP,{name:void 0},l))}(i,i.readVarint()+i.pos))}function mT(r,e){const i=[],o=r[`stretch_${e}`];let l=null;for(let d=0;d<o.length;d++)l===null?l=i.length===0?o[0]:i[i.length-1][1]+o[d]:(i.push([l,l+o[d]]),l=null);r[`stretch_${e}_areas`]=i}function YP(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(o,l){return o.readFields(JP,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},l)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(o,l){return o.readFields(tM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},l)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function JP(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=function(o,l){return o.readFields(QP,{left:0},l)}(i,i.readVarint()+i.pos):r===4&&e.variables.push(function(o,l){return o.readFields(eM,{name:void 0},l)}(i,i.readVarint()+i.pos))}function QP(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function eM(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=pg(i.readVarint()),e.value="rgb_color")}function tM(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(dg(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(o,l){return o.readFields(lM,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},l)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(o,l){return o.readFields(uM,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},l)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(o,l){return o.readFields(hM,{children:[]},l)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(o,l){const d=o.readFields(dM,{left:0,width:20,mask_type:pT.MASK_TYPE_LUMINANCE,children:[]},l);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function dg(r,e){return r.readFields(iM,{},e)}function iM(r,e,i){r===1?(e.group=function(o,l){return o.readFields(rM,{opacity:255,children:[]},l)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(o,l){return o.readFields(sM,{paint_order:1,commands:[],step:1,diffs:[],rule:l0.PATH_RULE_NON_ZERO},l)}(i,i.readVarint()+i.pos),e.node="path")}function rM(r,e,i){r===1?e.transform=fg(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(dg(i,i.readVarint()+i.pos))}function fg(r,e){return r.readFields(nM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function nM(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function sM(r,e,i){r===1?e.fill=function(o,l){return o.readFields(oM,{rgb_color:a0,paint:"rgb_color",opacity:255},l)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(o,l){return o.readFields(aM,{rgb_color:a0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},l)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function oM(r,e,i){r===1?(e.rgb_color=pg(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function pg(r){return new Ji((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function aM(r,e,i){r===1?(e.rgb_color=pg(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function lM(r,e,i){r===1?e.transform=fg(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(_T(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function _T(r,e){return r.readFields(cM,{offset:0,opacity:255,rgb_color:a0},e)}function cM(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=pg(i.readVarint()))}function uM(r,e,i){r===1?e.transform=fg(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(_T(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function hM(r,e,i){r===1?e.transform=fg(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(dg(i,i.readVarint()+i.pos))}function dM(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(dg(i,i.readVarint()+i.pos))}class fM{static calculate(e={},i=[]){const o=new Map,l=new Map;if(Object.keys(e).length===0)return o;i.forEach(d=>{l.set(d.name,d.rgb_color||new Ji(0,0,0))});for(const[d,f]of Object.entries(e))l.has(d)?o.set(l.get(d).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${d}"`);return o}}function sd(r,e=255,i){const o=e/255,l=r.toStringPremultipliedAlpha(),d=i.has(l)?i.get(l).clone():r.clone();return d.a*=o,d.toString()}function Ap(r,e){if(!Gd()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function pM(r,e){const i=fM.calculate(e.params,r.metadata?r.metadata.variables:[]),o=r.usvg_tree,l=o.width,d=o.height,f=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(l*f.a)),x=Math.max(1,Math.round(d*f.d)),w=new DOMMatrix([g/l,0,0,x/d,0,0]),A=Ap(g,x).getContext("2d");return u0(A,w,o,o,i),A.getImageData(0,0,g,x)}function u0(r,e,i,o,l){for(const d of o.children)gT(r,e,i,d,l)}function gT(r,e,i,o,l){o.group?(r.save(),function(d,f,g,x,w){const A=x.mask_idx!=null?g.masks[x.mask_idx]:null,I=x.clip_path_idx!=null?g.clip_paths[x.clip_path_idx]:null;if(x.transform&&(f=mg(x.transform).preMultiplySelf(f)),!function(z,B,H){return z.opacity!==255||B||H}(x,I!=null,A!=null))return void u0(d,f,g,x,w);const P=Ap(d.canvas.width,d.canvas.height),L=P.getContext("2d");u0(L,f,g,x,w),I&&ST(L,f,g,I),A&&ET(L,f,g,A,w),d.globalAlpha=x.opacity/255,d.drawImage(P,0,0)}(r,e,i,o.group,l),r.restore()):o.path&&(r.save(),function(d,f,g,x,w){const A=AT(x);d.setTransform(f),x.paint_order===XP.PAINT_ORDER_FILL_AND_STROKE?(yT(d,g,x,A,w),xT(d,g,x,A,w)):(xT(d,g,x,A,w),yT(d,g,x,A,w))}(r,e,i,o.path,l),r.restore())}function yT(r,e,i,o,l){const d=i.fill;if(!d)return;const f=d.opacity/255;switch(d.paint){case"rgb_color":r.fillStyle=sd(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":r.fillStyle=bT(r,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":r.fillStyle=wT(r,e.radial_gradients[d.radial_gradient_idx],f,l)}r.fill(o,vT(i))}function vT(r){return r.rule===l0.PATH_RULE_NON_ZERO?"nonzero":r.rule===l0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function xT(r,e,i,o,l){const d=i.stroke;if(!d)return;r.lineWidth=d.width,r.miterLimit=d.miterlimit,r.setLineDash(d.dasharray),r.lineDashOffset=d.dashoffset;const f=d.opacity/255;switch(d.paint){case"rgb_color":r.strokeStyle=sd(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":r.strokeStyle=bT(r,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":r.strokeStyle=wT(r,e.radial_gradients[d.radial_gradient_idx],f,l)}switch(d.linejoin){case hg.LINE_JOIN_MITER_CLIP:case hg.LINE_JOIN_MITER:r.lineJoin="miter";break;case hg.LINE_JOIN_ROUND:r.lineJoin="round";break;case hg.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(d.linecap){case c0.LINE_CAP_BUTT:r.lineCap="butt";break;case c0.LINE_CAP_ROUND:r.lineCap="round";break;case c0.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(o)}function bT(r,e,i,o){if(e.stops.length===1){const P=e.stops[0];return sd(P.rgb_color,P.opacity*i,o)}const l=mg(e.transform),{x1:d,y1:f,x2:g,y2:x}=e,w=l.transformPoint(new DOMPoint(d,f)),A=l.transformPoint(new DOMPoint(g,x)),I=r.createLinearGradient(w.x,w.y,A.x,A.y);for(const P of e.stops)I.addColorStop(P.offset,sd(P.rgb_color,P.opacity*i,o));return I}function wT(r,e,i,o){if(e.stops.length===1){const P=e.stops[0];return sd(P.rgb_color,P.opacity*i,o)}const l=mg(e.transform),{fx:d,fy:f,cx:g,cy:x}=e,w=l.transformPoint(new DOMPoint(d,f)),A=l.transformPoint(new DOMPoint(g,x)),I=r.createRadialGradient(w.x,w.y,0,A.x,A.y,e.r*((l.a+l.d)/2));for(const P of e.stops)I.addColorStop(P.offset,sd(P.rgb_color,P.opacity*i,o));return I}function TT(r,e,i,o){const l=o.transform?mg(o.transform).preMultiplySelf(e):e,d=Ap(r.canvas.width,r.canvas.height),f=d.getContext("2d");for(const x of o.children)if(x.group)TT(f,l,i,x.group);else if(x.path){const w=x.path,A=new Path2D;A.addPath(AT(w),l),f.fill(A,vT(w))}const g=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;g&&ST(f,l,i,g),r.globalCompositeOperation="source-over",r.drawImage(d,0,0)}function ST(r,e,i,o){const l=Ap(r.canvas.width,r.canvas.height);TT(l.getContext("2d"),e,i,o),r.globalCompositeOperation="destination-in",r.drawImage(l,0,0)}function ET(r,e,i,o,l){if(o.children.length===0)return;const d=o.mask_idx!=null?i.masks[o.mask_idx]:null;d&&ET(r,e,i,d,l);const f=r.canvas.width,g=r.canvas.height,x=Ap(f,g),w=x.getContext("2d"),A=o.width,I=o.height,P=o.left,L=o.top,z=new Path2D,B=new Path2D;B.rect(P,L,A,I),z.addPath(B,e),w.clip(z);for(const te of o.children)gT(w,e,i,te,l);const H=w.getImageData(0,0,f,g),Z=H.data;if(o.mask_type===pT.MASK_TYPE_LUMINANCE)for(let te=0;te<Z.length;te+=4)Z[te+3]=Z[te+3]/255*(.2126*Z[te]+.7152*Z[te+1]+.0722*Z[te+2]);w.putImageData(H,0,0),r.globalCompositeOperation="destination-in",r.drawImage(x,0,0)}function mg(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function AT(r){const e=new Path2D,i=r.step;let o=r.diffs[0]*i,l=r.diffs[1]*i;e.moveTo(o,l);for(let d=0,f=2;d<r.commands.length;d++)switch(r.commands[d]){case Ep.PATH_COMMAND_MOVE:o+=r.diffs[f++]*i,l+=r.diffs[f++]*i,e.moveTo(o,l);break;case Ep.PATH_COMMAND_LINE:o+=r.diffs[f++]*i,l+=r.diffs[f++]*i,e.lineTo(o,l);break;case Ep.PATH_COMMAND_QUAD:{const g=o+r.diffs[f++]*i,x=l+r.diffs[f++]*i;o=g+r.diffs[f++]*i,l=x+r.diffs[f++]*i,e.quadraticCurveTo(g,x,o,l);break}case Ep.PATH_COMMAND_CUBIC:{const g=o+r.diffs[f++]*i,x=l+r.diffs[f++]*i,w=g+r.diffs[f++]*i,A=x+r.diffs[f++]*i;o=w+r.diffs[f++]*i,l=A+r.diffs[f++]*i,e.bezierCurveTo(g,x,w,A,o,l);break}case Ep.PATH_COMMAND_CLOSE:e.closePath()}return e}class _g{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}It(_g,"LRUCache");class h0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new jn(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new _g(150)),this.cacheMap.get(o).get(Za(e.toString(),i))}setInCache(e,i,o,l){this.cacheDependenciesMap.has(l)||this.cacheDependenciesMap.set(l,new Map),this.cacheMap.has(l)||this.cacheMap.set(l,new _g(150));const d=this.cacheDependenciesMap.get(l),f=Za(e.id.toString(),o);d.get(f)||d.set(f,new Set);const g=this.cacheMap.get(l),x=e.toString();d.get(f).add(x),g.put(Za(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const l=this.cacheMap.get(o),d=this.cacheDependenciesMap.get(o);for(const f of e){const g=Za(f.toString(),i);if(d.has(g)){for(const x of d.get(g))l.delete(x);d.delete(g)}}}rasterize(e,i,o,l,d=pM){const f=this.getFromCache(e,o,l);if(f)return f.clone();const g=d(i.icon,e.options),x=h0._getImage(g);return this.setInCache(e,x,o,l),x.clone()}}class IT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function CT(r,e,i,o){let l=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<r[f]||i[f]>e[f])return null}else{const g=1/o[f];let x=(r[f]-i[f])*g,w=(e[f]-i[f])*g;if(x>w){const A=x;x=w,w=A}if(x>l&&(l=x),w<d&&(d=w),l>d)return null}return l}function PT(r,e,i,o,l,d,f,g,x,w,A){const I=o-r,P=l-e,L=d-i,z=f-r,B=g-e,H=x-i,Z=A[1]*H-A[2]*B,te=A[2]*z-A[0]*H,J=A[0]*B-A[1]*z,U=I*Z+P*te+L*J;if(Math.abs(U)<1e-15)return null;const X=1/U,ee=w[0]-r,ne=w[1]-e,me=w[2]-i,xe=(ee*Z+ne*te+me*J)*X;if(xe<0||xe>1)return null;const Se=ne*L-me*P,Pe=me*I-ee*L,He=ee*P-ne*I,nt=(A[0]*Se+A[1]*Pe+A[2]*He)*X;return nt<0||xe+nt>1?null:(z*Se+B*Pe+H*He)*X}function MT(r,e,i){return(r-e)/(i-e)}function RT(r,e,i,o,l,d,f,g,x){const w=1<<i,A=d-o,I=f-l,P=(r+1)/w*A+o,L=(e+0)/w*I+l,z=(e+1)/w*I+l;g[0]=(r+0)/w*A+o,g[1]=L,x[0]=P,x[1]=z}class DT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),g=[];let x=Math.ceil(Math.pow(2,f));const w=1/x,A=(L,z,B,H,Z)=>{const te=H?1:0,J=(L+1)*B-te,U=z*B,X=(z+1)*B-te;Z[0]=L*B,Z[1]=U,Z[2]=J,Z[3]=X};let I=new IT(x);const P=[];for(let L=0;L<x*x;L++){A(L%x,Math.floor(L/x),w,!1,P);const z=ic(P[0],P[1],d),B=ic(P[2],P[1],d),H=ic(P[2],P[3],d),Z=ic(P[0],P[3],d);I.minimums.push(Math.min(z,B,H,Z)),I.maximums.push(Math.max(z,B,H,Z)),I.leaves.push(1)}for(g.push(I),x/=2;x>=1;x/=2){const L=g[g.length-1];I=new IT(x);for(let z=0;z<x*x;z++){A(z%x,Math.floor(z/x),2,!0,P);const B=L.getElevation(P[0],P[1]),H=L.getElevation(P[2],P[1]),Z=L.getElevation(P[2],P[3]),te=L.getElevation(P[0],P[3]),J=L.isLeaf(P[0],P[1]),U=L.isLeaf(P[2],P[1]),X=L.isLeaf(P[2],P[3]),ee=L.isLeaf(P[0],P[3]),ne=Math.min(B.min,H.min,Z.min,te.min),me=Math.max(B.max,H.max,Z.max,te.max),xe=J&&U&&X&&ee;I.maximums.push(me),I.minimums.push(ne),I.leaves.push(me-ne<=5&&xe?1:0)}g.push(I)}return g}(this.dem),o=i.length-1,l=i[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,l,d,f,g=1){return CT([e,i,-100],[o,l,this.maximums[0]*g],d,f)}raycast(e,i,o,l,d,f,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,o,l,d,f,g);if(x==null)return null;const w=[],A=[],I=[],P=[],L=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:z,t:B,nodex:H,nodey:Z,depth:te}=L.pop();if(this.leaves[z]){RT(H,Z,te,e,i,o,l,I,P);const U=1<<te,X=(H+0)/U,ee=(H+1)/U,ne=(Z+0)/U,me=(Z+1)/U,xe=ic(X,ne,this.dem)*g,Se=ic(ee,ne,this.dem)*g,Pe=ic(ee,me,this.dem)*g,He=ic(X,me,this.dem)*g,nt=PT(I[0],I[1],xe,P[0],I[1],Se,P[0],P[1],Pe,d,f),et=PT(P[0],P[1],Pe,I[0],P[1],He,I[0],I[1],xe,d,f),rt=Math.min(nt!==null?nt:Number.MAX_VALUE,et!==null?et:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const lt=vn([],d,f,B);if(kT(xe,Se,He,Pe,MT(lt[0],I[0],P[0]),MT(lt[1],I[1],P[1]))>=lt[2])return B}continue}let J=0;for(let U=0;U<this._siblingOffset.length;U++){RT((H<<1)+this._siblingOffset[U][0],(Z<<1)+this._siblingOffset[U][1],te+1,e,i,o,l,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[z]+U]*g;const X=CT(I,P,d,f);if(X!=null){const ee=X;w[U]=ee;let ne=!1;for(let me=0;me<J&&!ne;me++)ee>=w[A[me]]&&(A.splice(me,0,U),ne=!0);ne||(A[J]=U),J++}}for(let U=0;U<J;U++){const X=A[U];L.push({idx:this.childOffsets[z]+X,t:w[X],nodex:(H<<1)+this._siblingOffset[X][0],nodey:(Z<<1)+this._siblingOffset[X][1],depth:te+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,l,d){if(e[l].isLeaf(i,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=l-1,g=e[f];let x=0,w=0;for(let A=0;A<this._siblingOffset.length;A++){const I=2*i+this._siblingOffset[A][0],P=2*o+this._siblingOffset[A][1],L=g.getElevation(I,P),z=g.isLeaf(I,P),B=this._addNode(L.min,L.max,z);z&&(x|=1<<A),w||(w=B)}for(let A=0;A<this._siblingOffset.length;A++)x&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*o+this._siblingOffset[A][1],f,w+A)}}function kT(r,e,i,o,l,d){return Kt(Kt(r,i,d),Kt(e,o,d),l)}function ic(r,e,i){const o=i.dim,l=Ae(r*o-.5,0,o-1),d=Ae(e*o-.5,0,o-1),f=Math.floor(l),g=Math.floor(d),x=Math.min(f+1,o-1),w=Math.min(g+1,o-1);return kT(i.get(f,g),i.get(x,g),i.get(f,w),i.get(x,w),l-f,d-g)}const mM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _M(r,e,i){return(256*r*256+256*e+i)/10-1e4}function gM(r,e,i){return 256*r+e+i/256-32768}class gg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ki(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const g=o==="terrarium"?gM:_M;for(let x=0;x<f.length;++x){const w=4*x;this.floatView[x]=g(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Ks.now()}_buildQuadTree(){this._tree=new DT(this)}get(e,i,o=!1){o&&(e=Ae(e,-1,this.dim),i=Ae(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,o){const l=this._idx(e,i),d=this.floatView[l];return this.floatView[l]=o,o-d}static getUnpackVector(e){return mM[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],l=gg.getUnpackVector(i);let d=Math.floor((e+l[3])/l[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new zb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(o){case-1:f=g-1;break;case 1:g=f+1}const x=-i*this.dim,w=-o*this.dim;for(let A=f;A<g;A++)for(let I=l;I<d;I++){const P=4*this._idx(I,A),L=4*this._idx(I+x,A+w);this.pixels[P+0]=e.pixels[L+0],this.pixels[P+1]=e.pixels[L+1],this.pixels[P+2]=e.pixels[L+2],this.pixels[P+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function yM(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(o,l){return o.readFields(TM,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},l)}(i,i.readVarint()+i.pos))}function vM(r,e,i){r===1?(e.delta_filter=function(o,l){return o.readFields(xM,{blockSize:0},l)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function xM(r,e,i){r===1&&(e.blockSize=i.readVarint())}function bM(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function wM(r,e,i){let o=0,l=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(d,f){return d.readFields(vM,{},f)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(d,f){return d.readFields(bM,{},f)}(i,i.readVarint()+i.pos):r===5?l=i.readFloat():r===6?o=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=l),e.scale===0&&(e.scale=o)}function TM(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(o,l){return o.readFields(wM,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},l)}(i,i.readVarint()+i.pos))}function SM(r,e,i){if(r===2)(function(o,l,d){o.readFields(EM,d,l)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function EM(r,e,i){if(r===1){let o=0;const l=i.readVarint()+i.pos;for(;i.pos<l;)e[o++]=i.readVarint()}}function AM(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const l=o===1?1:0,d=o===2?1:0;for(let f=0;f<e[0];f++){const g=e[1]*f;for(let x=l;x<e[1];x++){const w=e[2]*(x+g);for(let A=d;A<e[2];A++){const I=e[3]*(A+w);for(let P=0;P<e[3];P++){const L=I+P;r[L]+=r[L-i]}}}}i*=e[o]}return r}function IM(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function CM(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const o=r[i],l=r[i+1];r[i]=(240&o)>>4|(61440&o)>>8|(240&l)<<4|61440&l,r[i+1]=15&o|(3840&o)>>4|(15&l)<<8|(3840&l)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const o=r[i],l=r[i+1],d=r[i+2],f=r[i+3];r[i+0]=(192&o)>>6|(192&l)>>4|(192&d)>>2|192&f,r[i+1]=(48&o)>>4|(48&l)>>2|48&d|(48&f)<<2,r[i+2]=(12&o)>>2|12&l|(12&d)<<2|(12&f)<<4,r[i+3]=3&o|(3&l)<<2|(3&d)<<4|(3&f)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}It(gg,"DEMData"),It(DT,"DemMinMaxQuadTree",{omit:["dem"]});var ao=Uint8Array,Ip=Uint16Array,PM=Int32Array,LT=new ao([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zT=new ao([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MM=new ao([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),OT=function(r,e){for(var i=new Ip(31),o=0;o<31;++o)i[o]=e+=1<<r[o-1];var l=new PM(i[30]);for(o=1;o<30;++o)for(var d=i[o];d<i[o+1];++d)l[d]=d-i[o]<<5|o;return{b:i,r:l}},FT=OT(LT,2),BT=FT.b,RM=FT.r;BT[28]=258,RM[258]=28;for(var DM=OT(zT,0).b,NT=new Ip(32768),bn=0;bn<32768;++bn){var od=(43690&bn)>>1|(21845&bn)<<1;NT[bn]=((65280&(od=(61680&(od=(52428&od)>>2|(13107&od)<<2))>>4|(3855&od)<<4))>>8|(255&od)<<8)>>1}var Cp=function(r,e,i){for(var o=r.length,l=0,d=new Ip(e);l<o;++l)r[l]&&++d[r[l]-1];var f,g=new Ip(e);for(l=1;l<e;++l)g[l]=g[l-1]+d[l-1]<<1;f=new Ip(1<<e);var x=15-e;for(l=0;l<o;++l)if(r[l])for(var w=l<<4|r[l],A=e-r[l],I=g[r[l]-1]++<<A,P=I|(1<<A)-1;I<=P;++I)f[NT[I]>>x]=w;return f},Pp=new ao(288);for(bn=0;bn<144;++bn)Pp[bn]=8;for(bn=144;bn<256;++bn)Pp[bn]=9;for(bn=256;bn<280;++bn)Pp[bn]=7;for(bn=280;bn<288;++bn)Pp[bn]=8;var UT=new ao(32);for(bn=0;bn<32;++bn)UT[bn]=5;var kM=Cp(Pp,9),LM=Cp(UT,5),d0=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},jo=function(r,e,i){var o=e/8|0;return(r[o]|r[o+1]<<8)>>(7&e)&i},f0=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},zM=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$o=function(r,e,i){var o=new Error(e||zM[r]);if(o.code=r,Error.captureStackTrace&&Error.captureStackTrace(o,$o),!i)throw o;return o},OM=new ao(0),FM=typeof TextDecoder<"u"&&new TextDecoder;try{FM.decode(OM,{stream:!0})}catch{}const BM={gzip_data:"gzip"};class bo extends Error{constructor(e){super(e),this.name="MRTError"}}const NM={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},VT={uint32:1,uint16:2,uint8:4},UM={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let p0;class yg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new bo(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new bo("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new bo(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const l=function(d,f){return d.readFields(yM,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new p0(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new bo(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const d of l.layers)this.layers[d.name]=new jT(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let l of e.blockIndices){const d=o.dataIndex[l],f=d.firstByte-e.firstByte,g=d.lastByte-e.firstByte;if(o._blocksInProgress.has(l))continue;const x={layerName:o.name,firstByte:f,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:l,blockShape:[d.bands.length].concat(o.bandShape),buffer:o.buffer,codec:d.codec.codec,filters:d.filters.map(w=>w.filter)};o._blocksInProgress.add(l),i.push(x)}return new $T(i,()=>{i.forEach(l=>o._blocksInProgress.delete(l.blockIndex))},(l,d)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),l)throw l;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class jT{constructor({version:e,name:i,units:o,tileSize:l,pixelFormat:d,buffer:f,dataIndex:g},x){if(this.version=e,this.version!==1)throw new bo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=l,this.buffer=f,this.pixelFormat=NM[d],this.dataIndex=g,this.bandShape=[l+2*f,l+2*f,VT[this.pixelFormat]],this._decodedBlocks=new _g(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return VT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,l]of this.dataIndex.entries()){for(const[d,f]of l.bands.entries())if(f===e)return{bandIndex:i+d,blockIndex:o,blockBandIndex:d};i+=l.bands.length}break;case"number":for(const[o,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new bo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const l=[],d=new Set;for(const f of e){const{blockIndex:g}=this.getBlockForBand(f);if(g<0)throw new bo(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[g];l.includes(g)||l.push(g),d.add(g),i=Math.min(i,x.firstByte),o=Math.max(o,x.lastByte)}if(d.size>this.cacheSize)throw new bo(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new bo(`Band not found: ${JSON.stringify(e)}`);const l=this._decodedBlocks.get(i.toString());if(!l)throw new bo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],f=this.bandShape.reduce((w,A)=>w*A,1),g=o*f,x=l.subarray(g,g+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}yg.setPbf=function(r){p0=r};class $T{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}yg.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(o=>{const{layerName:l,firstByte:d,lastByte:f,pixelFormat:g,blockShape:x,blockIndex:w,filters:A,codec:I}=o,P=i.subarray(d,f+1),L=new Uint32Array(x[0]*x[1]*x[2]);let z;if(I!=="gzip_data")throw new bo(`Unhandled codec: ${I}`);return z=function(B,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((U=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||$o(6,"invalid gzip data");var me=ne[3],xe=10;4&me&&(xe+=2+(ne[10]|ne[11]<<8));for(var Se=(me>>3&1)+(me>>4&1);Se>0;Se-=!ne[xe++]);return xe+(2&me)}(J=B))+8>J.length&&$o(6,"invalid gzip data"),function(ne,me,xe,Se){var Pe=ne.length;if(!Pe||me.f&&!me.l)return xe||new ao(0);var He=!xe,nt=He||me.i!=2,et=me.i;He&&(xe=new ao(3*Pe));var rt,lt,je=function(en){var Rr=xe.length;if(en>Rr){var wr=new ao(Math.max(2*Rr,en));wr.set(xe),xe=wr}},it=me.f||0,Ne=me.p||0,Ge=me.b||0,ut=me.l,dt=me.d,Nt=me.m,Mt=me.n,xt=8*Pe;do{if(!ut){it=jo(ne,Ne,1);var ct=jo(ne,Ne+1,3);if(Ne+=3,!ct){var ci=ne[(ie=4+((Ne+7)/8|0))-4]|ne[ie-3]<<8,zt=ie+ci;if(zt>Pe){et&&$o(0);break}nt&&je(Ge+ci),xe.set(ne.subarray(ie,zt),Ge),me.b=Ge+=ci,me.p=Ne=8*zt,me.f=it;continue}if(ct==1)ut=kM,dt=LM,Nt=9,Mt=5;else if(ct==2){var Ot=jo(ne,Ne,31)+257,oi=jo(ne,Ne+10,15)+4,yi=Ot+jo(ne,Ne+5,31)+1;Ne+=14;for(var bi=new ao(yi),Mi=new ao(19),Ai=0;Ai<oi;++Ai)Mi[MM[Ai]]=jo(ne,Ne+3*Ai,7);Ne+=3*oi;var Ti=d0(Mi),pr=(1<<Ti)-1,Ir=Cp(Mi,Ti);for(Ai=0;Ai<yi;){var ie,se=Ir[jo(ne,Ne,pr)];if(Ne+=15&se,(ie=se>>4)<16)bi[Ai++]=ie;else{var Ze=0,mt=0;for(ie==16?(mt=3+jo(ne,Ne,3),Ne+=2,Ze=bi[Ai-1]):ie==17?(mt=3+jo(ne,Ne,7),Ne+=3):ie==18&&(mt=11+jo(ne,Ne,127),Ne+=7);mt--;)bi[Ai++]=Ze}}var wt=bi.subarray(0,Ot),bt=bi.subarray(Ot);Nt=d0(wt),Mt=d0(bt),ut=Cp(wt,Nt),dt=Cp(bt,Mt)}else $o(1);if(Ne>xt){et&&$o(0);break}}nt&&je(Ge+131072);for(var Ft=(1<<Nt)-1,ri=(1<<Mt)-1,zi=Ne;;zi=Ne){var Oi=(Ze=ut[f0(ne,Ne)&Ft])>>4;if((Ne+=15&Ze)>xt){et&&$o(0);break}if(Ze||$o(2),Oi<256)xe[Ge++]=Oi;else{if(Oi==256){zi=Ne,ut=null;break}var Si=Oi-254;Oi>264&&(Si=jo(ne,Ne,(1<<(Fi=LT[Ai=Oi-257]))-1)+BT[Ai],Ne+=Fi);var or=dt[f0(ne,Ne)&ri],br=or>>4;if(or||$o(3),Ne+=15&or,bt=DM[br],br>3){var Fi=zT[br];bt+=f0(ne,Ne)&(1<<Fi)-1,Ne+=Fi}if(Ne>xt){et&&$o(0);break}nt&&je(Ge+131072);var Gr=Ge+Si;if(Ge<bt){var Cr=0-bt,rr=Math.min(bt,Gr);for(Cr+Ge<0&&$o(3);Ge<rr;++Ge)xe[Ge]=(void 0)[Cr+Ge]}for(;Ge<Gr;++Ge)xe[Ge]=xe[Ge-bt]}}me.l=ut,me.p=zi,me.b=Ge,me.f=it,ut&&(it=1,me.m=Nt,me.d=dt,me.n=Mt)}while(!it);return Ge!=xe.length&&He?(rt=xe,((lt=Ge)==null||lt>rt.length)&&(lt=rt.length),new ao(rt.subarray(0,lt))):xe.subarray(0,Ge)}(J.subarray(U,-8),{i:2},new ao(((Z=J)[(te=Z.length)-4]|Z[te-3]<<8|Z[te-2]<<16|Z[te-1]<<24)>>>0))));var Z,te,J,U;const X=BM[H];if(!X)throw new Error(`Unhandled codec: ${H}`);const ee=new globalThis.DecompressionStream(X);return new Response(new Blob([B]).stream().pipeThrough(ee)).arrayBuffer().then(ne=>new Uint8Array(ne))}(P,I).then(B=>(function(H,Z){H.readFields(SM,Z)}(new p0(B),L),new UM[g](L.buffer))),z.then(B=>{for(let H=A.length-1;H>=0;H--)switch(A[H]){case"delta_filter":AM(B,x);break;case"zigzag_filter":IM(B);break;case"bitshuffle_filter":CM(B,g);break;default:throw new bo(`Unhandled filter "${A[H]}"`)}return{layerName:l,blockIndex:w,data:B}}).catch(B=>{throw B})}))},It($T,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),It(yg,"MapboxRasterTile"),It(jT,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Mp,m0,Go,ad,_0,ld=null;function GT(){return Er(self)&&self.worker.dracoUrl?self.worker.dracoUrl:m0||Vn.DRACO_URL}function HT(){if(Er(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ad)return ad;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ad=WebAssembly.validate(r)?Vn.MESHOPT_SIMD_URL:Vn.MESHOPT_URL,ad}const vg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Rp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qT(r,e,i){const o=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:l,byteLength:r.byteLength},i.buffers[l]=r}const g0="KHR_draco_mesh_compression";function jM(r,e){const i=r.extensions&&r.extensions[g0];if(!i)return;const o=new Go.Decoder,l=KT(e,i.bufferView),d=new Go.Mesh;if(!o.DecodeArrayToMesh(l,l.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[r.indices],g=vg[f.componentType],x=f.count*g.BYTES_PER_ELEMENT,w=Go._malloc(x);g===Uint16Array?o.GetTrianglesUInt16Array(d,x,w):o.GetTrianglesUInt32Array(d,x,w),qT(Go.memory.buffer.slice(w,w+x),f,e),Go._free(w);for(const A of Object.keys(i.attributes)){const I=o.GetAttributeByUniqueId(d,i.attributes[A]),P=e.json.accessors[r.attributes[A]],L=VM[P.componentType],z=P.count*Rp[P.type]*vg[P.componentType].BYTES_PER_ELEMENT,B=Go._malloc(z);o.GetAttributeDataArrayForAllPoints(d,I,Go[L],z,B),qT(Go.memory.buffer.slice(B,B+z),P,e),Go._free(B)}o.destroy(),d.destroy(),delete r.extensions[g0]}const xg="EXT_meshopt_compression";function $M(r,e){if(!r.extensions||!r.extensions[xg])return;const i=r.extensions[xg],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);_0.decodeGltfBuffer(l,i.count,i.byteStride,o,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=l.buffer,delete r.extensions[xg]}const WT=1179937895,ZT=new TextDecoder("utf8");function XT(r,e){return new URL(r,e).href}function GM(r,e,i,o){return fetch(XT(r.uri,o)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function KT(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function HM(r,e,i,o){if(r.uri){const l=XT(r.uri,o);return fetch(l).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(r.bufferView!==void 0){const l=KT(e,r.bufferView),d=new Blob([l],{type:r.mimeType});return createImageBitmap(d).then(f=>{e.images[i]=f})}}function YT(r,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===WT){const A=new Uint32Array(r,e);let I=2;const P=(A[I++]>>2)-3,L=A[I++]>>2;if(I++,o.json=JSON.parse(ZT.decode(A.subarray(I,I+L))),I+=L,I<P){const z=A[I++];I++;const B=e+(I<<2);o.buffers[0]=r.slice(B,B+z)}}else o.json=JSON.parse(ZT.decode(new Uint8Array(r,e)));const{buffers:l,images:d,meshes:f,extensionsUsed:g,bufferViews:x}=o.json;let w=Promise.resolve();if(l){const A=[];for(let I=0;I<l.length;I++){const P=l[I];P.uri?A.push(GM(P,o,I,i)):o.buffers[I]||(o.buffers[I]=null)}w=Promise.all(A)}return w.then(()=>{const A=[],I=g&&g.includes(g0),P=g&&g.includes(xg);if(I&&A.push(function(){if(!Go)return Mp??(Mp=function(L){let z,B=null;function H(){z=new Uint8Array(B.buffer)}function Z(){throw new Error("Unexpected Draco error.")}const te={a:{a:Z,d:function(J,U,X){return z.copyWithin(J,U,U+X)},c:function(J){const U=z.length,X=Math.max(J>>>0,Math.ceil(1.2*U)),ee=Math.ceil((X-U)/65536);try{return B.grow(ee),H(),!0}catch{return!1}},b:Z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,te):L.then(J=>J.arrayBuffer()).then(J=>WebAssembly.instantiate(J,te))).then(J=>{const{Rb:U,Qb:X,P:ee,T:ne,X:me,Ja:xe,La:Se,Qa:Pe,Va:He,Wa:nt,eb:et,jb:rt,f:lt,e:je,yb:it,zb:Ne,Ab:Ge,Bb:ut,Db:dt,Gb:Nt}=J.instance.exports;B=je;const Mt=(()=>{let xt=0,ct=0,ci=0,zt=0;return Ot=>{ci&&(U(zt),U(xt),ct+=ci,ci=xt=0),xt||(ct+=128,xt=X(ct));const oi=Ot.length+7&-8;let yi=xt;oi>=ct&&(ci=oi,yi=zt=X(oi));for(let bi=0;bi<Ot.length;bi++)z[yi+bi]=Ot[bi];return yi}})();return H(),lt(),{memory:je,_free:U,_malloc:X,Mesh:class{constructor(){this.ptr=ee()}destroy(){ne(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){rt(this.ptr)}DecodeArrayToMesh(xt,ct,ci){const zt=Mt(xt),Ot=Se(this.ptr,zt,ct,ci.ptr);return!!me(Ot)}GetAttributeByUniqueId(xt,ct){return{ptr:Pe(this.ptr,xt.ptr,ct)}}GetTrianglesUInt16Array(xt,ct,ci){He(this.ptr,xt.ptr,ct,ci)}GetTrianglesUInt32Array(xt,ct,ci){nt(this.ptr,xt.ptr,ct,ci)}GetAttributeDataArrayForAllPoints(xt,ct,ci,zt,Ot){et(this.ptr,xt.ptr,ct.ptr,ci,zt,Ot)}},DT_INT8:it(),DT_UINT8:Ne(),DT_INT16:Ge(),DT_UINT16:ut(),DT_UINT32:dt(),DT_FLOAT32:Nt()}})}(fetch(GT())),Mp.then(L=>{Go=L,Mp=void 0}))}()),P&&A.push(function(){if(_0)return;const L=function(z){let B;const H=WebAssembly.instantiateStreaming(z,{}).then(J=>{B=J.instance,B.exports.__wasm_call_ctors()}),Z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(J,U,X,ee,ne,me){(function(xe,Se,Pe,He,nt,et,rt){const lt=xe.exports.sbrk,je=He+3&-4,it=lt(je*nt),Ne=lt(et.length),Ge=new Uint8Array(xe.exports.memory.buffer);Ge.set(et,Ne);const ut=Se(it,He,nt,Ne,et.length);if(ut===0&&rt&&rt(it,je,nt),Pe.set(Ge.subarray(it,it+He*nt)),lt(it-lt(0)),ut!==0)throw new Error(`Malformed buffer data: ${ut}`)})(B,B.exports[te[ne]],J,U,X,ee,B.exports[Z[me]])}}}(fetch(HT()));return L.ready.then(()=>{_0=L})}()),d)for(let L=0;L<d.length;L++)A.push(HM(d[L],o,L,i));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(I&&f)for(const{primitives:L}of f)for(const z of L)jM(z,o);if(P&&f&&x)for(const L of x)$M(L,o);return o})})}function Eu(r,e){const i=r.json.bufferViews[e.bufferView],o=vg[e.componentType];return new o(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Rp[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Rp[e.type]))}function y0(r,e,i,o){const l=vg[e.componentType],d=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=r.json.bufferViews[e.bufferView],g=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:Rp[e.type],x=i.float32,w=x.length/i.capacity;for(let A=0,I=0;A<e.count*g;A+=g,I+=w)for(let P=0;P<w;P++)x[I+P]=o[A+P]*d;i._trim()}function qM(r,e,i){const o=r.indices,l=r.attributes,d={};d.indexArray=new Mn;const f=e.json.accessors[o],g=f.count/3;d.indexArray.reserve(g);const x=Eu(e,f);for(let P=0;P<g;P++)d.indexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);d.indexArray._trim(),d.vertexArray=new _o;const w=e.json.accessors[l.POSITION];d.vertexArray.reserve(w.count);const A=Eu(e,w);for(let P=0;P<w.count;P++)d.vertexArray.emplaceBack(A[3*P],A[3*P+1],A[3*P+2]);if(d.vertexArray._trim(),d.aabb=new zr(w.min,w.max),d.centroid=function(P,L){const z=[0,0,0],B=P.length;if(B>0){for(let H=0;H<B;H++){const Z=3*P[H];z[0]+=L[Z],z[1]+=L[Z+1],z[2]+=L[Z+2]}z[0]/=B,z[1]/=B,z[2]/=B}return z}(x,A),l.COLOR_0!==void 0){const P=e.json.accessors[l.COLOR_0],L=Rp[P.type],z=Eu(e,P);d.colorArray=L===3?new _o:new go,d.colorArray.resize(P.count),y0(e,P,d.colorArray,z)}if(l.NORMAL!==void 0){d.normalArray=new _o;const P=e.json.accessors[l.NORMAL];d.normalArray.resize(P.count);const L=Eu(e,P);y0(e,P,d.normalArray,L)}if(l.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Ya;const P=e.json.accessors[l.TEXCOORD_0];d.texcoordArray.resize(P.count);const L=Eu(e,P);y0(e,P,d.texcoordArray,L)}if(l._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Eu(e,P))}l._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Eu(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const I=r.material;return d.material=function(P,L){const{emissiveFactor:z=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:H=.5,normalTexture:Z,occlusionTexture:te,emissiveTexture:J,doubleSided:U}=P,{baseColorFactor:X=[1,1,1,1],metallicFactor:ee=1,roughnessFactor:ne=1,baseColorTexture:me,metallicRoughnessTexture:xe}=P.pbrMetallicRoughness||{},Se=te?L[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Se){const Pe=te.extensions.KHR_texture_transform;Se.offsetScale=[Pe.offset[0],Pe.offset[1],Pe.scale[0],Pe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ji(...X),metallicFactor:ee,roughnessFactor:ne,baseColorTexture:me?L[me.index]:void 0,metallicRoughnessTexture:xe?L[xe.index]:void 0},doubleSided:U,emissiveFactor:z,alphaMode:B,alphaCutoff:H,normalTexture:Z?L[Z.index]:void 0,occlusionTexture:Se,emissionTexture:J?L[J.index]:void 0,defined:P.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},i),d}function JT(r,e,i){const{matrix:o,rotation:l,translation:d,scale:f,mesh:g,extras:x,children:w}=r,A={};if(A.matrix=o||function(I,P,L,z){var B=P[0],H=P[1],Z=P[2],te=P[3],J=B+B,U=H+H,X=Z+Z,ee=B*J,ne=B*U,me=B*X,xe=H*U,Se=H*X,Pe=Z*X,He=te*J,nt=te*U,et=te*X,rt=z[0],lt=z[1],je=z[2];return I[0]=(1-(xe+Pe))*rt,I[1]=(ne+et)*rt,I[2]=(me-nt)*rt,I[3]=0,I[4]=(ne-et)*lt,I[5]=(1-(ee+Pe))*lt,I[6]=(Se+He)*lt,I[7]=0,I[8]=(me+nt)*je,I[9]=(Se-He)*je,I[10]=(1-(ee+xe))*je,I[11]=0,I[12]=L[0],I[13]=L[1],I[14]=L[2],I[15]=1,I}([],l||[0,0,0,1],d||[0,0,0],f||[1,1,1]),g!==void 0){A.meshes=i[g];const I=A.anchor=[0,0];for(const P of A.meshes){const{min:L,max:z}=P.aabb;I[0]+=L[0]+z[0],I[1]+=L[1]+z[1]}I[0]=Math.floor(I[0]/A.meshes.length/2),I[1]=Math.floor(I[1]/A.meshes.length/2)}if(x&&(x.id&&(A.id=x.id),x.lights&&(A.lights=function(I){if(!I.length)return[];const P=function(Z){const te=atob(Z),J=new Uint8Array(te.length);for(let U=0;U<te.length;U++)J[U]=te.codePointAt(U);return J}(I),L=[],z=P.length/24,B=new Uint16Array(P.buffer),H=new Float32Array(P.buffer);for(let Z=0;Z<z;Z++){const te=B[2*Z*6]/30,J=B[2*Z*6+1]/30,U=B[2*Z*6+10]/100,X=H[6*Z+1],ee=H[6*Z+2],ne=H[6*Z+3],me=H[6*Z+4],xe=ne-X,Se=me-ee,Pe=Math.hypot(xe,Se);L.push({pos:[X+.5*xe,ee+.5*Se,J],normal:[Se/Pe,-xe/Pe,0],width:Pe,height:te,depth:U,points:[X,ee,ne,me]})}return L}(x.lights))),w){const I=[];for(const P of w)I.push(JT(e.json.nodes[P],e,i));A.children=I}return A}function WM(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new wv(r.vertices,r.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:o}}function ZM(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const g=f[0],x=f[1];typeof g=="number"&&typeof x=="number"&&o.push(new gt(g,x))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let l=0;for(let f=0;f<o.length;f++){const g=o[f],x=o[(f+1)%o.length],w=o[(f+2)%o.length];l+=(g.x-x.x)*(w.y-x.y)-(w.x-x.x)*(g.y-x.y)}l>0&&o.reverse();const d=tp(o.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:o,indices:d}}function XM(r,e){const i=[],o=[];let l=0;const d=[];for(const f of r){l=i.length;const g=f.vertexArray.float32,x=f.indexArray.uint16;for(let w=0;w<f.vertexArray.length;w++)d[0]=g[3*w+0],d[1]=g[3*w+1],d[2]=g[3*w+2],$t(d,d,e),i.push(new gt(d[0],d[1]));for(let w=0;w<3*f.indexArray.length;w++)o.push(x[w]+l)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const g=i[o[f+0]],x=i[o[f+1]],w=i[o[f+2]];(g.x-x.x)*(w.y-x.y)-(w.x-x.x)*(g.y-x.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function QT(r){const e=function(x,w){const A=[],I=WebGL2RenderingContext;if(x.json.textures)for(const P of x.json.textures){const L={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};P.sampler!==void 0&&Object.assign(L,x.json.samplers[P.sampler]),A.push({image:w[P.source],sampler:L,uploaded:!1})}return A}(r,r.images),i=function(x,w){const A=[];for(const I of x.json.meshes){const P=[];for(const L of I.primitives)P.push(qM(L,x,w));A.push(P)}return A}(r,e),{scenes:o,scene:l,nodes:d}=r.json,f=o?o[l||0].nodes:d,g=[];for(const x of f)g.push(JT(d[x],r,i));return function(x,w,A){const I={},P=new Set;for(let L=0;L<x.length;L++){const z=A[w[L]];if(!z.extras)continue;const B=z.extras["mapbox:footprint:version"],H=z.extras["mapbox:footprint:id"];(B||H)&&P.add(L),B==="1.0.0"&&H&&(I[H]=L)}for(let L=0;L<x.length;L++){if(P.has(L))continue;const z=x[L],B=A[w[L]];if(!B.extras)continue;let H=null;z.id in I&&(H=XM(x[I[z.id]].meshes,z.matrix)),H||(H=ZM(B)),H&&(z.footprint=WM(H))}if(P.size>0){const L=Array.from(P.values()).sort((z,B)=>z-B);for(let z=L.length-1;z>=0;z--)x.splice(L[z],1)}}(g,f,r.json.nodes),g}function KM(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,o=r.aabb.min[1]-1,l=wu/(r.aabb.max[0]-i+2),d=wu/(r.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const g=e[f+2],x=(e[f+0]-i)*l|0,w=(e[f+1]-o)*d|0;g>r.heightmap[w*wu+x]&&(r.heightmap[w*wu+x]=g)}}function YM(r,e){const i={};i.indexArray=new Mn,i.indexArray.reserve(4*r.length),i.vertexArray=new _o,i.vertexArray.reserve(10*r.length),i.colorArray=new go,i.vertexArray.reserve(10*r.length);let o=0;for(const f of r){const g=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],w=Math.min(.29,.1*f.width/f.depth),A=f.width-2*f.depth*e*(w+.01),I=vn([],f.pos,x,A/2),P=vn([],f.pos,x,-A/2),L=[I[0],I[1],I[2]+f.height],z=[P[0],P[1],P[2]+f.height],B=vn([],f.normal,x,w);Yi(B,B,g);const H=vn([],f.normal,x,-w);Yi(H,H,g),Ni(B,I,B),Ni(H,P,H),I[2]+=.1,P[2]+=.1,i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]);const Z=A/g/2;i.colorArray.emplaceBack(-Z-w,-1,Z,.8),i.colorArray.emplaceBack(Z+w,-1,Z,.8),i.colorArray.emplaceBack(-Z,0,Z,1.3),i.colorArray.emplaceBack(Z,0,Z,1.3),i.colorArray.emplaceBack(Z+w,-.8,Z,.7),i.colorArray.emplaceBack(Z+w,-.8,Z,.7),i.colorArray.emplaceBack(0,0,Z,1.3),i.colorArray.emplaceBack(0,0,Z,1.3),i.colorArray.emplaceBack(Z+w,-1.2,Z,.8),i.colorArray.emplaceBack(Z+w,-1.2,Z,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const l={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Ji.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new zr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class eS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const JM=["id","tile","layer","source","sourceLayer","state"];class cd{constructor(e,i,o,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=l,this.properties=e.properties,this.id=d}clone(){const e=new cd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of JM)this[i]!==void 0&&(e[i]=this[i]);return e}}class tS{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(vt,16,0),this.featureIndexArray=new v_,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,l,d,f=0,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,d,f);const w=this.grid;for(let A=0;A<i.length;A++){const I=i[A],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const z=I[L];P[0]=Math.min(P[0],z.x),P[1]=Math.min(P[1],z.y),P[2]=Math.max(P[2],z.x),P[3]=Math.max(P[3],z.y)}g!==0&&(P[0]-=g,P[1]-=g,P[2]+=g,P[3]+=g),P[0]<vt&&P[1]<vt&&P[2]>=0&&P[3]>=0&&w.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yl.VectorTile(new U_(this.rawTileData)).layers,this.sourceLayerCoder=new eS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:l,tileTransform:d,pixelPosMatrix:f,availableImages:g}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const x=o.bufferedTilespaceBounds,w=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,z,B,H)=>un(o.bufferedTilespaceGeometry,L,z,B,H));w.sort(QM);let A=null;l.elevation&&w.length>0&&(A=rd.create(l.elevation,this.tileID));const I={};let P;for(let L=0;L<w.length;L++){const z=w[L];if(z===P)continue;P=z;const B=this.featureIndexArray.get(z);let H=null;this.is3DTile?this.loadMatchingModelFeature(I,B,e,o,l):this.loadMatchingFeature(I,B,e,g,(Z,te,J,U=0)=>(H||(H=Rt(Z,this.tileID.canonical,d)),te.queryIntersectsFeature(o,Z,J,H,this.z,l,f,A,U)))}return I}loadMatchingFeature(e,i,o,l,d){const{featureIndex:f,bucketIndex:g,sourceLayerIndex:x,layoutVertexArrayOffset:w}=i,A=this.bucketLayerIDs[g],I=o.layers,P=Object.keys(I);if(P.length&&!function(Z,te){for(let J=0;J<Z.length;J++)if(te.indexOf(Z[J])>=0)return!0;return!1}(P,A))return;const L=o.sourceCache,z=this.sourceLayerCoder.decode(x),B=this.vtLayers[z].feature(f),H=this.getId(B,z);for(let Z=0;Z<A.length;Z++){const te=A[Z];if(!I[te])continue;const{styleLayer:J,targets:U}=I[te];let X={};H!==void 0&&(X=L.getFeatureState(J.sourceLayer,H));const ee=!d||d(B,J,X,w);if(!ee)continue;const ne=new cd(B,this.z,this.x,this.y,H);ne.tile=this.tileID.canonical,ne.state=X;let me=this.serializedLayersCache.get(te);me||(me=J.serialize(),me.id=te,this.serializedLayersCache.set(te,me)),ne.source=me.source,ne.sourceLayer=me["source-layer"],ne.layer=Be({},me),ne.layer.paint=iS(me.paint,J.paint,B,X,l),ne.layer.layout=iS(me.layout,J.layout,B,X,l);let xe=!1;for(const Se of U){this.updateFeatureProperties(ne,Se);const{filter:Pe}=Se;if(Pe){if(B.properties=ne.properties,Pe.needGeometry){const He=Ut(B,!0);if(!Pe.filter(new cr(this.tileID.overscaledZ),He,this.tileID.canonical))continue}else if(!Pe.filter(new cr(this.tileID.overscaledZ),B))continue}xe=!0,Se.targetId&&this.addFeatureVariant(ne,Se)}xe&&this.appendToResult(e,te,f,ne,ee)}}loadMatchingModelFeature(e,i,o,l,d){const f=this.bucketLayerIDs[0][0],g=o.layers;if(!g[f])return;const{styleLayer:x,targets:w}=g[f];if(x.type!=="model")return;const A=l.tile,I=i.featureIndex,P=A.getBucket(x);if(!(P&&P instanceof cg))return;const L=function(me,xe,Se,Pe){const He=me.getNodesInfo()[xe];if(He.hiddenByReplacement||!He.node.meshes)return;let nt=Number.MAX_VALUE;const et=He.node,rt=Se.tile,lt=Pe.calculatePosMatrix(rt.tileID.toUnwrapped(),Pe.worldSize),je=He.evaluatedScale;let it=0;Pe.elevation&&et.elevation&&(it=et.elevation*Pe.elevation.exaggeration()),ze(lt,lt,[(et.anchor?et.anchor[0]:0)*(je[0]-1),(et.anchor?et.anchor[1]:0)*(je[1]-1),it]),be(lt,lt,je);const Ne=Se.queryGeometry,Ge=Ne.isPointQuery()?Ne.screenBounds:Ne.screenGeometry,ut=function(Nt){const Mt=$e([],lt,Nt.matrix);$e(Mt,Pe.expandedFarZProjMatrix,Mt);for(let xt=0;xt<Nt.meshes.length;++xt){const ct=Nt.meshes[xt];if(xt===Nt.lightMeshIndex)continue;const ci=tT(Ge,Pe,Mt,ct.aabb);ci!=null&&(nt=Math.min(ci,nt))}if(Nt.children)for(const xt of Nt.children)ut(xt)};if(ut(et),nt===Number.MAX_VALUE)return;const dt=new $(0,0);return dT(rt.tileID.canonical,dt,He.node.anchor[0],He.node.anchor[1]),{intersectionZ:nt,position:dt,feature:He.feature}}(P,I,l,d);if(!L)return;const{z,x:B,y:H}=A.tileID.canonical,{feature:Z,intersectionZ:te,position:J}=L;let U={};Z.id!==void 0&&(U=o.sourceCache.getFeatureState(x.sourceLayer,Z.id));const X=new cd({},z,B,H,Z.id);X.tile=this.tileID.canonical,X.state=U,X.properties=Z.properties,X.geometry={type:"Point",coordinates:[J.lng,J.lat]};let ee=this.serializedLayersCache.get(f);ee||(ee=x.serialize(),ee.id=f,this.serializedLayersCache.set(f,ee)),X.source=ee.source,X.sourceLayer=ee["source-layer"],X.layer=Be({},ee);let ne=!1;for(const me of w){this.updateFeatureProperties(X,me);const{filter:xe}=me;if(xe){if(Z.properties=X.properties,xe.needGeometry){if(!xe.filter(new cr(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!xe.filter(new cr(this.tileID.overscaledZ),Z))continue}ne=!0,me.targetId&&this.addFeatureVariant(X,me)}ne&&this.appendToResult(e,f,I,X,te)}updateFeatureProperties(e,i,o){if(i.properties){const l={};for(const d in i.properties){const f=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(l[d]=f)}e.properties=l}}addFeatureVariant(e,i,o){const l={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(l.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(l)}appendToResult(e,i,o,l,d){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:l,intersectionZ:d})}lookupSymbolFeatures(e,i,o,l,d){const f={};this.loadVTLayers();for(const g of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:g,layoutVertexArrayOffset:0},l,d);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),d=this.vtFeatures[l];if(d[i])return d[i];const f=this.vtLayers[l].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const l=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(l!=null)if(Array.isArray(l)){if(!this.promoteIdExpression){const d=Ll(l);if(d.result!=="success"){const f=d.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void ki(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new sh),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[l];typeof o=="boolean"&&(o=Number(o))}return o}}function iS(r,e,i,o,l){return xi(r,(d,f)=>{const g=e instanceof qa?e.get(f):null;return g&&g.evaluate?g.evaluate(i,o,void 0,l):g})}function QM(r,e){return e-r}It(tS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const rS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class v0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=rS[15&o];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new v0(g,f,d,e)}constructor(e,i=64,o=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=rS.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-g%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return x0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:g}=this,x=[0,d.length-1,0],w=[];for(;x.length;){const A=x.pop()||0,I=x.pop()||0,P=x.pop()||0;if(I-P<=g){for(let H=P;H<=I;H++){const Z=f[2*H],te=f[2*H+1];Z>=e&&Z<=o&&te>=i&&te<=l&&w.push(d[H])}continue}const L=P+I>>1,z=f[2*L],B=f[2*L+1];z>=e&&z<=o&&B>=i&&B<=l&&w.push(d[L]),(A===0?e<=z:i<=B)&&(x.push(P),x.push(L-1),x.push(1-A)),(A===0?o>=z:l>=B)&&(x.push(L+1),x.push(I),x.push(1-A))}return w}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,g=[0,l.length-1,0],x=[],w=o*o;for(;g.length;){const A=g.pop()||0,I=g.pop()||0,P=g.pop()||0;if(I-P<=f){for(let H=P;H<=I;H++)sS(d[2*H],d[2*H+1],e,i)<=w&&x.push(l[H]);continue}const L=P+I>>1,z=d[2*L],B=d[2*L+1];sS(z,B,e,i)<=w&&x.push(l[L]),(A===0?e-o<=z:i-o<=B)&&(g.push(P),g.push(L-1),g.push(1-A)),(A===0?e+o>=z:i+o>=B)&&(g.push(L+1),g.push(I),g.push(1-A))}return x}}function x0(r,e,i,o,l,d){if(l-o<=i)return;const f=o+l>>1;nS(r,e,f,o,l,d),x0(r,e,i,o,f-1,1-d),x0(r,e,i,f+1,l,1-d)}function nS(r,e,i,o,l,d){for(;l>o;){if(l-o>600){const w=l-o+1,A=i-o+1,I=Math.log(w),P=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*P*(w-P)/w)*(A-w/2<0?-1:1);nS(r,e,i,Math.max(o,Math.floor(i-A*P/w+L)),Math.min(l,Math.floor(i+(w-A)*P/w+L)),d)}const f=e[2*i+d];let g=o,x=l;for(Dp(r,e,o,i),e[2*l+d]>f&&Dp(r,e,o,l);g<x;){for(Dp(r,e,g,x),g++,x--;e[2*g+d]<f;)g++;for(;e[2*x+d]>f;)x--}e[2*o+d]===f?Dp(r,e,o,x):(x++,Dp(r,e,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function Dp(r,e,i,o){b0(r,i,o),b0(e,2*i,2*o),b0(e,2*i+1,2*o+1)}function b0(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function sS(r,e,i,o){const l=r-i,d=e-o;return l*l+d*d}n.$=Xn,n.A=Qo,n.B=Qs,n.C=Za,n.D=nd,n.E=Ra,n.F=2,n.G=pp,n.H=mw,n.I=bs,n.J=class extends ag{},n.K=li,n.L=Oc,n.M=to,n.N=Ah,n.O=Eh,n.P=gt,n.Q=Af,n.R=Yu,n.S=Ph,n.T=Kv,n.U=Lh,n.V=ag,n.W=Yc,n.X=Ll,n.Y=fh,n.Z=Pl,n._=Hc,n.a=function(r){return Vn.API_CDN_URL_REGEX.test(r)},n.a$=Et,n.a0=zc,n.a1=zh,n.a2=Ih,n.a3=Jm,n.a4=function(r){const e=r.value;let i=[];if(!e)return i;const o=li(e);return o!=="string"?(i=i.concat([new ag(r.key,e,`string expected, "${o}" found`)]),i):(e0(e,!0)||(i=i.concat([new ag(r.key,e,`invalid url "${e}"`)])),i)},n.a5=De,n.a6=s_,n.a7=Jr,n.a8=pt,n.a9=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return xr(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Kt(r.x,e.x,i),y:Kt(r.y,e.y,i),z:Kt(r.z,e.z,i),azimuthal:Kt(r.azimuthal,e.azimuthal,i),polar:Kt(r.polar,e.polar,i)}}},n.aA=Jt,n.aB=hr,n.aC=tt,n.aD=Ae,n.aE=_,n.aF=function(r,e){const i={};for(let o=0;o<e.length;o++){const l=e[o];l in r&&(i[l]=r[l])}return i},n.aG=Q,n.aH=he,n.aI=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,o){const l=this.entries[r]=this.entries[r]||{callbacks:[]};if(l.result){const[d,f]=l.result;return this.scheduler?this.scheduler.add(()=>{o(d,f)},e):o(d,f),()=>{}}return l.callbacks.push(o),l.cancel||(l.cancel=i((d,f)=>{l.result=[d,f];for(const g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(d,f)},e):g(d,f);setTimeout(()=>delete this.entries[r],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(d=>d!==o),l.callbacks.length||(l.cancel(),delete this.entries[r]))}}},n.aJ=function(r,e,i){const o=JSON.stringify(r.request);return r.data&&(this.deduped.entries[o]={result:[null,r.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},l=>{const d=gl(r.request,(f,g,x,w)=>{f?l(f):g&&l(null,{vectorTile:i?void 0:new Yl.VectorTile(new U_(g)),rawData:g,cacheControl:x,expires:w})});return()=>{d.cancel(),l()}},e)},n.aK=function(r){Dc++,Dc>Js&&(r.getActor().send("enforceCacheSizeLimit",Ro),Dc=0)},n.aL=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},n.aM=on,n.aN=Gw,n.aO=Kw,n.aP=$w,n.aQ=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<r.length;o++){const l=document.createElement("source");Ey(r[o])||(i.crossOrigin="Anonymous"),l.src=r[o],i.appendChild(l)}return{cancel:()=>{}}},n.aR=ig,n.aS=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>YT(e,0,r))},n.aT=QT,n.aU=class{constructor(r,e,i,o){this.id=r,this.position=e!=null?new $(e[0],e[1]):new $(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new zr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if($e(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const o=zr.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(o)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=pe([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,o,l,d,f=!1){aT(this.matrix,this,r.transform,this.position,e,i,o,l,d,f)}upload(r){if(!this.uploaded){for(const e of this.nodes)i0(e,r);for(const e of this.nodes)lg(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)r0(r)}},n.aV=pi,n.aW=_p,n.aX=_e,n.aY=ge,n.aZ=Xa,n.a_=Mn,n.aa=cr,n.ab=zl,n.ac=Fe,n.ad=$t,n.ae=di,n.af=Ie,n.ag=qa,n.ah=Xl,n.ai=Kt,n.aj=vt,n.ak=Am,n.al=G,n.am=Ji,n.an=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,o]){const l=xr([1,i,o]);return{x:l.x,y:l.y,z:l.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Kt(r.x,e.x,i),y:Kt(r.y,e.y,i),z:Kt(r.z,e.z,i)}}},n.ao=function(r,e,i=0,o=!0){const l=new gt(i,i),d=r.sub(l),f=e.add(l),g=[d,new gt(f.x,d.y),f,new gt(d.x,f.y)];return o&&g.push(d.clone()),g},n.ap=function(r,e){const i=[];for(let o=0;o<r.length;o++){const l=Ue(o-1,-1,r.length-1),d=Ue(o+1,-1,r.length-1),f=r[o],g=r[d],x=r[l].sub(f).unit(),w=g.sub(f).unit(),A=w.angleWithSep(x.x,x.y),I=x.add(w).unit().mult(-1*e/Math.sin(A/2));i.push(f.add(I))}return i},n.aq=Pw,n.ar=un,n.as=function(r,e,i=0){return vi(((e.x-i)*r.scale-r.x)*vt,(e.y*r.scale-r.y)*vt,Oe(e.z,e.y))},n.at=we,n.au=gr,n.av=oo,n.aw=V1,n.ax=function(r){let e=1/0,i=1/0,o=-1/0,l=-1/0;for(const d of r)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),l=Math.max(l,d.y);return{min:new gt(e,i),max:new gt(o,l)}},n.ay=ue,n.az=$e,n.b=function(r){return Vn.API_FONTS_REGEX.test(r)},n.b$=Yi,n.b0=Gh,n.b1=eg,n.b2=function(){$s.isLoading()||$s.isLoaded()||Fl()!=="deferred"||n_()},n.b3=zf,n.b4=Ut,n.b5=cd,n.b6=rn,n.b7=Cv,n.b8=bv,n.b9=Rt,n.bA=function(r,e){const{x:i,y:o}=r.point,l=wb(i,o,r.worldSize/r._pixelsPerMercatorPixel,0,0);return $e(l,l,ov(_a(e)))},n.bB=N,n.bC=function(r){return r[0]=0,r[1]=0,r[2]=0,r},n.bD=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},n.bE=tr,n.bF=vn,n.bG=_t,n.bH=fp,n.bI=Ls,n.bJ=Ov,n.bK=function(r,e,i,o,l){const d=5*e+2;r.float32[d+0]=i,r.float32[d+1]=o,r.float32[d+2]=l},n.bL=Q_,n.bM=N_,n.bN=ei,n.bO=On,n.bP=c1,n.bQ=iT,n.bR=p1,n.bS=m1,n.bT=Uv,n.bU=ww,n.bV=zv,n.bW=v0,n.bX=Ue,n.bY=Yt,n.bZ=function(r,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=o*x+l*g,r[1]=l*x-o*g,r[2]=d*x+f*g,r[3]=f*x-d*g,r},n.b_=Gt,n.ba=Fo,n.bb=au,n.bc=vo,n.bd=$r,n.be=tp,n.bf=Wv,n.bg=function(r,e){const i=Xl(e.zoom);if(i===0)return _a(r);const o=I_(r),l=sv(o),d=ue(o.getWest())*e.worldSize,f=ue(o.getEast())*e.worldSize,g=he(o.getNorth())*e.worldSize,x=he(o.getSouth())*e.worldSize,w=[d,g,0],A=[f,g,0],I=[d,x,0],P=[f,x,0],L=qe([],e.globeMatrix);return $t(w,w,L),$t(A,A,L),$t(I,I,L),$t(P,P,L),l[0]=el(l[0],I,i),l[1]=el(l[1],P,i),l[2]=el(l[2],A,i),l[3]=el(l[3],w,i),zr.fromPoints(l)},n.bh=P_,n.bi=qe,n.bj=Qf,n.bk=el,n.bl=Bh,n.bm=Hs,n.bn=kt,n.bo=ze,n.bp=yg,n.bq=U_,n.br=gl,n.bs=function(r,e){const i=[];for(const o in r)o in e||i.push(o);return i},n.bt=Ye,n.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bv=Po,n.bw=function(r){var e=new W(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},n.bx=pe,n.by=St,n.bz=Te,n.c=Ia,n.c$=function(r){return r({pluginStatus:ws,pluginURL:ua}),kh.on("pluginStateChange",r),r},n.c0=ht,n.c1=Pn,n.c2=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.c3=Wt,n.c4=function(r,e,i,o,l){var d,f=1/Math.tan(e/2);return r[0]=f/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,l!=null&&l!==1/0?(r[10]=(l+o)*(d=1/(o-l)),r[14]=2*l*o*d):(r[10]=-1,r[14]=-2*o),r},n.c5=function(r,e,i,o,l,d,f){var g=1/(e-i),x=1/(o-l),w=1/(d-f);return r[0]=-2*g,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(e+i)*g,r[13]=(l+o)*x,r[14]=(f+d)*w,r[15]=1,r},n.c6=ae,n.c7=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},n.c8=hu,n.c9=io,n.cA=sg,n.cB=Zt,n.cC=Yw,n.cD=function(r){const e=Yw(r,!0);return N([],[e[0],e[1],e[4],e[5]])},n.cE=be,n.cF=Wl,n.cG=ke,n.cH=function(r){const{x:e,y:i}=r.point,{lng:o,lat:l}=r._center;return wb(e,i,r.worldSize,o,l)},n.cI=Ui,n.cJ=K,n.cK=Nn,n.cL=v,n.cM=function(r,e,i){let o=0;for(let l=0;l<2;++l)r[l]>0&&(o+=(r[l]-0)*(r[l]-0)),e[l]<0&&(o+=(0-e[l])*(0-e[l]));return o},n.cN=45,n.cO=ih,n.cP=fe,n.cQ=Wh,n.cR=function(r,e,i){const o=Math.sqrt(r*r+e*e+i*i),l=o>0?Math.acos(i/o)*We:0;let d=r!==0||e!==0?Math.atan2(-e,-r)*We+90:0;return d<0&&(d+=360),[o,d,l]},n.cS=vi,n.cT=Me,n.cU=Ni,n.cV=zr,n.cW=xr,n.cX=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.cY=si,n.cZ=e0,n.c_=function(r,e){return r.readFields(KP,{icons:[]},e)},n.ca=uu,n.cb=an,n.cc=qh,n.cd=$,n.ce=Lw,n.cf=function(){var r=new W(4);return W!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.cg=function(r,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=o*x+d*g,r[1]=l*x+f*g,r[2]=o*-g+d*x,r[3]=l*-g+f*x,r},n.ch=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.ci=Sr,n.cj=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},n.ck=_r,n.cl=yr,n.cm=zn,n.cn=pu,n.co=Jw,n.cp=Ar,n.cq=vb,n.cr=function(r,e,i,o,l,d,f,g,x){if(x.name==="globe")return vb(r,e,new Ar(i,o,l),!1);const w=_p({z:i,x:o,y:l},x);return new zr([(d+w.x/w.scale)*e,e*(w.y/w.scale),f],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},n.cs=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},n.ct=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},n.cu=function(r){const e=Math.round((r+45+360)%360/90)%4;return ce[e]},n.cv=Re,n.cw=Tt,n.cx=b,n.cy=function(r){const e=pe(new Float64Array(16));$e(e,r.pixelMatrix,r.globeMatrix);const i=[0,k,0],o=[0,D,0];return $t(i,i,e),$t(o,o,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!lv(r,new $(r.center.lat,90)),o[0]>0&&o[0]<=r.width&&o[1]>0&&o[1]<=r.height&&!lv(r,new $(r.center.lat,-90))]},n.cz=function(r,e){const{scale:i}=r.tileTransform,o=i*vt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(l,d,f){var g=d[1],x=d[2],w=d[3],A=f[0],I=f[1];return l[0]=d[0]*A,l[1]=g*A,l[2]=x*I,l[3]=w*I,l}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},n.d=function(r){return Vn.API_TILEJSON_REGEX.test(r)},n.d$=Xf,n.d0=ug,n.d1=Qh,n.d2=Bv,n.d3=Wi,n.d4=Ha,n.d5=vs,n.d6=xs,n.d7=Ri,n.d8=function(r){const e=r.indexOf(ru);return e>=0?r.slice(0,e):r},n.d9=function(r){return r.indexOf(ru)>=0},n.dA=bb,n.dB=Zn,n.dC=Wn,n.dD=256,n.dE=function(r,e){const i=[0,0,0];return $t(i,i,P_(_a(e.canonical))),$t(i,i,r),i},n.dF=r=>({u_camera_to_center_distance:new an(r),u_extrude_scale:new Gs(r),u_device_pixel_ratio:new an(r),u_matrix:new hu(r),u_inv_rot_matrix:new hu(r),u_merc_center:new io(r),u_tile_id:new uu(r),u_zoom_transition:new an(r),u_up_dir:new uu(r),u_emissive_strength:new an(r)}),n.dG=r=>({u_matrix:new hu(r),u_pixels_to_tile_units:new Gs(r),u_device_pixel_ratio:new an(r),u_width_scale:new an(r),u_floor_width_scale:new an(r),u_units_to_pixels:new io(r),u_dash_image:new qh(r),u_gradient_image:new qh(r),u_image_height:new an(r),u_texsize:new io(r),u_tile_units_to_pixels:new an(r),u_alpha_discard_threshold:new an(r),u_trim_offset:new io(r),u_trim_fade_range:new io(r),u_trim_color:new Wh(r),u_emissive_strength:new an(r),u_zbias_factor:new an(r),u_tile_to_meter:new an(r),u_ground_shadow_factor:new uu(r)}),n.dH=r=>({u_matrix:new hu(r),u_texsize:new io(r),u_pixels_to_tile_units:new Gs(r),u_device_pixel_ratio:new an(r),u_width_scale:new an(r),u_floor_width_scale:new an(r),u_image:new qh(r),u_units_to_pixels:new io(r),u_tile_units_to_pixels:new an(r),u_alpha_discard_threshold:new an(r),u_trim_offset:new io(r),u_trim_fade_range:new io(r),u_trim_color:new Wh(r),u_emissive_strength:new an(r),u_zbias_factor:new an(r),u_tile_to_meter:new an(r),u_ground_shadow_factor:new uu(r),u_pattern_transition:new an(r)}),n.dI=su,n.dJ=eP,n.dK=Eb,n.dL=(r,e,i,o,l,d)=>{const f=r.transform,g=f.projection.name==="globe";let x;if(d.paint.get("circle-pitch-alignment")==="map")if(g){const A=bb(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([A,0,0,A])}else x=f.calculatePixelsToTileUnitsMatrix(i);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(f.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ks.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:XI,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(g){w.u_inv_rot_matrix=o,w.u_merc_center=l,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Xl(f.zoom);const A=l[0]*vt,I=l[1]*vt;w.u_up_dir=f.projection.upVector(new Ar(0,0,0),A,I)}return w},n.dM=H1,n.dN=ps,n.dO=(r,e,i,o,l,d,f,g,x,w)=>{const A=r.transform,I=A.pitch<15?j1(.07,.7,Ae((14-A.zoom)/5,0,1)):.07,P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:G1(r,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:$1(e,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:Me(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:w}},n.dP=(r,e,i,o,l,d,f,g,x,w)=>{const A=r.transform,I=A.calculatePixelsToTileUnitsMatrix(e),P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=A.pitch<15?j1(.07,.7,Ae((14-A.zoom)/5,0,1)):.07;return{u_matrix:G1(r,e,i,o),u_pixels_to_tile_units:I,u_device_pixel_ratio:d,u_width_scale:f,u_floor_width_scale:g,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:q1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$1(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:Me(e.tileID.canonical,0),u_ground_shadow_factor:w}},n.dQ=Bt,n.dR=ep,n.dS=Oe,n.dT=C1,n.dU=so,n.dV=B_,n.dW=Jl,n.dX=450,n.dY=7,n.dZ=LP,n.d_=Ki,n.da=function(r){const e=r.lastIndexOf(ru);return e>=0?r.slice(e+1):""},n.db=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.dc=function(r,e,i,o){return r.type==="custom"?new zP(r,e):new qP[r.type](r,e,i,o)},n.dd=Ii,n.de=function(r){const e=r.indexOf(ru);return e>=0?r.slice(e+1):""},n.df=class extends cd{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.dg=kh,n.dh=_l,n.di=E_,n.dj=class extends yo{constructor(r){super(r),this.current=A_}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.dk=ve,n.dl=function(r,e,i){const o=Xl(i.zoom),l=r.style.map._antialias,d=r.terrain&&r.terrain.exaggeration()>0;return o===0&&!l&&!d},n.dm=function(r){const e=r.pixelsPerMeter,i=e/ae(1,r.center.lat),o=pe(new Float64Array(16));return ze(o,o,[r.point.x,r.point.y,0]),be(o,o,[i,i,e]),Float32Array.from(o)},n.dn=I_,n.dp=function(r){const e=Re-5;r=Ae(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(G(r))),3);return Math.round(i*(R.length-1))},n.dq=function(r,e,i,o){const l=e.getNorth(),d=e.getSouth(),f=e.getWest(),g=e.getEast(),x=1<<r.z,w=g-f,A=l-d,I=w/C,P=-A/R[i],L=[0,I,0,P,0,0,l,f,0];if(r.z>0){const z=180/o;de(L,L,[z/w+1,0,0,0,z/A+1,0,-.5*z/I,.5*z/P,1])}return L[2]=x,L[5]=r.x,L[8]=r.y,L},n.dr=_a,n.ds=function(r,e,i){const o=pe(new Float64Array(16)),l=(e/(1<<r)-.5)*Math.PI*2;return Ke(o,i.globeMatrix,l),Float32Array.from(o)},n.dt=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,l=Math.floor(r.x),d=Math.floor((r.x-l)*o),f=Math.floor(r.y*o),g=this.findDEMTileFor(new on(i,l,i,d,f));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||r.y<0||r.y>1)return e;const l=o.getSource().maxzoom,d=1<<l,f=Math.floor(r.x),g=r.x-f,x=new on(l,f,l,Math.floor(g*d),Math.floor(r.y*d)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;const A=w.dem,I=1<<w.tileID.canonical.z,P=(g*I-w.tileID.canonical.x)*A.dim,L=(r.y*I-w.tileID.canonical.y)*A.dim,z=Math.floor(P),B=Math.floor(L);return(i?this.exaggeration():1)*Kt(Kt(A.get(z,B),A.get(z,B+1),L-B),Kt(A.get(z+1,B),A.get(z+1,B+1),L-B),P-z)}getAtTileOffset(r,e,i){const o=1<<r.canonical.z;return this.getAtPointOrZero(new Fe(r.wrap+(r.canonical.x+e/vt)/o,(r.canonical.y+i/vt)/o))}getAtTileOffsetFunc(r,e,i,o){return l=>{const d=this.getAtTileOffset(r,l.x,l.y),f=o.upVector(r.canonical,l.x,l.y);return Yi(f,f,d*o.upVectorScale(r.canonical,e,i).metersToTile),f}}getForTilePoints(r,e,i,o){if(this.isUsingMockSource())return!1;const l=rd.create(this,r,o);return!!l&&(e.forEach(d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,l=1<<r.canonical.z-o.canonical.z;let d=r.canonical.x/l-o.canonical.x,f=r.canonical.y/l-o.canonical.y,g=0;for(let x=0;x<r.canonical.z-o.canonical.z&&!i.leaves[g];x++){d*=2,f*=2;const w=2*Math.floor(f)+Math.floor(d);g=i.childOffsets[g]+w,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const l of r){const d=this.getMinMaxForTile(l.tileID);d&&(i=Math.min(i,d.min),o=Math.max(o,d.max),e=!0)}return e?{min:i,max:o}:null}},n.du=zb,n.dv=Zl,n.dw=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dx=Y,n.dy=function(r,e){var i=Math.sin(e),o=Math.cos(e);return r[0]=o,r[1]=i,r[2]=0,r[3]=-i,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dz=Ei,n.e=Vn,n.e$=eS,n.e0=256,n.e1=ov,n.e2=_o,n.e3=Ke,n.e4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.e5=pa,n.e6=ou,n.e7=function(r,e,i,o,l){return Ae((r-e)/(i-e)*(l-o)+o,o,l)},n.e8=Bi,n.e9=function(r,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],w=e[7],A=e[8],I=A*f-g*w,P=-A*d+g*x,L=w*d-f*x,z=i*I+o*P+l*L;return z?(r[0]=I*(z=1/z),r[1]=(-A*o+l*w)*z,r[2]=(g*o-l*f)*z,r[3]=P*z,r[4]=(A*i-l*x)*z,r[5]=(-g*i+l*d)*z,r[6]=L*z,r[7]=(-w*i+o*x)*z,r[8]=(f*i-o*d)*z,r):null},n.eA=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.eB=Le,n.eC=j,n.eD=Rs,n.eE=function(r,e,i,o){return r[0]=e,r[1]=i,r[2]=o,r},n.eF=function([r,e,i]){const o=Math.hypot(r,e,i),l=Math.atan2(r,i),d=.5*Math.PI-Math.acos(-e/o);return new $(K(l),K(d))},n.eG=jt,n.eH=Jv,n.eI=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(fn==null){const o=i.navigator?i.navigator.userAgent:null;fn=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fn}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.eJ=function(r,e){Ro=r,Js=e},n.eK=lv,n.eL=Tb,n.eM=function(r){const e=[0,0,0],i=pe(new Float64Array(16));return $e(i,r.pixelMatrix,r.globeMatrix),$t(e,e,i),new gt(e[0],e[1])},n.eN=function(r,e,i=!1){if(ws===Rf||ws===Df||ws===kf)throw new Error("setRTLTextPlugin cannot be called multiple times.");ua=Ks.resolveURL(r),ws=Rf,Lf=e,Dh(),i||n_()},n.eO=Fl,n.eP=function(){ug().acquire(s0)},n.eQ=function(){const r=Sp;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(s0),Sp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.eR=Su,n.eS=function(r){const e=qd();if(!e)return;const i=e.delete(Ys);r&&i.then(()=>r()).catch(r)},n.eT=Tp,n.eU=GT,n.eV=function(r){m0=Ks.resolveURL(r),ld||(ld=new nd(ug(),new Ra)),ld.broadcast("setDracoUrl",m0)},n.eW=HT,n.eX=function(r){ad=Ks.resolveURL(r),ld||(ld=new nd(ug(),new Ra)),ld.broadcast("setMeshoptUrl",ad)},n.eY=It,n.eZ=Kl,n.e_=Vo,n.ea=Zm,n.eb=ys,n.ec=Xe,n.ed=class{constructor(r,e,i,o){this.context=r,this.format=o,this.size=i,this.texture=r.gl.createTexture();const[l,d,f]=this.size,{gl:g}=r;g.bindTexture(g.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,l,d,f,0,Zv(this.format),Xv(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),r!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,r),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.ee=function(r,e){if(r===e){var i=e[1],o=e[2],l=e[3],d=e[6],f=e[7],g=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=o,r[9]=d,r[11]=e[14],r[12]=l,r[13]=f,r[14]=g}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.ef=Qv,n.eg=ni,n.eh=[1,1,1],n.ei=function(r,e,i,o){var l=new W(4);return l[0]=r,l[1]=e,l[2]=i,l[3]=o,l},n.ej=Pt,n.ek=function(r,e,i,o){var l=e[0],d=e[1],f=e[2],g=e[3];return r[0]=l+o*(i[0]-l),r[1]=d+o*(i[1]-d),r[2]=f+o*(i[2]-f),r[3]=g+o*(i[3]-g),r},n.el=rd,n.em=id,n.en=fa,n.eo=Ya,n.ep=function(r,e,i,o,l,d,f,g,x,w,A,I,P,L,z,B){var H=new W(16);return H[0]=r,H[1]=e,H[2]=i,H[3]=o,H[4]=l,H[5]=d,H[6]=f,H[7]=g,H[8]=x,H[9]=w,H[10]=A,H[11]=I,H[12]=P,H[13]=L,H[14]=z,H[15]=B,H},n.eq=V,n.er=jh,n.es=Wf,n.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new gt(1/0,1/0),max:new gt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=h1(new gt(0,0),new gt(vt,vt),r),o=[];if(e&&!Tv(i,this._globalClipBounds))return o;for(const l of this._activeRegions){if(l.hiddenByOverlap||!Tv(i,l))continue;const d=AC(l.min,l.max,r);o.push({min:d.min,max:d.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask,clipScope:l.clipScope})}return o}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(o).buckets[e.layer];l&&l.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),o=r.getClipMask(),l=r.getClipScope();for(const d of e){if(!d.footprint)continue;const f=h1(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:o,clipScope:l})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||O_(e.min,i.min)||O_(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,l){const d=(f,g)=>f+g;return o.length-l.length||o.reduce(d,"").localeCompare(l.reduce(d,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];r=i.priority!==o.priority||!u1(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!Po(i.clipScope,o.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==z_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const l=o[i].priority;for(;i<o.length&&o[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let l=i;const d=i;for(;l!==o;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let g=0;g<d;g++){const x=this._activeRegions[g];if(!x.hiddenByOverlap&&f.order===z_&&Tv(f,x)&&(f.hiddenByOverlap=f1(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++l}i=o,o=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eu=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Fo,o=new Mn,l=[],d=r+1+2,f=e[0]+1,g=e[0]+1+(1+e.length),x=(w,A,I)=>{let P=w===d-1?w-2:w===0?w:w-1;return P+=I?24575:0,[P,A]};for(let w=0;w<d;++w)i.emplaceBack(...x(w,0,!0));for(let w=0;w<f;++w)for(let A=0;A<d;++A)i.emplaceBack(...x(A,w,(A===0||A===d-1)&&!0));for(let w=0;w<e.length;++w){const A=e[w];for(let I=0;I<d;++I)i.emplaceBack(...x(I,A,!0))}for(let w=0;w<e.length;++w){const A=o.length,I=e[w]+1+2,P=new Mn;for(let B=0;B<I-1;B++){const H=B===I-2,Z=H?d*(g-e.length+w-B):d;for(let te=0;te<d-1;te++){const J=B*d+te;B===0||H||te===0||te===d-2?(P.emplaceBack(J+1,J,J+Z),P.emplaceBack(J+Z,J+Z+1,J+1)):(o.emplaceBack(J+1,J,J+Z),o.emplaceBack(J+Z,J+Z+1,J+1))}}const L=$r.simpleSegment(0,A,i.length,o.length-A);for(let B=0;B<P.uint16.length;B+=3)o.emplaceBack(P.uint16[B],P.uint16[B+1],P.uint16[B+2]);const z=$r.simpleSegment(0,A,i.length,o.length-A);l.push({withoutSkirts:L,withSkirts:z})}return{vertices:i,indices:o,segments:l}}_createGrid(r){const e=this._fillGridMeshWithLods(C,R);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,vo.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Mn;for(let f=0;f<=C;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new pa,o=new pa,l=new pa,d=new pa;this._poleSegments=[];for(let f=0,g=0;f<v;f++){const x=360/(1<<f);i.emplaceBack(0,-_,0,.5,0),o.emplaceBack(0,-_,0,.5,1),l.emplaceBack(0,-_,0,.5,.5),d.emplaceBack(0,-_,0,.5,.5);for(let w=0;w<=C;w++){let A=w/C,I=0;const P=Kt(0,x,A),[L,z,B]=O(WI,ZI,P,_);i.emplaceBack(L,z,B,A,I),o.emplaceBack(L,z,B,A,1-I);const H=G(P);A=.5+.5*Math.sin(H),I=.5+.5*Math.cos(H),l.emplaceBack(L,z,B,A,I),d.emplaceBack(L,z,B,A,1-I)}this._poleSegments.push($r.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Ts,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(o,Ts,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(l,Ts,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(d,Ts,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.ev=z_,n.ew=ye,n.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.ey=Ee,n.ez=ft,n.f=function(r){return r.indexOf("mapbox:")===0},n.f0=tS,n.f1=B1,n.f2=_u,n.f3="hd_road_elevation",n.f4=yv,n.f5=xi,n.f6=yu,n.f7=Fv,n.f8=xu,n.f9=function(r,e,i,o,l,d,f,g=1,x,w){r.createArrays(),r.tilePixelRatio=vt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const A=r.layers[0].layout,I=r.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=g,P.textSizeScaleRange=A.get("text-size-scale-range"),P.iconSizeScaleRange=A.get("icon-size-scale-range");const[L,z]=P.textSizeScaleRange,[B,H]=P.iconSizeScaleRange;P.textScaleFactor=Ae(P.scaleFactor,L,z),P.iconScaleFactor=Ae(P.scaleFactor,B,H);const Z=I["text-size"],te=I["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:me,maxZoom:xe}=r.textSizeData;P.compositeTextSizes=[Z.possiblyEvaluate(new cr(me),d),Z.possiblyEvaluate(new cr(xe),d)]}if(r.iconSizeData.kind==="composite"){const{minZoom:me,maxZoom:xe}=r.iconSizeData;P.compositeIconSizes=[te.possiblyEvaluate(new cr(me),d),te.possiblyEvaluate(new cr(xe),d)]}P.layoutTextSize=Z.possiblyEvaluate(new cr(f+1),d),P.layoutIconSize=te.possiblyEvaluate(new cr(f+1),d),P.textMaxSize=Z.possiblyEvaluate(new cr(18),d);const J=A.get("symbol-placement"),U=A.get("text-rotation-alignment")==="map"&&J!=="point",X=A.get("text-size");let ee=!1;const ne=[];for(const me of r.features){const xe=A.get("text-font").evaluate(me,{},d).join(","),Se=X.evaluate(me,{},d)*P.textScaleFactor,Pe=P.layoutTextSize.evaluate(me,{},d)*P.textScaleFactor,He=P.layoutIconSize.evaluate(me,{},d)*P.iconScaleFactor,nt={horizontal:{},vertical:void 0},et=me.text;let rt,lt=[0,0];if(et){const Ot=et.toString(),oi=A.get("text-letter-spacing").evaluate(me,{},d)*On,yi=A.get("text-line-height").evaluate(me,{},d)*On,bi=Hy(Ot)?oi:0,Mi=A.get("text-anchor").evaluate(me,{},d),Ai=A.get("text-variable-anchor");if(!Ai){const se=A.get("text-radial-offset").evaluate(me,{},d);if(se)lt=ww(Mi,[se*On,Nv]);else{const Ze=A.get("text-offset").evaluate(me,{},d);lt=[Ze[0]*On,Ze[1]*On]}}let Ti=U?"center":A.get("text-justify").evaluate(me,{},d);const pr=J==="point",Ir=pr?A.get("text-max-width").evaluate(me,{},d)*On:1/0,ie=se=>{r.allowVerticalPlacement&&Mf(Ot)&&(nt.vertical=Lv(et,e,i,l,xe,Ir,yi,Mi,se,bi,lt,Ls.vertical,!0,Pe,Se,x))};if(!U&&Ai){const se=Ti==="auto"?Ai.map(mt=>Uv(mt)):[Ti];let Ze=!1;for(let mt=0;mt<se.length;mt++){const wt=se[mt];if(!nt.horizontal[wt])if(Ze)nt.horizontal[wt]=nt.horizontal[0];else{const bt=Lv(et,e,i,l,xe,Ir,yi,"center",wt,bi,lt,Ls.horizontal,!1,Pe,Se,x);bt&&(nt.horizontal[wt]=bt,Ze=bt.positionedLines.length===1)}}ie("left")}else{if(Ti==="auto"&&(Ti=Uv(Mi)),pr||A.get("text-writing-mode").indexOf("horizontal")>=0||!Mf(Ot)){const se=Lv(et,e,i,l,xe,Ir,yi,Mi,Ti,bi,lt,Ls.horizontal,!1,Pe,Se,x);se&&(nt.horizontal[Ti]=se)}ie(pr?"left":Ti)}}let je,it,Ne,Ge,ut,dt,Nt,Mt=!1;if(me.icon&&me.icon.hasPrimary()){const Ot=Sw(me.icon,r.iconSizeData,I["icon-size"],d,r.zoom,me,x,P.iconScaleFactor);je=Ot.iconPrimary,Ne=Ot.iconSecondary;const oi=je.toString();if(it=o.get(oi),it&&(ut=A.get("icon-offset").evaluate(me,{},d),dt=A.get("icon-anchor").evaluate(me,{},d),Nt=A.get("icon-text-fit").evaluate(me,{},d),rt=hP(l.get(oi),Ne?l.get(Ne.toString()):void 0,ut,dt),Mt=it.sdf,r.sdfIcons===void 0?r.sdfIcons=it.sdf:r.sdfIcons!==it.sdf&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==r.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ne){const yi=Ne.toString();Ge=o.get(yi)}}ee=ee||!(!me.icon||!me.icon.hasSecondary());const xt=Vv(nt.horizontal)||nt.vertical;r.iconsInText||(r.iconsInText=!!xt&&xt.iconsInText);const ct=Pe*P.textScaleFactor/On,{defaultShapedIcon:ci,verticallyShapedIcon:zt}=xP(r,rt,A,me,d,nt,ct,ut,Nt);Nt!=="none"&&rt&&(ow(rt)||aw(rt))&&(q_(0,it,je,rt,ci,Nt,w,o,l),q_(0,Ge,Ne,rt,ci,Nt,w,o,l),zt&&(q_(0,it,je,rt,zt,Nt,w,o,l),q_(0,Ge,Ne,rt,zt,Nt,w,o,l))),rt=ci,ne.push({feature:me,shapedTextOrientations:nt,shapedText:xt,shapedIcon:rt,iconPrimary:je,iconSecondary:Ne,iconOffset:ut,iconAnchor:dt,verticallyShapedIcon:zt,layoutTextSize:Pe,layoutIconSize:He,textOffset:lt,isSDFIcon:Mt,iconTextFit:Nt})}return{featureData:ne,sizes:P,hasAnySecondaryIcon:ee,textAlongLine:U,symbolPlacement:J}},n.fa=_w,n.fb=function(r,e,i,o,l,d,f,g,x,w){const{featureData:A,hasAnySecondaryIcon:I,sizes:P,textAlongLine:L,symbolPlacement:z}=e;for(const B of A){const{shapedIcon:H,verticallyShapedIcon:Z,feature:te,shapedTextOrientations:J,shapedText:U,layoutTextSize:X,textOffset:ee,isSDFIcon:ne,iconPrimary:me,iconSecondary:xe,iconTextFit:Se,iconOffset:Pe}=B;Ew(H,w.iconPositions,me,xe),Ew(Z,w.iconPositions,me,xe),vP(J,w.iconPositions),(U||H)&&bP(r,te,J,H,Z,x,P,X,0,ee,ne,o,l,f,g,I,Se,Pe,L,z)}i&&r.generateCollisionDebugBuffers(d,r.collisionBoxArray,P.textScaleFactor)},n.fc=Yl,n.fd=gg,n.fe=Ic,n.ff=Zb,n.fg=J1,n.fh=fo,n.fi=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==WT){const i=new Uint32Array(r,0,7),[,,o,l,d,f]=i;e=i.byteLength+l+d+f+d,(o!==r.byteLength||e>=r.byteLength)&&ki("Invalid b3dm header information.")}return YT(r,e)},n.fj=function(r,e){const i=QT(r);for(const o of i){for(const l of o.meshes)KM(l);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(YM(o.lights,e)))}return i},n.fk=cg,n.fl=Er,n.fm=fT,n.fn=$s,n.fo=function(r){ko(),Ns!=null&&Ns.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-r;o++)e.delete(i[o]).catch(l=>ki(l.message))}).catch(i=>ki(i.message))}).catch(e=>ki(e.message))},n.g=function(r,e){return _l(Be(r,{method:"GET"}),e)},n.h=po,n.i=function(r){return Vn.API_STYLE_REGEX.test(r)&&!Ia(r)},n.j=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},n.l=Be,n.m=Wd,n.n=function(r,e){return _l(Be(r,{type:"json"}),e)},n.o=yl,n.p=function(r,e){return _l(Be(r,{method:"POST"}),e)},n.q=Ks,n.r=jn,n.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Gd,n.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=ki,n.x=function(){return o0||(o0=new Su),o0},n.y=h0,n.z=Kd}),S(["./shared"],function(n){function F(We){const G=We?We.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function W(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let K="[";for(const ce of We)K+=`${W(ce)},`;return`${K}]`}let G="{";for(const K of Object.keys(We).sort())G+=`${K}:${W(We[K])},`;return`${G}}`}function N(We){let G="";for(const K of n.bu)(We.type!=="model"||K!=="minzoom"&&K!=="maxzoom")&&(G+=`/${W(We[K])}`);return G}class Y{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ce){this._options=ce;for(const ye of G)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=n.dc(ye,this.scope,null,this._options)).compileFilter(ce),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of K)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ve=function(ye,Ee){const Ae={};for(let Ue=0;Ue<ye.length;Ue++){const Ye=ye[Ue];let Be=Ee&&Ee[Ye.id];Be||(Ye.type==="symbol"?Be=Ye.id:(Be=N(Ye),Ye.type==="line"&&Ye.paint&&function Et(Bt){return typeof Bt=="string"&&Bt==="line-progress"||(Array.isArray(Bt)?Bt.some(Et):!(!Bt||typeof Bt!="object")&&Object.values(Bt).some(Et))}(Ye.paint["line-width"])&&(Be+=`/${W(Ye.paint["line-width"])}`))),Ee&&(Ee[Ye.id]=Be);let yt=Ae[Be];yt||(yt=Ae[Be]=[]),yt.push(Ye)}const Ie=[];for(const Ue in Ae)Ie.push(Ae[Ue]);return Ie}(Object.values(this._layerConfigs),this.keyCache);for(const ye of ve){const Ee=ye.map(yt=>this._layers[yt.id]),Ae=Ee[0];if(Ae.visibility==="none")continue;const Ie=Ae.source||"";let Ue=this.familiesBySource[Ie];Ue||(Ue=this.familiesBySource[Ie]={});const Ye=Ae.sourceLayer||"_geojsonTileLayer";let Be=Ue[Ye];Be||(Be=Ue[Ye]=[]),Be.push(Ee)}}}const le=1*n.e_;class de{constructor(G){const K={},ce=[];for(const Ae in G){const Ie=G[Ae],Ue=K[Ae]={};for(const Ye in Ie.glyphs){const Be=Ie.glyphs[+Ye];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const yt=Be.metrics.localGlyph?le:1,Et={x:0,y:0,w:Be.bitmap.width+2*yt,h:Be.bitmap.height+2*yt};ce.push(Et),Ue[Ye]=Et}}const{w:ve,h:ye}=n.H(ce),Ee=new n.eZ({width:ve||1,height:ye||1});for(const Ae in G){const Ie=G[Ae];for(const Ue in Ie.glyphs){const Ye=Ie.glyphs[+Ue];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Be=K[Ae][Ue],yt=Ye.metrics.localGlyph?le:1;n.eZ.copy(Ye.bitmap,Ee,{x:0,y:0},{x:Be.x+yt,y:Be.y+yt},Ye.bitmap)}}this.image=Ee,this.positions=K}}n.eY(de,"GlyphAtlas");class Te{constructor(G){this.tileID=new n.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=n.aW(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor}parse(G,K,ce,ve,ye,Ee){this.status="parsing",this.data=G,this.collisionBoxArray=new n.b0;const Ae=new n.e$(Object.keys(G.layers).sort()),Ie=new n.f0(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Ue={},Ye=new n.f1(256,256),Be={featureIndex:Ie,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ye,availableImages:ce,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},yt=K.familiesBySource[this.source];for(const Xi in yt){const xr=G.layers[Xi];if(!xr)continue;let Er=!1,rn=!1,fn=!1;for(const Wn of yt[Xi])Wn[0].type==="symbol"?Er=!0:rn=!0,Wn[0].is3D()&&Wn[0].type!=="model"&&(fn=!0);if(this.extraShadowCaster&&!fn||this.isSymbolTile===!0&&!Er||this.isSymbolTile===!1&&!rn)continue;xr.version===1&&n.w(`Vector tile source "${this.source}" layer "${Xi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pn=Ae.encode(Xi),Bn=[];let Mo=!1;for(let Wn=0,Zn=0;Wn<xr.length;Wn++){const Ln=xr.feature(Wn),Vn=Ie.getId(Ln,Xi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Xi)){const po=Ln.properties?Ln.properties.worldview:null;if(this.worldview&&typeof po=="string")if(po==="all")Ln.properties.$localized=!0;else{if(!po.split(",").includes(this.worldview))continue;Ln.properties.$localized=!0,Ln.properties.worldview=this.worldview}}!Mo&&Ln.properties&&Ln.properties.hasOwnProperty(n.f2)&&(Mo=!0),Bn.push({feature:Ln,id:Vn,index:Zn,sourceLayerIndex:Pn}),Zn++}Mo&&!Be.elevationFeatures&&G.layers.hasOwnProperty(n.f3)&&(Be.elevationFeatures=n.f4.parseFrom(G.layers[n.f3],this.canonical));for(const Wn of yt[Xi]){const Zn=Wn[0];(!this.extraShadowCaster||Zn.is3D()&&Zn.type!=="model")&&(this.isSymbolTile!==void 0&&Zn.type==="symbol"!==this.isSymbolTile||Zn.minzoom&&this.zoom<Math.floor(Zn.minzoom)||Zn.maxzoom&&this.zoom>=Zn.maxzoom||Zn.visibility!=="none"&&(pe(Wn,this.zoom,Be.brightness,ce),(Ue[Zn.id]=Zn.createBucket({index:Ie.bucketLayerIDs.length,layers:Wn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ve})).populate(Bn,Be,this.tileID.canonical,this.tileTransform),Ie.bucketLayerIDs.push(Wn.map(Ln=>n.C(Ln.id,Ln.scope)))))}}let Et,Bt,pi,xi,Ii,Ri;Ye.trim();const Wr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ki=()=>{if(Et)return this.status="done",Ee(Et);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:Object.values(Ue).filter(Xi=>!Xi.isEmpty()),featureIndex:Ie,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Be.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Bt&&pi&&xi){const Xi=new de(Bt),xr=new Map;for(const[fn,Pn]of pi.entries()){const{imagePosition:Bn}=n.f7(fn,Pn,n.f8);xr.set(fn,Bn)}const Er={};for(const fn in Ue){const Pn=Ue[fn];Pn instanceof n.b1&&(pe(Pn.layers,this.zoom,Be.brightness,ce),Er[fn]=n.f9(Pn,Bt,Xi.positions,pi,xr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ii))}const rn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ye,pi,Ii,()=>{rn.iconsPending=!1,vr(Er,Xi,rn)}),this.rasterizeIfNeeded(ye,xi,Ri,()=>{rn.patternsPending=!1,vr(Er,Xi,rn)})}},vr=(Xi,xr,Er,rn)=>{if(Er.iconsPending||Er.patternsPending)return;const fn=new n.fa(pi,xi,this.lut);for(const Pn in Ue){const Bn=Ue[Pn];if(Pn in Xi)n.fb(Bn,Xi[Pn],this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,pi,fn);else if(Bn.hasPattern&&(Bn instanceof n.b7||Bn instanceof n.b8||Bn instanceof n.dV)){pe(Bn.layers,this.zoom,Be.brightness,ce);const Mo=Object.fromEntries(fn.patternPositions);Bn.addFeatures(Be,this.tileID.canonical,Mo,ce,this.tileTransform,this.brightness)}}this.status="done",Ee(null,{buckets:Object.values(Ue).filter(Pn=>!Pn.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,lineAtlas:Ye,imageAtlas:fn,brightness:Be.brightness})};if(!this.extraShadowCaster){const Xi=n.f5(Be.glyphDependencies,rn=>Object.keys(rn).map(Number));Object.keys(Xi).length?ye.send("getGlyphs",{uid:this.uid,stacks:Xi,scope:this.scope},(rn,fn)=>{Et||(Et=rn,Bt=fn,ki())},void 0,!1,Wr):Bt={};const xr=Array.from(Be.iconDependencies.keys()).map(rn=>n.I.parse(rn));xr.length?ye.send("getImages",{images:xr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(rn,fn)=>{Et||(Et=rn,pi=new Map,Ii=this.updateImageMapAndGetImageTaskQueue(pi,fn,Be.iconDependencies),ki())},void 0,!1,Wr):(pi=new Map,Ii=new Map);const Er=Array.from(Be.patternDependencies.keys()).map(rn=>n.I.parse(rn));Er.length?ye.send("getImages",{images:Er,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(rn,fn)=>{Et||(Et=rn,xi=new Map,Ri=this.updateImageMapAndGetImageTaskQueue(xi,fn,Be.patternDependencies),ki())},void 0,!1,Wr):(xi=new Map,Ri=new Map)}if(Be.elevationFeatures&&Be.elevationFeatures.length>0){const Xi=[];for(const Er of Object.values(Ue))if(Er instanceof n.b8){const rn=Er.getUnevaluatedPortalGraph();rn&&Xi.push(rn)}const xr=n.f6.evaluate(Xi);for(const Er of Object.values(Ue))Er instanceof n.b8&&Er.setEvaluatedPortalGraph(xr)}ki()}rasterizeIfNeeded(G,K,ce,ve){Array.from(K.values()).some(ye=>ye.usvg)?this.rasterize(G,K,ce,ve):ve()}updateImageMapAndGetImageTaskQueue(G,K,ce){const ve=new Map;for(const ye of K.keys()){const Ee=ce.get(ye)||[];for(const Ae of Ee){const Ie=Ae.toString(),Ue=K.get(Ae.id.toString());Ue.usvg?ve.has(Ie)||(ve.set(Ie,Ae),G.set(Ie,Object.assign({},Ue))):G.set(Ie,Ue)}}return ve}rasterize(G,K,ce,ve){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:ce},(ye,Ee)=>{if(!ye)for(const[Ae,Ie]of Ee.entries()){const Ue=Object.assign(K.get(Ae),{data:Ie});K.set(Ae,Ue)}ve()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function pe(We,G,K,ce){const ve=new n.aa(G,{brightness:K});for(const ye of We)ye.recalculate(ve,ce)}class qe extends n.E{constructor(G,K,ce,ve,ye,Ee,Ae){super(),this.actor=G,this.layerIndex=K,this.availableImages=ce,this.availableModels=ve,this.loadVectorData=Ee||n.aJ,this.loading={},this.loaded={},this.deduped=new n.aI(G.scheduler),this.isSpriteLoaded=ye,this.scheduler=G.scheduler,this.brightness=Ae}loadTile(G,K){const ce=G.uid,ve=G&&G.request,ye=ve&&ve.collectResourceTiming,Ee=this.loading[ce]=new Te(G);Ee.abort=this.loadVectorData(G,(Ae,Ie)=>{const Ue=!this.loading[ce];if(delete this.loading[ce],Ee.cancelRasterize(),Ue||Ae||!Ie)return Ee.status="done",Ue||(this.loaded[ce]=Ee),K(Ae);const Ye=Ie.rawData,Be={};Ie.expires&&(Be.expires=Ie.expires),Ie.cacheControl&&(Be.cacheControl=Ie.cacheControl),Ee.vectorTile=Ie.vectorTile||new n.fc.VectorTile(new n.bq(Ye));const yt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Et,Bt)=>{if(Et||!Bt)return K(Et);const pi={};if(ye){const xi=F(ve);xi.length>0&&(pi.resourceTiming=JSON.parse(JSON.stringify(xi)))}K(null,n.l({rawTileData:Ye.slice(0)},Bt,Be,pi))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[ce]=Ee})}reloadTile(G,K){const ce=this.loaded,ve=G.uid;if(ce&&ce[ve]){const ye=ce[ve];ye.scaleFactor=G.scaleFactor,ye.showCollisionBoxes=G.showCollisionBoxes,ye.projection=G.projection,ye.brightness=G.brightness,ye.tileTransform=n.aW(G.tileID.canonical,G.projection),ye.extraShadowCaster=G.extraShadowCaster,ye.lut=G.lut;const Ee=(Ae,Ie)=>{const Ue=ye.reloadCallback;Ue&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ue)),K(Ae,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ee):Ee())}else K(null,void 0)}abortTile(G,K){const ce=G.uid,ve=this.loading[ce];ve&&(ve.abort&&ve.abort(),delete this.loading[ce]),K()}removeTile(G,K){const ce=this.loaded,ve=G.uid;ce&&ce[ve]&&delete ce[ve],K()}}class $e{loadTile(G,K){const{uid:ce,encoding:ve,rawImageData:ye,padding:Ee}=G,Ae=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Ee):ye;K(null,new n.fd(ce,Ae,ve,Ee<1))}reloadTile(G,K){K(null,null)}abortTile(G,K){K()}removeTile(G,K){K()}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const ce=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}n.bp.setPbf(n.bq);class ze{constructor(G){this._mrt=new n.bp(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,K){const ce=this._mrt;this.status="parsing",this._entireBuffer=G;try{ce.parseHeader(G),this._isHeaderLoaded=!0;const ve=[];for(const ye in ce.layers){const Ee=ce.getLayer(ye),Ae=Ee.getDataRange(Ee.getBandList()),Ie=ce.createDecodingTask(Ae),Ue=G.slice(Ae.firstByte,Ae.lastByte+1),Ye=n.bp.performDecoding(Ue,Ie).then(Be=>Ie.complete(null,Be)).catch(Be=>Ie.complete(Be,null));ve.push(Ye)}Promise.allSettled(ve).then(()=>K(null,ce)).catch(ye=>K(ye))}catch(ve){K(ve)}}}class be{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,K){const ce=G.uid,ve=G.request,ye=this.loading[ce]=new ze(G),{cancel:Ee}=n.br(ve,(Ae,Ie,Ue,Ye)=>{const Be=!this.loading[ce];if(delete this.loading[ce],Be||Ae||!Ie)return ye.status="done",Be||(this.loaded[ce]=ye),K(Ae);ye.parse(Ie,(yt,Et)=>{if(yt||!Et)return K(yt);K(null,Et,Ue,Ye)}),this.loaded[ce]=ye});ye.abort=Ee}reloadTile(G,K){K(null,void 0)}abortTile(G,K){const ce=G.uid,ve=this.loading[ce];ve&&(ve.abort&&ve.abort(),delete this.loading[ce]),K()}removeTile(G,K){const ce=G.uid;this.loaded[ce]&&delete this.loaded[ce],K()}decodeRasterArray(G,K){n.bp.performDecoding(G.buffer,G.task).then(ce=>K(null,ce)).catch(ce=>K(ce))}}const ke=n.fc.VectorTileFeature.prototype.toGeoJSON;class Ke{constructor(G){this._feature=G,this.extent=n.aj,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){const G=[];for(const K of this._feature.geometry)G.push([new n.P(K[0],K[1])]);return G}{const G=[];for(const K of this._feature.geometry){const ce=[];for(const ve of K)ce.push(new n.P(ve[0],ve[1]));G.push(ce)}return G}}toGeoJSON(G,K,ce){return ke.call(this,G,K,ce)}}class St{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.aj,this.length=G.length,this._features=G}feature(G){return new Ke(this._features[G])}}const kt=64/4096,hi=128;class Wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(const ce of G){const ve=ce.id;if(ve==null)continue;let ye=this.features.get(ve);ye&&this.updateCache(ye,K),ce.geometry?(ye=ni(ce),this.updateCache(ye,K),this.features.set(ve,ye)):this.features.delete(ve),this.updateCache(ye,K)}}updateCache(G,K){for(const{canonical:ce,uid:ve}of Object.values(K)){const{z:ye,x:Ee,y:Ae}=ce;Zt(G,Math.pow(2,ye),Ee,Ae)&&delete K[ve]}}getTile(G,K,ce){const ve=Math.pow(2,G),ye=[];for(const Ee of this.features.values())Zt(Ee,ve,K,ce)&&ye.push(Ni(Ee,ve,K,ce));return{features:ye}}getFeatures(){return[...this.features.values()]}}function Zt({minX:We,minY:G,maxX:K,maxY:ce},ve,ye,Ee){return We<(ye+1+kt)/ve&&G<(Ee+1+kt)/ve&&K>(ye-kt)/ve&&ce>(Ee-kt)/ve}function ni(We){const{id:G,geometry:K,properties:ce}=We;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ve,coordinates:ye}=K,Ee={id:G,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ae=Ee.geometry;if(ve==="Point")qt(ye,Ae,Ee);else if(ve==="MultiPoint")for(const Ie of ye)qt(Ie,Ae,Ee);else if(ve==="LineString")Ee.type=2,di(ye,Ae,Ee);else if(ve==="MultiLineString")Ee.type=2,vi(ye,Ae,Ee);else if(ve==="Polygon")Ee.type=3,vi(ye,Ae,Ee,!0);else{if(ve!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(const Ie of ye)vi(Ie,Ae,Ee,!0)}return Ee}function qt([We,G],K,ce){const ve=n.ay(We);let ye=n.aH(G);ye=ye<0?0:ye>1?1:ye,K.push(ve,ye),ce.minX=Math.min(ce.minX,ve),ce.minY=Math.min(ce.minY,ye),ce.maxX=Math.max(ce.maxX,ve),ce.maxY=Math.max(ce.maxY,ye)}function di(We,G,K,ce=!1,ve=!1){const ye=[];for(const Ee of We)qt(Ee,ye,K);G.push(ye),ce&&function(Ee,Ae){let Ie=0;for(let Ue=0,Ye=Ee.length,Be=Ye-2;Ue<Ye;Be=Ue,Ue+=2)Ie+=(Ee[Ue]-Ee[Be])*(Ee[Ue+1]+Ee[Be+1]);if(Ie>0===Ae)for(let Ue=0,Ye=Ee.length;Ue<Ye/2;Ue+=2){const Be=Ee[Ue],yt=Ee[Ue+1];Ee[Ue]=Ee[Ye-2-Ue],Ee[Ue+1]=Ee[Ye-1-Ue],Ee[Ye-2-Ue]=Be,Ee[Ye-1-Ue]=yt}}(ye,ve)}function vi(We,G,K,ce=!1){for(let ve=0;ve<We.length;ve++)di(We[ve],G,K,ce,ve===0)}function Ni(We,G,K,ce){const{id:ve,type:ye,geometry:Ee,tags:Ae}=We,Ie=[];if(ye===1)(function(Ue,Ye,Be,yt,Et){for(let Bt=0;Bt<Ue.length;Bt+=2){const pi=Math.round(n.aj*(Ue[Bt+0]*Ye-Be)),xi=Math.round(n.aj*(Ue[Bt+1]*Ye-yt));Et.push([pi,xi])}})(Ee,G,K,ce,Ie);else for(const Ue of Ee)si(Ue,G,K,ce,Ie);return{id:ve,type:ye,geometry:Ie,tags:Ae}}function si(We,G,K,ce,ve){const Ee=n.aj+hi;let Ae;for(let Ie=0;Ie<We.length-2;Ie+=2){let Ue=Math.round(n.aj*(We[Ie+0]*G-K)),Ye=Math.round(n.aj*(We[Ie+1]*G-ce)),Be=Math.round(n.aj*(We[Ie+2]*G-K)),yt=Math.round(n.aj*(We[Ie+3]*G-ce));const Et=Be-Ue,Bt=yt-Ye;Ue<-128&&Be<-128||(Ue<-128?(Ye+=Math.round(Bt*((-128-Ue)/Et)),Ue=-128):Be<-128&&(yt=Ye+Math.round(Bt*((-128-Ue)/Et)),Be=-128),Ye<-128&&yt<-128||(Ye<-128?(Ue+=Math.round(Et*((-128-Ye)/Bt)),Ye=-128):yt<-128&&(Be=Ue+Math.round(Et*((-128-Ye)/Bt)),yt=-128),Ue>=Ee&&Be>=Ee||(Ue>=Ee?(Ye+=Math.round(Bt*((Ee-Ue)/Et)),Ue=Ee):Be>=Ee&&(yt=Ye+Math.round(Bt*((Ee-Ue)/Et)),Be=Ee),Ye>=Ee&&yt>=Ee||(Ye>=Ee?(Ue+=Math.round(Et*((Ee-Ye)/Bt)),Ye=Ee):yt>=Ee&&(Be=Ue+Math.round(Et*((Ee-Ye)/Bt)),yt=Ee),Ae&&Ue===Ae[Ae.length-1][0]&&Ye===Ae[Ae.length-1][1]||(Ae=[[Ue,Ye]],ve.push(Ae)),Ae.push([Be,yt])))))}}var Ui,mi,Yr,Yi={exports:{}},vn=function(){if(Yr)return Yi.exports;Yr=1;var We=n.fg(),G=function(){if(mi)return Ui;mi=1;var Ye=n.fe(),Be=n.ff().VectorTileFeature;function yt(Bt,pi){this.options=pi||{},this.features=Bt,this.length=Bt.length}function Et(Bt,pi){this.id=typeof Bt.id=="number"?Bt.id:void 0,this.type=Bt.type,this.rawGeometry=Bt.type===1?[Bt.geometry]:Bt.geometry,this.properties=Bt.tags,this.extent=pi||4096}return Ui=yt,yt.prototype.feature=function(Bt){return new Et(this.features[Bt],this.options.extent)},Et.prototype.loadGeometry=function(){var Bt=this.rawGeometry;this.geometry=[];for(var pi=0;pi<Bt.length;pi++){for(var xi=Bt[pi],Ii=[],Ri=0;Ri<xi.length;Ri++)Ii.push(new Ye(xi[Ri][0],xi[Ri][1]));this.geometry.push(Ii)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Bt=this.geometry,pi=1/0,xi=-1/0,Ii=1/0,Ri=-1/0,Wr=0;Wr<Bt.length;Wr++)for(var ki=Bt[Wr],vr=0;vr<ki.length;vr++){var Xi=ki[vr];pi=Math.min(pi,Xi.x),xi=Math.max(xi,Xi.x),Ii=Math.min(Ii,Xi.y),Ri=Math.max(Ri,Xi.y)}return[pi,Ii,xi,Ri]},Et.prototype.toGeoJSON=Be.prototype.toGeoJSON,Ui}();function K(Ye){var Be=new We;return function(yt,Et){for(var Bt in yt.layers)Et.writeMessage(3,ce,yt.layers[Bt])}(Ye,Be),Be.finish()}function ce(Ye,Be){var yt;Be.writeVarintField(15,Ye.version||1),Be.writeStringField(1,Ye.name||""),Be.writeVarintField(5,Ye.extent||4096);var Et={keys:[],values:[],keycache:{},valuecache:{}};for(yt=0;yt<Ye.length;yt++)Et.feature=Ye.feature(yt),Be.writeMessage(2,ve,Et);var Bt=Et.keys;for(yt=0;yt<Bt.length;yt++)Be.writeStringField(3,Bt[yt]);var pi=Et.values;for(yt=0;yt<pi.length;yt++)Be.writeMessage(4,Ue,pi[yt])}function ve(Ye,Be){var yt=Ye.feature;yt.id!==void 0&&Be.writeVarintField(1,yt.id),Be.writeMessage(2,ye,Ye),Be.writeVarintField(3,yt.type),Be.writeMessage(4,Ie,yt)}function ye(Ye,Be){var yt=Ye.feature,Et=Ye.keys,Bt=Ye.values,pi=Ye.keycache,xi=Ye.valuecache;for(var Ii in yt.properties){var Ri=yt.properties[Ii],Wr=pi[Ii];if(Ri!==null){Wr===void 0&&(Et.push(Ii),pi[Ii]=Wr=Et.length-1),Be.writeVarint(Wr);var ki=typeof Ri;ki!=="string"&&ki!=="boolean"&&ki!=="number"&&(Ri=JSON.stringify(Ri));var vr=ki+":"+Ri,Xi=xi[vr];Xi===void 0&&(Bt.push(Ri),xi[vr]=Xi=Bt.length-1),Be.writeVarint(Xi)}}}function Ee(Ye,Be){return(Be<<3)+(7&Ye)}function Ae(Ye){return Ye<<1^Ye>>31}function Ie(Ye,Be){for(var yt=Ye.loadGeometry(),Et=Ye.type,Bt=0,pi=0,xi=yt.length,Ii=0;Ii<xi;Ii++){var Ri=yt[Ii],Wr=1;Et===1&&(Wr=Ri.length),Be.writeVarint(Ee(1,Wr));for(var ki=Et===3?Ri.length-1:Ri.length,vr=0;vr<ki;vr++){vr===1&&Et!==1&&Be.writeVarint(Ee(2,ki-1));var Xi=Ri[vr].x-Bt,xr=Ri[vr].y-pi;Be.writeVarint(Ae(Xi)),Be.writeVarint(Ae(xr)),Bt+=Xi,pi+=xr}Et===3&&Be.writeVarint(Ee(7,1))}}function Ue(Ye,Be){var yt=typeof Ye;yt==="string"?Be.writeStringField(1,Ye):yt==="boolean"?Be.writeBooleanField(7,Ye):yt==="number"&&(Ye%1!=0?Be.writeDoubleField(3,Ye):Ye<0?Be.writeSVarintField(6,Ye):Be.writeVarintField(5,Ye))}return Yi.exports=K,Yi.exports.fromVectorTileJs=K,Yi.exports.fromGeojsonVt=function(Ye,Be){Be=Be||{};var yt={};for(var Et in Ye)yt[Et]=new G(Ye[Et].features,Be),yt[Et].name=Et,yt[Et].version=Be.version,yt[Et].extent=Be.extent;return K({layers:yt})},Yi.exports.GeoJSONWrapper=G,Yi.exports}(),In=n.fh(vn);const Rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},ys=Math.fround||(gr=new Float32Array(1),We=>(gr[0]=+We,gr[0]));var gr;const tr=3,_t=5,fi=6;class $t{constructor(G){this.options=Object.assign(Object.create(Rs),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:K,minZoom:ce,maxZoom:ve}=this.options;K&&console.time("total time");const ye=`prepare ${G.length} points`;K&&console.time(ye),this.points=G;const Ee=[];for(let Ie=0;Ie<G.length;Ie++){const Ue=G[Ie];if(!Ue.geometry)continue;const[Ye,Be]=Ue.geometry.coordinates,yt=ys(Sr(Ye)),Et=ys(we(Be));Ee.push(yt,Et,1/0,Ie,-1,1),this.options.reduce&&Ee.push(0)}let Ae=this.trees[ve+1]=this._createTree(Ee);K&&console.timeEnd(ye);for(let Ie=ve;Ie>=ce;Ie--){const Ue=+Date.now();Ae=this.trees[Ie]=this._createTree(this._cluster(Ae,Ie)),K&&console.log("z%d: %d clusters in %dms",Ie,Ae.numItems,+Date.now()-Ue)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,G[1]));let ye=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,ye=180;else if(ce>ye){const Be=this.getClusters([ce,ve,180,Ee],K),yt=this.getClusters([-180,ve,ye,Ee],K);return Be.concat(yt)}const Ae=this.trees[this._limitZoom(K)],Ie=Ae.range(Sr(ce),we(Ee),Sr(ye),we(ve)),Ue=Ae.data,Ye=[];for(const Be of Ie){const yt=this.stride*Be;Ye.push(Ue[yt+_t]>1?Ei(Ue,yt,this.clusterProps):this.points[Ue[yt+tr]])}return Ye}getChildren(G){const K=this._getOriginId(G),ce=this._getOriginZoom(G),ve="No cluster with the specified id.",ye=this.trees[ce];if(!ye)throw new Error(ve);const Ee=ye.data;if(K*this.stride>=Ee.length)throw new Error(ve);const Ae=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ie=ye.within(Ee[K*this.stride],Ee[K*this.stride+1],Ae),Ue=[];for(const Ye of Ie){const Be=Ye*this.stride;Ee[Be+4]===G&&Ue.push(Ee[Be+_t]>1?Ei(Ee,Be,this.clusterProps):this.points[Ee[Be+tr]])}if(Ue.length===0)throw new Error(ve);return Ue}getLeaves(G,K,ce){const ve=[];return this._appendLeaves(ve,G,K=K||10,ce=ce||0,0),ve}getTile(G,K,ce){const ve=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Ee,radius:Ae}=this.options,Ie=Ae/Ee,Ue=(ce-Ie)/ye,Ye=(ce+1+Ie)/ye,Be={features:[]};return this._addTileFeatures(ve.range((K-Ie)/ye,Ue,(K+1+Ie)/ye,Ye),ve.data,K,ce,ye,Be),K===0&&this._addTileFeatures(ve.range(1-Ie/ye,Ue,1,Ye),ve.data,ye,ce,ye,Be),K===ye-1&&this._addTileFeatures(ve.range(0,Ue,Ie/ye,Ye),ve.data,-1,ce,ye,Be),Be.features.length?Be:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){const ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,ve,ye){const Ee=this.getChildren(K);for(const Ae of Ee){const Ie=Ae.properties;if(Ie&&Ie.cluster?ye+Ie.point_count<=ve?ye+=Ie.point_count:ye=this._appendLeaves(G,Ie.cluster_id,ce,ve,ye):ye<ve?ye++:G.push(Ae),G.length===ce)break}return ye}_createTree(G){const K=new n.bW(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,ve,ye,Ee){for(const Ae of G){const Ie=Ae*this.stride,Ue=K[Ie+_t]>1;let Ye,Be,yt;if(Ue)Ye=yr(K,Ie,this.clusterProps),Be=K[Ie],yt=K[Ie+1];else{const pi=this.points[K[Ie+tr]];Ye=pi.properties;const[xi,Ii]=pi.geometry.coordinates;Be=Sr(xi),yt=we(Ii)}const Et={type:1,geometry:[[Math.round(this.options.extent*(Be*ye-ce)),Math.round(this.options.extent*(yt*ye-ve))]],tags:Ye};let Bt;Bt=Ue||this.options.generateId?K[Ie+tr]:this.points[K[Ie+tr]].id,Bt!==void 0&&(Et.id=Bt),Ee.features.push(Et)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){const{radius:ce,extent:ve,reduce:ye,minPoints:Ee}=this.options,Ae=ce/(ve*Math.pow(2,K)),Ie=G.data,Ue=[],Ye=this.stride;for(let Be=0;Be<Ie.length;Be+=Ye){if(Ie[Be+2]<=K)continue;Ie[Be+2]=K;const yt=Ie[Be],Et=Ie[Be+1],Bt=G.within(Ie[Be],Ie[Be+1],Ae),pi=Ie[Be+_t];let xi=pi;for(const Ii of Bt){const Ri=Ii*Ye;Ie[Ri+2]>K&&(xi+=Ie[Ri+_t])}if(xi>pi&&xi>=Ee){let Ii,Ri=yt*pi,Wr=Et*pi,ki=-1;const vr=(Be/Ye<<5)+(K+1)+this.points.length;for(const Xi of Bt){const xr=Xi*Ye;if(Ie[xr+2]<=K)continue;Ie[xr+2]=K;const Er=Ie[xr+_t];Ri+=Ie[xr]*Er,Wr+=Ie[xr+1]*Er,Ie[xr+4]=vr,ye&&(Ii||(Ii=this._map(Ie,Be,!0),ki=this.clusterProps.length,this.clusterProps.push(Ii)),ye(Ii,this._map(Ie,xr)))}Ie[Be+4]=vr,Ue.push(Ri/xi,Wr/xi,1/0,vr,-1,xi),ye&&Ue.push(ki)}else{for(let Ii=0;Ii<Ye;Ii++)Ue.push(Ie[Be+Ii]);if(xi>1)for(const Ii of Bt){const Ri=Ii*Ye;if(!(Ie[Ri+2]<=K)){Ie[Ri+2]=K;for(let Wr=0;Wr<Ye;Wr++)Ue.push(Ie[Ri+Wr])}}}}return Ue}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+_t]>1){const Ee=this.clusterProps[G[K+fi]];return ce?Object.assign({},Ee):Ee}const ve=this.points[G[K+tr]].properties,ye=this.options.map(ve);return ce&&ye===ve?Object.assign({},ye):ye}}function Ei(We,G,K){return{type:"Feature",id:We[G+tr],properties:yr(We,G,K),geometry:{type:"Point",coordinates:[(ce=We[G],360*(ce-.5)),Le(We[G+1])]}};var ce}function yr(We,G,K){const ce=We[G+_t],ve=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,ye=We[G+fi],Ee=ye===-1?{}:Object.assign({},K[ye]);return Object.assign(Ee,{cluster:!0,cluster_id:We[G+tr],point_count:ce,point_count_abbreviated:ve})}function Sr(We){return We/360+.5}function we(We){const G=Math.sin(We*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Le(We){const G=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ht(We,G,K,ce){let ve=ce;const ye=G+(K-G>>1);let Ee,Ae=K-G;const Ie=We[G],Ue=We[G+1],Ye=We[K],Be=We[K+1];for(let yt=G+3;yt<K;yt+=3){const Et=Pt(We[yt],We[yt+1],Ie,Ue,Ye,Be);if(Et>ve)Ee=yt,ve=Et;else if(Et===ve){const Bt=Math.abs(yt-ye);Bt<Ae&&(Ee=yt,Ae=Bt)}}ve>ce&&(Ee-G>3&&ht(We,G,Ee,ce),We[Ee+2]=ve,K-Ee>3&&ht(We,Ee,K,ce))}function Pt(We,G,K,ce,ve,ye){let Ee=ve-K,Ae=ye-ce;if(Ee!==0||Ae!==0){const Ie=((We-K)*Ee+(G-ce)*Ae)/(Ee*Ee+Ae*Ae);Ie>1?(K=ve,ce=ye):Ie>0&&(K+=Ee*Ie,ce+=Ae*Ie)}return Ee=We-K,Ae=G-ce,Ee*Ee+Ae*Ae}function Tt(We,G,K,ce){const ve={id:We??null,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")jt(ve,K);else if(G==="Polygon")jt(ve,K[0]);else if(G==="MultiLineString")for(const ye of K)jt(ve,ye);else if(G==="MultiPolygon")for(const ye of K)jt(ve,ye[0]);return ve}function jt(We,G){for(let K=0;K<G.length;K+=3)We.minX=Math.min(We.minX,G[K]),We.minY=Math.min(We.minY,G[K+1]),We.maxX=Math.max(We.maxX,G[K]),We.maxY=Math.max(We.maxY,G[K+1])}function Jt(We,G,K,ce){if(!G.geometry)return;const ve=G.geometry.coordinates;if(ve&&ve.length===0)return;const ye=G.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ae=[],Ie=G.id;if(K.promoteId?Ie=G.properties[K.promoteId]:K.generateId&&(Ie=ce||0),ye==="Point")Xt(ve,Ae);else if(ye==="MultiPoint")for(const Ue of ve)Xt(Ue,Ae);else if(ye==="LineString")Yt(ve,Ae,Ee,!1);else if(ye==="MultiLineString"){if(K.lineMetrics){for(const Ue of ve)Ae=[],Yt(Ue,Ae,Ee,!1),We.push(Tt(Ie,"LineString",Ae,G.properties));return}Gt(ve,Ae,Ee,!1)}else if(ye==="Polygon")Gt(ve,Ae,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ue of G.geometry.geometries)Jt(We,{id:Ie,geometry:Ue,properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ue of ve){const Ye=[];Gt(Ue,Ye,Ee,!0),Ae.push(Ye)}}We.push(Tt(Ie,ye,Ae,G.properties))}function Xt(We,G){G.push(Bi(We[0]),ti(We[1]),0)}function Yt(We,G,K,ce){let ve,ye,Ee=0;for(let Ie=0;Ie<We.length;Ie++){const Ue=Bi(We[Ie][0]),Ye=ti(We[Ie][1]);G.push(Ue,Ye,0),Ie>0&&(Ee+=ce?(ve*Ye-Ue*ye)/2:Math.sqrt(Math.pow(Ue-ve,2)+Math.pow(Ye-ye,2))),ve=Ue,ye=Ye}const Ae=G.length-3;G[2]=1,ht(G,0,Ae,K),G[Ae+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function Gt(We,G,K,ce){for(let ve=0;ve<We.length;ve++){const ye=[];Yt(We[ve],ye,K,ce),G.push(ye)}}function Bi(We){return We/360+.5}function ti(We){const G=Math.sin(We*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function _i(We,G,K,ce,ve,ye,Ee,Ae){if(ce/=G,ye>=(K/=G)&&Ee<ce)return We;if(Ee<K||ye>=ce)return null;const Ie=[];for(const Ue of We){const Ye=Ue.geometry;let Be=Ue.type;const yt=ve===0?Ue.minX:Ue.minY,Et=ve===0?Ue.maxX:Ue.maxY;if(yt>=K&&Et<ce){Ie.push(Ue);continue}if(Et<K||yt>=ce)continue;let Bt=[];if(Be==="Point"||Be==="MultiPoint")Gi(Ye,Bt,K,ce,ve);else if(Be==="LineString")lr(Ye,Bt,K,ce,ve,!1,Ae.lineMetrics);else if(Be==="MultiLineString")_r(Ye,Bt,K,ce,ve,!1);else if(Be==="Polygon")_r(Ye,Bt,K,ce,ve,!0);else if(Be==="MultiPolygon")for(const pi of Ye){const xi=[];_r(pi,xi,K,ce,ve,!0),xi.length&&Bt.push(xi)}if(Bt.length){if(Ae.lineMetrics&&Be==="LineString"){for(const pi of Bt)Ie.push(Tt(Ue.id,Be,pi,Ue.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(Bt.length===1?(Be="LineString",Bt=Bt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=Bt.length===3?"Point":"MultiPoint"),Ie.push(Tt(Ue.id,Be,Bt,Ue.tags))}}return Ie.length?Ie:null}function Gi(We,G,K,ce,ve){for(let ye=0;ye<We.length;ye+=3){const Ee=We[ye+ve];Ee>=K&&Ee<=ce&&xn(G,We[ye],We[ye+1],We[ye+2])}}function lr(We,G,K,ce,ve,ye,Ee){let Ae=jr(We);const Ie=ve===0?qr:Fn;let Ue,Ye,Be=We.start;for(let xi=0;xi<We.length-3;xi+=3){const Ii=We[xi],Ri=We[xi+1],Wr=We[xi+2],ki=We[xi+3],vr=We[xi+4],Xi=ve===0?Ii:Ri,xr=ve===0?ki:vr;let Er=!1;Ee&&(Ue=Math.sqrt(Math.pow(Ii-ki,2)+Math.pow(Ri-vr,2))),Xi<K?xr>K&&(Ye=Ie(Ae,Ii,Ri,ki,vr,K),Ee&&(Ae.start=Be+Ue*Ye)):Xi>ce?xr<ce&&(Ye=Ie(Ae,Ii,Ri,ki,vr,ce),Ee&&(Ae.start=Be+Ue*Ye)):xn(Ae,Ii,Ri,Wr),xr<K&&Xi>=K&&(Ye=Ie(Ae,Ii,Ri,ki,vr,K),Er=!0),xr>ce&&Xi<=ce&&(Ye=Ie(Ae,Ii,Ri,ki,vr,ce),Er=!0),!ye&&Er&&(Ee&&(Ae.end=Be+Ue*Ye),G.push(Ae),Ae=jr(We)),Ee&&(Be+=Ue)}let yt=We.length-3;const Et=We[yt],Bt=We[yt+1],pi=ve===0?Et:Bt;pi>=K&&pi<=ce&&xn(Ae,Et,Bt,We[yt+2]),yt=Ae.length-3,ye&&yt>=3&&(Ae[yt]!==Ae[0]||Ae[yt+1]!==Ae[1])&&xn(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&G.push(Ae)}function jr(We){const G=[];return G.size=We.size,G.start=We.start,G.end=We.end,G}function _r(We,G,K,ce,ve,ye){for(const Ee of We)lr(Ee,G,K,ce,ve,ye,!1)}function xn(We,G,K,ce){We.push(G,K,ce)}function qr(We,G,K,ce,ve,ye){const Ee=(ye-G)/(ce-G);return xn(We,ye,K+(ve-K)*Ee,1),Ee}function Fn(We,G,K,ce,ve,ye){const Ee=(ye-K)/(ve-K);return xn(We,G+(ce-G)*Ee,ye,1),Ee}function Tn(We,G){const K=[];for(let ce=0;ce<We.length;ce++){const ve=We[ce],ye=ve.type;let Ee;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ee=es(ve.geometry,G);else if(ye==="MultiLineString"||ye==="Polygon"){Ee=[];for(const Ae of ve.geometry)Ee.push(es(Ae,G))}else if(ye==="MultiPolygon"){Ee=[];for(const Ae of ve.geometry){const Ie=[];for(const Ue of Ae)Ie.push(es(Ue,G));Ee.push(Ie)}}K.push(Tt(ve.id,ye,Ee,ve.tags))}return K}function es(We,G){const K=[];K.size=We.size,We.start!==void 0&&(K.start=We.start,K.end=We.end);for(let ce=0;ce<We.length;ce+=3)K.push(We[ce]+G,We[ce+1],We[ce+2]);return K}function ho(We,G){if(We.transformed)return We;const K=1<<We.z,ce=We.x,ve=We.y;for(const ye of We.features){const Ee=ye.geometry,Ae=ye.type;if(ye.geometry=[],Ae===1)for(let Ie=0;Ie<Ee.length;Ie+=2)ye.geometry.push(Cn(Ee[Ie],Ee[Ie+1],G,K,ce,ve));else for(let Ie=0;Ie<Ee.length;Ie++){const Ue=[];for(let Ye=0;Ye<Ee[Ie].length;Ye+=2)Ue.push(Cn(Ee[Ie][Ye],Ee[Ie][Ye+1],G,K,ce,ve));ye.geometry.push(Ue)}}return We.transformed=!0,We}function Cn(We,G,K,ce,ve,ye){return[Math.round(K*(We*ce-ve)),Math.round(K*(G*ce-ye))]}function ts(We,G,K,ce,ve){const ye=G===ve.maxZoom?0:ve.tolerance/((1<<G)*ve.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ae of We)Mr(Ee,Ae,ye,ve);return Ee}function Mr(We,G,K,ce){const ve=G.geometry,ye=G.type,Ee=[];if(We.minX=Math.min(We.minX,G.minX),We.minY=Math.min(We.minY,G.minY),We.maxX=Math.max(We.maxX,G.maxX),We.maxY=Math.max(We.maxY,G.maxY),ye==="Point"||ye==="MultiPoint")for(let Ae=0;Ae<ve.length;Ae+=3)Ee.push(ve[Ae],ve[Ae+1]),We.numPoints++,We.numSimplified++;else if(ye==="LineString")fo(Ee,ve,We,K,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ae=0;Ae<ve.length;Ae++)fo(Ee,ve[Ae],We,K,ye==="Polygon",Ae===0);else if(ye==="MultiPolygon")for(let Ae=0;Ae<ve.length;Ae++){const Ie=ve[Ae];for(let Ue=0;Ue<Ie.length;Ue++)fo(Ee,Ie[Ue],We,K,!0,Ue===0)}if(Ee.length){let Ae=G.tags||null;if(ye==="LineString"&&ce.lineMetrics){Ae={};for(const Ue in G.tags)Ae[Ue]=G.tags[Ue];Ae.mapbox_clip_start=ve.start/ve.size,Ae.mapbox_clip_end=ve.end/ve.size}const Ie={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ae};G.id!==null&&(Ie.id=G.id),We.features.push(Ie)}}function fo(We,G,K,ce,ve,ye){const Ee=ce*ce;if(ce>0&&G.size<(ve?Ee:ce))return void(K.numPoints+=G.length/3);const Ae=[];for(let Ie=0;Ie<G.length;Ie+=3)(ce===0||G[Ie+2]>Ee)&&(K.numSimplified++,Ae.push(G[Ie],G[Ie+1])),K.numPoints++;ve&&function(Ie,Ue){let Ye=0;for(let Be=0,yt=Ie.length,Et=yt-2;Be<yt;Et=Be,Be+=2)Ye+=(Ie[Be]-Ie[Et])*(Ie[Be+1]+Ie[Et+1]);if(Ye>0===Ue)for(let Be=0,yt=Ie.length;Be<yt/2;Be+=2){const Et=Ie[Be],Bt=Ie[Be+1];Ie[Be]=Ie[yt-2-Be],Ie[Be+1]=Ie[yt-1-Be],Ie[yt-2-Be]=Et,Ie[yt-1-Be]=Bt}}(Ae,ye),We.push(Ae)}const fl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bs{constructor(G,K){const ce=(K=this.options=function(ye,Ee){for(const Ae in Ee)ye[Ae]=Ee[Ae];return ye}(Object.create(fl),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=function(ye,Ee){const Ae=[];if(ye.type==="FeatureCollection")for(let Ie=0;Ie<ye.features.length;Ie++)Jt(Ae,ye.features[Ie],Ee,Ie);else Jt(Ae,ye.type==="Feature"?ye:{geometry:ye},Ee);return Ae}(G,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(ye,Ee){const Ae=Ee.buffer/Ee.extent;let Ie=ye;const Ue=_i(ye,1,-1-Ae,Ae,0,-1,2,Ee),Ye=_i(ye,1,1-Ae,2+Ae,0,-1,2,Ee);return(Ue||Ye)&&(Ie=_i(ye,1,-Ae,1+Ae,0,-1,2,Ee)||[],Ue&&(Ie=Tn(Ue,1).concat(Ie)),Ye&&(Ie=Ie.concat(Tn(Ye,-1)))),Ie}(ve,K),ve.length&&this.splitTile(ve,0,0,0),ce&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ce,ve,ye,Ee,Ae){const Ie=[G,K,ce,ve],Ue=this.options,Ye=Ue.debug;for(;Ie.length;){ve=Ie.pop(),ce=Ie.pop(),K=Ie.pop(),G=Ie.pop();const Be=1<<K,yt=Ac(K,ce,ve);let Et=this.tiles[yt];if(!Et&&(Ye>1&&console.time("creation"),Et=this.tiles[yt]=ts(G,K,ce,ve,Ue),this.tileCoords.push({z:K,x:ce,y:ve}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,ve,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));const Er=`z${K}`;this.stats[Er]=(this.stats[Er]||0)+1,this.total++}if(Et.source=G,ye==null){if(K===Ue.indexMaxZoom||Et.numPoints<=Ue.indexMaxPoints)continue}else{if(K===Ue.maxZoom||K===ye)continue;if(ye!=null){const Er=ye-K;if(ce!==Ee>>Er||ve!==Ae>>Er)continue}}if(Et.source=null,G.length===0)continue;Ye>1&&console.time("clipping");const Bt=.5*Ue.buffer/Ue.extent,pi=.5-Bt,xi=.5+Bt,Ii=1+Bt;let Ri=null,Wr=null,ki=null,vr=null,Xi=_i(G,Be,ce-Bt,ce+xi,0,Et.minX,Et.maxX,Ue),xr=_i(G,Be,ce+pi,ce+Ii,0,Et.minX,Et.maxX,Ue);G=null,Xi&&(Ri=_i(Xi,Be,ve-Bt,ve+xi,1,Et.minY,Et.maxY,Ue),Wr=_i(Xi,Be,ve+pi,ve+Ii,1,Et.minY,Et.maxY,Ue),Xi=null),xr&&(ki=_i(xr,Be,ve-Bt,ve+xi,1,Et.minY,Et.maxY,Ue),vr=_i(xr,Be,ve+pi,ve+Ii,1,Et.minY,Et.maxY,Ue),xr=null),Ye>1&&console.timeEnd("clipping"),Ie.push(Ri||[],K+1,2*ce,2*ve),Ie.push(Wr||[],K+1,2*ce,2*ve+1),Ie.push(ki||[],K+1,2*ce+1,2*ve),Ie.push(vr||[],K+1,2*ce+1,2*ve+1)}}getTile(G,K,ce){G=+G,K=+K,ce=+ce;const ve=this.options,{extent:ye,debug:Ee}=ve;if(G<0||G>24)return null;const Ae=1<<G,Ie=Ac(G,K=K+Ae&Ae-1,ce);if(this.tiles[Ie])return ho(this.tiles[Ie],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",G,K,ce);let Ue,Ye=G,Be=K,yt=ce;for(;!Ue&&Ye>0;)Ye--,Be>>=1,yt>>=1,Ue=this.tiles[Ac(Ye,Be,yt)];return Ue&&Ue.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ye,Be,yt),console.time("drilling down")),this.splitTile(Ue.source,Ye,Be,yt,G,K,ce),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?ho(this.tiles[Ie],ye):null):null}}function Ac(We,G,K){return 32*((1<<We)*K+G)+We}function qu(We,G){const K=We.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);const ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return void G(null,null);const ve=new St(ce.features);let ye=In(ve);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:ve,rawData:ye.buffer})}class Ic extends qe{constructor(G,K,ce,ve,ye,Ee,Ae){super(G,K,ce,ve,ye,qu,Ae),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new Wt}loadData(G,K){const ce=G&&G.request,ve=ce&&ce.collectResourceTiming;this.loadGeoJSON(G,(ye,Ee)=>{if(ye||!Ee)return K(ye);if(typeof Ee!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){const Ie=n.X(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));Ee.features=Ee.features.filter(Ue=>Ie.value.evaluate({zoom:0},Ue))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new $t(function({superclusterOptions:Ie,clusterProperties:Ue}){if(!Ue||!Ie)return Ie;const Ye={},Be={},yt={accumulated:null,zoom:0},Et={properties:null},Bt=Object.keys(Ue);for(const pi of Bt){const[xi,Ii]=Ue[pi],Ri=n.X(Ii),Wr=n.X(typeof xi=="string"?[xi,["accumulated"],["get",pi]]:xi);Ye[pi]=Ri.value,Be[pi]=Wr.value}return Ie.map=pi=>{Et.properties=pi;const xi={};for(const Ii of Bt)xi[Ii]=Ye[Ii].evaluate(yt,Et);return xi},Ie.reduce=(pi,xi)=>{Et.properties=xi;for(const Ii of Bt)yt.accumulated=pi[Ii],pi[Ii]=Be[Ii].evaluate(yt,Et)},Ie}(G)).load(Ee.features):G.dynamic?this._dynamicIndex:function(Ie,Ue){return new Bs(Ie,Ue)}(Ee,G.geojsonVtOptions)}catch(Ie){return K(Ie)}const Ae={};if(ve){const Ie=F(ce);Ie&&(Ae.resourceTiming={},Ae.resourceTiming[G.source]=JSON.parse(JSON.stringify(Ie)))}K(null,Ae)}})}reloadTile(G,K){const ce=this.loaded;return ce&&ce[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)n.n(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class gt{constructor(G,K){this.tileID=new n.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ce,ve){this.status="parsing";const ye=new n.aM(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ee=[],Ae=K.familiesBySource[ce.source],Ie=new n.f0(ye,ce.promoteId);Ie.bucketLayerIDs=[],Ie.is3DTile=!0,n.fi(G).then(Ue=>{if(!Ue)return ve(new Error("Could not parse tile"));const Ye=n.fj(Ue,1/n.cT(ce.tileID.canonical)),Be=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ue.json.asset.extras&&Ue.json.asset.extras.MAPBOX_mesh_features,yt=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("EXT_meshopt_compression"),Et=new n.aa(this.zoom,{brightness:this.brightness});for(const Bt in Ae)for(const pi of Ae[Bt]){const xi=pi[0];Ie.bucketLayerIDs.push(pi.map(Ri=>n.C(Ri.id,Ri.scope))),xi.recalculate(Et,[]);const Ii=new n.fk(pi,Ye,ye,Be,yt,this.brightness,Ie);Be||(Ii.needsUpload=!0),Ee.push(Ii),Ii.evaluate(xi)}this.status="done",ve(null,{buckets:Ee,featureIndex:Ie,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ue=>ve(new Error(Ue.message)))}}class Po{constructor(G,K,ce,ve,ye,Ee,Ae){this.actor=G,this.layerIndex=K,this.availableImages=ce,this.availableModels=ve,this.brightness=Ae,this.loading={},this.loaded={}}loadTile(G,K){const ce=G.uid,ve=this.loading[ce]=new gt(G,this.brightness);n.br(G.request,(ye,Ee)=>{const Ae=!this.loading[ce];return delete this.loading[ce],Ae||ye?(ve.status="done",Ae||(this.loaded[ce]=ve),K(ye)):Ee&&Ee.byteLength!==0?void ve.parse(Ee,this.layerIndex,G,(Ie,Ue)=>{ve.status="done",this.loaded=this.loaded||{},this.loaded[ce]=ve,Ie||!Ue?K(Ie):K(null,Ue)}):(ve.status="done",this.loaded[ce]=ve,K())})}reloadTile(G,K){const ce=this.loaded,ve=G.uid;if(ce&&ce[ve]){const ye=ce[ve];ye.projection=G.projection,ye.brightness=G.brightness;const Ee=(Ae,Ie)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(G,K)),K(Ae,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){const ce=G.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(G,K){const ce=this.loaded,ve=G.uid;ce&&ce[ve]&&delete ce[ve],K()}}class Wu{constructor(G){this.self=G,this.actor=new n.fm(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.y,this.projections={},this.defaultProjection=n.ce({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:Ic,"raster-dem":$e,"raster-array":be,"batched-model":Po},this.workerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(n.fn.isParsed())throw new Error("RTL text plugin already registered.");n.fn.applyArabicShaping=K.applyArabicShaping,n.fn.processBidirectionalText=K.processBidirectionalText,n.fn.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ce){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],ce()}checkIfReady(G,K,ce){ce()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,K){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});const{scope:ce,isLoaded:ve}=K;if(this.isSpriteLoaded[G][ce]=ve,this.workerSources[G]&&this.workerSources[G][ce])for(const ye in this.workerSources[G][ce]){const Ee=this.workerSources[G][ce][ye];for(const Ae in Ee){const Ie=Ee[Ae];Ie instanceof qe&&(Ie.isSpriteLoaded=ve,Ie.fire(new n.A("isSpriteLoaded")))}}}setImages(G,K,ce){this.availableImages[G]||(this.availableImages[G]={});const{scope:ve,images:ye}=K;if(this.availableImages[G][ve]=ye,this.workerSources[G]&&this.workerSources[G][ve]){for(const Ee in this.workerSources[G][ve]){const Ae=this.workerSources[G][ve][Ee];for(const Ie in Ae)Ae[Ie].availableImages=ye}ce()}else ce()}setModels(G,{scope:K,models:ce},ve){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K]){for(const ye in this.workerSources[G][K]){const Ee=this.workerSources[G][K][ye];for(const Ae in Ee)Ee[Ae].availableModels=ce}ve()}else ve()}setProjection(G,K){this.projections[G]=n.ce(K)}setBrightness(G,K,ce){this.brightness=K,ce()}setLayers(G,K,ce){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ce()}updateLayers(G,K,ce){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).decodeRasterArray(K,ce)}reloadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(G,K,ce){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;const ve=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],ve.removeSource!==void 0?ve.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(ve){ce(ve.toString())}}syncRTLPluginState(G,K,ce){try{n.fn.setState(K);const ve=n.fn.getPluginURL();if(n.fn.isLoaded()&&!n.fn.isParsed()&&ve!=null){this.self.importScripts(ve);const ye=n.fn.isParsed();ce(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),ye)}}catch(ve){ce(ve.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ce=this.availableImages[G][K];return ce||(ce=[]),ce}getAvailableModels(G,K){this.availableModels[G]||(this.availableModels[G]={});let ce=this.availableModels[G][K];return ce||(ce={}),ce}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ce=this.layerIndexes[G][K];return ce||(ce=this.layerIndexes[G][K]=new Y,ce.scope=K),ce}getWorkerSource(G,K,ce,ve){const ye=this.workerSources;return ye[G]||(ye[G]={}),ye[G][ve]||(ye[G][ve]={}),ye[G][ve][K]||(ye[G][ve][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),ye[G][ve][K][ce]||(ye[G][ve][K][ce]=new this.workerSourceTypes[K]({send:(Ee,Ae,Ie,Ue,Ye,Be)=>this.actor.send(Ee,Ae,Ie,G,Ye,Be),scheduler:this.actor.scheduler},this.getLayerIndex(G,ve),this.getAvailableImages(G,ve),this.getAvailableModels(G,ve),this.isSpriteLoaded[G][ve],void 0,this.brightness)),ye[G][ve][K][ce]}rasterizeImagesWorker(G,K,ce){const ve=new Map;for(const[ye,{image:Ee,imageVariant:Ae}]of K.tasks.entries()){const Ie=this.imageRasterizer.rasterize(Ae,Ee,K.scope,G);ve.set(ye,Ie)}ce(void 0,ve)}removeRasterizedImages(G,K,ce){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,G),ce()}enforceCacheSizeLimit(G,K){n.fo(K)}getWorkerPerformanceMetrics(G,K,ce){ce(void 0,void 0)}}return n.fl(self)&&(self.worker=new Wu(self)),Wu}),S(["./shared"],function(n){var F="3.12.0";const W={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(u){performance.mark(u)},measure(u,t,s){performance.measure(u,t,s)}};function Y(u){const t=u.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var le,de={},Te=function(){if(le)return de;function u(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{v=new Worker(E),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(E),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===_.width}()?(s[p=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[p]=function(_){var v,b=function(E){var C=document.createElement("canvas"),R=Object.create(u.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=E,C.getContext("webgl2",R)}(_);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(p)),s[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}le=1,de.supported=u,de.notSupportedReason=t;var s={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},de}();function pe(u,t,s){const h=document.createElement(u);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function qe(u,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const p of Object.keys(t))h.setAttributeNS(null,p,String(t[p]));return s&&s.appendChild(h),h}const $e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ze=$e&&$e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let be;function ke(){$e&&ze&&(be=$e[ze],$e[ze]="none")}function Ke(){$e&&ze&&($e[ze]=be)}function St(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",St,!0)}function kt(){window.addEventListener("click",St,!0),window.setTimeout(()=>{window.removeEventListener("click",St,!0)},0)}function hi(u,t){const s=u.getBoundingClientRect();return ni(u,s,t)}function Wt(u,t){const s=u.getBoundingClientRect(),h=[];for(let p=0;p<t.length;p++)h.push(ni(u,s,t[p]));return h}function Zt(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function ni(u,t,s){const h=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new n.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const qt="01",di="NO_ACCESS_TOKEN";class vi{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!n.f(t))return t;const h=si(t);return h.params.push(`sdk=js-${F}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!n.f(t))return t;const h=si(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!n.f(t))return t;const h=si(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,p){if(!n.f(t))return t;const _=si(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),h&&_.params.push(`language=${h}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=si(t);return n.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):Ui(h)}normalizeSpriteURL(t,s,h,p){const _=si(t);return n.f(t)?(_.path=`/styles/v1${_.path}/sprite${s}${h}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${s}${h}`,Ui(_))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;const p=si(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&p.authority!=="raster"&&h===512?"@2x":""}${n.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${n.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${n.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${n.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||function(v){for(const b of v){const E=b.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(p.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,s){const h=si(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let p="mapbox://";h.path.match(/^\/raster\/v1\//)?p+=`raster/${h.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${h.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${h.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let _=h.params;return s&&(_=_.filter(v=>!v.match(/^access_token=/))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,s){const h=!!s&&n.f(s),p=[];for(const _ of t.tiles||[])n.h(_)?p.push(this.canonicalizeTileURL(_,h)):p.push(_);return p}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=si(n.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Ui(t);if(s=s||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),Ui(t)}}const Ni=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function si(u){const t=u.match(Ni);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ui(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const mi="mapbox.eventData";function Yr(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class Yi{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Yr(n.e.ACCESS_TOKEN);let h="";return h=s&&s.u?n.k(s.u):n.e.ACCESS_TOKEN||"",t?`${mi}.${t}:${h}`:`${mi}:${h}`}fetchEventData(){const t=n.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(h);_&&(this.anonId=_)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const t=n.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(h,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,p){if(!n.e.EVENTS_URL)return;const _=si(n.e.EVENTS_URL);_.params.push(`access_token=${p||n.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},b=s?n.l(v,s):v,E={url:Ui(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=n.p(E,C=>{this.pendingRequest=null,h(C),this.saveEventData(),this.processRequests(p)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const vn=new class extends Yi{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(s=>n.f(s)||n.h(s))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Yr(n.e.ACCESS_TOKEN),s=t?t.u:n.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(p),b=(p-this.eventData.lastSuccess)/864e5;h=h||b>=1||b<-1||_.getDate()!==v.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:qt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=s)},u):this.processRequests()}},In=vn.postTurnstileEvent.bind(vn),Rs=new class extends Yi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,s,h){this.skuToken=t,this.errorCb=h,n.e.EVENTS_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(di)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:qt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},ys=Rs.postMapLoadEvent.bind(Rs),gr=new class extends Yi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=n.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:s,style:h,importedStyles:p}=t;if(!n.e.EVENTS_URL||!u&&!n.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(s),v={mapInstanceId:_,eventId:this.getEventId(_),style:h};p.length&&(v.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:v},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},u)}},tr=gr.postStyleLoadEvent.bind(gr),_t=new class extends Yi{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){n.e.EVENTS_URL&&(u||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(p){const _=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),b=function(O){const j={};if(O){for(const V in O)if(V!=="other")for(const q of O[V]){const $=`${V}ResolveRangeMin`,Q=`${V}ResolveRangeMax`,re=`${V}RequestCount`,oe=`${V}RequestCachedCount`;j[$]=Math.min(j[$]||1/0,q.startTime),j[Q]=Math.max(j[Q]||-1/0,q.responseEnd);const fe=ue=>{j[ue]===void 0&&(j[ue]=0),++j[ue]};q.transferSize!==void 0&&q.transferSize===0&&fe(oe),fe(re)}}return j}(function(O,j){const V={};if(O)for(const q of O){const $=j(q);V[$]===void 0&&(V[$]=[]),V[$].push(q)}return V}(_,Y)),E=window.devicePixelRatio,C=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=C?C.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},D=(O,j,V)=>{V!=null&&O.push({name:j,value:V.toString()})};for(const O in b)D(k.counters,O,b[O]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(D(k.counters,"interactionRangeMin",p.interactionRange[0]),D(k.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const O of Object.keys(W)){const j=W[O],V=v.find(q=>q.name===j);V&&D(k.counters,j,V.startTime)}return D(k.counters,"visibilityHidden",p.visibilityHidden),D(k.attributes,"style",function(O){if(O)for(const j of O){const V=j.name.split("?")[0];if(n.i(V)){const q=V.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(_)),D(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),D(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),D(k.attributes,"projection",p.projection),D(k.attributes,"zoom",p.zoom),D(k.metadata,"devicePixelRatio",E),D(k.metadata,"connectionEffectiveType",R),D(k.metadata,"navigatorUserAgent",navigator.userAgent),D(k.metadata,"screenWidth",window.screen.width),D(k.metadata,"screenHeight",window.screen.height),D(k.metadata,"windowWidth",window.innerWidth),D(k.metadata,"windowHeight",window.innerHeight),D(k.metadata,"mapWidth",p.width/E),D(k.metadata,"mapHeight",p.height/E),D(k.metadata,"webglRenderer",p.renderer),D(k.metadata,"webglVendor",p.vendor),D(k.metadata,"sdkVersion",F),D(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(s);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(t,h,()=>{},u)}},fi=_t.postPerformanceEvent.bind(_t),$t=new class extends Yi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,s,h){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const p=si(n.e.API_URL+n.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${h||n.e.ACCESS_TOKEN||""}`);const _={url:Ui(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(_,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(h)})}getSessionAPI(u,t,s,h){this.skuToken=t,this.errorCb=h,n.e.SESSION_PATH&&n.e.API_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(di)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Ei=$t.getSessionAPI.bind($t),yr=new Set;function Sr(u,t){t?yr.add(u):yr.delete(u)}class we{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Le(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class ht extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const h of s.values())h.hasPendingRequests()&&t.push(h);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,s,p);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,h){this._validate(t,h)&&this.images.get(s).set(t.toString(),h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const p of t){if(p[0]<h||p[1]<p[0]||s<p[1])return!1;h=p[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const p=this.images.get(s).get(t.toString());h.version=p.version+1,this.images.get(s).set(t.toString(),h),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const h=this.images.get(s),p=h.get(t.toString());h.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(s=>n.I.from(s))}getImages(t,s,h){const p=[],_=[],v=this.imageProviders.get(s);for(const R of t){if(!R.iconsetId){p.push(R);continue}const k=v.get(R.iconsetId);k&&(this.getImage(R,s)?_.push(R):k.addPendingRequest(R))}if(p.length===0)return void this._notify(_,s,h);let b=!0;const E=!!this.loaded.get(s),C=this.images.get(s);if(!E)for(const R of p)C.has(R.toString())||(b=!1);E||b?this._notify(p,s,h):this.requestors.push({ids:p,scope:s,callback:h})}rasterizeImages(t,s){const h=new Map,{tasks:p,scope:_}=t;for(const[v,b]of p.entries()){const E=this.getImage(b.id,_);E&&h.set(v,{image:E,imageVariant:b})}this._rasterizeImages(_,h,s)}_rasterizeImages(t,s,h){if(n.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},h);else{const p=new Map;for(const[_,{image:v,imageVariant:b}]of s.entries())p.set(_,this.imageRasterizer.rasterize(b,v,t,0));h(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,h){const p=this.images.get(s),_=new Map;for(const v of t){if(!p.get(v.toString())){if(v.iconsetId)continue;this.fire(new n.A("styleimagemissing",{id:v.name}))}const b=p.get(v.toString());if(!b){n.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const E={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(E,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),_.set(n.I.toString(v),E)}h(null,_)}getPixelSize(t){const{width:s,height:h}=this.atlasImage.get(t);return{width:s,height:h}}getPattern(t,s,h){const p=t.toString(),_=this.patterns.get(s),v=_.get(p),b=this.getImage(t,s);if(!b)return null;if(v){if(v.position.version===b.version)return v.position;v.position.version=b.version}else{if(b.usvg&&!b.data){const E=this.getPatternInFlightId(p,s);if(this.patternsInFlight.has(E))return null;this.patternsInFlight.add(E);const C=new n.B(t).scaleSelf(n.q.devicePixelRatio),R=new Map([[C.toString(),{image:b,imageVariant:C}]]);return this._rasterizeImages(s,R,(k,D)=>this.storePatternImage(C,s,b,h,D)),null}this.storePattern(t,s,b)}return this._updatePatternAtlas(s,h),_.get(p).position}getPatternInFlightId(t,s){return n.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,p,_){const v=t.toString(),b=_?_.get(v):void 0;b&&(h.data=b,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const p={w:h.data.width+2*n.F,h:h.data.height+2*n.F,x:0,y:0},_=new n.G(p,h,n.F);this.patterns.get(s).set(t.toString(),{bin:p,position:_})}bind(t,s){const h=t.gl;let p=this.atlasTexture.get(s);p?this.dirty&&(p.update(this.atlasImage.get(s)),this.dirty=!1):(p=new n.T(t,this.atlasImage.get(s),h.RGBA8),this.atlasTexture.set(s,p)),p.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=this.patterns.get(t),p=Array.from(h.values()).map(({bin:C})=>C),{w:_,h:v}=n.H(p),b=this.atlasImage.get(t);b.resize({width:_||1,height:v||1});const E=this.images.get(t);for(const[C,{bin:R,position:k}]of h.entries()){let D=k.padding;const O=R.x+D,j=R.y+D,V=E.get(C).data,q=V.width,$=V.height;D=D>1?D-1:D,n.r.copy(V,b,{x:0,y:0},{x:O,y:j},{width:q,height:$},s),n.r.copy(V,b,{x:0,y:$-D},{x:O,y:j-D},{width:q,height:D},s),n.r.copy(V,b,{x:0,y:0},{x:O,y:j+$},{width:q,height:D},s),n.r.copy(V,b,{x:q-D,y:0},{x:O-D,y:j},{width:D,height:$},s),n.r.copy(V,b,{x:0,y:0},{x:O+q,y:j},{width:D,height:$},s),n.r.copy(V,b,{x:q-D,y:$-D},{x:O-D,y:j-D},{width:D,height:D},s),n.r.copy(V,b,{x:0,y:$-D},{x:O+q,y:j-D},{width:D,height:D},s),n.r.copy(V,b,{x:0,y:0},{x:O+q,y:j+$},{width:D,height:D},s),n.r.copy(V,b,{x:q-D,y:0},{x:O-D,y:j+$},{width:D,height:D},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const h=this.images.get(s);for(const p of t){if(this.callbackDispatchedThisFrame.get(s).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(p.toString());const _=h.get(p.toString());Le(_)&&this.updateImage(p,s,_)}}}function Pt(u){const t=u.key,s=u.value,h=u.valueSpec||{},p=u.objectElementValidators||{},_=u.style,v=u.styleSpec;let b=[];const E=n.K(s);if(E!=="object")return[new n.V(t,s,`object expected, ${E} found`)];for(const C in s){const R=C.split(".")[0];let k;p[R]?k=p[R]:h[R]?k=Mr:p["*"]?k=p["*"]:h["*"]&&(k=Mr),k?b=b.concat(k({key:(t&&`${t}.`)+C,value:s[C],valueSpec:h[R]||h["*"],style:_,styleSpec:v,object:s,objectKey:C},s)):b.push(new n.J(t,s[C],`unknown property "${C}"`))}for(const C in h)p[C]||h[C].required&&h[C].default===void 0&&s[C]===void 0&&b.push(new n.V(t,s,`missing required property "${C}"`));return b}function Tt(u){const t=u.value,s=u.valueSpec,h=u.style,p=u.styleSpec,_=u.key,v=u.arrayElementValidator||Mr;if(n.K(t)!=="array")return[new n.V(_,t,`array expected, ${n.K(t)} found`)];if(s.length&&t.length!==s.length)return[new n.V(_,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new n.V(_,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(b.function=s.function),n.K(s.value)==="object"&&(b=s.value);let E=[];for(let C=0;C<t.length;C++)E=E.concat(v({array:t,arrayIndex:C,value:t[C],valueSpec:b,style:h,styleSpec:p,key:`${_}[${C}]`},!0));return E}function jt(u){const t=u.key,s=u.value,h=u.valueSpec;let p=n.K(s);if(p==="number"&&s!=s&&(p="NaN"),p!=="number")return[new n.V(t,s,`number expected, ${p} found`)];if("minimum"in h){let _=h.minimum;if(n.K(h.minimum)==="array"&&(_=h.minimum[u.arrayIndex]),s<_)return[new n.V(t,s,`${s} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if(n.K(h.maximum)==="array"&&(_=h.maximum[u.arrayIndex]),s>_)return[new n.V(t,s,`${s} is greater than the maximum value ${_}`)]}return[]}function Jt(u){const t=u.valueSpec,s=n.M(u.value.type);let h,p,_,v={};const b=s!=="categorical"&&u.value.property===void 0,E=!b,C=n.K(u.value.stops)==="array"&&n.K(u.value.stops[0])==="array"&&n.K(u.value.stops[0][0])==="object",R=Pt({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(O){if(s==="identity")return[new n.V(O.key,O.value,'identity function may not have a "stops" property')];let j=[];const V=O.value;return j=j.concat(Tt({key:O.key,value:V,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:k})),n.K(V)==="array"&&V.length===0&&j.push(new n.V(O.key,V,"array must have at least one stop")),j},default:function(O){return Mr({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return s==="identity"&&b&&R.push(new n.V(u.key,u.value,'missing required property "property"')),s==="identity"||u.value.stops||R.push(new n.V(u.key,u.value,'missing required property "stops"')),s==="exponential"&&u.valueSpec.expression&&!n.N(u.valueSpec)&&R.push(new n.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(E&&!n.O(u.valueSpec)?R.push(new n.V(u.key,u.value,"property functions not supported")):b&&!n.Q(u.valueSpec)&&R.push(new n.V(u.key,u.value,"zoom functions not supported"))),s!=="categorical"&&!C||u.value.property!==void 0||R.push(new n.V(u.key,u.value,'"property" property is required')),R;function k(O){let j=[];const V=O.value,q=O.key;if(n.K(V)!=="array")return[new n.V(q,V,`array expected, ${n.K(V)} found`)];if(V.length!==2)return[new n.V(q,V,`array length 2 expected, length ${V.length} found`)];if(C){if(n.K(V[0])!=="object")return[new n.V(q,V,`object expected, ${n.K(V[0])} found`)];if(V[0].zoom===void 0)return[new n.V(q,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new n.V(q,V,"object stop key must have value")];const $=n.M(V[0].zoom);if(typeof $!="number")return[new n.V(q,V[0].zoom,"stop zoom values must be numbers")];if(_&&_>$)return[new n.V(q,V[0].zoom,"stop zoom values must appear in ascending order")];$!==_&&(_=$,p=void 0,v={}),j=j.concat(Pt({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:jt,value:D}}))}else j=j.concat(D({key:`${q}[0]`,value:V[0],style:O.style,styleSpec:O.styleSpec},V));return n.S(n.U(V[1]))?j.concat([new n.V(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):j.concat(Mr({key:`${q}[1]`,value:V[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function D(O,j){const V=n.K(O.value),q=n.M(O.value),$=O.value!==null?O.value:j;if(h){if(V!==h)return[new n.V(O.key,$,`${V} stop domain type must match previous stop domain type ${h}`)]}else h=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new n.V(O.key,$,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&s!=="categorical"){let Q=`number expected, ${V} found`;return n.O(t)&&s===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(O.key,$,Q)]}return s!=="categorical"||V!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?s!=="categorical"&&V==="number"&&typeof q=="number"&&typeof p=="number"&&p!==void 0&&q<p?[new n.V(O.key,$,"stop domain values must appear in ascending order")]:(p=q,s==="categorical"&&q in v?[new n.V(O.key,$,"stop domain values must be unique")]:(v[q]=!0,[])):[new n.V(O.key,$,`integer expected, found ${String(q)}`)]}}function Xt(u){const t=(u.expressionContext==="property"?n.W:n.X)(n.U(u.value),u.valueSpec);if(t.result==="error")return t.value.map(h=>new n.V(`${u.key}${h.key}`,u.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!s.outputDefined())return[new n.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!n.Y(s))return[new n.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Yt(s,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!n.Z(s,["zoom","feature-state"]))return[new n.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!n._(s))return[new n.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yt(u,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)s.delete(p);if(s.size===0)return[];const h=[];return u instanceof n.$&&s.has(u.name)?[new n.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(p=>{h.push(...Yt(p,t))}),h)}function Gt(u){const t=u.key,s=u.value,h=u.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(n.M(s))===-1&&p.push(new n.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(n.M(s))===-1&&p.push(new n.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function Bi(u){return n.a1(n.U(u.value))?Xt(n.L({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):ti(u)}function ti(u){const t=u.value,s=u.key;if(n.K(t)!=="array")return[new n.V(s,t,`array expected, ${n.K(t)} found`)];const h=u.styleSpec;let p,_=[];if(t.length<1)return[new n.V(s,t,"filter array must have at least 1 element")];switch(_=_.concat(Gt({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),n.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.M(t[1])==="$type"&&_.push(new n.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new n.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=n.K(t[1]),p!=="string"&&_.push(new n.V(`${s}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=n.K(t[v]),n.M(t[1])==="$type"?_=_.concat(Gt({key:`${s}[${v}]`,value:t[v],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new n.V(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(ti({key:`${s}[${v}]`,value:t[v],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":p=n.K(t[1]),t.length!==2?_.push(new n.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new n.V(`${s}[1]`,t[1],`string expected, ${p} found`))}return _}function _i(u,t){const s=u.key,h=u.style,p=u.layer,_=u.styleSpec,v=u.value,b=u.objectKey,E=_[`${t}_${u.layerType}`];if(!E)return[];const C=b.match(/^(.*)-use-theme$/);if(t==="paint"&&C&&E[C[1]])return n.S(v)?[].concat(Mr({key:u.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b})):Mr({key:s,value:v,valueSpec:{type:"string"},style:h,styleSpec:_});const R=b.match(/^(.*)-transition$/);if(t==="paint"&&R&&E[R[1]]&&E[R[1]].transition)return Mr({key:s,value:v,valueSpec:_.transition,style:h,styleSpec:_});const k=u.valueSpec||E[b];if(!k)return[new n.J(s,v,`unknown property "${b}"`)];let D;if(n.K(v)==="string"&&n.O(k)&&!k.tokens&&(D=/^{([^}]+)}$/.exec(v))){const j=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new n.V(s,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}const O=[];if(u.layerType==="symbol")b!=="text-field"||!h||h.glyphs||h.imports||O.push(new n.V(s,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&n.a2(n.U(v))&&n.M(v.type)==="identity"&&O.push(new n.V(s,v,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&n.O(k)&&(n.a3(k)||n.Q(k))){const j=n.W(n.U(v),k),V=j.value.expression||j.value._styleExpression.expression;V&&!n.Z(V,["measure-light"])&&(b==="model-emissive-strength"&&n._(V)&&n.Y(V)||O.push(new n.V(s,v,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return O.concat(Mr({key:u.key,value:v,valueSpec:k,style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Gi(u){return _i(u,"paint")}function lr(u){return _i(u,"layout")}function jr(u){let t=[];const s=u.value,h=u.key,p=u.style,_=u.styleSpec;s.type||s.ref||t.push(new n.V(h,s,'either "type" or "ref" is required'));let v=n.M(s.type);const b=n.M(s.ref);if(s.id){const E=n.M(s.id);for(let C=0;C<u.arrayIndex;C++){const R=p.layers[C];n.M(R.id)===E&&t.push(new n.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&t.push(new n.V(h,s[C],`"${C}" is prohibited for ref layers`))}),p.layers.forEach(C=>{n.M(C.id)===b&&(E=C)}),E?E.ref?t.push(new n.V(h,s.ref,"ref cannot reference another ref layer")):v=n.M(E.type):typeof b=="string"&&t.push(new n.V(h,s.ref,`ref layer "${b}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(s.source){const E=p.sources&&p.sources[s.source],C=E&&n.M(E.type);E?C==="vector"&&v==="raster"?t.push(new n.V(h,s.source,`layer "${s.id}" requires a raster source`)):C==="raster"&&v!=="raster"?t.push(new n.V(h,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&v!=="hillshade"?t.push(new n.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&C==="geojson"&&!E.lineMetrics?t.push(new n.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&C!=="raster-array"&&t.push(new n.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new n.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new n.V(h,s.source,`source "${s.source}" not found`))}else t.push(new n.V(h,s,'missing required property "source"'));return t=t.concat(Pt({key:h,value:s,valueSpec:_.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mr({key:`${h}.type`,value:s.type,valueSpec:_.layer.type,style:u.style,styleSpec:u.styleSpec,object:s,objectKey:"type"}),filter:E=>Bi(n.L({layerType:v},E)),layout:E=>Pt({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":C=>lr(n.L({layerType:v},C))}}),paint:E=>Pt({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":C=>Gi(n.L({layerType:v,layer:s},C))}})}})),t}function _r(u){const t=u.value,s=u.key,h=n.K(t);return h!=="string"?[new n.V(s,t,`string expected, ${h} found`)]:[]}const xn={promoteId:function u({key:t,value:s}){if(n.K(s)==="string")return _r({key:t,value:s});if(Array.isArray(s)){const h=[],p=n.U(s),_=n.X(p);return _.result==="error"&&_.value.forEach(v=>{h.push(new n.V(`${t}${v.key}`,null,`${v.message}`))}),n.Z(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const p in s)h.push(...u({key:`${t}.${p}`,value:s[p]}));return h}}};function qr(u){const t=u.value,s=u.key,h=u.styleSpec,p=u.style;if(!t.type)return[new n.V(s,t,'"type" is required')];const _=n.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||v.push(new n.J(s,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(Pt({key:s,value:t,valueSpec:h[`source_${_.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:xn})),v;case"geojson":if(v=Pt({key:s,value:t,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:xn}),t.cluster)for(const b in t.clusterProperties){const[E,C]=t.clusterProperties[b],R=typeof E=="string"?[E,["accumulated"],["get",b]]:E;v.push(...Xt({key:`${s}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...Xt({key:`${s}.${b}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return v;case"video":return Pt({key:s,value:t,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Pt({key:s,value:t,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new n.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gt({key:`${s}.type`,value:t.type,valueSpec:{values:Fn(h)}})}}function Fn(u){return u.source.reduce((t,s)=>{const h=u[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function Tn(u){const t=u.value,s=u.styleSpec,h=s.light,p=u.style;let _=[];const v=n.K(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new n.V("light",t,`object expected, ${v} found`)]),_;for(const b in t){const E=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);_=_.concat(C&&h[C[1]]?Mr({key:b,value:t[b],valueSpec:{type:"string"},style:p,styleSpec:s}):E&&h[E[1]]&&h[E[1]].transition?Mr({key:b,value:t[b],valueSpec:s.transition,style:p,styleSpec:s}):h[b]?Mr({key:b,value:t[b],valueSpec:h[b],style:p,styleSpec:s}):[new n.V(b,t[b],`unknown property "${b}"`)])}return _}function es(u){const t=u.value;let s=[];if(!t)return s;const h=n.K(t);if(h!=="object")return s=s.concat([new n.V("light-3d",t,`object expected, ${h} found`)]),s;const p=u.styleSpec,_=p["light-3d"],v=u.key,b=u.style,E=u.style.lights;for(const k of["type","id"])if(!(k in t))return s=s.concat([new n.V("light-3d",t,`missing property ${k} on light`)]),s;if(t.type&&E)for(let k=0;k<u.arrayIndex;k++){const D=n.M(t.type),O=E[k];n.M(O.type)===D&&s.push(new n.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${O.id.__line__}`))}const C=`properties_light_${t.type}`;if(!(C in p))return s=s.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const R=p[C];for(const k in t)if(k==="properties"){const D=t[k],O=n.K(D);if(O!=="object")return s=s.concat([new n.V("properties",D,`object expected, ${O} found`)]),s;for(const j in D)s=s.concat(R[j]?Mr({key:j,value:D[j],valueSpec:R[j],style:b,styleSpec:p}):[new n.J(u.key,D[j],`unknown property "${j}"`)])}else{const D=k.match(/^(.*)-transition$/),O=k.match(/^(.*)-use-theme$/);s=s.concat(O&&_[O[1]]?Mr({key:k,value:t[k],valueSpec:{type:"string"},style:b,styleSpec:p}):D&&_[D[1]]&&_[D[1]].transition?Mr({key:k,value:t[k],valueSpec:p.transition,style:b,styleSpec:p}):_[k]?Mr({key:k,value:t[k],valueSpec:_[k],style:b,styleSpec:p}):[new n.J(k,t[k],`unknown property "${k}"`)])}return s}function ho(u){const t=u.value,s=u.key,h=u.style,p=u.styleSpec,_=p.terrain;let v=[];const b=n.K(t);if(t===void 0||b==="null")return v;if(b!=="object")return v=v.concat([new n.V("terrain",t,`object expected, ${b} found`)]),v;for(const E in t){const C=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);v=v.concat(R&&_[R[1]]?Mr({key:E,value:t[E],valueSpec:{type:"string"},style:h,styleSpec:p}):C&&_[C[1]]&&_[C[1]].transition?Mr({key:E,value:t[E],valueSpec:p.transition,style:h,styleSpec:p}):_[E]?Mr({key:E,value:t[E],valueSpec:_[E],style:h,styleSpec:p}):[new n.J(E,t[E],`unknown property "${E}"`)])}if(t.source){const E=h.sources&&h.sources[t.source],C=E&&n.M(E.type);E?C!=="raster-dem"&&v.push(new n.V(s,t.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):v.push(new n.V(s,t.source,`source "${t.source}" not found`))}else v.push(new n.V(s,t,'terrain is missing required property "source"'));return v}function Cn(u){const t=u.value,s=u.style,h=u.styleSpec,p=h.fog;let _=[];const v=n.K(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new n.V("fog",t,`object expected, ${v} found`)]),_;for(const b in t){const E=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);_=_.concat(C&&p[C[1]]?Mr({key:b,value:t[b],valueSpec:{type:"string"},style:s,styleSpec:h}):E&&p[E[1]]&&p[E[1]].transition?Mr({key:b,value:t[b],valueSpec:h.transition,style:s,styleSpec:h}):p[b]?Mr({key:b,value:t[b],valueSpec:p[b],style:s,styleSpec:h}):[new n.J(b,t[b],`unknown property "${b}"`)])}return _}const ts={"*":()=>[],array:Tt,boolean:function(u){const t=u.value,s=u.key,h=n.K(t);return h!=="boolean"?[new n.V(s,t,`boolean expected, ${h} found`)]:[]},number:jt,color:function(u){const t=u.key,s=u.value,h=n.K(s);return h!=="string"?[new n.V(t,s,`color expected, ${h} found`)]:n.a0.parseCSSColor(s)===null?[new n.V(t,s,`color expected, "${s}" found`)]:[]},enum:Gt,filter:Bi,function:Jt,layer:jr,object:Pt,source:qr,model:n.a4,light:Tn,"light-3d":es,terrain:ho,fog:Cn,string:_r,formatted:function(u){return _r(u).length===0?[]:Xt(u)},resolvedImage:function(u){return _r(u).length===0?[]:Xt(u)},projection:function(u){const t=u.value,s=u.styleSpec,h=s.projection,p=u.style;let _=[];const v=n.K(t);if(v==="object")for(const b in t)_=_.concat(Mr({key:b,value:t[b],valueSpec:h[b],style:p,styleSpec:s}));else v!=="string"&&(_=_.concat([new n.V("projection",t,`object or string expected, ${v} found`)]));return _},import:function(u){const{value:t,styleSpec:s}=u,{data:h,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let _=Pt(n.L({},u,{value:p,valueSpec:s.import}));return n.M(p.id)===""&&_.push(new n.V(`${u.key}.id`,p,"import id can't be an empty string")),h&&(_=_.concat(fl(h,s,{key:`${u.key}.data`}))),_},iconset:function(u){const t=u.value,s=u.key,h=u.styleSpec,p=u.style;if(!t.type)return[new n.V(s,t,'"type" is required')];const _=n.M(t.type);let v=[];if(v=v.concat(Pt({key:s,value:t,valueSpec:h[`iconset_${_}`],style:p,styleSpec:h})),_==="source"&&t.source){const b=p.sources&&p.sources[t.source],E=b&&n.M(b.type);b?E!=="raster-array"&&v.push(new n.V(s,t.source,`iconset cannot be used with a source of type ${String(E)}, it only be used with a "raster-array" source type`)):v.push(new n.V(s,t.source,`source "${t.source}" not found`))}return v}};function Mr(u,t=!1){const s=u.value,h=u.valueSpec,p=u.styleSpec;if(h.expression&&n.a2(n.M(s)))return Jt(u);if(h.expression&&n.S(n.U(s)))return Xt(u);if(h.type&&ts[h.type]){const _=ts[h.type](u);return t===!0&&_.length>0&&n.K(u.value)==="array"?Xt(u):_}return Pt(n.L({},u,{valueSpec:h.type?p[h.type]:h}))}function fo(u){const t=u.value,s=u.key,h=_r(u);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new n.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new n.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function fl(u,t=n.a5,s={}){return Mr({key:s.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:fo,"*":()=>[]}})}function Bs(u,t=n.a5){return Ee(fl(u,t))}const Ac=u=>Ee(qr(u)),qu=u=>Ee(Tn(u)),Ic=u=>Ee(es(u)),gt=u=>Ee(ho(u)),Po=u=>Ee(Cn(u)),Wu=u=>Ee(function(t){const s=t.value,h=t.style,p=t.styleSpec,_=p.snow;let v=[];const b=n.K(s);if(s===void 0)return v;if(b!=="object")return v=v.concat([new n.V("snow",s,`object expected, ${b} found`)]),v;for(const E in s){const C=E.match(/^(.*)-transition$/);v=v.concat(C&&_[C[1]]&&_[C[1]].transition?Mr({key:E,value:s[E],valueSpec:p.transition,style:h,styleSpec:p}):_[E]?Mr({key:E,value:s[E],valueSpec:_[E],style:h,styleSpec:p}):[new n.J(E,s[E],`unknown property "${E}"`)])}return v}(u)),We=u=>Ee(function(t){const s=t.value,h=t.style,p=t.styleSpec,_=p.rain;let v=[];const b=n.K(s);if(s===void 0)return v;if(b!=="object")return v=v.concat([new n.V("rain",s,`object expected, ${b} found`)]),v;for(const E in s){const C=E.match(/^(.*)-transition$/);v=v.concat(C&&_[C[1]]&&_[C[1]].transition?Mr({key:E,value:s[E],valueSpec:p.transition,style:h,styleSpec:p}):_[E]?Mr({key:E,value:s[E],valueSpec:_[E],style:h,styleSpec:p}):[new n.J(E,s[E],`unknown property "${E}"`)])}return v}(u)),G=u=>Ee(jr(u)),K=u=>Ee(Bi(u)),ce=u=>Ee(Gi(u)),ve=u=>Ee(lr(u)),ye=u=>Ee(n.a4(u));function Ee(u){return u.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Ae(u,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof n.J?n.w(h.message):(u.fire(new n.z(new Error(h.message))),s=!0);return s}let Ie;class Ue extends n.E{constructor(t,s="flat"){super(),this._transitionable=new n.a6(Ie||(Ie=new n.a7({anchor:new n.a8(n.a5.light.anchor),position:new n.a9(n.a5.light.position),color:new n.a8(n.a5.light.color),intensity:new n.a8(n.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(qu,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Ae(this,t.call(Bs,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let Ye=class extends n.E{constructor(u,t,s,h){super(),this.scope=s,this._transitionable=new n.a6(new n.a7({source:new n.a8(n.a5.terrain.source),exaggeration:new n.a8(n.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new n.aa(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let s=-1,h=-1,p=1;for(const _ of t.zoomStops)p=t.evaluate(new n.aa(_)),p>.01?(s=_,h=-1):h=_;return p<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof n.ab}};const Be=45,yt=65,Et=.05;function Bt(u,t,s,h){const p=n.af(Be,yt,s),[_,v]=pi(u,h);let b=1-Math.min(1,Math.exp((t-_)/(v-_)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*p*u.alpha}function pi(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}function xi(u,t,s,h,p){const _=n.ad([],[t,s,h],p.mercatorFogMatrix);return Bt(u,n.ae(_),p.pitch,p._fov)}function Ii(u,t,s,h,p,_,v){const b=[[s,h,0],[p,h,0],[p,_,0],[s,_,0]];let E=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(const R of b){const k=n.ad([],R,t),D=n.ae(k);E=Math.min(E,D),C=Math.max(C,D)}return[Bt(u,E,v.pitch,v._fov),Bt(u,C,v.pitch,v._fov)]}class Ri extends n.E{constructor(t,s,h,p){super();const _=new n.a7({range:new n.a8(n.a5.fog.range),color:new n.a8(n.a5.fog.color),"color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a8(n.a5.fog["high-color"]),"high-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a8(n.a5.fog["space-color"]),"space-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a8(n.a5.fog["horizon-blend"]),"star-intensity":new n.a8(n.a5.fog["star-intensity"]),"vertical-range":new n.a8(n.a5.fog["vertical-range"])});this._transitionable=new n.a6(_,h,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new n.ag(_),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=n.ah(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:s?[n.ai(_[0],p[0],h),n.ai(_[1],p[1],h)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(Po,t,h))return;const p=n.l({},t);for(const _ of Object.keys(n.a5.fog))p[_]===void 0&&(p[_]=n.a5.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.af(Be,yt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,p,_){const v=n.ac.fromLngLat(p),b=_.elevation?_.elevation.getAtPointOrZero(v):0;return xi(h,v.x,v.y,b,_)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ii(this.state,s,0,0,n.aj,n.aj,this._transform)}getOpacityForBounds(t,s,h,p,_){return this._transform.projection.supportsFog?Ii(this.state,t,s,h,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?pi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const p=t.points[h];let _;if(p[2]>=0)_=p;else{const v=t.points[h-4];_=n.ak(v,p,v[2]/(v[2]-p[2]))}if(xi(this.state,_[0],_[1],0,this._transform)>=Et)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Ae(this,t.call(Bs,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let Wr,ki,vr,Xi,xr=class extends n.E{constructor(u,t,s,h){super();const p=Wr||(Wr=new n.a7({density:new n.a8(n.a5.snow.density),intensity:new n.a8(n.a5.snow.intensity),color:new n.a8(n.a5.snow.color),opacity:new n.a8(n.a5.snow.opacity),vignette:new n.a8(n.a5.snow.vignette),"vignette-color":new n.a8(n.a5.snow["vignette-color"]),"center-thinning":new n.a8(n.a5.snow["center-thinning"]),direction:new n.a8(n.a5.snow.direction),"flake-size":new n.a8(n.a5.snow["flake-size"])}));this._transitionable=new n.a6(p,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(p),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=n.al(s[0]),p=-Math.max(n.al(s[1]),.01),_=[Math.cos(h)*Math.cos(p),Math.sin(h)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette"),b=this.properties.get("vignette-color");return b.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(t.r,t.g,t.b,t.a*u),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(Wu,u,s))return;const h=n.l({},u);for(const p of Object.keys(n.a5.snow))h[p]===void 0&&(h[p]=n.a5.snow[p].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Ae(this,u.call(Bs,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}},Er=class extends n.E{constructor(u,t,s,h){super();const p=ki||(ki=new n.a7({density:new n.a8(n.a5.rain.density),intensity:new n.a8(n.a5.rain.intensity),color:new n.a8(n.a5.rain.color),opacity:new n.a8(n.a5.rain.opacity),vignette:new n.a8(n.a5.rain.vignette),"vignette-color":new n.a8(n.a5.rain["vignette-color"]),"center-thinning":new n.a8(n.a5.rain["center-thinning"]),direction:new n.a8(n.a5.rain.direction),"droplet-size":new n.a8(n.a5.rain["droplet-size"]),"distortion-strength":new n.a8(n.a5.rain["distortion-strength"])}));this._transitionable=new n.a6(p,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(p),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=n.al(s[0]),p=-Math.max(n.al(s[1]),.01),_=[Math.cos(h)*Math.cos(p),Math.sin(h)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(t.r,t.g,t.b,t.a*u),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(We,u,s))return;const h=n.l({},u);for(const p of Object.keys(n.a5.rain))h[p]===void 0&&(h[p]=n.a5.rain[p].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Ae(this,u.call(Bs,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}};class rn extends n.E{constructor(t,s,h,p){super(),this.scope=h,this._options=t,this.properties=new n.ag(s),this._transitionable=new n.a6(s,h,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class fn{constructor(t,s,h,p){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,s){let h,p;if(t instanceof n.P||typeof t[0]=="number"){const _=n.P.convert(t);h=[_],p=s.isPointAboveHorizon(_)}else{const _=n.P.convert(t[0]),v=n.P.convert(t[1]),b=_.add(v)._div(2);h=[_,v],p=n.ao(_,v).every(E=>s.isPointAboveHorizon(E))&&s.isPointAboveHorizon(b)}return new fn(h,s.getCameraPoint(),p,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.ao(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?p[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(p[3]=this.cameraPoint)),n.ap(p,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.ao(s,h,t),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>h.y))+((_.x>s.x)+(_.x>h.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,s,h,p=0){const _=t.queryPadding/s._pixelsPerMercatorPixel+1,v=h?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let b=t.tileID.wrap+(v.unwrapped?p:0);const E=v.polygon.map(q=>n.aq(t.tileTransform,q,b));if(!n.ar(E,0,0,n.aj,n.aj))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const C=this.screenGeometryMercator.polygon.map(q=>n.as(t.tileTransform,q,b)),R=C.map(q=>new n.P(q[0],q[1])),k=s.getFreeCameraOptions().position||new n.ac(0,0,0),D=n.as(t.tileTransform,k,b),O=C.map(q=>{const $=n.at(q,q,D);return n.au($,$),new n.av(D,$)}),j=n.aw(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:O,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(V=n.ax(E),V.min.x=n.aD(V.min.x,0,n.aj),V.min.y=n.aD(V.min.y,0,n.aj),V.max.x=n.aD(V.max.x,0,n.aj),V.max.y=n.aD(V.max.y,0,n.aj),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:j};var V}_bufferedScreenMercator(t,s){const h=Mo(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=p,p}}_bufferedCameraMercator(t,s){const h=Mo(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=p,p}}_projectAndResample(t,s){const h=function(_,v){const b=n.az([],v.pixelMatrix,v.globeMatrix),E=[0,-n.aE,0,1],C=[0,n.aE,0,1],R=[0,0,0,1];n.aA(E,E,b),n.aA(C,C,b),n.aA(R,R,b);const k=new n.P(E[0]/E[3],E[1]/E[3]),D=new n.P(C[0]/C[3],C[1]/C[3]),O=n.aB(_,k)&&E[3]<R[3],j=n.aB(_,D)&&C[3]<R[3];if(!O&&!j)return null;const V=function(he,ae,_e){for(let ge=1;ge<he.length;ge++){const Oe=Bn(ae.pointCoordinate3D(he[ge-1]).x),Re=Bn(ae.pointCoordinate3D(he[ge]).x);if(_e<0){if(Oe<Re)return{idx:ge,t:-Oe/(Re-1-Oe)}}else if(Re<Oe)return{idx:ge,t:(1-Oe)/(Re+1-Oe)}}return null}(_,v,O?-1:1);if(!V)return null;const{idx:q,t:$}=V;let Q=q>1?Pn(_.slice(0,q),v):[],re=q<_.length?Pn(_.slice(q),v):[];Q=Q.map(he=>new n.P(Bn(he.x),he.y)),re=re.map(he=>new n.P(Bn(he.x),he.y));const oe=[...Q];oe.length===0&&oe.push(re[re.length-1]);const fe=n.ai(oe[oe.length-1].y,(re.length===0?Q[0]:re[0]).y,$);let ue;return ue=O?[new n.P(0,fe),new n.P(0,0),new n.P(1,0),new n.P(1,fe)]:[new n.P(1,fe),new n.P(1,1),new n.P(0,1),new n.P(0,fe)],oe.push(...ue),re.length===0?oe.push(Q[0]):oe.push(...re),{polygon:oe.map(he=>new n.ac(he.x,he.y)),unwrapped:!1}}(t,s);if(h)return h;const p=function(_,v){let b=!1,E=-1/0,C=0;for(let k=0;k<_.length-1;k++)_[k].x>E&&(E=_[k].x,C=k);for(let k=0;k<_.length-1;k++){const D=(C+k)%(_.length-1),O=_[D],j=_[D+1];Math.abs(O.x-j.x)>.5&&(O.x<j.x?(O.x+=1,D===0&&(_[_.length-1].x+=1)):(j.x+=1,D+1===_.length-1&&(_[0].x+=1)),b=!0)}const R=n.ay(v.center.lng);return b&&R<Math.abs(R-1)&&_.forEach(k=>{k.x-=1}),{polygon:_,unwrapped:b}}(Pn(t,s).map(_=>new n.P(Bn(_.x),_.y)),s);return{polygon:p.polygon.map(_=>new n.ac(_.x,_.y)),unwrapped:p.unwrapped}}}function Pn(u,t){return n.aC(u,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function Bn(u){return u<0?1+u%1:u%1}function Mo(u){return 100*u|0}function Wn(u,t,s,h,p){const _=function(b,E){if(b)return p(b);if(E){if(u.url&&E.tiles&&u.tiles&&delete u.tiles,E.variants){if(!Array.isArray(E.variants))return p(new Error("variants must be an array"));for(const R of E.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return p(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){E=n.l(E,R);break}}}const C=n.aF(n.l({},E,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);C.tiles=t.canonicalizeTileset(C,u.url),p(null,C)}},v=function(b,E,C){if(!b)return null;if(!E&&!C)return b;C=C||b.worldview_default;const R=Object.values(b.language||{});if(R.length===0)return null;const k=Object.values(b.worldview||{});if(k.length===0)return null;const D=R.every(j=>j===E),O=k.every(j=>j===C);return D&&O?b:E in(b.language_options||{})||C in(b.worldview_options||{})?null:b.language_options&&b.worldview_options?b:null}(u.data,s,h);return v?n.q.frame(()=>_(null,v)):u.url?n.n(t.transformRequest(t.normalizeSourceURL(u.url,null,s,h),n.R.Source),_):n.q.frame(()=>{const{data:b,...E}=u;_(null,E)})}function Zn(u,t){const s=Math.pow(2,t.z),h=Math.floor(n.ay(u.getWest())*s),p=Math.floor(n.aH(u.getNorth())*s),_=Math.ceil(n.ay(u.getEast())*s),v=Math.ceil(n.aH(u.getSouth())*s);return t.x>=h&&t.x<_&&t.y>=p&&t.y<v}class Ln{constructor(t,s,h){this.bounds=t?n.aG.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(n.aG.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Zn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(Zn(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Ln(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class Vn extends n.E{constructor(t,s,h,p){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.aF(s,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new n.aI}load(t){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Wn(this._options,this.map._requestManager,s,h,(p,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new n.z(p));else if(_){if(n.l(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of _.vector_layers)this.vectorLayerIds.push(v.id),_.worldview&&_.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=Ln.fromTileJSON(_),In(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(h),_=this.map._requestManager.transformRequest(p,n.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,b=v?{image:v.image.clone()}:null,E={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:b,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(h)&&(E.worldview=this.map.getWorldview()||this.worldviewDefault,E.localizableLayerIds=this.localizableLayerIds),E.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",E,C.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",E,C.bind(this),void 0,!0);else{const R=n.aJ.call({deduped:this._deduped},E,(k,D)=>{k||!D?C.call(this,k):(E.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},t.actor&&t.actor.send("loadTile",E,C.bind(this),void 0,!0))},!0);t.request={cancel:R}}function C(R,k){return delete t.request,t.aborted?s(null):R&&R.status!==404?s(R):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),n.aK(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class po extends n.E{constructor(t,s,h,p){super(),this.id=t,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},s),n.l(this,n.aF(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Wn(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new n.z(s)):h&&(n.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),this.tileBounds=Ln.fromTileJSON(h),In(h.tiles),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=n.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(p,n.R.Tile),(_,v,b,E)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):_?(t.state="errored",s(_)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:E}),t.setTexture(v,this.map.painter),t.state="loaded",n.aK(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ia extends po{constructor(t,s,h,p){super(t,s,h,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=n.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(h,n.R.Tile),_={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const v=(b,E,C,R)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(b)return b.name==="AbortError"?void 0:(t.state="errored",s(b));if(this.map._refreshExpiredTiles&&E&&t.setExpiryData({cacheControl:C,expires:R}),this.partial)t.state="empty";else{if(!E)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=E}s(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",_,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(p,_)=>{if(p)return t.state="errored",this.fire(new n.z(p)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:_})=>_===t),h=s&&s.fields,p=h&&h.bands&&h.bands;return p?p[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const p=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;s instanceof n.aN?_=s.paint.get("raster-array-band"):s instanceof n.aO&&(_=s.paint.get("raster-particle-array-band"));const v=_||this.getInitialBand(p);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,v)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,v)}getImages(t,s){const h=new Map;for(const p of t)for(const _ of s){const[v,b]=_.split("/"),E=p.getLayer(v);if(!E||!E.hasBand(b)||!E.hasDataForBand(b))continue;const{bytes:C,tileSize:R,buffer:k}=E.getBandView(b),D=R+2*k,O={data:new n.r({width:D,height:D},C),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(_,O)}return h}}const Cc={vector:Vn,raster:po,"raster-dem":class extends po{constructor(u,t,s,h){super(u,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(p,_){p&&(u.state="errored",t(p)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=n.o(this.map._requestManager.transformRequest(s,n.R.Tile),(function(p,_,v,b){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(p)u.state="errored",t(p);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:v,expires:b});const E=ImageBitmap&&_ instanceof ImageBitmap&&n.t(),C=1-(_.width-n.aL(_.width))/2;C<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const R=E?_:n.q.getImageData(_,C),k={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:C};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",k,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,p=t.x===0?u.wrap-1:u.wrap,_=(t.x+1+s)%s,v=t.x+1===s?u.wrap+1:u.wrap,b={};return b[new n.aM(u.overscaledZ,p,t.z,h,t.y).key]={backfilled:!1},b[new n.aM(u.overscaledZ,v,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(b[new n.aM(u.overscaledZ,p,t.z,h,t.y-1).key]={backfilled:!1},b[new n.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new n.aM(u.overscaledZ,v,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(b[new n.aM(u.overscaledZ,p,t.z,h,t.y+1).key]={backfilled:!1},b[new n.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new n.aM(u.overscaledZ,v,t.z,_,t.y+1).key]={backfilled:!1}),b}},"raster-array":Ia,geojson:class extends n.E{constructor(u,t,s,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=n.aj/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:n.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new n.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new n.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of u.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:s},h),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=n.l({append:u},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(s),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,p)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new n.z(h));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new n.A("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=n.C(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,p=h?{image:h.image.clone()}:null,_=this._partialReload,v={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_};u.request=this.actor.send(s,v,(b,E)=>_&&!E?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):b?t(b):(u.loadVectorData(E,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aP{constructor(u,t,s,h){super(u,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aQ(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new n.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new n.z(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aP,model:class extends n.E{constructor(u,t,s,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const s=this._options.models[t],h=n.aS(this.map._requestManager.transformRequest(s.uri,n.R.Model).url).then(p=>{if(!p)return;const _=n.aT(p),v=new n.aU(t,s.position,s.orientation,_);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(p=>{this.fire(new n.z(new Error(`Could not load model ${t} from ${s.uri}: ${p.message}`)))});u.push(h)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new n.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends n.E{constructor(u,t,s,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Wn(this._options,this.map._requestManager,t,s,(h,p)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new n.z(h))):p&&(n.l(this,p),p.bounds&&(this.tileBounds=new Ln(p.bounds,this.minzoom,this.maxzoom)),In(p.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,n.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.q.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const _=Object.values(u.buckets);for(const v of _)v.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,p.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,p.bind(this),void 0,!0);function p(_,v){return u.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&v&&u.setExpiryData(v),u.loadModelData(v,this.map.painter),u.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aP{constructor(u,t,s,h){super(u,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new n.z(new n.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.z(new n.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.z(new n.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.z(new n.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.z(new n.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof n.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.E{constructor(u,t,s,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ln(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:s,z:h}=u.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:s,y:h,z:p}=u.tileID.canonical,_=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:p},{signal:_.signal})).then((function(v){return delete u.request,u.aborted?(u.state="unloaded",t(null)):v===void 0?(u.state="errored",t(null)):v===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement}(v)?(this.loadTileData(u,v),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(u.state="errored",t(v))}),u.request.cancel=()=>_.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof n.T?(u.destroy(!0),u.texture&&u.texture instanceof n.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:p}=u.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:p})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=n.C(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}}},pl=function(u,t,s,h){const p=new Cc[t.type](u,t,s,h);if(p.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${p.id}`);return n.aV(["load","abort","unload","serialize","prepare"],p),p};function Zu(u,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:p,importId:_}=h;return`featureset:${p}${_?`:import:${_}`:""}`}}(u.target)}`}function Pc(u,t,s,h=""){if(u.uniqueFeatureID){const p=Zu(u,t,h);if(s.has(p))return!0;s.add(p)}return!1}function Ca(u,t,s,h,p=!1){const _=t.sourceCache.transform,v=t.sourceCache.tilesIn(u,t.has3DLayers,p);v.sort(Ks);const b=[];for(const E of v){const C=E.tile.queryRenderedFeatures(t,E,s,h,_,p);Object.keys(C).length&&b.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:C})}return b.length===0?{}:function(E){const C={},R={};for(const k of E){const D=k.queryResults,O=k.wrappedTileID,j=R[O]=R[O]||{};for(const V in D){const q=D[V],$=j[V]=j[V]||{},Q=C[V]=C[V]||[];for(const re of q)$[re.featureIndex]||($[re.featureIndex]=!0,Q.push(re))}}return C}(b)}function Mc(u,t,s,h,p){const _={},v=h.queryRenderedSymbols(u),b=[];for(const E of Object.keys(v).map(Number))b.push(p[E]);b.sort(Ks);for(const E of b){const C=E.featureIndex.lookupSymbolFeatures(v[E.bucketInstanceId],E.bucketIndex,E.sourceLayerIndex,t,s);for(const R in C){const k=_[R]=_[R]||[],D=C[R];D.sort((O,j)=>{const V=E.featureSortOrder;if(V){const q=V.indexOf(O.featureIndex);return V.indexOf(j.featureIndex)-q}return j.featureIndex-O.featureIndex});for(const O of D)k.push(O)}}return _}function Gd(u,t){const s=u.getRenderableIds().map(_=>u.getTileByID(_)),h=[],p={};for(let _=0;_<s.length;_++){const v=s[_],b=v.tileID.canonical.key;p[b]||(p[b]=!0,v.querySourceFeatures(h,t))}return h}function Ks(u,t){const s=u.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Hd(u,t){const s={};if(!t)return s;for(const h of u){const p=h.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(p.length!==0){h.layers=p,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(_=>p.filter(v=>v.id===_)[0]));for(const _ of p)s[_.fqid]=h}}return s}const vs=32,Ys=33,Ro=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,s=0,h=0,p=0,_=0,v=0,b=0;for(1&t?p=_=v=vs:s=h=b=vs;(t>>=1)>1;){const C=s+p>>1,R=h+_>>1;1&t?(p=s,_=h,s=v,h=b):(s=p,h=_,p=v,_=b),v=C,b=R}const E=4*u;Ro[E+0]=s,Ro[E+1]=h,Ro[E+2]=p,Ro[E+3]=_}const Js=new Uint16Array(2178),Do=new Uint8Array(1089),Ns=new Uint16Array(1089);function Rc(u){return u===0?-.03125:u===32?.03125:0}const qd={type:2,extent:n.aj,loadGeometry:()=>[[new n.P(0,0),new n.P(n.aj+1,0),new n.P(n.aj+1,n.aj+1),new n.P(0,n.aj+1),new n.P(0,0)]]};class ko{constructor(t,s,h,p,_){this.tileID=t,this.uid=n.a$(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<n.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Hd(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.b1){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.b1&&_.hasRTLText){this.hasRTLText=!0,n.b2();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],v=s.style.getOwnLayer(p);if(!v)continue;const b=v.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,b)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Hd(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new n.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=s.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,s,h,p,_,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const b=function(E,C){const R=n.bn([],[.5*E.width,.5*-E.height,1]);return n.bo(R,R,[1,-1,0]),n.az(R,R,E.calculateProjMatrix(C.toUnwrapped())),Float32Array.from(R)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:b,transform:p,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[_];if(!v)return;const b=n.b3(s&&s.filter),{z:E,x:C,y:R}=this.tileID.canonical,k={z:E,x:C,y:R};for(let D=0;D<v.length;D++){const O=v.feature(D);if(b.needGeometry){const q=n.b4(O,!0);if(!b.filter(new n.aa(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!b.filter(new n.aa(this.tileID.overscaledZ),O))continue;const j=h.getId(O,_),V=new n.b5(O,E,C,R,j);V.tile=k,t.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=n.b6(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const _=this.expirationTime-s;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),_=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const b=this.buckets[v],E=b.layers[0],C=E.sourceLayer||"_geojsonTileLayer",R=h[C],k=t.style.getLayerSourceCache(E);let D={};k&&(D=k._state.getState(C,void 0));const O=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},j=Object.keys(D).length>0&&!s;j&&!b.stateDependentLayers.length&&!s||b.update(D,R,p,O,j?b.stateDependentLayers:b.layers,s,_),(b instanceof n.b7||b instanceof n.b8)&&t._terrain&&t._terrain.enabled&&k&&b.uploadPending()&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(v);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,s){const h=s.context,p=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(h,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const p of s)h[p]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const p=this.dependencies[h];if(p){for(const _ of s)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=n.b9(qd,this.tileID.canonical,this.tileTransform)[0],p=new n.ba,_=new n.bb;for(let v=0;v<h.length;v++){const{x:b,y:E}=h[v];p.emplaceBack(b,E),_.emplaceBack(v)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,n.bc.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=n.b9(qd,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const v=function(b,E){const C=n.aW(b,E),R=Math.pow(2,b.z);for(let q=0;q<Ys;q++)for(let $=0;$<Ys;$++){const Q=n.aX((b.x+($+Rc($))/vs)/R),re=n.aY((b.y+(q+Rc(q))/vs)/R),oe=E.project(Q,re),fe=q*Ys+$;Js[2*fe+0]=Math.round((oe.x*C.scale-C.x)*n.aj),Js[2*fe+1]=Math.round((oe.y*C.scale-C.y)*n.aj)}Do.fill(0),Ns.fill(0);for(let q=2045;q>=0;q--){const $=4*q,Q=Ro[$+0],re=Ro[$+1],oe=Ro[$+2],fe=Ro[$+3],ue=Q+oe>>1,he=re+fe>>1,ae=ue+he-re,_e=he+Q-ue,ge=re*Ys+Q,Oe=fe*Ys+oe,Re=he*Ys+ue,Je=Math.hypot((Js[2*ge+0]+Js[2*Oe+0])/2-Js[2*Re+0],(Js[2*ge+1]+Js[2*Oe+1])/2-Js[2*Re+1])>=16;Do[Re]=Do[Re]||(Je?1:0),q<1022&&(Do[Re]=Do[Re]||Do[(re+_e>>1)*Ys+(Q+ae>>1)]||Do[(fe+_e>>1)*Ys+(oe+ae>>1)])}const k=new n.aZ,D=new n.a_;let O=0;function j(q,$){const Q=$*Ys+q;return Ns[Q]===0&&(k.emplaceBack(Js[2*Q+0],Js[2*Q+1],q*n.aj/vs,$*n.aj/vs),Ns[Q]=++O),Ns[Q]-1}function V(q,$,Q,re,oe,fe){const ue=q+Q>>1,he=$+re>>1;if(Math.abs(q-oe)+Math.abs($-fe)>1&&Do[he*Ys+ue])V(oe,fe,q,$,ue,he),V(Q,re,oe,fe,ue,he);else{const ae=j(q,$),_e=j(Q,re),ge=j(oe,fe);D.emplaceBack(ae,_e,ge)}}return V(0,0,vs,vs,vs,0),V(vs,vs,0,0,0,vs),{vertices:k,indices:D}}(this.tileID.canonical,s);p=v.vertices,_=v.indices}else{p=new n.aZ,_=new n.a_;for(const{x:b,y:E}of h)p.emplaceBack(b,E,0,0);const v=n.be(p.int16.subarray(0,4*p.length),void 0,4);for(let b=0;b<v.length;b+=3)_.emplaceBack(v[b],v[b+1],v[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,n.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=n.bd.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const p=this.tileID.canonical,_=n.bg(p,s),v=n.bh(_),b=n.ah(s.zoom);let E;b>0&&(E=n.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,s,v,E,b),this._makeGlobeTileDebugTextBuffer(t,p,s,v,E,b)}_globePoint(t,s,h,p,_,v,b){let E=n.bj(t,s,h);if(v){const C=1<<h.z,R=n.ay(p.center.lng),k=n.aH(p.center.lat),D=(h.x+.5)/C-R;let O=0;D>.5?O=-1:D<-.5&&(O=1);let j=(t/n.aj+h.x)/C+O,V=(s/n.aj+h.y)/C;j=(j-R)*p._pixelsPerMercatorPixel+R,V=(V-k)*p._pixelsPerMercatorPixel+k;const q=[j*p.worldSize,V*p.worldSize,0];n.ad(q,q,v),E=n.bk(E,q,b)}return n.ad(E,E,_)}_makeGlobeTileDebugBorderBuffer(t,s,h,p,_,v){const b=new n.ba,E=new n.bb,C=new n.bl,R=(D,O,j,V,q)=>{const $=(j-D)/(q-1),Q=(V-O)/(q-1),re=b.length;for(let oe=0;oe<q;oe++){const fe=D+oe*$,ue=O+oe*Q;b.emplaceBack(fe,ue);const he=this._globePoint(fe,ue,s,h,p,_,v);C.emplaceBack(he[0],he[1],he[2]),E.emplaceBack(re+oe)}},k=n.aj;R(0,0,k,0,16),R(k,0,k,k,16),R(k,k,0,k,16),R(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(b,n.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(C,n.bm.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,b.length,E.length)}_makeGlobeTileDebugTextBuffer(t,s,h,p,_,v){const b=n.aj/4,E=new n.ba,C=new n.a_,R=new n.bl,k=25;C.reserve(32),E.reserve(k),R.reserve(k);const D=(O,j)=>k*O+j;for(let O=0;O<k;O++){const j=O*b;for(let V=0;V<k;V++){const q=V*b;E.emplaceBack(q,j);const $=this._globePoint(q,j,s,h,p,_,v);R.emplaceBack($[0],$[1],$[2])}}for(let O=0;O<4;O++)for(let j=0;j<4;j++){const V=D(O,j),q=D(O,j+1),$=D(O+1,j),Q=D(O+1,j+1);C.emplaceBack(V,q,$),C.emplaceBack($,q,Q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(C),this._tileDebugTextBuffer=t.createVertexBuffer(E,n.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(R,n.bm.members),this._tileDebugTextSegments=n.bd.simpleSegment(0,0,k,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bp.setPbf(n.bq);class Dc extends ko{constructor(t,s,h,p,_){super(t,s,h,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,p=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(h,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new n.bp(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.br(p,(_,v,b,E)=>{if(_)s(_);else try{const C=h.getHeaderLength(v);if(C>t)return void(this.request=this.fetchHeader(C,s));h.parseHeader(v),this._isHeaderLoaded=!0;let R=0;for(const k of Object.values(h.layers))R=Math.max(R,k.dataIndex[k.dataIndex.length-1].lastByte);v.byteLength>=R&&(this.entireBuffer=v),s(null,this.entireBuffer||v,b,E)}catch(C){s(C)}}),this.request}fetchBand(t,s,h){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void h(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void h(new Error("Can't fetch tile band without an actor"));let v;const b=(k,D)=>{v.complete(k,D),k?h(k):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},E=(k,D)=>{if(k)return h(k);const O=_.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:D,task:v},b,void 0,!0);this._workQueue.push(()=>{O&&O.cancel(),v.cancel()})},C=p.getLayer(t);if(!C)return void h(new Error(`Unknown sourceLayer "${t}"`));if(C.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const R=C.getDataRange([s]);if(v=p.createDecodingTask(R),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)E(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),D=n.br(k,E);this._fetchQueue.push(()=>{D.cancel(),v.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:p,tileSize:_,buffer:v,offset:b,scale:E}=h.getBandView(s),C=_+2*v,R=new n.r({width:C,height:C},p),k=this.texture;k&&k instanceof n.T&&k.update(R,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:R,buffer:v,offset:b,tileSize:_,format:h.pixelFormat,mix:[E,256*E,65536*E,16777216*E]}}}class Wd{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:s,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,p=s===void 0?0:this.data[h].indexOf(s),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const p of this.data[h])t(p.value)||s.push(p);for(const h of s)this.remove(h.value.tileID,h)}}class kc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},n.l(this.stateChanges[t][p],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])h[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in h)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(h in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][h]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(s!==void 0){const b=String(s),E=n.l({},h[b],p[b]);if(_){const C=_[s];if(C===null)return{};for(const R in C)delete E[R]}return E}const v=n.l({},h,p);if(_)for(const b in _)delete v[b];return v}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),n.l(this.state[p][v],this.stateChanges[p][v]),_[v]=this.state[p][v];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const v in this.state[p])_[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(this.deletedStates[p][v]===null)this.state[p][v]={};else if(this.state[p][v])for(const b of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][b];_[v]=this.state[p][v]}h[p]=h[p]||{},n.l(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in t)t[p].refreshFeatureState(s)}}class is extends n.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Wd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new kc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Xu).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const p in this._tiles)this._isIdRenderable(+p,t,s)&&h.push(this._tiles[p]);return t?h.sort((p,_)=>{const v=p.tileID,b=_.tileID,E=new n.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),C=new n.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-b.overscaledZ||C.y-E.y||C.x-E.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Xu).map(p=>p.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new n.z(p,{tile:t}));else{if(this._source.fire(new n.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const _=s[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const v=this.getTileByID(_);h(t,v),h(v,t)}}function h(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-p.tileID.canonical.x;const b=_.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),C=_.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,v,b),p.neighboringTiles&&p.neighboringTiles[C]&&(p.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,p){for(const _ in this._tiles){let v=this._tiles[_];if(p[_]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>h)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(b=C)}let E=b;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){p[b.key]=b;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const p=t.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,p=Math.ceil(t.height/s)+1,_=Math.floor(h*p*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(b)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,s,h,p,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let b,E=this._source.maxzoom;const C=this.map&&this.map.painter?this.map.painter._terrain:null;if(C&&C.sourceCache===this&&C.attenuationRange()){const D=C.attenuationRange()[0],O=Math.floor(D)-Math.log2(C.getDemUpscale());E>O&&(E=O)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new n.aM(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){const D=t.clone();D.tileCoverLift=this.tileCoverLift,b=D.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new n.aM(1,0,1,0,0)),b.push(new n.aM(1,0,1,1,0)),b.push(new n.aM(1,0,1,0,1)),b.push(new n.aM(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const D=this._source.hasTile.bind(this._source);b=b.filter(O=>D(O))}}else b=[];if(b.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ku(this._source.type)){const D=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),O=Math.min(D,this._source.maxzoom);if(v){const j=t.extendTileCover(b,O);for(const V of j)b.push(V)}else if(_){const j=t.extendTileCover(b,O,this.transform._camera.forward());for(const V of j)b.push(V)}else if(this.castsShadows&&p){const j=t.extendTileCover(b,O,p);for(const V of j)this._shadowCasterTiles[V.key]=!0,b.push(V)}}const R=this._updateRetainedTiles(b);if(Ku(this._source.type)&&b.length!==0){const D={},O={},j=Object.keys(R);for(const q of j){const $=R[q],Q=this._tiles[q];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=n.q.now())continue;const re=this.findLoadedParent($,Math.max($.overscaledZ-is.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),D[re.tileID.key]=re.tileID),O[q]=$}const V=b[b.length-1].overscaledZ;for(const q in this._tiles){const $=this._tiles[q];if(R[q]||!$.hasData())continue;let Q=$.tileID;for(;Q.overscaledZ>V;){Q=Q.scaledTo(Q.overscaledZ-1);const re=this._tiles[Q.key];if(re&&re.hasData()&&O[Q.key]){R[q]=$.tileID;break}}}for(const q in D)R[q]||(this._coveredTiles[q]=!0,R[q]=D[q])}for(const D in R)this._tiles[D].clearFadeHold();const k=n.bs(this._tiles,R);for(const D of k){const O=this._tiles[D];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},p=t.reduce((C,R)=>Math.min(C,R.overscaledZ),1/0),_=t[0].overscaledZ,v=Math.max(_-is.maxOverzooming,this._source.minzoom),b=Math.max(_+is.maxUnderzooming,this._source.minzoom),E={};for(const C of t){const R=this._addTile(C);s[C.key]=C,R.hasData()||p<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,p,b,s);for(const C of t){let R=this._tiles[C.key];if(R.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const D=C.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){s[D.key]=D;continue}}else{const D=C.children(this._source.maxzoom);if(s[D[0].key]&&s[D[1].key]&&s[D[2].key]&&s[D[3].key])continue}let k=R.wasRequested();for(let D=C.overscaledZ-1;D>=v;--D){const O=C.scaledTo(D);if(h[O.key]||(h[O.key]=!0,R=this.getTile(O),!R&&k&&(R=this._addTile(O)),R&&(s[O.key]=O,k=R.wasRequested(),R.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}s.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of s)this._loadedParentTiles[_]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new Dc(t,_,this.transform.tileZoom,p,this._isRaster):new ko(t,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,h||this._source.fire(new n.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const p=[],_=this.transform;if(!_)return p;const v=_.projection.name==="globe",b=n.ay(_.center.lng);for(const E in this._tiles){const C=this._tiles[E];if(h&&C.clearQueryDebugViz(),C.holdingForFade())continue;let R;if(v){const k=C.tileID.canonical;if(k.z===0){const D=[Math.abs(n.aD(b,...ml(k,-1))-b),Math.abs(n.aD(b,...ml(k,1))-b)];R=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(n.aD(b,...ml(k,-1))-b),Math.abs(n.aD(b,...ml(k,0))-b),Math.abs(n.aD(b,...ml(k,1))-b)];R=[D.indexOf(Math.min(...D))-1]}}else R=[0];for(const k of R){const D=t.containsTile(C,_,s,k);D&&p.push(D)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of h)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const v of s){const b=1/(1<<v.canonical.z);_[v.key]=((v.canonical.x+.5)*b+v.wrap-h[0])*p[0]+((v.canonical.y+.5)*b-h[1])*p[1]-h[2]*p[2]}return s.sort((v,b)=>_[v.key]-_[b.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Ku(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const p=this._tiles[t];p&&p.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(t,s))};return void this._source.on("data",E)}const h=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,v=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const E of p){const C=E.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of C)h.set(R.key,R);this.usedForTerrain&&E.updateElevation(!1)}const b=Array.from(h.values());n.bt(b,(E,C)=>{const R=new ko(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,k=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),C(k,R)})},s)}}function Xu(u,t){const s=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||h-s||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Ku(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function ml(u,t){const s=1<<u.z;return[u.x/s+t,(u.x+1)/s+t]}is.maxOverzooming=10,is.maxUnderzooming=3;class wm{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const p=this.style._mergedLayers[h];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:s});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let p=!1;h.type==="fill-extrusion"?p=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(p=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&s.visible,s.visible=p}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,v=this.style.getLayerSourceCache(_);let b=1;_.type==="fill-extrusion"&&(b=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let E=v?v.getTile(s):null;if(!E&&v&&s.canonical.z>v.getSource().minzoom){let C=s.scaledTo(Math.min(v.getSource().maxzoom,s.overscaledZ-1));for(;C.overscaledZ>=v.getSource().minzoom&&(E=v.getTile(C),!E&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:E?E.getBucket(_):null,tileID:E?E.tileID:s,verticalScale:b})}t.hasAnyZOffset=!1;let h=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),v=_.zOffset,b=this._getHeightAtTileOffset(s,_.tileAnchorX,_.tileAnchorY);_.zOffset=b!==Number.NEGATIVE_INFINITY?b:v,h||v===_.zOffset||(h=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,p){let _=s,v=h;if(t.canonical.z!==p.canonical.z){const b=p.canonical,E=1/(1<<t.canonical.z-b.z);_=(s+t.canonical.x*n.aj)*E-b.x*n.aj|0,v=(h+t.canonical.y*n.aj)*E-b.y*n.aj|0}return{tileX:_,tileY:v}}_getHeightAtTileOffset(t,s,h){let p,_;for(let v=0;v<this.layers.length;++v){if(this.layers[v].layer.type!=="fill-extrusion")continue;const{bucket:b,tileID:E,verticalScale:C}=this.currentBuildingBuckets[v];if(!b)continue;const{tileX:R,tileY:k}=this._mapCoordToOverlappingTile(t,s,h,E),D=b.getHeightAtTileCoord(R,k);D&&D.height!==void 0&&(D.hidden?p=D.height:_=Math.max(D.height*C,_||0))}if(_!==void 0)return _;for(let v=0;v<this.layers.length;++v){const b=this.layers[v];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:E,tileID:C}=this.currentBuildingBuckets[v];if(!E)continue;const{tileX:R,tileY:k}=this._mapCoordToOverlappingTile(t,s,h,C),D=E.getHeightAtTileCoord(R,k);if(D&&!D.hidden)return D.height===void 0&&p!==void 0?Math.min(D.maxHeight,p)*D.verticalScale:D.height?D.height*D.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Yu(u,t){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return n.bu.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Ju(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=Yu(u[s],t[u[s].ref]));return u}const Wi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function _l(u,t,s){s.push({command:Wi.addSource,args:[u,t[u]]})}function gl(u,t,s){t.push({command:Wi.removeSource,args:[u]}),s[u]=!0}function Ey(u,t,s,h){gl(u,s,h),_l(u,t,s)}function Tm(u,t,s){let h;for(h in u[s])if(u[s].hasOwnProperty(h)&&h!=="data"&&!n.bv(u[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!n.bv(u[s][h],t[s][h]))return!1;return!0}function Pa(u,t,s,h,p,_){let v;for(v in t=t||{},u=u||{})u.hasOwnProperty(v)&&(n.bv(u[v],t[v])||s.push({command:_,args:[h,v,t[v],p]}));for(v in t)t.hasOwnProperty(v)&&!u.hasOwnProperty(v)&&(n.bv(u[v],t[v])||s.push({command:_,args:[h,v,t[v],p]}))}function Jo(u){return u.id}function yl(u,t){return u[t.id]=t,u}class Sm{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aD(t,0,1);let s=1,h=this._distances[s];const p=t*this.paddedLength+this.padding;for(;h<p&&s<this._distances.length;)h=this._distances[++s];const _=s-1,v=this._distances[_],b=h-v,E=b>0?(p-v)/b:0;return this.points[_].mult(1-E).add(this.points[s].mult(E))}}class Zd{constructor(t,s,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,p,_){this._forEachCell(s,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,s,h,p){this._forEachCell(s-p,h-p,s+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(p)}_insertBoxCell(t,s,h,p,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,s,h,p,_,v){this.circleCells[_].push(v)}_query(t,s,h,p,_,v){if(h<0||t>this.width||p<0||s>this.height)return!_&&[];const b=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=p){if(_)return!0;for(let E=0;E<this.boxKeys.length;E++)b.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const C=this.circles[3*E],R=this.circles[3*E+1],k=this.circles[3*E+2];b.push({key:this.circleKeys[E],x1:C-k,y1:R-k,x2:C+k,y2:R+k})}return v?b.filter(v):b}return this._forEachCell(t,s,h,p,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},v),_?b.length>0:b}_queryCircle(t,s,h,p,_){const v=t-h,b=t+h,E=s-h,C=s+h;if(b<0||v>this.width||C<0||E>this.height)return!p&&[];const R=[];return this._forEachCell(v,E,b,C,this._queryCellCircle,R,{hitTest:p,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},_),p?R.length>0:R}query(t,s,h,p,_){return this._query(t,s,h,p,!1,_)}hitTest(t,s,h,p,_){return this._query(t,s,h,p,!0,_)}hitTestCircle(t,s,h,p){return this._queryCircle(t,s,h,!0,p)}_queryCell(t,s,h,p,_,v,b,E){const C=b.seenUids,R=this.boxCells[_];if(R!==null){const D=this.bboxes;for(const O of R)if(!C.box[O]){C.box[O]=!0;const j=4*O;if(t<=D[j+2]&&s<=D[j+3]&&h>=D[j+0]&&p>=D[j+1]&&(!E||E(this.boxKeys[O]))){if(b.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[O],x1:D[j],y1:D[j+1],x2:D[j+2],y2:D[j+3]})}}}const k=this.circleCells[_];if(k!==null){const D=this.circles;for(const O of k)if(!C.circle[O]){C.circle[O]=!0;const j=3*O;if(this._circleAndRectCollide(D[j],D[j+1],D[j+2],t,s,h,p)&&(!E||E(this.circleKeys[O]))){if(b.hitTest)return v.push(!0),!0;{const V=D[j],q=D[j+1],$=D[j+2];v.push({key:this.circleKeys[O],x1:V-$,y1:q-$,x2:V+$,y2:q+$})}}}}}_queryCellCircle(t,s,h,p,_,v,b,E){const C=b.circle,R=b.seenUids,k=this.boxCells[_];if(k!==null){const O=this.bboxes;for(const j of k)if(!R.box[j]){R.box[j]=!0;const V=4*j;if(this._circleAndRectCollide(C.x,C.y,C.radius,O[V+0],O[V+1],O[V+2],O[V+3])&&(!E||E(this.boxKeys[j])))return v.push(!0),!0}}const D=this.circleCells[_];if(D!==null){const O=this.circles;for(const j of D)if(!R.circle[j]){R.circle[j]=!0;const V=3*j;if(this._circlesCollide(O[V],O[V+1],O[V+2],C.x,C.y,C.radius)&&(!E||E(this.circleKeys[j])))return v.push(!0),!0}}}_forEachCell(t,s,h,p,_,v,b,E){const C=this._convertToXCellCoord(t),R=this._convertToYCellCoord(s),k=this._convertToXCellCoord(h),D=this._convertToYCellCoord(p);for(let O=C;O<=k;O++)for(let j=R;j<=D;j++)if(_.call(this,t,s,h,p,this.xCellCount*j+O,v,b,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,p,_,v){const b=p-t,E=_-s,C=h+v;return C*C>b*b+E*E}_circleAndRectCollide(t,s,h,p,_,v,b){const E=(v-p)/2,C=Math.abs(t-(p+E));if(C>E+h)return!1;const R=(b-_)/2,k=Math.abs(s-(_+R));if(k>R+h)return!1;if(C<=E||k<=R)return!0;const D=C-E,O=k-R;return D*D+O*O<=h*h}}const Ma={unknown:0,flipRequired:1,flipNotRequired:2},Lc=Math.tan(85*Math.PI/180);function vl(u,t,s,h,p,_,v){const b=n.bz();if(s)if(_.name==="globe"){const E=n.bA(p,t);n.az(b,b,E)}else{const E=n.bB([],v);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3],h||n.by(b,b,p.angle)}else n.az(b,p.labelPlaneMatrix,u);return b}function Qu(u,t,s,h,p,_,v){const b=vl(u,t,s,h,p,_,v);return _.name==="globe"&&s||(b[2]=b[6]=b[10]=b[14]=0),b}function Xd(u,t,s,h,p,_,v){if(s){if(_.name==="globe"){const b=vl(u,t,s,h,p,_,v);return n.bi(b,b),n.az(b,u,b),b}{const b=n.bw(u),E=n.bx([]);return E[0]=v[0],E[1]=v[1],E[4]=v[2],E[5]=v[3],n.az(b,b,E),h||n.by(b,b,-p.angle),b}}return p.glCoordMatrix}function xs(u,t,s,h){const p=[u,t,s,1];s?n.aA(p,p,h):Em(p,p,h);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Qo(u,t){return Math.min(.5+u/t*.5,1.5)}function Kd(u,t){const s=u[0]/u[3],h=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Yd(u,t,s,h,p,_,v,b,E,C){const R=s.transform,k=h?u.textSizeData:u.iconSizeData,D=n.bH(k,s.transform.zoom),O=R.projection.name==="globe",j=[256/s.width*2+1,256/s.height*2+1],V=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;V.clear();let q=null;O&&(q=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const $=u.lineVertexArray,Q=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,re=s.transform.width/s.transform.height;let oe,fe=!1;for(let ue=0;ue<Q.length;ue++){const he=Q.get(ue),{numGlyphs:ae,writingMode:_e}=he;if(_e!==n.bI.vertical||fe||oe===n.bI.horizontal||(fe=!0),oe=_e,(he.hidden||_e===n.bI.vertical)&&!fe){Ji(ae,V);continue}fe=!1;const ge=new n.P(he.tileAnchorX,he.tileAnchorY);let{x:Oe,y:Re,z:Je}=R.projection.projectTilePoint(ge.x,ge.y,C.canonical);if(E){const[Rt,Ut,Ct]=E(ge);Oe+=Rt,Re+=Ut,Je+=Ct}const Xe=[Oe,Re,Je,1];if(n.aA(Xe,Xe,t),!Kd(Xe,j)){Ji(ae,V);continue}const ft=Xe[3],Me=Qo(s.transform.getCameraToCenterDistance(R.projection),ft),Fe=n.bJ(k,D,he),Ce=v?Fe/Me:Fe*Me,tt=xs(Oe,Re,Je,p);if(tt[3]<=0){Ji(ae,V);continue}let Ve={};const st=n.al(u.layers[0].layout.get("text-max-angle")),Qe=Math.cos(st),ot=v?null:E,at=bs(he,Ce,!1,b,t,p,_,u.glyphOffsetArray,$,V,q,tt,ge,Ve,re,ot,R.projection,C,v,Qe);fe=at.useVertical,ot&&at.needsFlipping&&(Ve={}),(at.notEnoughRoom||fe||at.needsFlipping&&bs(he,Ce,!0,b,t,p,_,u.glyphOffsetArray,$,V,q,tt,ge,Ve,re,ot,R.projection,C,v,Qe).notEnoughRoom)&&Ji(ae,V)}h?(u.text.dynamicLayoutVertexBuffer.updateData(V),q&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(q)):(u.icon.dynamicLayoutVertexBuffer.updateData(V),q&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(q))}function eh(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q){const{lineStartIndex:$,glyphStartIndex:Q,segment:re}=b,oe=Q+b.numGlyphs,fe=$+b.lineLength,ue=t.getoffsetX(Q),he=t.getoffsetX(oe-1),ae=zc(u*ue,s,h,p,_,v,re,$,fe,E,C,R,k,D,!0,O,j,V,q);if(!ae)return null;const _e=zc(u*he,s,h,p,_,v,re,$,fe,E,C,R,k,D,!0,O,j,V,q);return _e?{first:ae,last:_e}:null}function Ra(u,t,s,h){return u===n.bI.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:u===n.bI.vertical?h>0?{needsFlipping:!0}:null:t!==Ma.unknown&&function(p,_){return p===0||Math.abs(_/p)>Lc}(s,h)?t===Ma.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function bs(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q,re){const oe=t/24,fe=u.lineOffsetX*oe,ue=u.lineOffsetY*oe,{lineStartIndex:he,glyphStartIndex:ae,numGlyphs:_e,segment:ge,writingMode:Oe,flipState:Re}=u,Je=he+u.lineLength,Xe=ft=>{if(R){const[tt,Ve,st]=ft.up,Qe=C.length;n.bK(R,Qe+0,tt,Ve,st),n.bK(R,Qe+1,tt,Ve,st),n.bK(R,Qe+2,tt,Ve,st),n.bK(R,Qe+3,tt,Ve,st)}const[Me,Fe,Ce]=ft.point;n.bL(C,Me,Fe,Ce,ft.angle)};if(_e>1){const ft=eh(oe,b,fe,ue,s,k,D,u,E,_,O,V,!1,q,$,Q,re);if(!ft)return{notEnoughRoom:!0};if(h&&!s){let[Me,Fe,Ce]=ft.first.point,[tt,Ve,st]=ft.last.point;[Me,Fe]=xs(Me,Fe,Ce,v),[tt,Ve]=xs(tt,Ve,st,v);const Qe=Ra(Oe,Re,(tt-Me)*j,Ve-Fe);if(u.flipState=Qe&&Qe.needsFlipping?Ma.flipRequired:Ma.flipNotRequired,Qe)return Qe}Xe(ft.first);for(let Me=ae+1;Me<ae+_e-1;Me++){const Fe=zc(oe*b.getoffsetX(Me),fe,ue,s,k,D,ge,he,Je,E,_,O,V,!1,!1,q,$,Q,re);if(!Fe)return C.length-=4*(Me-ae),{notEnoughRoom:!0};Xe(Fe)}Xe(ft.last)}else{if(h&&!s){const Me=xs(D.x,D.y,0,p),Fe=he+ge+1,Ce=new n.P(E.getx(Fe),E.gety(Fe)),tt=xs(Ce.x,Ce.y,0,p),Ve=tt[3]>0?tt:th(D,Ce,Me,1,p,void 0,q,$.canonical),st=Ra(Oe,Re,(Ve[0]-Me[0])*j,Ve[1]-Me[1]);if(u.flipState=st&&st.needsFlipping?Ma.flipRequired:Ma.flipNotRequired,st)return st}const ft=zc(oe*b.getoffsetX(ae),fe,ue,s,k,D,ge,he,Je,E,_,O,V,!1,!1,q,$,Q,re);if(!ft)return{notEnoughRoom:!0};Xe(ft)}return{}}function Jd(u,t,s,h,p){const{x:_,y:v,z:b}=h.projectTilePoint(u.x,u.y,t);if(!p)return xs(_,v,b,s);const[E,C,R]=p(u);return xs(_+E,v+C,b+R,s)}function th(u,t,s,h,p,_,v,b){const E=Jd(u.sub(t)._unit()._add(u),b,p,v,_);return n.at(E,s,E),n.au(E,E),n.bF(E,s,E,h)}function zc(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q){const re=h?u-t:u+t;let oe=re>0?1:-1,fe=0;h&&(oe*=-1,fe=Math.PI),oe<0&&(fe+=Math.PI);let ue=b+v+(oe>0?0:1)|0,he=p,ae=p,_e=0,ge=0;const Oe=Math.abs(re),Re=[],Je=[];let Xe=_,ft=Xe,Me=n.bC([]);const Fe=()=>th(ft,Xe,ae,Oe-_e+1,R,D,V,q.canonical);for(;_e+ge<=Oe;){if(ue+=oe,ue<b||ue>=E)return null;if(ae=he,ft=Xe,Re.push(ae),O&&Je.push(ft),Xe=new n.P(C.getx(ue),C.gety(ue)),he=k[ue],!he){const Ct=Jd(Xe,q.canonical,R,V,D);he=Ct[3]>0?k[ue]=Ct:Fe()}_e+=ge;const Rt=n.at([],he,ae),Ut=n.bD(ae,he);if(s&&Ut>0&&ge>0&&n.bE(Me,Rt)/(ge*Ut)<Q)return null;ge=Ut,Me=Rt}j&&D&&(k[ue]&&(he=Fe(),ge=n.bD(ae,he),Me=n.at([],he,ae)),k[ue]=he);const Ce=(Oe-_e)/ge,tt=Xe.sub(ft)._mult(Ce)._add(ft),Ve=n.bF([],ae,Me,Ce);let st=[0,0,1],Qe=Me[0],ot=Me[1];if($&&(st=V.upVector(q.canonical,tt.x,tt.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Rt=[st[2],0,-st[0]],Ut=n.bG([],st,Rt);n.au(Rt,Rt),n.au(Ut,Ut),Qe=n.bE(Me,Rt),ot=n.bE(Me,Ut)}if(s){const Rt=n.bG([],st,Me);n.au(Rt,Rt),n.bF(Ve,Ve,Rt,s*oe)}const at=fe+Math.atan2(ot,Qe);return Re.push(Ve),O&&Je.push(tt),{point:Ve,angle:at,path:Re,tilePath:Je,up:st}}function Ji(u,t){const s=t.length,h=s+4*u;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function Em(u,t,s){const h=t[0],p=t[1];return u[0]=s[0]*h+s[4]*p+s[12],u[1]=s[1]*h+s[5]*p+s[13],u[3]=s[3]*h+s[7]*p+s[15],u}const Kt=100;class Am{constructor(t,s,h=new Zd(t.width+200,t.height+200,25),p=new Zd(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Kt,this.screenBottomBoundary=t.height+Kt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,p,_,v,b,E){let C=h.projectedAnchorX,R=h.projectedAnchorY,k=h.projectedAnchorZ;const D=h.elevation,O=h.tileID,j=t.getProjection();if(D&&O){const[ue,he,ae]=j.upVector(O.canonical,h.tileAnchorX,h.tileAnchorY),_e=j.upVectorScale(O.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=ue*D*_e,R+=he*D*_e,k+=ae*D*_e}const V=this.projectAndGetPerspectiveRatio(b,C,R,k,h.tileID,j.name==="globe"||!!D||this.transform.pitch>0,j),q=v*V.perspectiveRatio,$=(h.x1*s+p.x-h.padding)*q+V.point.x,Q=(h.y1*s+p.y-h.padding)*q+V.point.y,re=(h.x2*s+p.x+h.padding)*q+V.point.x,oe=(h.y2*s+p.y+h.padding)*q+V.point.y,fe=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid($,Q,re,oe)||!_&&this.grid.hitTest($,Q,re,oe,E)||fe?{box:[],offscreen:!1,occluded:V.occluded}:{box:[$,Q,re,oe],offscreen:this.isOffscreen($,Q,re,oe),occluded:!1}}placeCollisionCircles(t,s,h,p,_,v,b,E,C,R,k,D,O,j,V){const q=[],$=this.transform.elevation,Q=t.getProjection(),re=$?$.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,Q):null,oe=new n.P(h.tileAnchorX,h.tileAnchorY);let{x:fe,y:ue,z:he}=Q.projectTilePoint(oe.x,oe.y,V.canonical);if(re){const[st,Qe,ot]=re(oe);fe+=st,ue+=Qe,he+=ot}const ae=Q.name==="globe",_e=this.projectAndGetPerspectiveRatio(b,fe,ue,he,V,ae||!!$||this.transform.pitch>0,Q),{perspectiveRatio:ge}=_e,Oe=(k?v/ge:v*ge)/n.bO,Re=xs(fe,ue,he,E),Je=h.lineOffsetX*Oe,Xe=h.lineOffsetY*Oe,ft=n.al(t.layers[0].layout.get("text-max-angle")),Me=Math.cos(ft),Fe=_e.signedDistanceFromCamera>0?eh(Oe,_,Je,Xe,!1,Re,oe,h,p,E,{},$&&!k?re:null,k&&!!$,Q,V,k,Me):null;let Ce=!1,tt=!1,Ve=!0;if(Fe&&!_e.occluded){const st=.5*O*ge+j,Qe=new n.P(-100,-100),ot=new n.P(this.screenRightBoundary,this.screenBottomBoundary),at=new Sm,{first:Rt,last:Ut}=Fe,Ct=Rt.path.length;let Vt=[];for(let ui=Ct-1;ui>=1;ui--)Vt.push(Rt.path[ui]);for(let ui=1;ui<Ut.path.length;ui++)Vt.push(Ut.path[ui]);const Lt=2.5*st;C&&(Vt=Vt.map(([ui,Di,ur],sr)=>(re&&!ae&&(ur=re(sr<Ct-1?Rt.tilePath[Ct-1-sr]:Ut.tilePath[sr-Ct+2])[2]),xs(ui,Di,ur,C))),Vt.some(ui=>ui[3]<=0)&&(Vt=[]));let ei=[];if(Vt.length>0){let ui=1/0,Di=-1/0,ur=1/0,sr=-1/0;for(const Li of Vt)ui=Math.min(ui,Li[0]),ur=Math.min(ur,Li[1]),Di=Math.max(Di,Li[0]),sr=Math.max(sr,Li[1]);Di>=Qe.x&&ui<=ot.x&&sr>=Qe.y&&ur<=ot.y&&(ei=[Vt.map(Li=>new n.P(Li[0],Li[1]))],(ui<Qe.x||Di>ot.x||ur<Qe.y||sr>ot.y)&&(ei=n.bM(ei,Qe.x,Qe.y,ot.x,ot.y)))}for(const ui of ei){at.reset(ui,.25*st);let Di=0;Di=at.length<=.5*st?1:Math.ceil(at.paddedLength/Lt)+1;for(let ur=0;ur<Di;ur++){const sr=ur/Math.max(Di-1,1),Li=at.lerp(sr),Xr=Li.x+Kt,Ur=Li.y+Kt;q.push(Xr,Ur,st,0);const gi=Xr-st,Vi=Ur-st,Zi=Xr+st,hr=Ur+st;if(Ve=Ve&&this.isOffscreen(gi,Vi,Zi,hr),tt=tt||this.isInsideGrid(gi,Vi,Zi,hr),!s&&this.grid.hitTestCircle(Xr,Ur,st,D)&&(Ce=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!R&&Ce||!tt?[]:q,offscreen:Ve,collisionDetected:Ce,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,p=1/0,_=-1/0,v=-1/0;for(const R of t){const k=new n.P(R.x+Kt,R.y+Kt);h=Math.min(h,k.x),p=Math.min(p,k.y),_=Math.max(_,k.x),v=Math.max(v,k.y),s.push(k)}const b=this.grid.query(h,p,_,v).concat(this.ignoredGrid.query(h,p,_,v)),E={},C={};for(const R of b){const k=R.key;if(E[k.bucketInstanceId]===void 0&&(E[k.bucketInstanceId]={}),E[k.bucketInstanceId][k.featureIndex])continue;const D=[new n.P(R.x1,R.y1),new n.P(R.x2,R.y1),new n.P(R.x2,R.y2),new n.P(R.x1,R.y2)];n.bN(s,D)&&(E[k.bucketInstanceId][k.featureIndex]=!0,C[k.bucketInstanceId]===void 0&&(C[k.bucketInstanceId]=[]),C[k.bucketInstanceId].push(k.featureIndex))}return C}insertCollisionBox(t,s,h,p,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,p,_){const v=s?this.ignoredGrid:this.grid,b={bucketInstanceId:h,featureIndex:p,collisionGroupID:_};for(let E=0;E<t.length;E+=4)v.insertCircle(b,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,s,h,p,_,v,b){const E=[s,h,p,1];let C=!1;p||this.transform.pitch>0?(n.aA(E,E,t),this.fogState&&_&&b.name!=="globe"&&(C=function(D,O,j,V,q,$){const Q=$.calculateFogTileMatrix(q),re=[O,j,V];return n.ad(re,re,Q),Bt(D,n.ae(re),$.pitch,$._fov)}(this.fogState,s,h,p,_.toUnwrapped(),this.transform)>.9)):Em(E,E,t);const R=E[3];return{point:new n.P((E[0]/R+1)/2*this.transform.width+Kt,(-E[1]/R+1)/2*this.transform.height+Kt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/R*.5,1.5),signedDistanceFromCamera:R,occluded:v&&E[2]>R||C}}isOffscreen(t,s,h,p){return h<Kt||t>=this.screenRightBoundary||p<Kt||s>this.screenBottomBoundary}isInsideGrid(t,s,h,p){return h>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=n.bx([]);return n.bo(t,t,[-100,-100,0]),t}}function ih(u,t,s){const h=t.createTileMatrix(u,u.worldSize,s.toUnwrapped());return n.az(new Float32Array(16),u.projMatrix,h)}function rh(u,t,s){if(t.projection.name===s.projection.name)return u.projMatrix;const h=s.clone();return h.setProjection(t.projection),ih(h,t.getProjection(),u)}function Oc(u,t,s){return t.name===s.projection.name?u.projMatrix:ih(s,t,u)}class Us{constructor(t,s,h,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Da{constructor(t,s,h,p,_,v=!1){this.text=new Us(t?t.text:null,s,h,_),this.icon=new Us(t?t.icon:null,s,p,_),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ea{constructor(t,s,h,p=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=p}}class Ht{constructor(){this.invProjMatrix=n.bz(),this.viewportMatrix=n.bz(),this.circles=[]}}class fr{constructor(t,s,h,p,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class nr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function fs(u,t,s,h,p){const{horizontalAlign:_,verticalAlign:v}=n.bV(u),b=-(_-.5)*t,E=-(v-.5)*s,C=n.bU(u,h);return new n.P(b+C[0]*p,E+C[1]*p)}function ta(u,t,s,h,p){const _=new n.P(u,t);return s&&_._rotate(h?p:-p),_}class ir{constructor(t,s,h,p,_,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Am(this.transform,_),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new nr(h),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,p,_=1){const v=h.getBucket(s),b=h.latestFeatureIndex;if(!v||!b||s.fqid!==v.layerIds[0])return;const E=v.layers[0].layout,C=v.layers[0].paint,R=h.collisionBoxArray,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/n.aj,O=h.tileID.toUnwrapped();this.transform.setProjection(v.projection);const j=(V=h.tileID,q=v.getProjection(),$=this.transform,q.name===this.projection?$.calculateProjMatrix(V.toUnwrapped()):ih($,q,V));var V,q,$;const Q=E.get("text-pitch-alignment")==="map",re=E.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const oe=s.dynamicFilter(),fe=s.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(h),he=Qu(j,h.tileID.canonical,Q,re,this.transform,v.getProjection(),ue);let ae=null;if(Q){const Fe=Xd(j,h.tileID.canonical,Q,re,this.transform,v.getProjection(),ue);ae=n.az([],this.transform.labelPlaneMatrix,Fe)}let _e=null;oe&&h.latestFeatureIndex&&(_e={unwrappedTileID:O,dynamicFilter:oe,dynamicFilterNeedsFeature:fe}),this.retainedQueryData[v.bucketInstanceId]=new fr(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,h.tileID);const[ge,Oe]=v.layers[0].layout.get("text-size-scale-range"),Re=n.aD(_,ge,Oe),[Je,Xe]=E.get("icon-size-scale-range"),ft=n.aD(_,Je,Xe),Me={bucket:v,layout:E,paint:C,posMatrix:j,textLabelPlaneMatrix:he,labelToScreenMatrix:ae,clippingData:_e,scale:k,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:n.bH(v.textSizeData,this.transform.zoom,Re),partiallyEvaluatedIconSize:n.bH(v.iconSizeData,this.transform.zoom,ft),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(p)for(const Fe of v.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:tt,symbolInstanceEnd:Ve}=Fe;t.push({sortKey:Ce,symbolInstanceStart:tt,symbolInstanceEnd:Ve,parameters:Me})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q){const{textOffset0:re,textOffset1:oe,crossTileID:fe}=D,ue=[re,oe],he=fs(t,h,p,ue,_),ae=this.collisionIndex.placeCollisionBox(j,_,s,ta(he.x,he.y,v,b,this.transform.angle),k,E,C,R.predicate);if(q){const _e=j.getSymbolInstanceIconSize(Q,this.transform.zoom,D.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,_e,q,ta(he.x,he.y,v,b,this.transform.angle),k,E,C,R.predicate).box.length===0)return}if(ae.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(_e=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:ue,width:h,height:p,anchor:t,textScale:_,prevAnchor:_e},this.markUsedJustification(j,t,D,V),j.allowVerticalPlacement&&(this.markUsedOrientation(j,V,D),this.placedOrientations[fe]=V),{shift:he,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,s,h,p,_=1){const{bucket:v,layout:b,paint:E,posMatrix:C,textLabelPlaneMatrix:R,labelToScreenMatrix:k,clippingData:D,textPixelRatio:O,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:$,collisionGroup:Q,latestFeatureIndex:re}=t.parameters,oe=b.get("text-optional"),fe=b.get("icon-optional"),ue=b.get("text-allow-overlap"),he=b.get("icon-allow-overlap"),ae=b.get("text-rotation-alignment")==="map",_e=b.get("text-pitch-alignment")==="map",ge=E.get("symbol-z-offset"),Oe=b.get("symbol-elevation-reference")==="sea",[Re,Je]=b.get("text-size-scale-range"),[Xe,ft]=b.get("icon-size-scale-range"),Me=n.aD(_,Re,Je),Fe=n.aD(_,Xe,ft);this.transform.setProjection(v.projection);let Ce=ue&&(he||!v.hasIconData()||fe),tt=he&&(ue||!v.hasTextData()||oe);const Ve=!ge.isConstant();!v.collisionArrays&&V&&v.deserializeCollisionBoxes(V),h&&p&&v.updateCollisionDebugBuffers(this.transform.zoom,V,Me,Fe);const st=(Qe,ot,at)=>{const{crossTileID:Rt,numVerticalGlyphVertices:Ut}=Qe;let Ct=null;if(D&&D.dynamicFilterNeedsFeature||Ve){const Hi=this.retainedQueryData[v.bucketInstanceId];Ct=re.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:Hi.bucketIndex,sourceLayerIndex:Hi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(D&&!(0,D.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ct,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new n.P(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[Rt]=new ea(!1,!1,!1,!0),void s.add(Rt);const Vt=ge.evaluate(Ct,{});if(s.has(Rt))return;if(j)return void(this.placements[Rt]=new ea(!1,!1,!1));let Lt=!1,ei=!1,ui=!0,Di=!1,ur=!1,sr=null,Li={box:null,offscreen:null,occluded:null},Xr={box:null},Ur=null,gi=null,Vi=null,Zi=0,hr=0,un=0;at.textFeatureIndex?Zi=at.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(Zi=Qe.featureIndex),at.verticalTextFeatureIndex&&(hr=at.verticalTextFeatureIndex);const Qr=Hi=>{Hi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Lr=this.transform.elevation;Hi.elevation=Oe?Vt:Vt+(Lr?Lr.getAtTileOffset(Hi.tileID,Hi.tileAnchorX,Hi.tileAnchorY):0),Hi.elevation+=Qe.zOffset},ln=at.textBox;if(ln){Qr(ln);const Hi=Qi=>{let Nr=n.bI.horizontal;if(v.allowVerticalPlacement&&!Qi&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[Rt];Rn&&(this.placedOrientations[Rt]=Rn,Nr=Rn,this.markUsedOrientation(v,Nr,Qe))}return Nr},Lr=(Qi,Nr)=>{if(v.allowVerticalPlacement&&Ut>0&&at.verticalTextBox){for(const Rn of v.writingModes)if(Rn===n.bI.vertical?(Li=Nr(),Xr=Li):Li=Qi(),Li&&Li.box&&Li.box.length)break}else Li=Qi()};if(b.get("text-variable-anchor")){let Qi=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt]){const Ar=this.prevPlacement.variableOffsets[Rt];Qi.indexOf(Ar.anchor)>0&&(Qi=Qi.filter(zn=>zn!==Ar.anchor),Qi.unshift(Ar.anchor))}const Nr=(Ar,zn,on)=>{const Nn=v.getSymbolInstanceTextSize(q,Qe,this.transform.zoom,ot),so=(Ar.x2-Ar.x1)*Nn+2*Ar.padding,Uo=(Ar.y2-Ar.y1)*Nn+2*Ar.padding,Ts=Qe.hasIconTextFit&&!he?zn:null;Ts&&Qr(Ts);let Hs={box:[],offscreen:!1,occluded:!1};const vo=ue?2*Qi.length:Qi.length;for(let xo=0;xo<vo;++xo){const oo=this.attemptAnchorPlacement(Qi[xo%Qi.length],Ar,so,Uo,Nn,ae,_e,O,C,Q,xo>=Qi.length,Qe,ot,v,on,Ts,q,$);if(oo&&(Hs=oo.placedGlyphBoxes,Hs&&Hs.box&&Hs.box.length)){Lt=!0,sr=oo.shift;break}}return Hs};Lr(()=>Nr(ln,at.iconBox,n.bI.horizontal),()=>{const Ar=at.verticalTextBox;return Ar&&Qr(Ar),v.allowVerticalPlacement&&!(Li&&Li.box&&Li.box.length)&&Ut>0&&Ar?Nr(Ar,at.verticalIconBox,n.bI.vertical):{box:null,offscreen:null,occluded:null}}),Li&&(Lt=Li.box,ui=Li.offscreen,Di=Li.occluded);const Rn=Hi(!(!Li||!Li.box));if(!Lt&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[Rt];Ar&&(this.variableOffsets[Rt]=Ar,this.markUsedJustification(v,Ar.anchor,Qe,Rn))}}else{const Qi=(Nr,Rn)=>{const Ar=v.getSymbolInstanceTextSize(q,Qe,this.transform.zoom,ot,_),zn=this.collisionIndex.placeCollisionBox(v,Ar,Nr,new n.P(0,0),ue,O,C,Q.predicate);return zn&&zn.box&&zn.box.length&&(this.markUsedOrientation(v,Rn,Qe),this.placedOrientations[Rt]=Rn),zn};Lr(()=>Qi(ln,n.bI.horizontal),()=>{const Nr=at.verticalTextBox;return v.allowVerticalPlacement&&Ut>0&&Nr?(Qr(Nr),Qi(Nr,n.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Hi(!!(Li&&Li.box&&Li.box.length))}}if(Ur=Li,Lt=Ur&&Ur.box&&Ur.box.length>0,ui=Ur&&Ur.offscreen,Di=Ur&&Ur.occluded,Qe.useRuntimeCollisionCircles){const Hi=v.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),Lr=n.bJ(v.textSizeData,q,Hi),Qi=b.get("text-padding");gi=this.collisionIndex.placeCollisionCircles(v,ue,Hi,v.lineVertexArray,v.glyphOffsetArray,Lr,C,R,k,h,_e,Q.predicate,Qe.collisionCircleDiameter*Lr/n.bO,Qi,this.retainedQueryData[v.bucketInstanceId].tileID),Lt=ue||gi.circles.length>0&&!gi.collisionDetected,ui=ui&&gi.offscreen,Di=gi.occluded}if(at.iconFeatureIndex&&(un=at.iconFeatureIndex),at.iconBox){const Hi=Lr=>{Qr(Lr);const Qi=Qe.hasIconTextFit&&sr?ta(sr.x,sr.y,ae,_e,this.transform.angle):new n.P(0,0),Nr=v.getSymbolInstanceIconSize($,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Nr,Lr,Qi,he,O,C,Q.predicate)};Xr&&Xr.box&&Xr.box.length&&at.verticalIconBox?(Vi=Hi(at.verticalIconBox),ei=Vi.box.length>0):(Vi=Hi(at.iconBox),ei=Vi.box.length>0),ui=ui&&Vi.offscreen,ur=Vi.occluded}const Br=oe||Qe.numHorizontalGlyphVertices===0&&Ut===0,wi=fe||Qe.numIconVertices===0;if(Br||wi?wi?Br||(ei=ei&&Lt):Lt=ei&&Lt:ei=Lt=ei&&Lt,Lt&&Ur&&Ur.box&&this.collisionIndex.insertCollisionBox(Ur.box,b.get("text-ignore-placement"),v.bucketInstanceId,Xr&&Xr.box&&hr?hr:Zi,Q.ID),ei&&Vi&&this.collisionIndex.insertCollisionBox(Vi.box,b.get("icon-ignore-placement"),v.bucketInstanceId,un,Q.ID),gi&&(Lt&&this.collisionIndex.insertCollisionCircles(gi.circles,b.get("text-ignore-placement"),v.bucketInstanceId,Zi,Q.ID),h)){const Hi=v.bucketInstanceId;let Lr=this.collisionCircleArrays[Hi];Lr===void 0&&(Lr=this.collisionCircleArrays[Hi]=new Ht);for(let Qi=0;Qi<gi.circles.length;Qi+=4)Lr.circles.push(gi.circles[Qi+0]),Lr.circles.push(gi.circles[Qi+1]),Lr.circles.push(gi.circles[Qi+2]),Lr.circles.push(gi.collisionDetected?1:0)}const kr=v.projection.name!=="globe";Ce=Ce&&(kr||!Di),tt=tt&&(kr||!ur),this.placements[Rt]=new ea(Lt||Ce,ei||tt,ui||v.justReloaded),s.add(Rt)};if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.elevationType==="road"&&v.updateRoadElevation(),v.updateZOffset(),v.sortFeaturesByY){const Qe=v.getSortedSymbolIndexes(this.transform.angle);for(let ot=Qe.length-1;ot>=0;--ot){const at=Qe[ot];st(v.symbolInstances.get(at),at,v.collisionArrays[at])}v.hasAnyZOffset&&n.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Qe=v.getSortedIndexesByZOffset();for(let ot=0;ot<Qe.length;++ot){const at=Qe[ot];st(v.symbolInstances.get(at),at,v.collisionArrays[at])}}else for(let Qe=t.symbolInstanceStart;Qe<t.symbolInstanceEnd;Qe++)st(v.symbolInstances.get(Qe),Qe,v.collisionArrays[Qe]);if(h&&v.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[v.bucketInstanceId];n.bi(Qe.invProjMatrix,C),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,s,h,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E,crossTileID:C}=h,R=n.bT(s),k=p===n.bI.vertical?E:R==="left"?_:R==="center"?v:R==="right"?b:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=k>=0&&_!==k?0:C),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=k>=0&&v!==k?0:C),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=k>=0&&b!==k?0:C),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=k>=0&&E!==k?0:C)}markUsedOrientation(t,s,h){const p=s===n.bI.horizontal||s===n.bI.horizontalOnly?s:0,_=s===n.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C}=h,R=t.text.placedSymbolArray;v>=0&&(R.get(v).placedOrientation=p),b>=0&&(R.get(b).placedOrientation=p),E>=0&&(R.get(E).placedOrientation=p),C>=0&&(R.get(C).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],R=_[E];R?(this.opacities[E]=new Da(R,p,C.text,C.icon,null,C.clipped),h=h||C.text!==R.text.placed||C.icon!==R.icon.placed):(this.opacities[E]=new Da(null,p,C.text,C.icon,C.skipFade,C.clipped),h=h||C.text||C.icon)}for(const E in _){const C=_[E];if(!this.opacities[E]){const R=new Da(C,p,!1,!1);R.isHidden()||(this.opacities[E]=R,h=h||C.text.placed||C.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,p){const _=new Set;for(const v of s){const b=v.getBucket(t);b&&v.latestFeatureIndex&&t.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,_,v,v.collisionBoxArray,h,p,v.tileID,t.scope),b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,v.tileID),b.elevationType==="road"&&b.updateRoadElevation(),b.updateZOffset())}}updateBucketOpacities(t,s,h,p,_,v,b,E){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const C=t.layers[0].layout,R=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),D=new Da(null,0,!1,!1,!0),O=C.get("text-allow-overlap"),j=C.get("icon-allow-overlap"),V=C.get("text-variable-anchor"),q=C.get("text-rotation-alignment")==="map",$=C.get("text-pitch-alignment")==="map",Q=R.get("symbol-z-offset"),re=C.get("symbol-elevation-reference")==="sea",oe=!Q.isConstant(),fe=new Da(null,0,O&&(j||!t.hasIconData()||C.get("icon-optional")),j&&(O||!t.hasTextData()||C.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ue=(ae,_e,ge)=>{for(let Oe=0;Oe<_e/4;Oe++)ae.opacityVertexArray.emplaceBack(ge)};let he=0;v&&t.updateReplacement(b,v);for(let ae=0;ae<t.symbolInstances.length;ae++){const _e=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:Oe,crossTileID:Re,numIconVertices:Je,tileAnchorX:Xe,tileAnchorY:ft}=_e;let Me=null;const Fe=this.retainedQueryData[t.bucketInstanceId];oe&&_e&&Fe&&(Me=h.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ce=Q.evaluate(Me,{}),tt=s.has(Re);let Ve=this.opacities[Re];tt?Ve=D:Ve||(Ve=fe,this.opacities[Re]=Ve),s.add(Re);const st=ge>0||Oe>0,Qe=Je>0,ot=this.placedOrientations[Re],at=ot===n.bI.vertical,Rt=ot===n.bI.horizontal||ot===n.bI.horizontalOnly;!st&&!Qe||Ve.isHidden()||he++;let Ut=!1;if((st||Qe)&&v)for(const Ct of t.activeReplacements){if(n.bP(Ct,_,n.bQ.Symbol,E)||Ct.min.x>Xe||Xe>Ct.max.x||Ct.min.y>ft||ft>Ct.max.y)continue;const Vt=n.bR(Xe,ft,b.canonical,Ct.footprintTileId.canonical);if(Ut=n.bS(Vt,Ct.footprint),Ut)break}if(st){const Ct=Ut?ia:xl(Ve.text);ue(t.text,ge,at?ia:Ct),ue(t.text,Oe,Rt?ia:Ct);const Vt=Ve.text.isHidden(),{leftJustifiedTextSymbolIndex:Lt,centerJustifiedTextSymbolIndex:ei,rightJustifiedTextSymbolIndex:ui,verticalPlacedTextSymbolIndex:Di}=_e,ur=t.text.placedSymbolArray,sr=Vt||at?1:0;Lt>=0&&(ur.get(Lt).hidden=sr),ei>=0&&(ur.get(ei).hidden=sr),ui>=0&&(ur.get(ui).hidden=sr),Di>=0&&(ur.get(Di).hidden=Vt||Rt?1:0);const Li=this.variableOffsets[Re];Li&&this.markUsedJustification(t,Li.anchor,_e,ot);const Xr=this.placedOrientations[Re];Xr&&(this.markUsedJustification(t,"left",_e,Xr),this.markUsedOrientation(t,Xr,_e))}if(Qe){const Ct=Ut?ia:xl(Ve.icon),{placedIconSymbolIndex:Vt,verticalPlacedIconSymbolIndex:Lt}=_e,ei=t.icon.placedSymbolArray,ui=Ve.icon.isHidden()?1:0;Vt>=0&&(ue(t.icon,Je,at?ia:Ct),ei.get(Vt).hidden=ui),Lt>=0&&(ue(t.icon,_e.numVerticalIconVertices,Rt?ia:Ct),ei.get(Lt).hidden=ui)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[ae];if(Ct){let Vt=new n.P(0,0),Lt=!0;if(Ct.textBox||Ct.verticalTextBox){if(V){const ui=this.variableOffsets[Re];ui?(Vt=fs(ui.anchor,ui.width,ui.height,ui.textOffset,ui.textScale),q&&Vt._rotate($?this.transform.angle:-this.transform.angle)):Lt=!1}k&&(Lt=!Ve.clipped),Ct.textBox&&ka(t.textCollisionBox.collisionVertexArray,Ve.text.placed,!Lt||at,Ce,re,Vt.x,Vt.y),Ct.verticalTextBox&&ka(t.textCollisionBox.collisionVertexArray,Ve.text.placed,!Lt||Rt,Ce,re,Vt.x,Vt.y)}const ei=Lt&&!!(!Rt&&Ct.verticalIconBox);Ct.iconBox&&ka(t.iconCollisionBox.collisionVertexArray,Ve.icon.placed,ei,Ce,re,_e.hasIconTextFit?Vt.x:0,_e.hasIconTextFit?Vt.y:0),Ct.verticalIconBox&&ka(t.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!ei,Ce,re,_e.hasIconTextFit?Vt.x:0,_e.hasIconTextFit?Vt.y:0)}}}if(t.fullyClipped=he===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ae.invProjMatrix,t.placementViewportMatrix=ae.viewportMatrix,t.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function ka(u,t,s,h,p,_,v){u.emplaceBack(t?1:0,s?1:0,_||0,v||0,h,p?1:0),u.emplaceBack(t?1:0,s?1:0,_||0,v||0,h,p?1:0),u.emplaceBack(t?1:0,s?1:0,_||0,v||0,h,p?1:0),u.emplaceBack(t?1:0,s?1:0,_||0,v||0,h,p?1:0)}const Fc=Math.pow(2,25),Bc=Math.pow(2,24),rs=Math.pow(2,17),pn=Math.pow(2,16),Ay=Math.pow(2,9),Nc=Math.pow(2,8),Qd=Math.pow(2,1);function xl(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*Fc+t*Bc+s*rs+t*pn+s*Ay+t*Nc+s*Qd+t}const ia=0;class nh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,p,_,v){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,h,E.symbolInstanceStart===0,v),this._currentPartIndex++,_())return!0}return!1}}class ns{constructor(t,s,h,p,_,v,b,E,C){this.placement=new ir(t,_,v,b,E,C),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,p,_){const v=n.q.now(),b=()=>{const E=n.q.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=s[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){const R=E,k=R.layout.get("symbol-z-elevate"),D=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,O=R.layout.get("symbol-z-order"),j=O==="viewport-y"||O==="auto"&&!(O!=="viewport-y"&&D),V=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),q=j&&V,$=this._inProgressLayer=this._inProgressLayer||new nh(R),Q=n.C(E.source,E.scope);if($.continuePlacement(k||q?p[Q]:h[Q],this.placement,this._showCollisionBoxes,E,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Qs=512/n.aj/2;class ps{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new n.bW(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*n.aj,_=t.canonical.y*n.aj;for(let v=0;v<s.length;v++){const{key:b,crossTileID:E,tileAnchorX:C,tileAnchorY:R}=s.get(v),k=Math.floor((p+C)*Qs),D=Math.floor((_+R)*Qs);this.index.add(k,D),this.keys.push(b),this.crossTileIDs.push(E)}this.index.finish()}findMatches(t,s,h){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),_=Qs/Math.pow(2,s.canonical.z-this.tileID.canonical.z),v=s.canonical.x*n.aj,b=s.canonical.y*n.aj;for(let E=0;E<t.length;E++){const C=t.get(E);if(C.crossTileID)continue;const{key:R,tileAnchorX:k,tileAnchorY:D}=C,O=Math.floor((v+k)*_),j=Math.floor((b+D)*_),V=this.index.range(O-p,j-p,O+p,j+p).sort((q,$)=>q-$);for(const q of V){const $=this.crossTileIDs[q];if(this.keys[q]===R&&!h.has($)){h.add($),C.crossTileID=$;break}}}}}class Im{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const v in p){const b=p[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),_[b.tileID.key]=b}this.indexes[h]=_}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in v){const E=v[b];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,p)}else{const b=v[t.scaledTo(Number(_)).key];b&&b.findMatches(s.symbolInstances,t,p)}}for(let _=0;_<s.symbolInstances.length;_++){const v=s.symbolInstances.get(_);v.crossTileID||(v.crossTileID=h.generate(),p.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ps(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],s=!0)}return s}}class Sn{constructor(){this.layerIndexes={},this.crossTileIDs=new Im,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new bl);let v=!1;const b={};p.name!=="globe"&&_.handleWrapJump(h);for(const E of s){const C=E.getBucket(t);C&&t.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(E.tileID,C,this.crossTileIDs)&&(v=!0),b[C.bucketInstanceId]=!0)}return _.removeStaleBuckets(b)&&(v=!0),v}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const ss=771;class Ci{constructor(t,s,h,p){this.blendFunction=t,this.blendColor=s,this.mask=h,this.blendEquation=p}}Ci.Replace=[1,0,1,0],Ci.disabled=new Ci(Ci.Replace,n.am.transparent,[!1,!1,!1,!1]),Ci.unblended=new Ci(Ci.Replace,n.am.transparent,[!0,!0,!0,!0]),Ci.alphaBlended=new Ci([1,ss,1,ss],n.am.transparent,[!0,!0,!0,!0]),Ci.alphaBlendedNonPremultiplied=new Ci([770,ss,770,ss],n.am.transparent,[!0,!0,!0,!0]),Ci.multiply=new Ci([774,0,774,0],n.am.transparent,[!0,!0,!0,!0]);class Dt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Uc=7680;class ai{constructor(t,s,h,p,_,v){this.test=t,this.ref=s,this.mask=h,this.fail=p,this.depthFail=_,this.pass=v}}ai.disabled=new ai({func:519,mask:0},0,0,Uc,Uc,Uc);const La=1029,wl=2305;class li{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function Cm(u,t){const s=n.c1(u,3);n.c3(u,t),n.c7(u,3,s)}function eo(u,t){const s=n.bY([]);return n.bZ(s,s,-t),n.b_(s,s,-u),s}function Pm(u,t){const s=[u[0],u[1],0],h=[t[0],t[1],0];if(n.ae(s)>=1e-15){const v=n.au([],s);n.b$(h,v,n.bE(h,v)),t[0]=h[0],t[1]=h[1]}const p=n.bG([],t,u);if(n.c0(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return eo(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}li.disabled=new li(!1,La,wl),li.backCCW=new li(!0,La,wl),li.backCW=new li(!0,La,2304),li.frontCW=new li(!0,1028,2304),li.frontCCW=new li(!0,1028,wl);class sh{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof n.ac?t:new n.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=n.bX(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,p=this._elevation?this._elevation.getAtPointOrZero(n.ac.fromLngLat(t)):0,_=n.ac.fromLngLat(t,p),v=[_.x-h.x,_.y-h.y,_.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Pm(v,s)}setPitchBearing(t,s){this.orientation=eo(n.al(t),n.al(-s))}}class Xn{constructor(t,s){this._transform=n.bx([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new n.ac(t[0],t[1],t[2])}get position(){const t=n.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&n.c7(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.bY([]),t&&Cm(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=eo(t,s),Cm(this._transform,this._orientation)}forward(){const t=n.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return n.bi(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const p=this.position;n.b$(p,p,-t);const _=new Float64Array(16);return n.bn(_,[h,h,h]),n.bo(_,_,p),_[10]*=s,_}getWorldToCamera(t,s){const h=new Float64Array(16),p=new Float64Array(4),_=this.position;return n.c2(p,this._orientation),n.b$(_,_,-t),n.c3(h,p),n.bo(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,p){const _=new Float64Array(16);return n.c4(_,t,s,h,p),_}getCameraToClipOrthographic(t,s,h,p,_,v){const b=new Float64Array(16);return n.c5(b,t,s,h,p,_,v),b}getDistanceToElevation(t,s=!1){const h=t===0?0:n.c6(t,s?n.aY(this.position[1]):this.position[1]),p=this.forward();return(h-this.position[2])/p[2]}clone(){return new Xn([...this.position],[...this.orientation])}}const os={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Tl{constructor(t=0,s=0,h=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=p}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=n.ai(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=n.ai(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=n.ai(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=n.ai(t.right,s.right,h)),this}getCenter(t,s){const h=n.aD((this.left+t-this.right)/2,0,t),p=n.aD((this.top+s-this.bottom)/2,0,s);return new n.P(h,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Tl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ra=15;class za{constructor(t,s,h,p,_,v,b){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=p??60,this.setProjection(v),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new n.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Tl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new za(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ra}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return n.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=n.ce(this.projectionOptions);const h=this.getProjection(),p=!n.bv(s,h);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.ce({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=n.cf(),n.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=n.aD(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let p=0,_=0;for(let v=0;v<s.length;v++){const b=new n.P(s[v][0]*this.width,h+s[v][1]*(this.height-h)),E=t.pointCoordinate(b);if(!E)continue;const C=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);p+=E[3]*C,_+=C}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),v=Math.max(p-h,_);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const p=n.ae(n.at([],this._camera.position,h));return n.aD(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!n.ch(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];n.ci(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new sh;return s.position=new n.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!n.cj(t))return!1;n.ck(t,t);const s=n.cl([],[0,0,-1],t),h=n.cl([],[0,-1,0],t);if(h[2]<0)return!1;const p=Pm(s,h);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=n.aD(t[2],p/h,p/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new n.cm(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new n.P(0,0)),p=this.pointCoordinate(new n.P(this.width,0)),_=this.pointCoordinate(new n.P(this.width,this.height)),v=this.pointCoordinate(new n.P(0,this.height)),b=Math.floor(Math.min(h.x,p.x,_.x,v.x)),E=Math.floor(Math.max(h.x,p.x,_.x,v.x)),C=1;for(let R=b-C;R<=E+C;R++)R!==0&&s.push(new n.cm(R,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let p=[];const _=h!=null,v=!_;if(v&&this.zoom<s||_&&h[0]===0&&h[1]===0)return p;const b=new Set,E=(R,k,D,O,j)=>{const V=n.cK(k,R,D,O,j);b.has(V)||(p.push(new n.aM(R,k,D,O,j)),b.add(V))};for(let R=0;R<t.length;R++){const k=t[R];if(v&&k.canonical.z!==s)continue;const D=k.canonical,O=k.overscaledZ,j=k.wrap,V=1<<D.z,q=D.x+1<V,$=D.x>0,Q=D.y+1<V,re=D.y>0,oe=k.wrap-($?0:1),fe=k.wrap+(q?0:1),ue=$?D.x-1:V-1,he=q?D.x+1:0;if(_)h[0]<0?(E(O,fe,D.z,he,D.y),h[1]<0&&Q&&(E(O,j,D.z,D.x,D.y+1),E(O,fe,D.z,he,D.y+1)),h[1]>0&&re&&(E(O,j,D.z,D.x,D.y-1),E(O,fe,D.z,he,D.y-1))):h[0]>0?(E(O,oe,D.z,ue,D.y),h[1]<0&&Q&&(E(O,j,D.z,D.x,D.y+1),E(O,oe,D.z,ue,D.y+1)),h[1]>0&&re&&(E(O,j,D.z,D.x,D.y-1),E(O,oe,D.z,ue,D.y-1))):h[1]<0&&Q?E(O,j,D.z,D.x,D.y+1):re&&E(O,j,D.z,D.x,D.y-1);else{const ae=k.visibleQuadrants;1&ae&&(E(O,oe,D.z,ue,D.y),re&&(E(O,j,D.z,D.x,D.y-1),E(O,oe,D.z,ue,D.y-1))),2&ae&&(E(O,fe,D.z,he,D.y),re&&(E(O,j,D.z,D.x,D.y-1),E(O,fe,D.z,he,D.y-1))),4&ae&&(E(O,oe,D.z,ue,D.y),Q&&(E(O,j,D.z,D.x,D.y+1),E(O,oe,D.z,ue,D.y+1))),8&ae&&(E(O,fe,D.z,he,D.y),Q&&(E(O,j,D.z,D.x,D.y+1),E(O,fe,D.z,he,D.y+1)))}}const C=[];for(const R of p)p.some(k=>R.isChildOf(k))||C.push(R);if(p=C.filter(R=>!t.some(k=>!!(R.overscaledZ<s&&k.isChildOf(R))||R.equals(k)||R.isChildOf(k))),v){const R=1<<s,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),D=[R*k.x,R*k.y],O=4,j=O*O;p=p.filter(V=>{const q=V.canonical.x+.5-D[0],$=V.canonical.y+.5-D[1];return q*q+$*$<j})}return p}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const b=this.locationCoordinate(this.center),E=this.center.lat,C=1<<s,R=[C*b.x,C*b.y,0],k=this.projection.name==="globe",D=!k,O=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,D),j=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=C*n.c6(1,this.center.lat),q=this._camera.position[2]/n.c6(1,this.center.lat),$=[C*j.x,C*j.y,q*(D?1:V)],Q=k||p,re=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),oe=this.isLODDisabled(!0)?s:0;let fe;if(this._elevation&&t.isTerrainDEM)fe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ce=this._elevation.getMinMaxForVisibleTiles();fe=Ce?Ce.max:this._centerAltitude}else fe=this._centerAltitude;const ue=t.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?n.co(this):1,ae=Ce=>{const Ve=new n.ac(Ce.x+25e-6,Ce.y,Ce.z),st=new n.ac(Ce.x,Ce.y+25e-6,Ce.z),Qe=Ce.toLngLat(),ot=Ve.toLngLat(),at=st.toLngLat(),Rt=this.locationCoordinate(Qe),Ut=this.locationCoordinate(ot),Ct=this.locationCoordinate(at),Vt=Math.hypot(Ut.x-Rt.x,Ut.y-Rt.y),Lt=Math.hypot(Ct.x-Rt.x,Ct.y-Rt.y);return Math.sqrt(Vt*Lt)*he/25e-6},_e=Ce=>{const tt=fe,Ve=ue;return{aabb:n.cr(this,C,0,0,0,Ce,Ve,tt,this.projection),zoom:0,x:0,y:0,minZ:Ve,maxZ:tt,wrap:Ce,fullyVisible:!1}},ge=[];let Oe=[];const Re=s,Je=t.reparseOverscaled?h:s,Xe=(q-this._centerAltitude)*V,ft=Ce=>{if(!this._elevation||!Ce.tileID||!v)return;const tt=this._elevation.getMinMaxForTile(Ce.tileID),Ve=Ce.aabb;tt?(Ve.min[2]=tt.min,Ve.max[2]=tt.max,Ve.center[2]=(Ve.min[2]+Ve.max[2])/2):(Ce.shouldSplit=Fe(Ce),Ce.shouldSplit||(Ve.min[2]=Ve.max[2]=Ve.center[2]=this._centerAltitude))},Me=(Ce,tt)=>{if(.707*tt<Ce)return 1;const Ve=tt/Ce;return Ve/(1.4144271570014144+(Math.pow(1.1,Ve-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Ce=>{if(Ce.zoom<oe)return!0;if(Ce.zoom===Re)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const tt=Ce.aabb.distanceX($),Ve=Ce.aabb.distanceY($);let st=Xe,Qe=1;if(k){st=Ce.aabb.distanceZ($);const Lt=Math.pow(2,Ce.zoom),ei=n.aY((Ce.y+1)/Lt),ui=n.aY(Ce.y/Lt),Di=Math.min(Math.max(E,ei),ui),ur=n.cP(Di)/n.cP(E);if(Qe=Di===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ur/this._mercatorScaleRatio),this.zoom<=n.cL&&Ce.zoom===Re-1&&ur>=.9)return!0}else if(_&&(st=Ce.aabb.distanceZ($)*V),this.projection.isReprojectedInTileSpace&&h<=5){const Lt=Math.pow(2,Ce.zoom),ei=ae(new n.ac((Ce.x+.5)/Lt,(Ce.y+.5)/Lt));Qe=ei>.85?1:ei}if(!v){const Lt=Math.sqrt(tt*tt+Ve*Ve+st*st);let ei=(1<<Re-Ce.zoom)*re*Qe;return ei*=Me(Math.max(st,Xe),Lt),Lt<ei}let ot=Number.MAX_VALUE,at=0;const Rt=Ce.aabb.getCorners(),Ut=[];for(const Lt of Rt){n.at(Ut,Lt,$),k||(_?Ut[2]*=V:Ut[2]=Xe);const ei=n.bE(Ut,this._camera.forward());ei<ot&&(ot=ei,at=Math.abs(Ut[2]))}let Ct=(1<<Re-Ce.zoom)*re*Qe;if(Ct*=Me(Math.max(at,Xe),ot),ot<Ct)return!0;const Vt=Ce.aabb.closestPoint(R);return Vt[0]===R[0]&&Vt[1]===R[1]};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)ge.push(_e(-Ce)),ge.push(_e(Ce));for(ge.push(_e(0));ge.length>0;){const Ce=ge.pop(),tt=Ce.x,Ve=Ce.y;let st=Ce.fullyVisible;const Qe=()=>this.projection.name==="globe"&&(Ce.y===0||Ce.y===(1<<Ce.zoom)-1);if(!st){let ot=Q?Ce.aabb.intersects(O):Ce.aabb.intersectsFlat(O);if(ot===0&&Qe()){const at=new n.cp(Ce.zoom,tt,Ve);ot=n.cq(this,C,at,!0).intersects(O)}if(ot===0)continue;st=ot===2}if(Ce.zoom!==Re&&Fe(Ce))for(let ot=0;ot<4;ot++){const at=(tt<<1)+ot%2,Rt=(Ve<<1)+(ot>>1),Ut={aabb:v?Ce.aabb.quadrant(ot):n.cr(this,C,Ce.zoom+1,at,Rt,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:at,y:Rt,wrap:Ce.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};_&&!k&&(Ut.tileID=new n.aM(Ce.zoom+1===Re?Je:Ce.zoom+1,Ce.wrap,Ce.zoom+1,at,Rt),ft(Ut)),ge.push(Ut)}else{const ot=Ce.zoom===Re?Je:Ce.zoom;if(t.minzoom&&t.minzoom>ot)continue;let at=0;if(!st){let Vt=Q?Ce.aabb.intersectsPrecise(O):Ce.aabb.intersectsPreciseFlat(O);if(Vt===0&&Qe()){const Lt=new n.cp(Ce.zoom,tt,Ve);Vt=n.cq(this,C,Lt,!0).intersectsPrecise(O)}if(Vt===0)continue;if(t.calculateQuadrantVisibility)if(O.containsPoint(Ce.aabb.center))at=15;else for(let Lt=0;Lt<4;Lt++)Ce.aabb.quadrant(Lt).intersects(O)!==0&&(at|=1<<Lt)}const Rt=R[0]-(.5+tt+(Ce.wrap<<Ce.zoom))*(1<<s-Ce.zoom),Ut=R[1]-.5-Ve,Ct=Ce.tileID?Ce.tileID:new n.aM(ot,Ce.wrap,Ce.zoom,tt,Ve);t.calculateQuadrantVisibility&&(Ct.visibleQuadrants=at),Oe.push({tileID:Ct,distanceSq:Rt*Rt+Ut*Ut})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,tt=this.horizonLineFromTop();Oe=Oe.filter(Ve=>{const st=[0,0,0,1],Qe=[n.aj,n.aj,0,1],ot=this.calculateFogTileMatrix(Ve.tileID.toUnwrapped());n.aA(st,st,ot),n.aA(Qe,Qe,ot);const at=n.cs([],st,Qe),Rt=n.ct([],st,Qe),Ut=n.cM(at,Rt);if(Ut===0)return!0;let Ct=!1;const Vt=this._elevation;if(Vt&&Ut>Ce&&tt!==0){const Lt=this.calculateProjMatrix(Ve.tileID.toUnwrapped());let ei;t.isTerrainDEM||(ei=Vt.getMinMaxForTile(Ve.tileID)),ei||(ei={min:ue,max:fe});const ui=n.cu(this.rotation),Di=[ui[0]*n.aj,ui[1]*n.aj,ei.max];n.ad(Di,Di,Lt),Ct=(1-Di[1])*this.height*.5<tt}return Ut<Ce||Ct})}return Oe.sort((Ce,tt)=>Ce.distanceSq-tt.distanceSq).map(Ce=>Ce.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=n.aD(t.lat,-n.cv,n.cv),h=this.projection.project(t.lng,s);return new n.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,p;const _=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;h=(s.x-_.x)/b,p=(s.y-_.y)/b}else{const b=this.pointCoordinate(s),E=this.pointCoordinate(_);h=b.x-E.x,p=b.y-E.y}const v=this.locationCoordinate(t);this.setLocation(new n.ac(v.x-h,v.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?n.c6(s,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new n.ac(p.x,p.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];n.aA(p,p,this.pixelMatrixInverse),n.aA(_,_,this.pixelMatrixInverse);const v=_[3];n.cw(p,p,1/p[3]),n.cw(_,_,1/v);const b=p[2],E=_[2];return{p0:p,p1:_,t:b===E?0:(h-b)/(E-b)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return n.aA(s,s,this.pixelMatrixInverse),n.aA(h,h,this.pixelMatrixInverse),n.cw(s,s,1/s[3]),n.cw(h,h,1/h[3]),s[2]=n.c6(s[2],this._center.lat)*this.worldSize,h[2]=n.c6(h[2],this._center.lat)*this.worldSize,n.cw(s,s,1/this.worldSize),n.cw(h,h,1/this.worldSize),new n.av([s[0],s[1],s[2]],n.au([],n.at([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:p}=t,_=n.c6(s[2],this._center.lat),v=n.c6(h[2],this._center.lat);return new n.ac(n.ai(s[0],h[0],p)/this.worldSize,n.ai(s[1],h[1],p)/this.worldSize,n.ai(_,v,p))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new n.ac(h[0],h[1],h[2]);let p=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,s);const v=.02*_,b=t.clone();for(let E=0;E<10&&_-p>v;E++){b.y=n.ai(p,_,.66);const C=this.projection.pointCoordinate3D(this,b.x,b.y);C?(_=b.y,h=C):p=b.y}return h?new n.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cx)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return n.aA(p,p,this.pixelMatrix),p[3]>0?new n.P(p[0]/p[3],p[1]/p[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.P(s,t)),v=this.pointLocation3D(new n.P(p,t)),b=this.pointLocation3D(new n.P(p,h)),E=this.pointLocation3D(new n.P(s,h));let C=Math.min(_.lng,v.lng,b.lng,E.lng),R=Math.max(_.lng,v.lng,b.lng,E.lng),k=Math.min(_.lat,v.lat,b.lat,E.lat),D=Math.max(_.lat,v.lat,b.lat,E.lat);const O=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,V=(q,$,Q,re,oe)=>{const fe=(q+Q)/2,ue=($+re)/2,he=new n.P(fe,ue),{lng:ae,lat:_e}=this.pointLocation3D(he),ge=Math.max(0,C-ae,k-_e,ae-R,_e-D);C=Math.min(C,ae),R=Math.max(R,ae),k=Math.min(k,_e),D=Math.max(D,_e),(oe<j||ge>O)&&(V(q,$,fe,ue,oe+1),V(fe,ue,Q,re,oe+1))};if(V(s,t,p,t,1),V(p,t,p,h,1),V(p,h,s,h,1),V(s,h,s,t,1),this.projection.name==="globe"){const[q,$]=n.cy(this);q?(D=90,R=180,C=-180):$&&(k=-90,R=180,C=-180)}return new n.aG(new n.cd(C,k),new n.cd(R,D))}_getBoundsRectangular(t,s){const{top:h,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=new n.P(p,h),E=new n.P(v,h),C=new n.P(v,_),R=new n.P(p,_);let k=this.pointCoordinate(b,t),D=this.pointCoordinate(E,t);const O=this.pointCoordinate(C,s),j=this.pointCoordinate(R,s),V=(q,$)=>($.y-q.y)/($.x-q.x);return k.y>1&&D.y>=0?k=new n.ac((1-j.y)/V(j,k)+j.x,1):k.y<0&&D.y<=1&&(k=new n.ac(-j.y/V(j,k)+j.x,0)),D.y>1&&k.y>=0?D=new n.ac((1-O.y)/V(O,D)+O.x,1):D.y<0&&k.y<=1&&(D=new n.ac(-O.y/V(O,D)+O.x,0)),new n.aG().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(O))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,p)=>{if(p.dem){const _=p.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.cv,this.maxLat=n.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.ay(this.minLng)*this.tileSize,this.worldMaxX=n.ay(this.maxLng)*this.tileSize,this.worldMinY=n.aH(this.maxLat)*this.tileSize,this.worldMaxY=n.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const p=t.canonical,_=1/this.height,v=this.cameraWorldSize,b=v/this.zoomScale(p.z),E=(p.x+Math.pow(2,p.z)*t.wrap)*b,C=p.y*b,R=this.point;R.x*=v/this.worldSize,R.y*=v/this.worldSize;const k=this.angle,D=Math.sin(-k),O=-Math.cos(-k);return h[s]={bearing:[D,O],center:[(R.x-E)*_,(R.y-C)*_],scale:b/n.aj*_},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.az(p,this.worldToFogMatrix,p),h[s]=new Float32Array(p),h[s]}calculateProjMatrix(t,s=!1,h=!1){const p=t.key;let _;if(_=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const v=this.calculatePosMatrix(t,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,n.az(v,b,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const p=n.cz(t,this);return h[s]=p,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=n.bn([],[t,t,t]);return n.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=n.c6(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),p=this._camera.forward(),_=n.c6(1,this._center.lat);h[2]/=_,p[2]/=_,n.au(p,p);const v=t.raycast(h,p,t.exaggeration());if(v){const b=n.bF([],h,p,v),E=new n.ac(b[0],b[1],n.c6(b[2],n.aY(b[1]))),C=(E.z+n.ae([E.x-h[0],E.y-h[1],E.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=n.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(h),_=s.getAtPointOrZero(new n.ac(...p)),v=this.pixelsPerMeter/this.worldSize*_,b=this._minimumHeightOverTerrain(),E=p[2]-v;if(E<=b)if(E<0||t){const C=this.locationCoordinate(this._center,this._centerAltitude),R=[p[0],p[1],C.z-p[2]],k=n.ae(R);R[2]-=(b-E)/this._pixelsPerMercatorPixel;const D=n.ae(R);if(D===0)return;n.b$(R,R,k/D*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],C.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const D=this.center;return D.lat=n.aD(D.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(D.lng=n.aD(D.lng,this.minLng,this.maxLng)),this.center=D,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:p}=this.point;let _=0,v=h,b=p;const E=this.width/2,C=this.height/2,R=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(p-C<R&&(b=R+C),p+C>k&&(b=k-C),k-R<this.height&&(_=Math.max(_,this.height/(k-R)),b=(k+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const D=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,j=this.worldSize/2-(D+O)/2;v=(h+j+this.worldSize)%this.worldSize-j,v-E<D&&(v=D+E),v+E>O&&(v=O-E),O-D<this.width&&(_=Math.max(_,this.width/(O-D)),v=(O+D)/2)}v===h&&b===p||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(v,b))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.c6(1,this.center.lat)/n.c6(1,n.cN));const p=n.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?h:1,v=this._camera.getWorldToCamera(this.worldSize,_);let b;const E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(E[8]=2*-t.x/this.width,E[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=_e*this.aspect,Oe=-ge,Re=-_e;ge-=t.x,Oe-=t.x,_e+=t.y,Re+=t.y,b=this._camera.getCameraToClipOrthographic(Oe,ge,Re,_e,this._nearZ,this._farZ),((Je,Xe,ft,Me)=>{for(let Fe=0;Fe<16;Fe++)Je[Fe]=n.ai(Xe[Fe],ft[Fe],Me)})(b,b,E,n.cO(this.pitch>=ra?1:this.pitch/ra))}else b=E;const C=n.cB([],E,v);let R=n.cB([],b,v);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),ge=n.bx([]);n.bo(ge,ge,[_e.x*this.worldSize,_e.y*this.worldSize,0]),n.az(ge,ge,n.cC(this)),n.bo(ge,ge,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),n.az(R,R,ge),n.az(C,C,ge),this.inverseAdjustmentMatrix=n.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cE([],R,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=R,this.invProjMatrix=n.bi(new Float64Array(16),this.projMatrix),s){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cB([],_e,v)}else this.expandedFarZProjMatrix=this.projMatrix;const k=n.bi([],b);this.frustumCorners=n.cF.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const D=new Float32Array(16);n.bx(D),n.cE(D,D,[1,-1,1]),n.cG(D,D,this._pitch),n.by(D,D,this.angle);const O=n.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bw(O);const j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-t.x/this.width,O[9]=2*(t.y+j)/this.height,this.skyboxMatrix=n.az(D,O,D);const V=this.point,q=V.x,$=V.y,Q=this.width%2/2,re=this.height%2/2,oe=Math.cos(this.angle),fe=Math.sin(this.angle),ue=q-Math.round(q)+oe*Q+fe*re,he=$-Math.round($)+oe*re+fe*Q,ae=new Float64Array(R);if(n.bo(ae,ae,[ue>.5?ue-1:ue,he>.5?he-1:he,0]),this.alignedProjMatrix=ae,R=n.bz(),n.cE(R,R,[this.width/2,-this.height/2,1]),n.bo(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=n.bz(),n.cE(R,R,[1,-1,1]),n.bo(R,R,[-1,-1,0]),n.cE(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=n.az(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},R=n.bi(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cH(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ad(_e,_e,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,s];n.b$(_,_,p),n.b$(h,h,-1),n.cI(h,h,_);const v=n.bz();n.bo(v,v,h),n.cE(v,v,_),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,p)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-h[0]*_,p.y/this.worldSize-h[1]*_,t/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((s-h)/p,1)),this._camera.position=n.bF([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:p}=this._camera.getPitchBearing(),_=n.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.al(this._maxPitch)),b=Math.max((t[2]-_)/Math.cos(h),v),E=this._zoomFromMercatorZ(b);n.bF(t,t,s,b),this._pitch=n.aD(h,n.al(this.minPitch),n.al(this.maxPitch)),this.angle=n.bX(p,-Math.PI,Math.PI),this._setZoom(n.aD(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=n.cx,p=0,_=1/0;for(;h-s>1e-6&&h>s;){const v=s+.5*(h-s),b=this.tileSize*Math.pow(2,v),E=this.getCameraToCenterDistance(this.projection,v,b),C=this.scaleZoom(E/(t*this.tileSize)),R=Math.abs(v-C);R<_&&(_=R,p=v),v<C?s=v:h=v}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),p=Math.max(t.x,s.x),_=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new n.P(h,_),new n.P(p,v),new n.P(h,v),new n.P(p,_)],E=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(const R of b){const k=this.pointRayIntersection(R);if(k.t<0)return!0;const D=this.rayIntersectionCoordinate(k);if(D.x<E||D.y<0||D.x>C||D.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=n.ae(n.at([],this._camera.position,t)),p=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,p],_){const v=[s,h,p,1];n.aA(v,v,_);const b=v[3]=Math.max(v[3],1e-6);return v[0]/=b,v[1]/=b,v[2]/=b,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const p=n.cA(t,s,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,h,p);let v=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(v=n.ai(1,v,n.cO(this.pitch>=ra?1:this.pitch/ra))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.az(t,t,this.globeMatrix),t}getFrustum(t){return n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Oa=(u,t)=>{if(t>0&&u.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=u.transform,h=Math.max(Math.abs(s._zoom-(u.minCutoffZoom-1)),1),p=s.isLODDisabled(!1)?n.af(60,45,s.pitch):n.af(30,15,s.pitch),_=s._farZ-s._nearZ,v=t*s.height,b=((1-(E=p))*s.cameraToCenterDistance+E*(s._farZ+v))*h;var E;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(b-s._nearZ)/_,(b-v-s._nearZ)/_]}}},as={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Vc{constructor(t,s){this.aabb=t,this.lastCascade=s}}class jc{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new Vc(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const p=n.cV.fromPoints(t.points);let _=0;for(const v in this.receivers){const b=this.receivers[v];if(!b||!p.intersectsAabb(b.aabb))continue;b.aabb.min=p.closestPoint(b.aabb.min),b.aabb.max=p.closestPoint(b.aabb.max);const E=b.aabb.getCorners();for(let C=0;C<h.length;C++){let R=!0;for(const k of E){const D=[k[0]*s,k[1]*s,k[2]];if(n.ad(D,D,h[C].matrix),D[0]<-1||D[0]>1||D[1]<-1||D[1]>1){R=!1;break}}if(b.lastCascade=C,_=Math.max(_,C),R)break}}return _+1}}class Iy{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new jc,this._depthMode=new Dt(t.context.gl.LEQUAL,Dt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(as,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(as,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(as,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const p=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||p<=0||(this._shadowLayerCount=h.style.order.reduce((j,V)=>{const q=h.style._mergedLayers[V];return j+(q.hasShadowPass()&&!q.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=h.context,v=as.shadowMapResolution,b=as.shadowMapResolution;if(this._cascades.length===0||as.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<as.cascadeCount;++j){const V=h._shadowMapDebug,q=_.gl,$=_.createFramebuffer(v,b,V,"texture"),Q=new n.T(_,{width:v,height:b,data:null},q.DEPTH_COMPONENT16);if($.depthAttachment.set(Q.texture),V){const re=new n.T(_,{width:v,height:b,data:null},q.RGBA8);$.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:$,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cn,scale:0})}}this.shadowDirection=ef(s);let E=0;if(t.elevation){const j=t.elevation,V=[1e4,-1e4];j.visibleDemTiles.filter(q=>q.dem).forEach(q=>{const $=q.dem.tree;V[0]=Math.min(V[0],$.minimums[0]),V[1]=Math.max(V[1],$.maximums[0])}),V[0]!==1e4&&(E=(V[1]-V[0])*j.exaggeration())}const C=1.5*t.cameraToCenterDistance,R=3*C,k=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){const V=this._cascades[j];let q=t.height/50,$=1;as.cascadeCount===1?$=R:j===0?$=C:(q=C,$=R);const[Q,re]=tf(t,this.shadowDirection,q,$,as.shadowMapResolution,E);V.scale=t.scale,V.matrix=Q,V.boundingSphereRadius=re,n.bi(k,V.matrix),V.frustum=n.cn.fromInvProjectionMatrix(k,1,0,!0),V.far=$}const D=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[D].far,this._cascades[D].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/as.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=as.shadowMapResolution,this._uniformValues.u_shadowmap_0=os.ShadowMap0,this._uniformValues.u_shadowmap_1=os.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const O=h.transform.elevation;for(const j of this._groundShadowTiles){let V={min:0,max:0};if(O){const q=O.getMinMaxForTile(j);q&&(V=q)}this.addShadowReceiver(j.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,p=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),p.viewport.set([0,0,as.shadowMapResolution,as.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){h.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:n.am.white,depth:1});for(const v of t.order){const b=t._mergedLayers[v];if(!b.hasShadowPass()||b.isHidden(h.transform.zoom))continue;const E=t.getLayerSourceCache(b),C=E?s[E.id]:void 0;(b.type==="model"||C&&C.length)&&h.renderLayer(h,E,b,C)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,p=s.directionalLight,_=s.ambientLight;if(!p||!_)return;const v=[],b=Oa(t,t.longestCutoffRange);b.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&v.push("NORMAL_OFFSET");const E=mo(s,p,_),C=new Dt(h.gl.LEQUAL,Dt.ReadOnly,t.depthRangeFor3D);for(const R of this._groundShadowTiles){const k=R.toUnwrapped(),D=t.isTileAffectedByFog(R),O=t.getOrCreateProgram("groundShadow",{defines:v,overrideFog:D});this.setupShadows(k,O),t.uploadCommonUniforms(h,O,k,null,b);const j={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:E};O.draw(t,h.gl.TRIANGLES,C,ai.disabled,Ci.multiply,li.disabled,j,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ci.unblended:Ci.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return n.az(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return n.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,p=0){if(!this.enabled)return;const _=this.painter.transform,v=this.painter.context,b=v.gl,E=this._uniformValues,C=new Float64Array(16),R=_.calculatePosMatrix(t,_.worldSize);for(let k=0;k<this._cascades.length;k++)n.az(C,this._cascades[k].matrix,R),E[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(b.TEXTURE0+os.ShadowMap0+k),this._cascades[k].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const k=n.cT(t.canonical),D=2/_.tileSize*n.aj/as.shadowMapResolution,O=D*this._cascades[0].boundingSphereRadius,j=D*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(h==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));E.u_shadow_normal_offset=[k,O*V,j*V],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(v,E)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,v=this._uniformValues,b=new Float64Array(16);for(let E=0;E<as.cascadeCount;E++)n.az(b,this._cascades[E].matrix,t),v[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),p.activeTexture.set(_.TEXTURE0+os.ShadowMap0+E),this._cascades[E].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const E=as.normalOffset;v.u_shadow_normal_offset=[1,E,E],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(p,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,p){if(p[2]>=0)return{};const _=function(E,C,R){const k=R/(1<<E.canonical.z);return new n.cV([E.canonical.x*k+E.wrap*R,E.canonical.y*k+E.wrap*R,0],[(E.canonical.x+1)*k+E.wrap*R,(E.canonical.y+1)*k+E.wrap*R,C])}(t,s,h).getCorners(),v=s/-p[2];p[0]<0?(n.cU(_[0],_[0],[p[0]*v,0,0]),n.cU(_[3],_[3],[p[0]*v,0,0])):p[0]>0&&(n.cU(_[1],_[1],[p[0]*v,0,0]),n.cU(_[2],_[2],[p[0]*v,0,0])),p[1]<0?(n.cU(_[0],_[0],[0,p[1]*v,0]),n.cU(_[1],_[1],[0,p[1]*v,0])):p[1]>0&&(n.cU(_[2],_[2],[0,p[1]*v,0]),n.cU(_[3],_[3],[0,p[1]*v,0]));const b={};return b.vertices=_,b.planes=[Lo(_[1],_[0],_[4]),Lo(_[2],_[1],_[5]),Lo(_[3],_[2],_[6]),Lo(_[0],_[3],_[7])],b}addShadowReceiver(t,s,h){this._receivers.add(t,n.cV.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function Lo(u,t,s){const h=n.at([],s,t),p=n.at([],u,t),_=n.bG([],h,p),v=n.ae(_);return v===0?[0,0,1,0]:(n.b$(_,_,1/v),[_[0],_[1],_[2],-n.bE(_,t)])}function ef(u){const t=u.properties.get("direction"),s=n.cR(t.x,t.y,t.z);s[2]=n.aD(s[2],0,75);const h=n.cW([s[0],s[1],s[2]]);return n.cS(h.x,h.y,h.z)}function mo(u,t,s){const h=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),_=t.properties.get("intensity"),v=t.properties.get("direction"),b=[v.x,v.y,v.z],E=s.properties.get("color-use-theme")==="none",C=s.properties.get("color"),R=s.properties.get("intensity"),k=Math.max(n.bE([0,0,1],b),0),D=[0,0,0];n.b$(D,C.toRenderColor(E?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),R);const O=[0,0,0];return n.b$(O,p.toRenderColor(h?null:u.getLut(s.scope)).toArray01Linear().slice(0,3),k*_),n.cX([D[0]>0?D[0]/(D[0]+O[0]):0,D[1]>0?D[1]/(D[1]+O[1]):0,D[2]>0?D[2]/(D[2]+O[2]):0])}function tf(u,t,s,h,p,_){const v=u.zoom,b=u.scale,E=u.worldSize,C=1/E,R=u.aspect,k=Math.sqrt(1+R*R)*Math.tan(.5*u.fovX),D=k*k,O=h-s,j=h+s;let V,q;D>O/j?(V=h,q=h*k):(V=.5*j*(1+D),q=.5*Math.sqrt(O*O+2*(h*h+s*s)*D+j*j*D*D));const $=u.projection.pixelsPerMeter(u.center.lat,E),Q=u._camera.getCameraToWorldMercator(),re=[0,0,-V*C];n.ad(re,re,Q);let oe=q*C;const fe=u._edgeInsets;if(!(fe.left===0&&fe.top===0&&fe.right===0&&fe.bottom===0||fe.left===fe.right&&fe.top===fe.bottom)){const st=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?$:1),Qe=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,s,h);Qe[8]=2*-u.centerOffset.x/u.width,Qe[9]=2*u.centerOffset.y/u.height;const ot=new Float64Array(16);n.cB(ot,Qe,st);const at=new Float64Array(16);n.bi(at,ot);const Rt=n.cn.fromInvProjectionMatrix(at,E,v,!0);for(const Ut of Rt.points){const Ct=((ue=Ut)[0]/=b,ue[1]/=b,ue[2]=n.c6(ue[2],u._center.lat),ue);oe=Math.max(oe,n.c0(n.cY([],re,Ct)))}}var ue;oe*=p/(p-1);const he=Math.acos(t[2]),ae=Math.atan2(-t[0],-t[1]),_e=new Xn;_e.position=re,_e.setPitchBearing(he,ae);const ge=_e.getWorldToCamera(E,$),Oe=oe*E,Re=Math.min(u._mercatorZfromZoom(17)*E*-2,-2*Oe),Je=_e.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,Re,(Oe+_*$)/t[2]),Xe=new Float64Array(16);n.az(Xe,Je,ge);const ft=n.cS(Math.floor(1e6*re[0])/1e6*E,Math.floor(1e6*re[1])/1e6*E,0),Me=.5*p,Fe=[0,0,0];n.ad(Fe,ft,Xe),n.b$(Fe,Fe,Me);const Ce=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],tt=[0,0,0];n.at(tt,Fe,Ce),n.b$(tt,tt,-1/Me);const Ve=new Float64Array(16);return n.bx(Ve),n.bo(Ve,Ve,tt),n.az(Xe,Ve,Xe),[Xe,Oe]}class na extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return n.aS(this.requestManager.transformRequest(s,n.R.Model).url).then(h=>{if(!h)return;const p=n.aT(h),_=new n.aU(t,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(h=>{if(h&&h.status===404)return null;this.fire(new n.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={forceReload:!1}){this.models[s]||(this.models[s]={});const p=Object.keys(t),_=[],v=[];for(const b of p){const E=t[b];this.hasURLBeenRequested(E)&&!h.forceReload||(this.modelByURL[E]={modelId:b,scope:s},_.push(this.loadModel(b,E)),v.push(b)),this.models[s][b]||(this.models[s][b]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+v.length,Promise.allSettled(_).then(b=>{for(let E=0;E<b.length;E++){const{status:C}=b[E];if(C==="rejected")continue;const{value:R}=b[E];this.models[s][v[E]]||(this.models[s][v[E]]={model:null,numReferences:1}),this.models[s][v[E]].model=R}this.numModelsLoading[s]-=v.length,this.fire(new n.A("data",{dataType:"style"}))}).catch(b=>{this.fire(new n.z(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const p=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,h,{exactIdMatch:!0})||this.hasModelBeenAdded(t,h))&&this.modelUris[h][t]===p)this.models[h][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:_,modelId:v}=this.modelByURL[p];this.models[_][v].numReferences++}else this.modelUris[h][t]=p,this.load({[t]:this.modelUris[h][t]},h)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const p in t)h[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const p of t)this.hasModel(p,s,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[s][p].numReferences++:this.modelUris[s][p]&&!this.hasURLBeenRequested(p)?h[p]=this.modelUris[s][p]:!this.hasURLBeenRequested(p)&&n.cZ(p,!1)&&(this.modelUris[s][p]=this.requestManager.normalizeModelURL(p),h[p]=this.modelUris[s][p]);this.load(h,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,h=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const p=this.modelUris[s][t];h||delete this.modelUris[s][t],delete this.modelByURL[p];const _=this.models[s][t].model;if(!_)return;delete this.models[s][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const h=this.models[t][s].model;delete this.models[t][s],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const Cy=new n.a7({data:new n.a8(n.a5.colorTheme.data)}),Py={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Mm(u){return u=u||{},Object.assign(u,Py)}class Rm extends n.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},n.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(v,b){const[E,C]=v,{center:R,radius:k}=b,[D,O]=R,j=Math.abs(E-D);return Math.sqrt((j>180?360-j:j)**2+(C-O)**2)<=k}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new n.P(this._map.transform.width/2,this._map.transform.height/2),p=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(t?p:h,s);_.length>0&&(this._selectedFloorplan&&_[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=_[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(_){const[[v,b],[E,C]]=_,R=(E-v+360)%360,k=R>180?360-R:R;return{center:[(v+k/2+360)%360,(b+C)/2],radius:Math.sqrt(k**2+(C-b)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const _ of this._indoorData.levels)_.id===this._selectedLevel.id&&(p=_.id);if(this.fire(new n.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),s){const _=this._indoorData.buildings.find(v=>v.id===s);this._buildingSelected(_,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const _=this._indoorData.levels.find(v=>v.id===h);this._updateLevels(_,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new n.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(s,!0)}this.fire(new n.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(C){const R=C.indexOf("/floor/");if(R===-1)return C;const k=R+7,D=C.indexOf("/",k);return D===-1?C.slice(k):C.slice(k,D)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],_={},v={},b={},E={};for(const C of this._indoorData.levels)if(p.push(C.id),_[C.id]=C.height,v[C.id]=C.base,t){if(this.mergeFloors){const R=h(t.id),k=h(C.id);b[C.id]=k===R?"true":"false"}else b[C.id]=C.id===t.id?"true":"false";E[C.id]=C.base<t.base?"true":"false"}else E[C.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",E]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const C=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),R=this._map.getZoom(),k=C.zoom?Math.abs(R-C.zoom):0;this._map.fitBounds(t.extent,k>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:R})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(h,s);if(p.length>0){for(const _ of p)if(JSON.parse(_.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=_,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function My(u){if(!u.metadata||!u.metadata.content_area)return;const t=n.q.devicePixelRatio,{left:s,top:h,width:p,height:_}=u.metadata.content_area,v=s*t,b=h*t;return[v,b,v+p*t,b+_*t]}function oh(u){if(u)return u.map(([t,s])=>[t*n.q.devicePixelRatio,s*n.q.devicePixelRatio])}class Dm{constructor(t,s,h){this.id=t,this.scope=s,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const h=this.sourceCache.getSource();if(!(h instanceof Ia))return t;const p=s.map(v=>this.sourceCache.getTile(v)),_=h.getImages(p,Array.from(this.pendingRequests));for(const[v,b]of _)t.set(n.I.from({name:v,iconsetId:this.id}),b),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const sa=(u,t)=>Ae(u,t&&t.filter(s=>s.identifier!=="source.canvas")),km=n.aF(Wi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Lm=n.aF(Wi,["setCenter","setZoom","setBearing","setPitch"]),zo=new Set(["background","sky","slot","custom"]),$c={version:8,layers:[],sources:{}},rf={duration:300,delay:0};class Vs extends n.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=n.l({},rf),this._buildingIndex=new wm(this),this.crossTileSymbolIndex=new Sn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new we,this.dispatcher=s.dispatcher?s.dispatcher:new n.D(n.d0(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new ht(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new n.d1(t._requestManager,s.localFontFamily?n.d2.all:s.localIdeographFontFamily?n.d2.ideographs:n.d2.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new na(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",n.d3());const h=this;this._rtlTextPluginCallback=Vs.registerForPluginStateChange(p=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,v)=>{if(n.d4(_),v&&v.every(b=>b))for(const b in h._sourceCaches){const E=h._sourceCaches[b],C=E.getSource().type;C!=="vector"&&C!=="geojson"||E.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===_.id&&this._validateLayer(b)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;const s=n.d5(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${n.d6(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const p=(_,v)=>{try{v(null,this.setState(_,h))}catch(b){v(b,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(_,n.R.Style);n.n(v,(b,E)=>{b?this.fire(new n.z(b)):E&&p(E,s)})}else typeof t=="object"&&p(t,s)}loadURL(t,s={}){this.fire(new n.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,h);const _=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(_,(v,b)=>{if(this._request=null,v)this.fire(new n.z(v));else if(b)return this.importsCache.set(t,b),this._load(b,h)})}loadJSON(t,s={}){this.fire(new n.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new n.A("dataloading",{dataType:"style"})),this._load($c,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const v=this._createFragmentStyle(_),b=new Promise(R=>{v.once("style.import.load",R),v.once("error",R)}).then(()=>this.mergeAll());if(p.push(b),this.resolvedImports.has(_.url)){v.loadEmpty();continue}const E=_.data||this.importsCache.get(_.url);E?(v.loadJSON(E,{validate:s}),this._isInternalStyle(E)&&(v.globalId=null)):_.url?v.loadURL(_.url,{validate:s}):v.loadEmpty();const C={style:v,id:_.id,config:_.config};if(h){const R=this.fragments.findIndex(({id:k})=>k===h);this.fragments=this.fragments.slice(0,R).concat(C).concat(this.fragments.slice(R))}else this.fragments.push(C)}return Promise.allSettled(p)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?n.C(t.id,this.scope):t.id;let h;const p=this._initialConfig&&this._initialConfig[s];(t.config||p)&&(h=n.l({},t.config,p));const _=new Vs(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?Mm(t.schema):t.schema;if(this._isInternalStyle(t)){const v=n.l({},$c,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,s)}if(this.updateConfig(this._config,h),s&&sa(this,Bs(t)))return;this._loaded=!0,this.stylesheet=n.d7(t);const p=()=>{for(const C in t.sources)this.addSource(C,t.sources[C],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const C in t.iconsets)this.addIconset(C,t.iconsets[C]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=Ju(this.stylesheet.layers);if(this._order=v.map(C=>C.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new Ue(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ue(this.stylesheet.light)),this._layers={};for(const C of v){const R=n.dc(C,this.scope,this._styleColorTheme.lut,this.options);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const k=this.getOwnLayerSourceCache(R),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&R.canCastShadows()&&D&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.A("data",{dataType:"style"}));const E=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new n.A(E?"style.load":"style.import.load"))}).catch(C=>{this.fire(new n.z(new Error("Failed to load imports",C))),this.fire(new n.A(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.A(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const v=this._evaluateColorThemeData(_);this._loadColorTheme(v).then(()=>{p()}).catch(b=>{n.w(`Couldn't load color theme from the stylesheet: ${b}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,p,_,v,b,E,C,R;const k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(t=D.light),D.stylesheet.lights)for(const O of D.stylesheet.lights)O.type==="ambient"&&D.ambientLight!=null&&(s=D.ambientLight),O.type==="directional"&&D.directionalLight!=null&&(h=D.directionalLight);p=this._prioritizeTerrain(p,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(_=D.fog),D.stylesheet.snow&&D.snow!=null&&(v=D.snow),D.stylesheet.rain&&D.rain!=null&&(b=D.rain),D.stylesheet.camera!=null&&(R=D.stylesheet.camera),D.stylesheet.projection!=null&&(E=D.stylesheet.projection),D.stylesheet.transition!=null&&(C=D.stylesheet.transition),k[D.scope]=D._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=_,this.snow=v,this.rain=b,this._styleColorThemeForScope=k,p===null?delete this.terrain:this.terrain=p,this.camera=R||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=n.l({},rf,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const p of h.fragments)s(p.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const p=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:p?t:null:s!=null&&(!t||p||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const v=n.C(_,p.scope);t[v]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const v=n.C(_,p.scope);s[v]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const v=n.C(_,p.scope);h[v]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const v of _._order){const b=_._layers[v];if(b.type==="slot"){const E=n.d8(v);if(t[E])continue;t[E]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):s.push(b)}}),this._mergedOrder=[];const p=(_=[])=>{for(const v of _)if(v.type==="slot"){const b=n.d8(v.id);t[b]&&p(t[b]),this._mergedSlots.push(b)}else{const b=n.C(v.id,v.scope);this._mergedOrder.push(b),h[b]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};p(s),this._mergedOrder.sort((_,v)=>{const b=h[_],E=h[v];return b.hasInitialOcclusionOpacityProperties?E.is3D(!!this.terrain)?1:0:b.is3D(!!this.terrain)&&E.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,p){const _=n.l({},h);for(const b of Object.keys(n.a5.colorTheme))_[b]===void 0&&(_[b]=n.a5.colorTheme[b].default);const v=new n.a6(Cy,s,new Map(p));return v.setTransitionOrValue(_,p),v.untransitioned().possiblyEvaluate(new n.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let v=t;v.startsWith(_)||(v=_+v);const b=n.I.from("mapbox-reserved-lut"),E=new Image;E.src=v,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},E.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:C,height:R,data:k}=n.q.getImageData(E);if(R>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==R*R)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(b)&&this.removeImage(b),this.addImage(b,{data:new n.r({width:C,height:R},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});const D=this.imageManager.getImage(b,this.scope);D?(this._styleColorTheme.lut={image:D.data,data:t},h()):p(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,p){let _,v,b;const E=n.q.devicePixelRatio>1?"@2x":"";let C=n.n(h.transformRequest(h.normalizeSpriteURL(s,E,".json"),n.R.SpriteJSON),(D,O)=>{C=null,b||(b=D,_=O,k())}),R=n.o(h.transformRequest(h.normalizeSpriteURL(s,E,".png"),n.R.SpriteImage),(D,O)=>{R=null,b||(b=D,v=O,k())});function k(){if(b)p(b);else if(_&&v){const D=n.q.getImageData(v),O={};for(const j in _){const{width:V,height:q,x:$,y:Q,sdf:re,pixelRatio:oe,stretchX:fe,stretchY:ue,content:he}=_[j],ae=new n.r({width:V,height:q});n.r.copy(D,ae,{x:$,y:Q},{x:0,y:0},{width:V,height:q},null),O[j]={data:ae,pixelRatio:oe,sdf:re,stretchX:fe,stretchY:ue,content:he,usvg:!1}}p(null,O)}}return{cancel(){C&&(C.cancel(),C=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new n.z(s));else if(h){const p=new Map;for(const _ in h)p.set(n.I.from(_),h[_]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSourceCache(s.source);if(!h)return void this.fire(new n.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=h.getSource();if(p.type!=="raster-array")return void this.fire(new n.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const _=new Dm(t,this.scope,h);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,p;this._spriteRequest=(p=(_,v)=>{if(this._spriteRequest=null,_)s?this._loadSprite(t):this.fire(new n.z(_));else if(v){const b=new Map;for(const E in v)b.set(n.I.from(E),v[E]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))},n.br((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),n.R.Iconset),(_,v)=>{if(_)return void p(_);const b={},E=n.c_(new n.bq(v));for(const C of E.icons){const R={version:1,pixelRatio:n.q.devicePixelRatio,content:My(C),stretchX:C.metadata?oh(C.metadata.stretch_x_areas):void 0,stretchY:C.metadata?oh(C.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:C};b[C.name]=R}p(null,b)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new n.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const p=this._layers[h];p&&p.type!=="custom"&&s.push(p.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new n.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new n.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const v of _){const b=t.getDefaultProgramParams(v,s.zoom,this._styleColorTheme.lut);b&&(h.style=this,this.fog&&(h._fogVisible=!0,b.overrideFog=!0,h.getOrCreateProgram(v,b)),h._fogVisible=!1,b.overrideFog=!1,h.getOrCreateProgram(v,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,h.getOrCreateProgram(v,b)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const E in b){const{updatedIds:C,removedIds:R}=b[E];(C||R)&&(this._updateWorkerLayers(E,C,R),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const b in this._mergedSourceCaches){const E=this._mergedSourceCaches[b];_[b]=E.used,E.used=!1,E.tileCoverLift=0}for(const b of this._mergedOrder){const E=this._mergedLayers[b];if(E.recalculate(t,this._availableImages),!E.isHidden(t.zoom)){const C=this.getLayerSourceCache(E);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,E.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(E,t)}):this.precompilePrograms(E,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const b of v)b.sourceCache.used=!0;for(const b in _){const E=this._mergedSourceCaches[b];_[b]!==E.used&&E.getSource().fire(new n.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new n.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const h=s.resolvePendingRequests(),p=this.getFragmentStyle(s.scope);p&&p.addImages(h)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const h=this._mergedSourceCaches[s].getSource().scope;t[h]=t[h]||this._changes.getUpdatedImages(h),t[h].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[h])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,h){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:s?p._serializeLayers(s):[],scope:t,removedIds:h||[],options:p.options})}setState(t,s){if(this._checkLoaded(),sa(this,Bs(t)))return!1;(t=n.d7(t)).layers=Ju(t.layers);const h=function(v,b){if(!v)return[{command:Wi.setStyle,args:[b]}];let E=[];try{if(!n.bv(v.version,b.version))return[{command:Wi.setStyle,args:[b]}];if(n.bv(v.center,b.center)||E.push({command:Wi.setCenter,args:[b.center]}),n.bv(v.zoom,b.zoom)||E.push({command:Wi.setZoom,args:[b.zoom]}),n.bv(v.bearing,b.bearing)||E.push({command:Wi.setBearing,args:[b.bearing]}),n.bv(v.pitch,b.pitch)||E.push({command:Wi.setPitch,args:[b.pitch]}),n.bv(v.sprite,b.sprite)||E.push({command:Wi.setSprite,args:[b.sprite]}),n.bv(v.glyphs,b.glyphs)||E.push({command:Wi.setGlyphs,args:[b.glyphs]}),n.bv(v.imports,b.imports)||function(O=[],j=[],V){j=j||[];const q=(O=O||[]).map(Jo),$=j.map(Jo),Q=O.reduce(yl,{}),re=j.reduce(yl,{}),oe=q.slice();let fe,ue,he,ae;for(fe=0,ue=0;fe<q.length;fe++)he=q[fe],re.hasOwnProperty(he)?ue++:(V.push({command:Wi.removeImport,args:[he]}),oe.splice(oe.indexOf(he,ue),1));for(fe=0,ue=0;fe<$.length;fe++)he=$[$.length-1-fe],oe[oe.length-1-fe]!==he&&(Q.hasOwnProperty(he)?(V.push({command:Wi.removeImport,args:[he]}),oe.splice(oe.lastIndexOf(he,oe.length-ue),1)):ue++,ae=oe[oe.length-fe],V.push({command:Wi.addImport,args:[re[he],ae]}),oe.splice(oe.length-fe,0,he));for(const _e of j){const ge=Q[_e.id];ge&&!n.bv(ge,_e)&&V.push({command:Wi.updateImport,args:[_e.id,_e]})}}(v.imports,b.imports,E),n.bv(v.transition,b.transition)||E.push({command:Wi.setTransition,args:[b.transition]}),n.bv(v.light,b.light)||E.push({command:Wi.setLight,args:[b.light]}),n.bv(v.fog,b.fog)||E.push({command:Wi.setFog,args:[b.fog]}),n.bv(v.snow,b.snow)||E.push({command:Wi.setSnow,args:[b.snow]}),n.bv(v.rain,b.rain)||E.push({command:Wi.setRain,args:[b.rain]}),n.bv(v.projection,b.projection)||E.push({command:Wi.setProjection,args:[b.projection]}),n.bv(v.lights,b.lights)||E.push({command:Wi.setLights,args:[b.lights]}),n.bv(v.camera,b.camera)||E.push({command:Wi.setCamera,args:[b.camera]}),n.bv(v.iconsets,b.iconsets)||function(O,j,V){let q;for(q in j=j||{},O=O||{})O.hasOwnProperty(q)&&(j.hasOwnProperty(q)||V.push({command:Wi.removeIconset,args:[q]}));for(q in j){if(!j.hasOwnProperty(q))continue;const $=j[q];O.hasOwnProperty(q)?n.bv(O[q],$)||(V.push({command:Wi.removeIconset,args:[q]}),V.push({command:Wi.addIconset,args:[q,$]})):V.push({command:Wi.addIconset,args:[q,$]})}}(v.iconsets,b.iconsets,E),!n.bv(v["color-theme"],b["color-theme"]))return[{command:Wi.setStyle,args:[b]}];const C={},R=[];(function(O,j,V,q){let $;for($ in j=j||{},O=O||{})O.hasOwnProperty($)&&(j.hasOwnProperty($)||gl($,V,q));for($ in j){if(!j.hasOwnProperty($))continue;const Q=j[$];O.hasOwnProperty($)?n.bv(O[$],Q)||(O[$].type==="geojson"&&Q.type==="geojson"&&Tm(O,j,$)?V.push({command:Wi.setGeoJSONSourceData,args:[$,Q.data]}):Ey($,j,V,q)):_l($,j,V)}})(v.sources,b.sources,R,C);const k=[];v.layers&&v.layers.forEach(O=>{O.source&&C[O.source]?E.push({command:Wi.removeLayer,args:[O.id]}):k.push(O)});let D=v.terrain;D&&C[D.source]&&(E.push({command:Wi.setTerrain,args:[void 0]}),D=void 0),E=E.concat(R),n.bv(D,b.terrain)||E.push({command:Wi.setTerrain,args:[b.terrain]}),function(O,j,V){j=j||[];const q=(O=O||[]).map(Jo),$=j.map(Jo),Q=O.reduce(yl,{}),re=j.reduce(yl,{}),oe=q.slice(),fe=Object.create(null);let ue,he,ae,_e,ge,Oe,Re;for(ue=0,he=0;ue<q.length;ue++)ae=q[ue],re.hasOwnProperty(ae)?he++:(V.push({command:Wi.removeLayer,args:[ae]}),oe.splice(oe.indexOf(ae,he),1));for(ue=0,he=0;ue<$.length;ue++)ae=$[$.length-1-ue],oe[oe.length-1-ue]!==ae&&(Q.hasOwnProperty(ae)?(V.push({command:Wi.removeLayer,args:[ae]}),oe.splice(oe.lastIndexOf(ae,oe.length-he),1)):he++,Oe=oe[oe.length-ue],V.push({command:Wi.addLayer,args:[re[ae],Oe]}),oe.splice(oe.length-ue,0,ae),fe[ae]=!0);for(ue=0;ue<$.length;ue++)if(ae=$[ue],_e=Q[ae],ge=re[ae],!fe[ae]&&!n.bv(_e,ge))if(n.bv(_e.source,ge.source)&&n.bv(_e["source-layer"],ge["source-layer"])&&n.bv(_e.type,ge.type)){for(Re in Pa(_e.layout,ge.layout,V,ae,null,Wi.setLayoutProperty),Pa(_e.paint,ge.paint,V,ae,null,Wi.setPaintProperty),n.bv(_e.slot,ge.slot)||V.push({command:Wi.setSlot,args:[ae,ge.slot]}),n.bv(_e.filter,ge.filter)||V.push({command:Wi.setFilter,args:[ae,ge.filter]}),n.bv(_e.minzoom,ge.minzoom)&&n.bv(_e.maxzoom,ge.maxzoom)||V.push({command:Wi.setLayerZoomRange,args:[ae,ge.minzoom,ge.maxzoom]}),_e)_e.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?Pa(_e[Re],ge[Re],V,ae,Re.slice(6),Wi.setPaintProperty):n.bv(_e[Re],ge[Re])||V.push({command:Wi.setLayerProperty,args:[ae,Re,ge[Re]]}));for(Re in ge)ge.hasOwnProperty(Re)&&!_e.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?Pa(_e[Re],ge[Re],V,ae,Re.slice(6),Wi.setPaintProperty):n.bv(_e[Re],ge[Re])||V.push({command:Wi.setLayerProperty,args:[ae,Re,ge[Re]]}))}else V.push({command:Wi.removeLayer,args:[ae]}),Oe=oe[oe.lastIndexOf(ae)+1],V.push({command:Wi.addLayer,args:[ge,Oe]})}(k,b.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Wi.setStyle,args:[b]}]}return E}(this.serialize(),t).filter(v=>!(v.command in Lm));if(h.length===0)return!1;const p=h.filter(v=>!(v.command in km));if(p.length>0)throw new Error(`Unimplemented: ${p.map(v=>v.command).join(", ")}.`);const _=[];return h.forEach(v=>{_.push(this[v.command](...v.args))}),s&&Promise.all(_).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s))return this.fire(new n.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new n.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new n.A("data",{dataType:"style"})),this}addModel(t,s,h={}){return this._checkLoaded(),this._validate(ye,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this.fire(new n.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Ac,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=pl(t,s,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=v=>{const b=(v?"symbol:":"other:")+p.id,E=n.C(b,this.scope),C=this._sourceCaches[b]=new is(E,p,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=C,C.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([_,v])=>v.type==="source"&&v.source===t);if(p)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const h=this.getOwnSourceCaches(t);for(const p of h){const _=n.d8(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new n.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const p of t){if(this._validate(Ic,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(s)}else this.ambientLight=new rn(p,vr||(vr=new n.a7({color:new n.a8(n.a5.properties_light_ambient.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(s)}else this.directionalLight=new rn(p,Xi||(Xi=new n.a7({direction:new n.an(n.a5.properties_light_directional.direction),color:new n.a8(n.a5.properties_light_directional.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_directional.intensity),"cast-shadows":new n.a8(n.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a8(n.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a8(n.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new n.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=D=>.2126*(D[0]<=.03928?D[0]/12.92:Math.pow((D[0]+.055)/1.055,2.4))+.7152*(D[1]<=.03928?D[1]/12.92:Math.pow((D[1]+.055)/1.055,2.4))+.0722*(D[2]<=.03928?D[2]/12.92:Math.pow((D[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),_=t.properties.get("intensity"),v=t.properties.get("direction"),b=1-n.cR(v.x,v.y,v.z)[2]/90,E=h(p)*_*b,C=s.properties.get("color").toRenderColor(null).toArray01(),R=s.properties.get("intensity"),k=h(C)*R;return Number(((E+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.d9(t)){const s=n.da(t),h=this.fragments.find(({id:_})=>_===s);if(!h)return;const p=n.d8(t);return h.style.getFragmentStyle(p)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(p,_="")=>`${p}::${_}`;this._featuresetSelectors={};for(const p in t){const _=this._featuresetSelectors[p]=[];for(const v of t[p].selectors){if(v.featureNamespace){const E=this.getOwnLayer(v.layer);if(!E){n.w(`Layer is undefined for selector: ${v.layer}`);continue}const C=h(E.source,E.sourceLayer);if(C in s&&s[C]!==v.featureNamespace){n.w(`"featureNamespace ${v.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}s[C]=v.featureNamespace}let b;if(v.properties)for(const E in v.properties){const C=n.X(v.properties[E]);C.result==="success"&&(b=b||{},b[E]=C.value)}_.push({layerId:v.layer,namespace:v.featureNamespace,properties:b,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const p in s.stylesheet.featuresets)h.push({featuresetId:p,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),p=h.stylesheet.featuresets;if(!p||!p[t])return this.fire(new n.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const v of p[t].selectors){const b=h.getOwnLayer(v.layer);b&&_.push(b)}return _}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const p=n.C(s,h.scope),_=h.options.get(p),v=_?_.value||_.default:null;return v?v.serialize():null}setConfigProperty(t,s,h){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.indoor?Mm(p.stylesheet.schema):p.stylesheet.schema;if(!_||!_[s])return;const v=n.X(h);if(v.result!=="success")return void sa(this,v.value);const b=v.value.expression,E=n.C(s,p.scope),C=p.options.get(E);if(!C)return;let R;const{minValue:k,maxValue:D,stepValue:O,type:j,values:V}=_[s],q=n.X(_[s].default);q.result==="success"&&(R=q.value.expression),R?(this.options.set(E,Object.assign({},C,{value:b,default:R,minValue:k,maxValue:D,stepValue:O,type:j,values:V})),this.updateConfigDependencies(s)):this.fire(new n.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const p={};for(const _ in h){const v=n.C(_,s.scope),b=s.options.get(v),E=b?b.value||b.default:null;p[_]=E?E.serialize():null}return p}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let p,_;const v=n.X(s[h].default);if(v.result==="success"&&(p=v.value.expression),t&&t[h]!==void 0){const D=n.X(t[h]);D.result==="success"&&(_=D.value.expression)}const{minValue:b,maxValue:E,stepValue:C,type:R,values:k}=s[h];if(p){const D=n.C(h,this.scope);this.options.set(D,{default:p,value:_,minValue:b,maxValue:E,stepValue:C,type:R,values:k})}else this.fire(new n.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new n.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const p=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&p!==""||s._styleColorTheme.lut&&p!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new n.z(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(sa(this,n.db(t)))return;_=n.dc(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=n.d7(t),t=n.l(t,{source:p})),this._validate(G,`layers.${p}`,t,{arrayIndex:-1},h))return;_=n.dc(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let v=this._order.length;if(s){const R=this._order.indexOf(s);if(R===-1)return void this.fire(new n.z(new Error(`Layer with id "${s}" does not exist on this map.`)));_.slot===this._layers[s].slot?v=R:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const b=this.getOwnLayerSourceCache(_),E=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&_.canCastShadows()&&E&&(b.castsShadows=!0);const C=this._changes.getRemovedLayer(_);if(C&&_.source&&b&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const R=n.C(_.source,_.scope);C.type!==_.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),b.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(s){const v=this._order.indexOf(s);if(v===-1)return void this.fire(new n.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?_=v:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const p=this.getOwnLayerSourceCache(s);if(p&&p.castsShadows){let _=!1;for(const v in this._layers)if(this._layers[v].source===s.source&&this._layers[v].canCastShadows()){_=!0;break}p.castsShadows=_}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===s&&p.maxzoom===h||(s!=null&&(p.minzoom=s),h!=null&&(p.maxzoom=h),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!n.bv(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(K,`layers.${p.id}.filter`,s,{layerType:p.type},h)||(p.filter=n.d7(s),this._updateLayer(p)))}getFilter(t){const s=this._checkLayer(t);if(s)return n.d7(s.filter)}setLayoutProperty(t,s,h,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!n.bv(_.getLayoutProperty(s),h)){if(h!=null&&(!p||p.validate!==!1)&&sa(_,ve.call(Bs,{key:`layers.${t}.layout.${s}`,layerType:_.type,objectKey:s,value:h,styleSpec:n.a5,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(s,h),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||n.bv(_.getPaintProperty(s),h)||h!=null&&(!p||p.validate!==!1)&&sa(_,ce.call(Bs,{key:`layers.${t}.paint.${s}`,layerType:_.type,objectKey:s,value:h,styleSpec:n.a5})))return;const v=_.setPaintProperty(s,h);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),v&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:C}=t.target,R=this.getFragmentStyle(C),k=R.getFeaturesetLayers(E);for(const{source:D,sourceLayer:O}of k)R.setFeatureState({id:t.id,source:D,sourceLayer:O},s)}else if("layerId"in t.target){const{layerId:E}=t.target,C=this.getLayer(E);this.setFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer},s)}return}const h=t.source,p=t.sourceLayer,_=this._checkSource(h);if(!_)return;const v=_.type;if(v==="geojson"&&p)return void this.fire(new n.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!p)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(h);for(const E of b)E.setFeatureState(p,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:C}=t.target,R=this.getFragmentStyle(C),k=R.getFeaturesetLayers(E);for(const{source:D,sourceLayer:O}of k)R.removeFeatureState({id:t.id,source:D,sourceLayer:O},s)}else if("layerId"in t.target){const{layerId:E}=t.target,C=this.getLayer(E);this.removeFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer},s)}return}const h=t.source,p=this._checkSource(h);if(!p)return;const _=p.type,v=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!v)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.z(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(h);for(const E of b)E.removeFeatureState(v,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:v,importId:b}=t.target,E=this.getFragmentStyle(b),C=E.getFeaturesetLayers(v);for(const{source:R,sourceLayer:k}of C){const D=E.getFeatureState({id:t.id,source:R,sourceLayer:k});if(D&&!_)_=D;else if(!n.bv(_,D))return void this.fire(new n.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,b=this.getLayer(v);_=this.getFeatureState({id:t.id,source:b.source,sourceLayer:b.sourceLayer})}return _}const s=t.source,h=t.sourceLayer,p=this._checkSource(s);if(p){if(p.type!=="vector"||h)return t.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=n.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=b=>this._mergedLayers[b].is3D(!!this.terrain),h=this.order,p={},_=[];for(let b=h.length-1;b>=0;b--){const E=h[b];if(s(E)){p[E]=b;for(const C of t){const R=C[E];if(R)for(const k of R)_.push(k)}}}_.sort((b,E)=>E.intersectionZ-b.intersectionZ);const v=[];for(let b=h.length-1;b>=0;b--){const E=h[b];if(s(E))for(let C=_.length-1;C>=0;C--){const R=_[C].feature;if(R.layer&&p[R.layer.id]<b)break;v.push(R),_.pop()}else for(const C of t){const R=C[E];if(R)for(const k of R)v.push(k.feature)}}return v}queryRenderedFeatures(t,s,h){let p;s&&!Array.isArray(s)&&s.filter&&(this._validate(K,"queryRenderedFeatures.filter",s.filter,null,s),p=n.b3(s.filter));const _={},v=R=>{if(zo.has(R.type))return;const k=this.getOwnLayerSourceCache(R),D=_[k.id]=_[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};R.is3D(!!this.terrain)&&(D.has3DLayers=!0),D.layers[R.fqid]=D.layers[R.fqid]||{styleLayer:R,targets:[]},D.layers[R.fqid].targets.push({filter:p})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new n.z(new Error("parameters.layers must be an Array."))),[];for(const R of s.layers){const k=this._layers[R];if(!k)return this.fire(new n.z(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];v(k)}}else for(const R in this._layers)v(this._layers[R]);const b=this._queryRenderedFeatures(t,_,h),E=this._flattenAndSortRenderedFeatures(b),C=[];for(const R of E)n.de(R.layer.id)===this.scope&&C.push(R);return C}queryRenderedFeatureset(t,s,h){let p;s&&!Array.isArray(s)&&s.filter&&(this._validate(K,"queryRenderedFeatures.filter",s.filter,null,s),p=n.b3(s.filter));const _="mock",v=[];if(s&&s.target)v.push(Object.assign({},s,{targetId:_,filter:p}));else{const R=this.getFeaturesetDescriptors();for(const k of R)v.push({targetId:_,filter:p,target:k});for(const{style:k}of this.fragments){const D=k.getFeaturesetDescriptors();for(const O of D)v.push({targetId:_,filter:p,target:O})}}const b=this.queryRenderedTargets(t,v,h),E=[],C=new Set;for(const R of b)for(const k of R.variants[_])Pc(k,R,C)||E.push(new n.df(R,k));return E}queryRenderedTargets(t,s,h){const p={},_=(b,E,C,R)=>{const k=p[E.id]=p[E.id]||{sourceCache:E,layers:{},has3DLayers:!1};if(k.layers[b.fqid]=k.layers[b.fqid]||{styleLayer:b,targets:[]},b.is3D(!!this.terrain)&&(k.has3DLayers=!0),!R)return C.uniqueFeatureID=!1,void k.layers[b.fqid].targets.push(C);k.layers[b.fqid].targets.push(Object.assign({},C,{namespace:R.namespace,properties:R.properties,uniqueFeatureID:R.uniqueFeatureID}))};for(const b of s)if("featuresetId"in b.target){const{featuresetId:E,importId:C}=b.target,R=this.getFragmentStyle(C);if(!R||!R._featuresetSelectors)continue;const k=R._featuresetSelectors[E];if(!k){this.fire(new n.z(new Error(`The featureset '${E}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const D of k){const O=R.getOwnLayer(D.layerId);O&&!zo.has(O.type)&&_(O,R.getOwnLayerSourceCache(O),b,D)}}else if("layerId"in b.target){const{layerId:E}=b.target,C=this.getLayer(E);if(!C||zo.has(C.type))continue;_(C,this.getLayerSourceCache(C),b)}const v=this._queryRenderedFeatures(t,p,h);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,s,h){const p=[],_=!!this.map._showQueryGeometry,v=fn.createFromScreenPoints(t,h);for(const b in s){const E=Ca(v,s[b],this._availableImages,h,_);Object.keys(E).length&&p.push(E)}if(this.placement)for(const b in s){if(!s[b].sourceCache._onlySymbols)continue;const E=Mc(v.screenGeometry,s[b],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(E).length&&p.push(E)}return p}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(K,"querySourceFeatures.filter",h,null,s);let p=[];const _=this.getOwnSourceCaches(t);for(const v of _)p=p.concat(Gd(v,s));return p}addSourceType(t,s,h){return Vs.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(Vs.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const b in t)if(!n.bv(t[b],p[b])){_=!0;break}if(!_)return;const v=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const p=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const b="terrain-dem-src";this.addSource(b,h.source),h=n.d7(h),h=n.l(h,{source:b})}const _=n.l({},h),v={};if(this.terrain&&p){_.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(v.style=b.serialize())}if(this._validate(gt,"terrain",_,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new n.A("data",{dataType:"style"}))}else{const _=this.terrain,v=_.get();for(const b of Object.keys(n.a5.terrain))!h.hasOwnProperty(b)&&n.a5.terrain[b].default&&(h[b]=n.a5.terrain[b].default);for(const b in t)if(!n.bv(t[b],v[b])){_.set(t,this.options),this.stylesheet.terrain=t;const E=this._getTransitionParameters({duration:0});_.updateTransitions(E),this.fire(new n.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ri(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new xr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new Er(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!n.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!n.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!n.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new n.A("colorthemeset")),t()}).catch(p=>{n.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new Ye(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});h.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,p,_={}){if(_&&_.validate===!1)return!1;const v=n.l({},this.serialize());return sa(this,t.call(Bs,n.l({key:s,style:v,value:h,styleSpec:n.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=ef(this.directionalLight));const h=new Set;for(const p in this._mergedLayers){const _=this._mergedLayers[p];_.hasElevation()&&!h.has(_.source)&&h.add(_.source)}for(const p in this._mergedSourceCaches){const _=this._mergedSourceCaches[p],v=h.has(_._source.id);_.update(t,void 0,void 0,s,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,p,_,v,b=!1){let E=!1,C=!1;const R={},k={};for(const D of this._mergedOrder){const O=this._mergedLayers[D];if(O.type!=="symbol")continue;const j=n.C(O.source,O.scope);let V=R[j];if(!V){const $=this.getLayerSourceCache(O);if(!$)continue;const Q=$.getRenderableIds(!0).map(re=>$.getTileByID(re));k[j]=Q.slice(),V=R[j]=Q.sort((re,oe)=>oe.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(oe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(O,V,s.center.lng,s.projection);E=E||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new n.A("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),s.zoom))&&(this.pauseablePlacement=new ns(s,this._mergedOrder,b,h,p,_,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E){this._buildingIndex.onNewFrame(s.zoom);for(let D=0;D<this._mergedOrder.length;D++){const O=this._mergedLayers[this._mergedOrder[D]];if(O.type!=="symbol")continue;const j=this.isLayerClipped(O);this.placement.updateLayerOpacities(O,R[n.C(O.source,O.scope)],D,j?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new n.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const p=h.findIndex(({id:_})=>_===s);return p===-1&&this.fire(new n.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,p).concat(t).concat(h.slice(p)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[p].url&&this.setImportUrl(t,s.url),n.bv(s.config,h[p].config)||this.setImportConfig(t,s.config,s.data.schema),n.bv(s.data,h[p].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(s);if(_===-1)return this;const v=h[p],b=this.fragments[p];return h=h.filter(({id:E})=>E!==t),this.fragments=this.fragments.filter(({id:E})=>E!==t),this.stylesheet.imports=h.slice(0,_).concat(v).concat(h.slice(_)),this.fragments=this.fragments.slice(0,_).concat(b).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;h[p].url=s;const _=this.fragments[p];return _.style=this._createFragmentStyle(h[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),p=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete p[h].data,this.setImportUrl(t,p[h].url))}setImportConfig(t,s,h){this._checkLoaded();const p=this.getImportIndex(t),_=this.stylesheet.imports||[];if(p===-1)return this;s?_[p].config=s:delete _[p].config;const v=this.fragments[p];h&&v.style.stylesheet&&(v.style.stylesheet.schema=h);const b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=s,v.style.updateConfig(s,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new n.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=n.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=n.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const p=this.getLayer(h);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const p=v=>{if(v){const b=s.images.map(E=>n.I.toString(E));v.setDependencies(s.tileID.key,s.type,b)}},_=n.C(s.source,s.scope);p(this._mergedOtherSourceCaches[_]),p(this._mergedSymbolSourceCaches[_])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return n.dh(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new n.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(h||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vs.getSourceType=function(u){return Cc[u]},Vs.setSourceType=function(u,t){Cc[u]=t},Vs.registerForPluginStateChange=n.c$;var Sl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,El=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,nf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ah="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ds=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,lh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,sf=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ch=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,uh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,of=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Fa=[];Il(Sl,Fa),Il(nf,Fa),Il(El,Fa);const js={"_prelude_fog.vertex.glsl":lh,"_prelude_terrain.vertex.glsl":Ds,"_prelude_shadow.vertex.glsl":uh,"_prelude_fog.fragment.glsl":vt,"_prelude_shadow.fragment.glsl":of,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":sf,"_prelude_raster_particle.glsl":ch},Al={};ji("",Ds),ji(vt,lh),ji(of,uh),ji(sf,""),ji(ch,"");const oa=ji(El,nf),Gc=Sl;var Ba={background:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ji("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ji(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ji("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ji("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ji(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ji(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ji(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ji(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ji(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ji("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ji("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ji(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ji(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ji("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ji(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ah),skyboxGradient:ji(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ah),skyboxCapture:ji(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ji(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ji(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ji("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ji("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ji("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ji("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Il(u,t){const s=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=h.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function ji(u,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(C=>{const R=C.split(" ");return R[R.length-1]}),p=[...new Set(p)]);const _={},v=[],b=[];if(u=u.replace(s,(C,R)=>(b.push(R),"")),(t=t.replace(s,(C,R)=>(v.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let E=[...Fa];Il(u,E),Il(t,E);for(const C of[...v,...b])js[C]||console.error(`Undefined include: ${C}`),Al[C]||(Al[C]=[],Il(js[C],Al[C])),E=[...E,...Al[C]];return{fragmentSource:u=u.replace(h,(C,R,k,D,O)=>(_[O]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${k} ${D} ${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${k} ${D} ${O} = u_${O};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${k} ${D} ${O};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(C,R,k,D,O)=>{const j=D==="float"?"vec2":D,V=O.match(/color/)?"color":j;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${k} ${D} a_${O};
#endif
`:_[O]?R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${k} ${j} a_${O};
out ${k} ${D} ${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:R==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${k} ${D} a_${O};
    out ${k} ${D} ${O};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${k} ${j} a_${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:R==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${k} ${D} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${j} a_${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${k} ${D} ${O} = a_${O};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${k} ${D} ${O} = a_${O};
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${k} ${D} ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${k} ${D} ${O} = u_${O};
#endif
`}),staticAttributes:p,usedDefines:E,vertexIncludes:v,fragmentIncludes:b}}class af{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,p,_,v,b,E){this.context=t;let C=this.boundPaintVertexBuffers.length!==p.length;for(let k=0;!C&&k<p.length;k++)this.boundPaintVertexBuffers[k]!==p[k]&&(C=!0);let R=this.boundDynamicVertexBuffers.length!==b.length;for(let k=0;!R&&k<b.length;k++)this.boundDynamicVertexBuffers[k]!==b[k]&&(R=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||C||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==v)this.freshBind(s,h,p,_,v,b,E);else{t.bindVertexArrayOES.set(this.vao);for(const k of b)k&&(k.bind(),E&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,s,E));_&&_.dynamicDraw&&_.bind()}}freshBind(t,s,h,p,_,v,b){const E=t.numAttributes,C=this.context,R=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=v,s.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,_);for(const k of h)k.enableAttributes(R,t),k.bind(),k.setVertexAttribPointers(R,t,_);for(const k of v)k&&(k.enableAttributes(R,t),k.bind(),k.setVertexAttribPointers(R,t,_),b&&k.instanceCount&&k.setVertexAttribDivisor(R,t,b));p&&p.bind(),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ry(u,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new n.ac(0,h/s).toLngLat().lat,new n.ac(0,(h+1)/s).toLngLat().lat]}function zm(u,t,s,h,p,_,v){const b=u.context,E=b.gl,C=s.hillshadeFBO;if(!C)return;u.prepareDrawTile();const R=u.isTileAffectedByFog(t),k=u.getOrCreateProgram("hillshade",{overrideFog:R});b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get());const D=((q,$,Q,re)=>{const oe=Q.paint.get("hillshade-shadow-color"),fe=Q.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ue=Q.paint.get("hillshade-highlight-color"),he=Q.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ae=Q.paint.get("hillshade-accent-color"),_e=Q.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ge=Q.paint.get("hillshade-emissive-strength");let Oe=n.al(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")Oe-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const Je=q.style.directionalLight.properties.get("direction"),Xe=n.cR(Je.x,Je.y,Je.z);Oe=n.al(Xe[1])}const Re=!q.options.moving;return{u_matrix:re||q.transform.calculateProjMatrix($.tileID.toUnwrapped(),Re),u_image:0,u_latrange:Ry(0,$.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),Oe],u_shadow:oe.toRenderColor(fe?null:Q.lut),u_highlight:ue.toRenderColor(he?null:Q.lut),u_emissive_strength:ge,u_accent:ae.toRenderColor(_e?null:Q.lut)}})(u,s,h,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(b,k,t.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:V}=u.getTileBoundsBuffers(s);k.draw(u,E.TRIANGLES,p,_,v,li.disabled,D,h.id,O,j,V)}function lf(u,t,s){if(!t.needsDEMTextureUpload)return;const h=u.context,p=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new n.T(h,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function cf(u,t,s){const h=u.context,p=h.gl;if(!t.dem)return;const _=t.dem;if(h.activeTexture.set(p.TEXTURE1),lf(u,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const v=_.dim;h.activeTexture.set(p.TEXTURE0);let b=t.hillshadeFBO;if(!b){const D=new n.T(h,{width:v,height:v,data:null},p.RGBA8);D.bind(p.LINEAR,p.CLAMP_TO_EDGE),b=t.hillshadeFBO=h.createFramebuffer(v,v,!0,"renderbuffer"),b.colorAttachment.set(D.texture)}h.bindFramebuffer.set(b.framebuffer),h.viewport.set([0,0,v,v]);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:C,tileBoundsSegments:R}=u.getMercatorTileBoundsBuffers(),k=[];u.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(u,p.TRIANGLES,Dt.disabled,ai.disabled,Ci.unblended,li.disabled,((D,O)=>{const j=O.stride,V=n.bz();return n.c5(V,0,n.aj,-n.aj,0,0,1),n.bo(V,V,[0,-n.aj,0]),{u_matrix:V,u_image:1,u_dimension:[j,j],u_zoom:D.overscaledZ}})(t.tileID,_),s.id,E,C,R),t.needsHillshadePrepare=!1}class Zr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dy extends Zr{getDefault(){return n.am.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ky extends Zr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ly extends Zr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Om extends Zr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zy extends Zr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hh extends Zr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Oy extends Zr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Fm extends Zr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class uf extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class dh extends Zr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hf extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Na extends Zr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class df extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Bm extends Zr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends Zr{getDefault(){return n.am.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Hc extends Zr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class fh extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ph extends Zr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Pl extends Zr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let mh=class extends Zr{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class ff extends Zr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Nm extends Zr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pf extends Zr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class _h extends Zr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qc extends Zr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Um extends Zr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Vm extends Zr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jm extends Zr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Ml extends Zr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $m extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Fy extends Zr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mf extends Zr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class By extends mf{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class gh extends mf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _f extends mf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class gf extends gh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const yf=(u,t,s)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),vf=(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:C,u_globe_pos:R,u_globe_radius:k,u_viewport:D,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:O,u_far_z_cutoff:j});function xf(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const Rl=new class{constructor(){this.operations={}}newMorphing(u,t,s,h,p){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[u]={startTime:h,phase:0,duration:p,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Dl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function kl(u,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*h}function Gm(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const ms=u=>({u_matrix:u});function Wc(u,t,s,h,p){if(p>0){const _=n.q.now(),v=(_-u.timeAdded)/p,b=t?(_-t.timeAdded)/p:-1,E=s.getSource(),C=h.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-C)>Math.abs(u.tileID.overscaledZ-C),k=R&&u.refreshedUponExpiration?1:n.aD(R?v:1-b,0,1);return u.refreshedUponExpiration&&v>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class yh extends is{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new n.D(n.d0(),null),p=pl("mock-dem",s,h,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class vh extends is{constructor(t){const s=pl("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.D(n.d0(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,v)=>{if(_[v.key]="",!this._tiles[v.key]){const b=new ko(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);b.state="loaded",this._tiles[v.key]=b}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xh extends n.aM{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class bh extends n.dt{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,p,_]=function(E){const C=new n.ba,R=new n.a_,k=131;C.reserve(17161),R.reserve(33800);const D=n.aj/128,O=n.aj+D/2,j=O+D;for(let q=-D;q<j;q+=D)for(let $=-D;$<j;$+=D){const Q=$<0||$>O||q<0||q>O?24575:0,re=n.aD(Math.round($),0,n.aj),oe=n.aD(Math.round(q),0,n.aj);C.emplaceBack(re+Q,oe)}const V=(q,$)=>{const Q=$*k+q;R.emplaceBack(Q+1,Q,Q+k),R.emplaceBack(Q+k,Q+k+1,Q+1)};for(let q=1;q<129;q++)for(let $=1;$<129;$++)V($,q);return[0,129].forEach(q=>{for(let $=0;$<130;$++)V($,q),V(q,$)}),[C,R,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(h,n.bc.members),this.gridIndexBuffer=v.createIndexBuffer(p),this.gridSegments=n.bd.simpleSegment(0,0,h.length,p.length),this.gridNoSkirtSegments=n.bd.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vh(s.map),this.orthoMatrix=n.bz(),n.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.aj,0,n.aj,0,1);const b=v.gl;this._overlapStencilMode=new ai({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yh(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const b=t.terrain&&t.terrain.scope,E=p.get("source"),C=_?this._mockSourceCache:t.getSourceCache(E,b);if(!C)return void n.w(`Couldn't find terrain source "${E}".`);if(this.sourceCache=C,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(s):p.get("exaggeration"),!s.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(s,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const p=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(_);let b=_-this._previousZoom;const E=this._previousUpdateTimestamp;let C=_;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(_-C)>.5&&(b=.5*(_-C+b)),b*p<0&&(C+=b)),this._evaluationZoom=C;const R=v.getExaggeration(C),k=R===v.getExaggeration(Math.max(0,C-.1));if(k&&Math.abs(R-this._exaggeration)<.01)return R;let D=Math.min(.1,.00375*(this._updateTimestamp-E));return(k||R<.1||Math.abs(b)<1e-4)&&(D=Math.min(.2,4*D)),n.ai(this._exaggeration,R,D)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(n.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=s.getIds().map(E=>{const C=s.getTileByID(E).tileID;return C.projMatrix=h.calculateProjMatrix(C.toUnwrapped()),C});(function(E,C){const R=C.transform.pointCoordinate(C.transform.getCameraPoint()),k=new n.P(R.x,R.y);E.sort((D,O)=>{if(O.overscaledZ-D.overscaledZ)return O.overscaledZ-D.overscaledZ;const j=new n.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),V=new n.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),q=k.mult(1<<D.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(j)-q.distSqr(V)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const E in v){const C=v[E];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,t[E],_),C.usedForTerrain))continue;const R=t[E];C.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[s.id]=p.map(E=>new xh(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const C=this.terrainTileForTile[E.key];if(!C)continue;const R=C.tileID.key;R in b||(this._visibleDemTiles.push(C),b[R]=R)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const p=this.terrainTileForTile[h],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),lf(this.painter,p,_))}}_prepareDemTileUniforms(t,s,h,p){if(!s||s.demTexture==null)return!1;const _=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-_.z),b=p||"";return h[`u_dem_tl${b}`]=[_.x*v%1,_.y*v%1],h[`u_dem_scale${b}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,p)=>{if(!p.dem)return h;const _=p.dem.tree.minimums[0];return _>0&&t++,h+_},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),p=new n.du({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new n.T(t,p,s.R32F,{premultiply:!1}),_}setupElevationDraw(t,s,h){const p=this.painter.context,_=p.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let b=null,E=null,C=1;if(h&&h.morphing&&this._useVertexMorphing){const O=h.morphing.srcDemTile,j=h.morphing.dstDemTile;C=h.morphing.phase,O&&j&&(this._prepareDemTileUniforms(t,O,v,"_prev")&&(E=O),this._prepareDemTileUniforms(t,j,v)&&(b=j))}const R=O=>O&&O.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let k=null;var D;if(this.enabled?E&&b?(k=b.demTexture,p.activeTexture.set(_.TEXTURE4),E.demTexture.bind(R(E),_.CLAMP_TO_EDGE),v.u_dem_lerp=C):(b=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,b,v)?b.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),k&&(v.u_dem_size=(D=k).size[0]===1?1:D.size[0]-2,k.bind(R(b),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,v),h&&h.useMeterToDem&&b){const O=(1<<b.tileID.canonical.z)*n.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=O}if(h&&h.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(p,v),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(p,O)}}globeUniformValues(t,s,h){const p=t.projection;return{u_tile_tl_up:p.upVector(s,0,0),u_tile_tr_up:p.upVector(s,n.aj,0),u_tile_br_up:p.upVector(s,n.aj,n.aj),u_tile_bl_up:p.upVector(s,0,n.aj),u_tile_up_scale:h?n.dv(1):p.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,v,b,E){if(p.transform.projection.name==="globe")(function(C,R,k,D,O){const j=C.context,V=j.gl;let q,$;const Q=C.transform,re=n.dl(C,j,Q),oe=(Je,Xe)=>{if($===Xe)return;const ft=[Dl[Xe],"PROJECTION_GLOBE_VIEW"];re&&ft.push("CUSTOM_ANTIALIASING");const Me=C.isTileAffectedByFog(Je);q=C.getOrCreateProgram("globeRaster",{defines:ft,overrideFog:Me}),$=Xe},fe=C.colorModeForRenderPass(),ue=new Dt(V.LEQUAL,Dt.ReadWrite,C.depthRangeFor3D);Rl.update(O);const he=n.dm(Q),ae=[n.ay(Q.center.lng),n.aH(Q.center.lat)],_e=C.globeSharedBuffers,ge=[Q.width*n.q.devicePixelRatio,Q.height*n.q.devicePixelRatio],Oe=Float32Array.from(Q.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const Je=C.transform,Xe=kl(Je.zoom,R.exaggeration(),R.sourceCache._source.tileSize);$=-1;const ft=V.TRIANGLES;for(const Me of D){const Fe=k.getTile(Me),Ce=ai.disabled,tt=R.prevTerrainTileForTile[Me.key],Ve=R.terrainTileForTile[Me.key];xf(tt,Ve)&&Rl.newMorphing(Me.key,tt,Ve,O,250),j.activeTexture.set(V.TEXTURE0),Fe.texture&&Fe.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const st=Rl.getMorphValuesForProxy(Me.key),Qe=st?1:0;st&&n.L(Re,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:n.dk(st.phase)}});const ot=n.dn(Me.canonical),at=n.dp(ot.getCenter().lat),Rt=n.dq(Me.canonical,ot,at,Je.worldSize/Je._pixelsPerMercatorPixel),Ut=n.bh(n.dr(Me.canonical)),Ct=vf(Je.expandedFarZProjMatrix,Oe,he,Ut,n.ah(Je.zoom),ae,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,ge,Xe,Je._farZ,Rt);if(oe(Me,Qe),q&&(R.setupElevationDraw(Fe,q,Re),C.uploadCommonUniforms(j,q,Me.toUnwrapped()),_e)){const[Vt,Lt,ei]=_e.getGridBuffers(at,Xe!==0);q.draw(C,ft,ue,Ce,fe,li.backCCW,Ct,"globe_raster",Vt,Lt,ei)}}}if(_e&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Je.push("CUSTOM_ANTIALIASING"),q=C.getOrCreateProgram("globeRaster",{defines:Je});for(const Xe of D){const{x:ft,y:Me,z:Fe}=Xe.canonical,Ce=Me===0,tt=Me===(1<<Fe)-1,[Ve,st,Qe,ot]=_e.getPoleBuffers(Fe,!1);if(ot&&(Ce||tt)){const at=k.getTile(Xe);j.activeTexture.set(V.TEXTURE0),at.texture&&at.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Rt=n.ds(Fe,ft,Q);const Ut=n.bh(n.dr(Xe.canonical)),Ct=(Vt,Lt)=>Vt.draw(C,V.TRIANGLES,ue,ai.disabled,fe,li.disabled,vf(Q.expandedFarZProjMatrix,Rt,Rt,Ut,0,ae,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,ge,0,Q._farZ),"globe_pole_raster",Lt,Qe,ot);R.setupElevationDraw(at,q,Re),C.uploadCommonUniforms(j,q,Xe.toUnwrapped()),Ce&&C.renderDefaultNorthPole&&Ct(q,Ve),tt&&C.renderDefaultSouthPole&&(Rt=n.cE(n.bz(),Rt,[1,-1,1]),Ct(q,st))}}}})(p,_,v,b,E);else{const C=p.context,R=C.gl;let k,D;const O=p.shadowRenderer,j=Oa(p,p.longestCutoffRange),V=fe=>{if(D===fe)return;const ue=[];ue.push(Dl[fe]),j.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),O&&(ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&ue.push("NORMAL_OFFSET")),k=p.getOrCreateProgram("terrainRaster",{defines:ue}),D=fe},q=p.colorModeForRenderPass(),$=new Dt(R.LEQUAL,Dt.ReadWrite,p.depthRangeFor3D);Rl.update(E);const Q=p.transform,re=kl(Q.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let oe=[0,0,0];if(O){const fe=p.style.directionalLight,ue=p.style.ambientLight;fe&&ue&&(oe=mo(p.style,fe,ue))}{D=-1;const fe=R.TRIANGLES,[ue,he]=[_.gridIndexBuffer,_.gridSegments];for(const ae of b){const _e=v.getTile(ae),ge=ai.disabled,Oe=_.prevTerrainTileForTile[ae.key],Re=_.terrainTileForTile[ae.key];xf(Oe,Re)&&Rl.newMorphing(ae.key,Oe,Re,E,250),C.activeTexture.set(R.TEXTURE0),_e.texture&&_e.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const Je=Rl.getMorphValuesForProxy(ae.key),Xe=Je?1:0;let ft;Je&&(ft={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:n.dk(Je.phase)}});const Me=yf(ae.projMatrix,Gm(ae.canonical,Q.renderWorldCopies)?re/10:re,oe);if(V(Xe),!k)continue;_.setupElevationDraw(_e,k,ft);const Fe=ae.toUnwrapped();O&&O.setupShadows(Fe,k),p.uploadCommonUniforms(C,k,Fe,null,j),k.draw(p,fe,$,ge,q,li.backCCW,Me,"terrain_raster",_.gridBuffer,ue,he)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],v=this._drapedRenderBatches.shift(),b=s.style.order,E=[];let C=0;for(const R of _){const k=p.getTileByID(R.proxyTileKey),D=p.proxyCachedFBO[R.key]?p.proxyCachedFBO[R.key][t]:void 0,O=D!==void 0?p.renderCache[D]:this.pool[C++],j=D!==void 0;if(k.texture=O.tex,j&&!O.dirty){E.push(k.tileID);continue}let V;h.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(h.clear({color:n.am.transparent,stencil:0}),O.dirty=!1);for(let q=v.start;q<=v.end;++q){const $=s.style._mergedLayers[b[q]];if($.isHidden(s.transform.zoom))continue;const Q=s.style.getLayerSourceCache($),re=Q?this.proxyToSource[R.key][Q.id]:[R];if(!re)continue;const oe=re;h.viewport.set([0,0,O.fb.width,O.fb.height]),V!==(Q?Q.id:null)&&(this._setupStencil(O,re,$,Q),V=Q?Q.id:null),s.renderLayer(s,Q,$,oe)}if(this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const $=s.style._mergedLayers[b[q]];if($.isHidden(s.transform.zoom))continue;const Q=s.style.getLayerSourceCache($),re=Q?this.proxyToSource[R.key][Q.id]:[R];if(!re)continue;const oe=re;h.viewport.set([0,0,O.fb.width,O.fb.height]),V!==(Q?Q.id:null)&&(this._setupStencil(O,re,$,Q),V=Q?Q.id:null),s.renderLayer(s,Q,$,oe)}this.renderedToTile?(O.dirty=!0,E.push(k.tileID)):j||--C,C===5&&(C=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,p=s;for(let _=0;_<s;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?h=Math.max(h,_):p=Math.min(p,_);return p>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const v=_.tileID,b=1<<v.overscaledZ,{x:E,y:C}=v.canonical,R=E/b,k=(E+1)/b,D=C/b,O=(C+1)/b;return{minx:R,miny:D,maxx:k,maxy:O,t:_.dem.tree.raycastRoot(R,D,k,O,t,s,h),tile:_}});p.sort((_,v)=>(_.t!==null?_.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const v=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,h);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const p=new n.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);p.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=t.createFramebuffer(h[0],h[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new gf(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Vn){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(_&&!s[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof n.ab){s[_.id]=!0;for(const v of this.proxyCoords){const b=this.proxyToSource[v.key][_.id];if(b)for(const E of b)this._clearRenderCacheForTile(_.id,E)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof po){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(!_||s[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const v=p.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][_.id];if(E)for(const C of E){const R=Wc(_.getTile(C),_.findLoadedParent(C,0),_,this.painter.transform,v);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(_.id,C)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let p,_=0,v=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++_<s;)v=this._style._mergedLayers[t[_]];for(;_<s;++_){const b=this._style._mergedLayers[t[_]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?p===void 0&&(p=_):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(h.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&h.push({start:p,end:_-1}),h.length!==0){const b=h[h.length-1];this._pendingGroundEffectLayers.every(E=>E>b.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<v.length;++b){const E=Object.values(v[b]);s.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,p=this._tilesDirty;for(let v=h.length-1;v>=0;v--){const b=h[v];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const E=t[b.key],C=this.proxyToSource[b.key];let R=0;for(const k in C){const D=C[k],O=E[k];if(!O||O.length!==D.length||D.some((j,V)=>j!==O[V]||p[k]&&p[k].hasOwnProperty(j.key))){R=-1;break}++R}for(const k in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][k]].dirty=R<0||R!==Object.values(E).length}}const _=[...this._drapedRenderBatches];_.sort((v,b)=>b.end-b.start-(v.end-v.start));for(const v of _)for(const b of h){if(s.proxyCachedFBO[b.key])continue;let E=s.renderCachePool.pop();E===void 0&&s.renderCache.length<50&&(E=s.renderCache.length,s.renderCache.push(this._createFBO())),E!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][v.start]=E,s.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,v=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(h.isTileClipped())b=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ai.disabled}_renderTileClippingMasks(t,s){const h=this.painter,p=this.painter.context,_=p.gl;h._tileClippingMaskIDs={},p.setColorMode(Ci.disabled),p.setDepthMode(Dt.disabled);const v=h.getOrCreateProgram("clippingMask");for(const b of t){const E=h._tileClippingMaskIDs[b.key]=--s;v.draw(h,_.TRIANGLES,Dt.disabled,new ai({func:_.ALWAYS,mask:0},E,255,_.KEEP,_.KEEP,_.REPLACE),Ci.disabled,li.disabled,ms(b.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];n.aA(h,h,s.pixelMatrixInverse),n.cw(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const p=s._camera.position,_=n.c6(1,s.center.lat),v=[p[0],p[1],p[2]/_,0],b=n.cY([],h.slice(0,3),v);n.au(b,b);const E=this.raycast(v,b,this._exaggeration);return E!==null&&E?(n.bF(v,v,b,E),v[3]=v[2],v[2]*=_,v):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof n.aP)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let E=0;E<_.length;E++){const C=_[E],R=this._findTileCoveringTileID(C,t);if(R){const k=this._createProxiedId(C,R,h[C.key]&&h[C.key][t.id]);p.push(k),this.proxyToSource[C.key][t.id]=[k]}}let v=!1;const b=new Set;for(let E=0;E<s.length;E++){const C=t.getTile(s[E]);if(!C||!C.hasData())continue;const R=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==C.tileID.canonical.z){const k=this.proxyToSource[R.tileID.key][t.id],D=this._createProxiedId(R.tileID,C,h[R.tileID.key]&&h[R.tileID.key][t.id]);k?k.splice(k.length-1,0,D):this.proxyToSource[R.tileID.key][t.id]=[D];const O=this.proxyToSource[R.tileID.key][t.id];b.has(O)||b.add(O),p.push(D),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const E of b)E.sort((C,R)=>R.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,v=t.getSource(),b=v.tileID;if(!b)return;const E=new n.P(b.x,b.y)._div(1<<b.z),C=v.coordinates.map(n.ac.fromLngLat).reduce((k,D)=>(k.min.x=Math.min(k.min.x,D.x-E.x),k.min.y=Math.min(k.min.y,D.y-E.y),k.max.x=Math.max(k.max.x,D.x-E.x),k.max.y=Math.max(k.max.y,D.y-E.y),k),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(k,D)=>{const O=k.wrap+k.canonical.x/(1<<k.canonical.z),j=k.canonical.y/(1<<k.canonical.z),V=n.aj/(1<<k.canonical.z),q=D.wrap+D.canonical.x/(1<<D.canonical.z),$=D.canonical.y/(1<<D.canonical.z);return O+V<q+C.min.x||O>q+C.max.x||j+V<$+C.min.y||j>$+C.max.y};for(let k=0;k<_.length;k++){const D=_[k];for(let O=0;O<s.length;O++){const j=t.getTile(s[O]);if(!j||!j.hasData()||R(D,j.tileID))continue;const V=this._createProxiedId(D,j,h[D.key]&&h[D.key][t.id]),q=this.proxyToSource[D.key][t.id];q?q.push(V):this.proxyToSource[D.key][t.id]=[V],p.push(V)}}}_createProxiedId(t,s,h){let p=this.orthoMatrix;if(h){const _=h.find(v=>v.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){const _=t.canonical.z-s.tileID.canonical.z;let v,b,E;p=n.bz();const C=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(v=n.aj>>_,b=v*((s.tileID.canonical.x<<_)-t.canonical.x+C),E=v*((s.tileID.canonical.y<<_)-t.canonical.y)):(v=n.aj<<-_,b=n.aj*(s.tileID.canonical.x-(t.canonical.x+C<<-_)),E=n.aj*(s.tileID.canonical.y-(t.canonical.y<<-_))),n.c5(p,0,v,0,v,0,1),n.bo(p,p,[b,E,0])}return new xh(s.tileID,t.key,p)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const p=this._findCoveringTileCache[s.id],_=p[t.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let v=h?h.tileID:t,b=v.overscaledZ;const E=s.getSource().minzoom,C=[];if(!_){const k=s.getSource().maxzoom;if(t.canonical.z>=k){const D=t.canonical.z-k;s.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new n.aM(b,t.wrap,k,t.canonical.x>>D,t.canonical.y>>D)):D!==0&&(b=k,v=new n.aM(b,t.wrap,k,t.canonical.x>>D,t.canonical.y>>D))}v.key!==t.key&&(C.push(v.key),h=s.getTile(v))}const R=k=>{C.forEach(D=>{p[D]=k}),C.length=0};for(b-=1;b>=E&&(!h||!h.hasData());b--){h&&R(h.tileID.key);const k=v.calculateScaledKey(b);if(h=s.getTileByID(k),h&&h.hasData())break;const D=p[k];if(D===null)break;D===void 0?C.push(k):h=s.getTileByID(D)}return R(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function bf(u,t,s){const h=function(b,E,C){const R=n.bE(E,b),k=n.bE(C,[.2126,.7152,.0722]),D=(j,V,q)=>(1-q)*j+q*V,O=D(1-.3*Math.min(k,1),1,Math.min(R+1,1));return D(.92,1,Math.asin(n.aD(E[2],-1,1))/Math.PI+.5)*O}(u,[0,0,1],t),p=[0,0,0];n.b$(p,s.slice(0,3),h);const _=[0,0,0];n.b$(_,t.slice(0,3),u[2]);const v=[0,0,0];return n.cU(v,p,_),n.cX(v)}const wh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],wf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Th{static cacheKey(t,s,h,p){let _=`${s}${p?p.cacheKey:""}`;for(const v of h)t.usedDefines.includes(v)&&(_+=`/${v}`);return _}constructor(t,s,h,p,_,v){const b=t.gl;this.program=b.createProgram(),this.configuration=p,this.name=s,this.fixedDefines=[...v];const E=p?p.getBinderAttributes():[],C=(h.staticAttributes||[]).concat(E);let R=p?p.defines():[];R=R.concat(v.map(q=>`#define ${q}`));const k=`#version 300 es
`;let D=k+R.concat("precision mediump float;",Gc,oa.fragmentSource).join(`
`);for(const q of h.fragmentIncludes)D+=`
${js[q]}`;D+=`
${h.fragmentSource}`;let O=k+R.concat("precision highp float;",Gc,oa.vertexSource).join(`
`);for(const q of h.vertexIncludes)O+=`
${js[q]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(O+=`
uniform int u_instanceID;
`),O+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(O=O.replaceAll("gl_InstanceID","u_instanceID"));const j=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(j,D),b.compileShader(j),b.attachShader(this.program,j);const V=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(V,O),b.compileShader(V),b.attachShader(this.program,V),this.attributes={},this.numAttributes=C.length;for(let q=0;q<this.numAttributes;q++)if(C[q]){const $=C[q].startsWith("a_")?C[q]:`a_${C[q]}`;b.bindAttribLocation(this.program,q,$),this.attributes[$]=q}b.linkProgram(this.program),b.deleteShader(V),b.deleteShader(j),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(q=>({u_instanceID:new n.cc(q)}))(t)),(v.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(q=>({u_dem:new n.cc(q),u_dem_prev:new n.cc(q),u_dem_tl:new n.c9(q),u_dem_scale:new n.cb(q),u_dem_tl_prev:new n.c9(q),u_dem_scale_prev:new n.cb(q),u_dem_size:new n.cb(q),u_dem_lerp:new n.cb(q),u_exaggeration:new n.cb(q),u_depth:new n.cc(q),u_depth_size_inv:new n.c9(q),u_depth_range_unpack:new n.c9(q),u_occluder_half_size:new n.cb(q),u_occlusion_depth_offset:new n.cb(q),u_meter_to_dem:new n.cb(q),u_label_plane_matrix_inv:new n.c8(q)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new n.ca(q),u_tile_tr_up:new n.ca(q),u_tile_br_up:new n.ca(q),u_tile_bl_up:new n.ca(q),u_tile_up_scale:new n.cb(q)}))(t)),v.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new n.c8(q),u_fog_range:new n.c9(q),u_fog_color:new n.cQ(q),u_fog_horizon_blend:new n.cb(q),u_fog_vertical_limit:new n.c9(q),u_fog_temporal_offset:new n.cb(q),u_frustum_tl:new n.ca(q),u_frustum_tr:new n.ca(q),u_frustum_br:new n.ca(q),u_frustum_bl:new n.ca(q),u_globe_pos:new n.ca(q),u_globe_radius:new n.cb(q),u_globe_transition:new n.cb(q),u_is_globe:new n.cc(q),u_viewport:new n.c9(q)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new n.cQ(q)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new n.ca(q),u_lighting_directional_dir:new n.ca(q),u_lighting_directional_color:new n.ca(q),u_ground_radiance:new n.ca(q)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new n.c8(q),u_light_matrix_1:new n.c8(q),u_fade_range:new n.c9(q),u_shadow_normal_offset:new n.ca(q),u_shadow_intensity:new n.cb(q),u_shadow_texel_size:new n.cb(q),u_shadow_map_resolution:new n.cb(q),u_shadow_direction:new n.ca(q),u_shadow_bias:new n.ca(q),u_shadowmap_0:new n.cc(q),u_shadowmap_1:new n.cc(q)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}_drawDebugWireframe(t,s,h,p,_,v,b,E,C,R){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const D=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!wh.includes(this.name))||!(!k.layers3D||!wf.includes(this.name))))return;const O=D.gl,j=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,D);if(!j)return;const V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");const q=t.getOrCreateProgram(this.name,{config:this.configuration,defines:V});D.program.set(q.program);const $=(oe,fe,ue)=>{if(fe[oe]&&ue[oe])for(const he in fe[oe])ue[oe][he]&&ue[oe][he].set(ue.program,he,fe[oe][he].current)};C&&C.setUniforms(q.program,D,q.binderUniforms,b,{zoom:E}),$("fixedUniforms",this,q),$("terrainUniforms",this,q),$("globeUniforms",this,q),$("fogUniforms",this,q),$("lightsUniforms",this,q),$("shadowUniforms",this,q),j.bind(),D.setColorMode(new Ci([O.ONE,O.ONE_MINUS_SRC_ALPHA,O.ZERO,O.ONE],n.am.transparent,[!0,!0,!0,!1])),D.setDepthMode(new Dt(s.func===O.LESS?O.LEQUAL:s.func,Dt.ReadOnly,s.range)),D.setStencilMode(ai.disabled);const Q=3*v.primitiveLength*2,re=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const oe=R||1;for(let fe=0;fe<oe;++fe)q.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",fe),O.drawElements(O.LINES,Q,O.UNSIGNED_SHORT,re)}else R&&R>1?O.drawElementsInstanced(O.LINES,Q,O.UNSIGNED_SHORT,re,R):O.drawElements(O.LINES,Q,O.UNSIGNED_SHORT,re);_.bind(),D.program.set(this.program),D.setDepthMode(s),D.setStencilMode(h),D.setColorMode(p)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const p of Object.keys(h))if(!h[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${s} being defined`)}}draw(t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q){const $=t.context,Q=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(h),$.setStencilMode(p),$.setColorMode(_),$.setCullFace(v);for(const fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,b[fe]);j&&j.setUniforms(this.program,$,this.binderUniforms,D,{zoom:O});const re={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[s];this.checkUniforms(E,"RENDER_SHADOWS",this.shadowUniforms);const oe=q&&q>0?1:void 0;for(const fe of k.get()){const ue=fe.vaos||(fe.vaos={});if((ue[E]||(ue[E]=new af)).bind($,this,C,j?j.getPaintVertexBuffers():[],R,fe.vertexOffset,V||[],oe),this.forceManualRenderingForInstanceIDShaders){const he=q||1;for(let ae=0;ae<he;++ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ae),R?Q.drawElements(s,fe.primitiveLength*re,Q.UNSIGNED_SHORT,fe.primitiveOffset*re*2):Q.drawArrays(s,fe.vertexOffset,fe.vertexLength)}else q&&q>1?Q.drawElementsInstanced(s,fe.primitiveLength*re,Q.UNSIGNED_SHORT,fe.primitiveOffset*re*2,q):R?Q.drawElements(s,fe.primitiveLength*re,Q.UNSIGNED_SHORT,fe.primitiveOffset*re*2):Q.drawArrays(s,fe.vertexOffset,fe.vertexLength);s===Q.TRIANGLES&&R&&this._drawDebugWireframe(t,h,p,_,R,fe,D,O,j,q)}}}function Zc(u,t,s=0){const h=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,u.transform.tileZoom)/h,_=p*(t.tileID.canonical.x+t.tileID.wrap*h),v=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.aw(t,1,u.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v],u_pattern_transition:s}}const Xc={terrain:0,flat:1},Hm=n.bz(),Ua=(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$)=>{const Q=t.style.light,re=Q.properties.get("position"),oe=[re.x,re.y,re.z],fe=n.dx();Q.properties.get("anchor")==="viewport"&&(n.dy(fe,-t.transform.angle),n.dz(oe,oe,fe));const ue=Q.properties.get("color"),he=t.transform,ae={u_matrix:u,u_lightpos:oe,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Xc[C],u_base_type:Xc[R],u_ao:p,u_edge_radius:_,u_width_scale:v,u_flood_light_color:j,u_vertical_scale:V,u_flood_light_intensity:q,u_ground_shadow_factor:$};return he.projection.name==="globe"&&(ae.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],ae.u_zoom_transition=k,ae.u_inv_rot_matrix=O,ae.u_merc_center=D,ae.u_up_dir=he.projection.upVector(new n.cp(0,0,0),D[0]*n.aj,D[1]*n.aj),ae.u_height_lift=E),ae},Ny=(u,t,s,h,p,_)=>({u_matrix:u,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:Xc[p],u_base_type:Xc[_]}),Uy=(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$)=>{const Q=Ua(u,t,s,h,p,_,v,b,C,R,k,D,O,j,V,q,1,[0,0,0]),re={u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8};return n.l(Q,Zc(t,E,$),re)},qm=(u,t,s)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:s}),Wm=(u,t,s,h,p,_=0)=>n.l(qm(u,t,p),Zc(s,h,_)),Vy=(u,t,s,h)=>({u_matrix:u,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:h}),jy=(u,t,s,h,p,_,v=0)=>n.l(Wm(u,t,s,h,_,v),{u_world:p}),Tf=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),Kc=(u,t,s,h,p)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:p}),Zm=(u,t,s,h)=>{const p=n.aj/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Va=(u,t,s=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),Xm=n.bz(),Km=(u,t,s,h,p,_,v)=>{const b=u.transform,E=b.projection.name==="globe",C=E?n.dA(b.zoom,t.canonical)*b._pixelsPerMercatorPixel:n.aw(s,1,_),R={u_matrix:t.projMatrix,u_extrude_scale:C,u_intensity:v,u_inv_rot_matrix:Xm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){R.u_inv_rot_matrix=h,R.u_merc_center=p,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=n.ah(b.zoom);const k=p[0]*n.aj,D=p[1]*n.aj;R.u_up_dir=b.projection.upVector(new n.cp(0,0,0),k,D)}return R};function Sf(u,[t,s,h,p],[_,v]){if(_===v)return[0,0,0,0];const b=255*(u-1)/(u*(v-_));return[t*b,s*b,h*b,p*b]}function Sh(u,t,[s,h]){return s===h?0:.5/u+(t-s)*(u-1)/(u*(h-s))}const aa=(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q,re,oe)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:C,u_fade_t:R.mix,u_opacity:R.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:n.dB(k.paint.get("raster-saturation")),u_contrast_factor:n.dC(k.paint.get("raster-contrast")),u_spin_weights:Ym(k.paint.get("raster-hue-rotate")),u_perspective_transform:D,u_raster_elevation:O,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:E,u_colorization_mix:Sf(n.dD,V,$),u_colorization_offset:Sh(n.dD,q,$),u_color_ramp:j,u_texture_offset:[re/(Q+2*re),Q/(Q+2*re)],u_texture_res:[Q+2*re,Q+2*re],u_emissive_strength:oe});function Ym(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const ks=.05,Ef=(u,t,s,h,p,_,v,b,E,C,R,k)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:C,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:E}),Eh=(u,t,s,h,p,_,v,b,E,C)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:_,u_velocity_res:p,u_max_speed:v,u_uv_offset:b,u_data_scale:[255*E[0],255*E[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[ks,ks]}),Jm=(u,t,s,h,p,_,v,b,E,C)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:p,u_speed_factor:_,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:b,u_data_scale:[255*E[0],255*E[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[ks,ks]}),Af=n.bz(),Ah=(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q,re,oe,fe,ue)=>{const he=p.transform,ae={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:he.getCameraToCenterDistance(Q),u_rotate_symbol:+s,u_aspect_ratio:he.width/he.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+C,u_elevation_from_sea:E?1:0,u_pitch_with_map:+h,u_texsize:R,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Af,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Af,u_up_vector:[0,-1,0],u_color_adj_mat:oe,u_icon_transition:fe||0,u_gamma_scale:h?p.transform.getCameraToCenterDistance(Q)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ue||1,u_ground_shadow_factor:re,u_inv_matrix:n.bi(n.bz(),v)};return Q.name==="globe"&&(ae.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],ae.u_zoom_transition=j,ae.u_inv_rot_matrix=q,ae.u_merc_center=V,ae.u_camera_forward=he._camera.forward(),ae.u_ecef_origin=n.dE(he.globeMatrix,O.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(he.globeMatrix),ae.u_up_vector=$),ae},Ih=(u,t,s,h)=>({u_matrix:u,u_emissive_strength:t,u_opacity:s,u_color:h}),Qm=(u,t,s,h,p,_,v,b,E)=>n.l(function(C,R,k,D,O,j){const{width:V,height:q}=D.imageManager.getPixelSize(R),$=Math.pow(2,j.tileID.overscaledZ),Q=j.tileSize*Math.pow(2,D.transform.tileZoom)/$,re=Q*(j.tileID.canonical.x+j.tileID.wrap*$),oe=Q*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[V,q],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:O?[D.transform.width,-1*D.transform.height]:[1/n.aw(j,1,D.transform.tileZoom),1/n.aw(j,1,D.transform.tileZoom)],u_pixel_coord_upper:[re>>16,oe>>16],u_pixel_coord_lower:[65535&re,65535&oe]}}(0,_,v,h,b,E),{u_matrix:u,u_emissive_strength:t,u_opacity:s}),Ch=new Float32Array(n.bx([])),ja=(u,t,s,h,p,_,v,b,E,C,R,k,D,O=[0,0,0],j)=>{const V=p.style.light,q=V.properties.get("position"),$=[-q.x,-q.y,q.z],Q=n.dx();V.properties.get("anchor")==="viewport"&&(n.dy(Q,-p.transform.angle),n.dz($,$,Q));const re=R.alphaMode==="MASK",oe=V.properties.get("color").toRenderColor(null),fe=D.paint.get("model-ambient-occlusion-intensity"),ue=D.paint.get("model-color").constantOr(n.am.white).toRenderColor(null),he=D.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||Ch,u_lightpos:$,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:O,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[b[0],b[1],b[2],1],u_metallicFactor:E,u_roughnessFactor:C,u_baseColorTexture:os.BaseColor,u_metallicRoughnessTexture:os.MetallicRoughness,u_normalTexture:os.Normal,u_occlusionTexture:os.Occlusion,u_emissionTexture:os.Emission,u_lutTexture:os.LUT,u_color_mix:[ue.r,ue.g,ue.b,he],u_aoIntensity:fe,u_emissive_strength:k,u_occlusionTextureTransform:j||[0,0,0,0]}},e_=(u,t=Ch,s=Ch)=>({u_matrix:u,u_instance:t,u_node_matrix:s}),$y={fillExtrusion:u=>({u_matrix:new n.c8(u),u_lightpos:new n.ca(u),u_lightintensity:new n.cb(u),u_lightcolor:new n.ca(u),u_vertical_gradient:new n.cb(u),u_opacity:new n.cb(u),u_edge_radius:new n.cb(u),u_width_scale:new n.cb(u),u_ao:new n.c9(u),u_height_type:new n.cc(u),u_base_type:new n.cc(u),u_tile_id:new n.ca(u),u_zoom_transition:new n.cb(u),u_inv_rot_matrix:new n.c8(u),u_merc_center:new n.c9(u),u_up_dir:new n.ca(u),u_height_lift:new n.cb(u),u_flood_light_color:new n.ca(u),u_vertical_scale:new n.cb(u),u_flood_light_intensity:new n.cb(u),u_ground_shadow_factor:new n.ca(u)}),fillExtrusionDepth:u=>({u_matrix:new n.c8(u),u_edge_radius:new n.cb(u),u_width_scale:new n.cb(u),u_vertical_scale:new n.cb(u),u_height_type:new n.cc(u),u_base_type:new n.cc(u)}),fillExtrusionPattern:u=>({u_matrix:new n.c8(u),u_lightpos:new n.ca(u),u_lightintensity:new n.cb(u),u_lightcolor:new n.ca(u),u_vertical_gradient:new n.cb(u),u_height_factor:new n.cb(u),u_edge_radius:new n.cb(u),u_width_scale:new n.cb(u),u_ao:new n.c9(u),u_height_type:new n.cc(u),u_base_type:new n.cc(u),u_tile_id:new n.ca(u),u_zoom_transition:new n.cb(u),u_inv_rot_matrix:new n.c8(u),u_merc_center:new n.c9(u),u_up_dir:new n.ca(u),u_height_lift:new n.cb(u),u_image:new n.cc(u),u_texsize:new n.c9(u),u_pixel_coord_upper:new n.c9(u),u_pixel_coord_lower:new n.c9(u),u_tile_units_to_pixels:new n.cb(u),u_opacity:new n.cb(u),u_pattern_transition:new n.cb(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new n.c8(u),u_opacity:new n.cb(u),u_ao_pass:new n.cb(u),u_meter_to_tile:new n.cb(u),u_ao:new n.c9(u),u_flood_light_intensity:new n.cb(u),u_flood_light_color:new n.ca(u),u_attenuation:new n.cb(u),u_edge_radius:new n.cb(u),u_fb:new n.cc(u),u_fb_size:new n.cb(u),u_dynamic_offset:new n.cb(u)}),fill:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_ground_shadow_factor:new n.ca(u)}),fillPattern:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_image:new n.cc(u),u_texsize:new n.c9(u),u_pixel_coord_upper:new n.c9(u),u_pixel_coord_lower:new n.c9(u),u_tile_units_to_pixels:new n.cb(u),u_ground_shadow_factor:new n.ca(u),u_pattern_transition:new n.cb(u)}),fillOutline:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_world:new n.c9(u),u_ground_shadow_factor:new n.ca(u)}),fillOutlinePattern:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_world:new n.c9(u),u_image:new n.cc(u),u_texsize:new n.c9(u),u_pixel_coord_upper:new n.c9(u),u_pixel_coord_lower:new n.c9(u),u_tile_units_to_pixels:new n.cb(u),u_ground_shadow_factor:new n.ca(u),u_pattern_transition:new n.cb(u)}),building:u=>({u_matrix:new n.c8(u),u_normal_matrix:new n.c8(u),u_opacity:new n.cb(u)}),buildingDepth:u=>({u_matrix:new n.c8(u)}),elevatedStructuresDepth:u=>({u_matrix:new n.c8(u),u_depth_bias:new n.cb(u)}),elevatedStructures:u=>({u_matrix:new n.c8(u),u_ground_shadow_factor:new n.ca(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new n.c8(u),u_camera_pos:new n.ca(u),u_depth_bias:new n.cb(u),u_height_scale:new n.cb(u),u_reset_depth:new n.cb(u)}),circle:n.dF,collisionBox:u=>({u_matrix:new n.c8(u),u_camera_to_center_distance:new n.cb(u),u_extrude_scale:new n.c9(u)}),collisionCircle:u=>({u_matrix:new n.c8(u),u_inv_matrix:new n.c8(u),u_camera_to_center_distance:new n.cb(u),u_viewport_size:new n.c9(u)}),debug:u=>({u_color:new n.di(u),u_matrix:new n.c8(u),u_overlay:new n.cc(u),u_overlay_scale:new n.cb(u)}),clippingMask:u=>({u_matrix:new n.c8(u)}),heatmap:u=>({u_extrude_scale:new n.cb(u),u_intensity:new n.cb(u),u_matrix:new n.c8(u),u_inv_rot_matrix:new n.c8(u),u_merc_center:new n.c9(u),u_tile_id:new n.ca(u),u_zoom_transition:new n.cb(u),u_up_dir:new n.ca(u)}),heatmapTexture:u=>({u_image:new n.cc(u),u_color_ramp:new n.cc(u),u_opacity:new n.cb(u)}),hillshade:u=>({u_matrix:new n.c8(u),u_image:new n.cc(u),u_latrange:new n.c9(u),u_light:new n.c9(u),u_shadow:new n.di(u),u_highlight:new n.di(u),u_emissive_strength:new n.cb(u),u_accent:new n.di(u)}),hillshadePrepare:u=>({u_matrix:new n.c8(u),u_image:new n.cc(u),u_dimension:new n.c9(u),u_zoom:new n.cb(u)}),line:n.dG,linePattern:n.dH,raster:u=>({u_matrix:new n.c8(u),u_normalize_matrix:new n.c8(u),u_globe_matrix:new n.c8(u),u_merc_matrix:new n.c8(u),u_grid_matrix:new n.dj(u),u_tl_parent:new n.c9(u),u_scale_parent:new n.cb(u),u_fade_t:new n.cb(u),u_opacity:new n.cb(u),u_image0:new n.cc(u),u_image1:new n.cc(u),u_brightness_low:new n.cb(u),u_brightness_high:new n.cb(u),u_saturation_factor:new n.cb(u),u_contrast_factor:new n.cb(u),u_spin_weights:new n.ca(u),u_perspective_transform:new n.c9(u),u_raster_elevation:new n.cb(u),u_zoom_transition:new n.cb(u),u_merc_center:new n.c9(u),u_cutoff_params:new n.cQ(u),u_colorization_mix:new n.cQ(u),u_colorization_offset:new n.cb(u),u_color_ramp:new n.cc(u),u_texture_offset:new n.c9(u),u_texture_res:new n.c9(u),u_emissive_strength:new n.cb(u)}),rasterParticle:u=>({u_matrix:new n.c8(u),u_normalize_matrix:new n.c8(u),u_globe_matrix:new n.c8(u),u_merc_matrix:new n.c8(u),u_grid_matrix:new n.dj(u),u_tl_parent:new n.c9(u),u_scale_parent:new n.cb(u),u_fade_t:new n.cb(u),u_opacity:new n.cb(u),u_image0:new n.cc(u),u_image1:new n.cc(u),u_raster_elevation:new n.cb(u),u_zoom_transition:new n.cb(u),u_merc_center:new n.c9(u),u_cutoff_params:new n.cQ(u)}),rasterParticleTexture:u=>({u_texture:new n.cc(u),u_opacity:new n.cb(u)}),rasterParticleDraw:u=>({u_particle_texture:new n.cc(u),u_particle_texture_side_len:new n.cb(u),u_tile_offset:new n.c9(u),u_velocity:new n.cc(u),u_color_ramp:new n.cc(u),u_velocity_res:new n.c9(u),u_max_speed:new n.cb(u),u_uv_offset:new n.c9(u),u_data_scale:new n.c9(u),u_data_offset:new n.cb(u),u_particle_pos_scale:new n.cb(u),u_particle_pos_offset:new n.c9(u)}),rasterParticleUpdate:u=>({u_particle_texture:new n.cc(u),u_particle_texture_side_len:new n.cb(u),u_velocity:new n.cc(u),u_velocity_res:new n.c9(u),u_max_speed:new n.cb(u),u_speed_factor:new n.cb(u),u_reset_rate:new n.cb(u),u_rand_seed:new n.cb(u),u_uv_offset:new n.c9(u),u_data_scale:new n.c9(u),u_data_offset:new n.cb(u),u_particle_pos_scale:new n.cb(u),u_particle_pos_offset:new n.c9(u)}),symbol:u=>({u_is_size_zoom_constant:new n.cc(u),u_is_size_feature_constant:new n.cc(u),u_size_t:new n.cb(u),u_size:new n.cb(u),u_camera_to_center_distance:new n.cb(u),u_rotate_symbol:new n.cc(u),u_aspect_ratio:new n.cb(u),u_fade_change:new n.cb(u),u_matrix:new n.c8(u),u_label_plane_matrix:new n.c8(u),u_coord_matrix:new n.c8(u),u_is_text:new n.cc(u),u_elevation_from_sea:new n.cc(u),u_pitch_with_map:new n.cc(u),u_texsize:new n.c9(u),u_texsize_icon:new n.c9(u),u_texture:new n.cc(u),u_texture_icon:new n.cc(u),u_gamma_scale:new n.cb(u),u_device_pixel_ratio:new n.cb(u),u_tile_id:new n.ca(u),u_zoom_transition:new n.cb(u),u_inv_rot_matrix:new n.c8(u),u_merc_center:new n.c9(u),u_camera_forward:new n.ca(u),u_tile_matrix:new n.c8(u),u_up_vector:new n.ca(u),u_ecef_origin:new n.ca(u),u_is_halo:new n.cc(u),u_icon_transition:new n.cb(u),u_color_adj_mat:new n.c8(u),u_scale_factor:new n.cb(u),u_ground_shadow_factor:new n.ca(u),u_inv_matrix:new n.c8(u)}),background:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_opacity:new n.cb(u),u_color:new n.di(u)}),backgroundPattern:u=>({u_matrix:new n.c8(u),u_emissive_strength:new n.cb(u),u_opacity:new n.cb(u),u_image:new n.cc(u),u_pattern_tl:new n.c9(u),u_pattern_br:new n.c9(u),u_texsize:new n.c9(u),u_pattern_size:new n.c9(u),u_pixel_coord_upper:new n.c9(u),u_pixel_coord_lower:new n.c9(u),u_pattern_units_to_pixels:new n.c9(u)}),terrainRaster:u=>({u_matrix:new n.c8(u),u_image0:new n.cc(u),u_skirt_height:new n.cb(u),u_ground_shadow_factor:new n.ca(u)}),skybox:u=>({u_matrix:new n.c8(u),u_sun_direction:new n.ca(u),u_cubemap:new n.cc(u),u_opacity:new n.cb(u),u_temporal_offset:new n.cb(u)}),skyboxGradient:u=>({u_matrix:new n.c8(u),u_color_ramp:new n.cc(u),u_center_direction:new n.ca(u),u_radius:new n.cb(u),u_opacity:new n.cb(u),u_temporal_offset:new n.cb(u)}),skyboxCapture:u=>({u_matrix_3f:new n.dj(u),u_sun_direction:new n.ca(u),u_sun_intensity:new n.cb(u),u_color_tint_r:new n.cQ(u),u_color_tint_m:new n.cQ(u),u_luminance:new n.cb(u)}),globeRaster:u=>({u_proj_matrix:new n.c8(u),u_globe_matrix:new n.c8(u),u_normalize_matrix:new n.c8(u),u_merc_matrix:new n.c8(u),u_zoom_transition:new n.cb(u),u_merc_center:new n.c9(u),u_image0:new n.cc(u),u_grid_matrix:new n.dj(u),u_skirt_height:new n.cb(u),u_far_z_cutoff:new n.cb(u),u_frustum_tl:new n.ca(u),u_frustum_tr:new n.ca(u),u_frustum_br:new n.ca(u),u_frustum_bl:new n.ca(u),u_globe_pos:new n.ca(u),u_globe_radius:new n.cb(u),u_viewport:new n.c9(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.ca(u),u_frustum_tr:new n.ca(u),u_frustum_br:new n.ca(u),u_frustum_bl:new n.ca(u),u_horizon:new n.cb(u),u_transition:new n.cb(u),u_fadeout_range:new n.cb(u),u_color:new n.cQ(u),u_high_color:new n.cQ(u),u_space_color:new n.cQ(u),u_temporal_offset:new n.cb(u),u_horizon_angle:new n.cb(u)}),model:u=>({u_matrix:new n.c8(u),u_lighting_matrix:new n.c8(u),u_normal_matrix:new n.c8(u),u_node_matrix:new n.c8(u),u_lightpos:new n.ca(u),u_lightintensity:new n.cb(u),u_lightcolor:new n.ca(u),u_camera_pos:new n.ca(u),u_opacity:new n.cb(u),u_baseColorFactor:new n.cQ(u),u_emissiveFactor:new n.cQ(u),u_metallicFactor:new n.cb(u),u_roughnessFactor:new n.cb(u),u_baseTextureIsAlpha:new n.cc(u),u_alphaMask:new n.cc(u),u_alphaCutoff:new n.cb(u),u_baseColorTexture:new n.cc(u),u_metallicRoughnessTexture:new n.cc(u),u_normalTexture:new n.cc(u),u_occlusionTexture:new n.cc(u),u_emissionTexture:new n.cc(u),u_lutTexture:new n.cc(u),u_color_mix:new n.cQ(u),u_aoIntensity:new n.cb(u),u_emissive_strength:new n.cb(u),u_occlusionTextureTransform:new n.cQ(u)}),modelDepth:u=>({u_matrix:new n.c8(u),u_instance:new n.c8(u),u_node_matrix:new n.c8(u)}),groundShadow:u=>({u_matrix:new n.c8(u),u_ground_shadow_factor:new n.ca(u)}),stars:u=>({u_matrix:new n.c8(u),u_up:new n.ca(u),u_right:new n.ca(u),u_intensity_multiplier:new n.cb(u)}),snowParticle:u=>({u_modelview:new n.c8(u),u_projection:new n.c8(u),u_time:new n.cb(u),u_cam_pos:new n.ca(u),u_velocityConeAperture:new n.cb(u),u_velocity:new n.cb(u),u_horizontalOscillationRadius:new n.cb(u),u_horizontalOscillationRate:new n.cb(u),u_boxSize:new n.cb(u),u_billboardSize:new n.cb(u),u_simpleShapeParameters:new n.c9(u),u_screenSize:new n.c9(u),u_thinningCenterPos:new n.c9(u),u_thinningShape:new n.ca(u),u_thinningAffectedRatio:new n.cb(u),u_thinningParticleOffset:new n.cb(u),u_particleColor:new n.cQ(u),u_direction:new n.ca(u)}),rainParticle:u=>({u_modelview:new n.c8(u),u_projection:new n.c8(u),u_time:new n.cb(u),u_cam_pos:new n.ca(u),u_texScreen:new n.cc(u),u_velocityConeAperture:new n.cb(u),u_velocity:new n.cb(u),u_boxSize:new n.cb(u),u_rainDropletSize:new n.c9(u),u_distortionStrength:new n.cb(u),u_rainDirection:new n.ca(u),u_color:new n.cQ(u),u_screenSize:new n.c9(u),u_thinningCenterPos:new n.c9(u),u_thinningShape:new n.ca(u),u_thinningAffectedRatio:new n.cb(u),u_thinningParticleOffset:new n.cb(u),u_shapeDirectionalPower:new n.cb(u),u_shapeNormalPower:new n.cb(u),u_mode:new n.cb(u)}),vignette:u=>({u_vignetteShape:new n.ca(u),u_vignetteColor:new n.cQ(u)}),occlusion:u=>({u_matrix:new n.c8(u),u_anchorPos:new n.ca(u),u_screenSizePx:new n.c9(u),u_occluderSizePx:new n.c9(u),u_color:new n.cQ(u)})};class Oo{constructor(t,s,h,p){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oo.uniqueIdxCounter=0;const Gy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class If{constructor(t,s,h,p,_,v){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.instanceCount=v,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const p=s.attributes[this.attributes[h].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],v=s.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Gy[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let p=0;p<this.attributes.length;p++){const _=s.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ph{constructor(t,s,h,p,_){this.context=t,this.width=s,this.height=h;const v=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new By(t,v)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new gh(t,v):new _f(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class Ll{constructor(t,s){this.gl=t,this.clearColor=new Dy(this),this.clearDepth=new ky(this),this.clearStencil=new Ly(this),this.colorMask=new Om(this),this.depthMask=new zy(this),this.stencilMask=new hh(this),this.stencilFunc=new Oy(this),this.stencilOp=new Fm(this),this.stencilTest=new uf(this),this.depthRange=new dh(this),this.depthTest=new hf(this),this.depthFunc=new Na(this),this.blend=new df(this),this.blendFunc=new Bm(this),this.blendColor=new Cl(this),this.blendEquation=new Hc(this),this.cullFace=new fh(this),this.cullFaceSide=new ph(this),this.frontFace=new Pl(this),this.program=new mh(this),this.activeTexture=new ff(this),this.viewport=new Nm(this),this.bindFramebuffer=new pf(this),this.bindRenderbuffer=new _h(this),this.bindTexture=new qc(this),this.bindVertexBuffer=new Um(this),this.bindElementBuffer=new Vm(this),this.bindVertexArrayOES=new jm(this),this.pixelStoreUnpack=new Ml(this),this.pixelStoreUnpackPremultiplyAlpha=new $m(this),this.pixelStoreUnpackFlipY=new Fy(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new Oo(this,t,s,h)}createVertexBuffer(t,s,h,p,_){return new If(this,t,s,h,p,_)}createRenderbuffer(t,s,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,h,p){return new Ph(this,t,s,h,p)}clear({color:t,depth:s,stencil:h,colorMask:p}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),s!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bv(t.blendFunction,Ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let $a;function zl(u,t,s,h,p,_,v){const b=u.context,E=b.gl,C=u.transform,R=u.getOrCreateProgram("collisionBox"),k=[];let D=0,O=0;for(let oe=0;oe<h.length;oe++){const fe=h[oe],ue=t.getTile(fe),he=ue.getBucket(s);if(!he)continue;const ae=rh(fe,he,C);let _e=ae;p[0]===0&&p[1]===0||(_e=u.translatePosMatrix(ae,ue,p,_));const ge=v?he.textCollisionBox:he.iconCollisionBox,Oe=he.collisionCircleArray;if(Oe.length>0){const Re=n.bz(),Je=_e;n.cB(Re,he.placementInvProjMatrix,C.glCoordMatrix),n.cB(Re,Re,he.placementViewportMatrix),k.push({circleArray:Oe,circleOffset:O,transform:Je,invTransform:Re,projection:he.getProjection()}),D+=Oe.length/4,O=D}ge&&(u.terrain&&u.terrain.setupElevationDraw(ue,R),R.draw(u,E.LINES,Dt.disabled,ai.disabled,u.colorModeForRenderPass(),li.disabled,Zm(_e,C,ue,he.getProjection()),s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,C.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!v||!k.length)return;const j=u.getOrCreateProgram("collisionCircle"),V=new n.dI;V.resize(4*D),V._trim();let q=0;for(const oe of k)for(let fe=0;fe<oe.circleArray.length/4;fe++){const ue=4*fe,he=oe.circleArray[ue+0],ae=oe.circleArray[ue+1],_e=oe.circleArray[ue+2],ge=oe.circleArray[ue+3];V.emplace(q++,he,ae,_e,ge,0),V.emplace(q++,he,ae,_e,ge,1),V.emplace(q++,he,ae,_e,ge,2),V.emplace(q++,he,ae,_e,ge,3)}(!$a||$a.length<2*D)&&($a=function(oe){const fe=2*oe,ue=new n.a_;ue.resize(fe),ue._trim();for(let he=0;he<fe;he++){const ae=6*he;ue.uint16[ae+0]=4*he+0,ue.uint16[ae+1]=4*he+1,ue.uint16[ae+2]=4*he+2,ue.uint16[ae+3]=4*he+2,ue.uint16[ae+4]=4*he+3,ue.uint16[ae+5]=4*he+0}return ue}(D));const $=b.createIndexBuffer($a,!0),Q=b.createVertexBuffer(V,n.dJ.members,!0);for(const oe of k){const fe={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(re=C).getCameraToCenterDistance(oe.projection),u_viewport_size:[re.width,re.height]};j.draw(u,E.TRIANGLES,Dt.disabled,ai.disabled,u.colorModeForRenderPass(),li.disabled,fe,s.id,Q,$,n.bd.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,C.zoom)}var re;Q.destroy(),$.destroy()}const Yc=n.bz();function Jc(u){const t=u._camera.getWorldToCamera(u.worldSize,1),s=n.az([],t,u.globeMatrix);n.bi(s,s);const h=[0,0,0],p=[0,1,0,0];return n.aA(p,p,s),h[0]=p[0],h[1]=p[1],h[2]=p[2],n.au(h,h),h}function Mh({width:u,height:t,anchor:s,textOffset:h,textScale:p},_){const{horizontalAlign:v,verticalAlign:b}=n.bV(s),E=-(v-.5)*u,C=-(b-.5)*t,R=n.bU(s,h);return new n.P((E/p+R[0])*_,(C/p+R[1])*_)}function Cf(u,t,s,h,p,_,v,b,E,C){const R=u.text.placedSymbolArray,k=u.text.dynamicLayoutVertexArray,D=u.icon.dynamicLayoutVertexArray,O={},j=u.getProjection(),V=Oc(v,j,p),q=p.elevation,$=j.upVectorScale(v.canonical,p.center.lat,p.worldSize).metersToTile;k.clear();for(let Q=0;Q<R.length;Q++){const re=R.get(Q),{tileAnchorX:oe,tileAnchorY:fe,numGlyphs:ue}=re,he=re.hidden||!re.crossTileID||u.allowVerticalPlacement&&!re.placedOrientation?null:h[re.crossTileID];if(he){let ae=0,_e=0,ge=0;if(q){const tt=q?q.getAtTileOffset(v,oe,fe):0,[Ve,st,Qe]=j.upVector(v.canonical,oe,fe);ae=tt*Ve*$,_e=tt*st*$,ge=tt*Qe*$}let[Oe,Re,Je,Xe]=xs(re.projectedAnchorX+ae,re.projectedAnchorY+_e,re.projectedAnchorZ+ge,s?V:_);const ft=Qo(p.getCameraToCenterDistance(j),Xe);let Me=n.bJ(u.textSizeData,E,re)*ft/n.bO;s&&(Me*=u.tilePixelRatio/b);const Fe=Mh(he,Me);s?({x:Oe,y:Re,z:Je}=j.projectTilePoint(oe+Fe.x,fe+Fe.y,v.canonical),[Oe,Re,Je]=xs(Oe+ae,Re+_e,Je+ge,_)):(t&&Fe._rotate(-p.angle),Oe+=Fe.x,Re+=Fe.y,Je=0);const Ce=u.allowVerticalPlacement&&re.placedOrientation===n.bI.vertical?Math.PI/2:0;for(let tt=0;tt<ue;tt++)n.bL(k,Oe,Re,Je,Ce);C&&re.associatedIconIndex>=0&&(O[re.associatedIconIndex]={x:Oe,y:Re,z:Je,angle:Ce})}else Ji(ue,k)}if(C){D.clear();const Q=u.icon.placedSymbolArray;for(let re=0;re<Q.length;re++){const oe=Q.get(re),{numGlyphs:fe}=oe,ue=O[re];if(oe.hidden||!ue)Ji(fe,D);else{const{x:he,y:ae,z:_e,angle:ge}=ue;for(let Oe=0;Oe<fe;Oe++)n.bL(D,he,ae,_e,ge)}}u.icon.dynamicLayoutVertexBuffer.updateData(D)}u.text.dynamicLayoutVertexBuffer.updateData(k)}function Rh(u,t,s,h,p,_,v={}){const b=s.paint.get("icon-translate"),E=s.paint.get("text-translate"),C=s.paint.get("icon-translate-anchor"),R=s.paint.get("text-translate-anchor"),k=s.layout.get("icon-rotation-alignment"),D=s.layout.get("text-rotation-alignment"),O=s.layout.get("icon-pitch-alignment"),j=s.layout.get("text-pitch-alignment"),V=s.layout.get("icon-keep-upright"),q=s.layout.get("text-keep-upright"),$=s.paint.get("icon-color-saturation"),Q=s.paint.get("icon-color-contrast"),re=s.paint.get("icon-color-brightness-min"),oe=s.paint.get("icon-color-brightness-max"),fe=s.layout.get("symbol-elevation-reference")==="sea",ue=u.context,he=ue.gl,ae=u.transform,_e=k==="map",ge=D==="map",Oe=O==="map",Re=j==="map",Je=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Xe=!1;const ft=u.depthModeForSublayer(0,Dt.ReadOnly),Me=new Dt(u.context.gl.LEQUAL,Dt.ReadOnly,u.depthRangeFor3D),Fe=[n.ay(ae.center.lng),n.aH(ae.center.lat)],Ce=s.layout.get("text-variable-anchor"),tt=ae.projection.name==="globe",Ve=[],st=[0,-1,0];for(const Qe of h){const ot=t.getTile(Qe),at=ot.getBucket(s);if(!at||at.projection.name==="mercator"&&tt||at.fullyClipped)continue;const Rt=at.projection.name==="globe",Ut=Rt?n.ah(ae.zoom):0,Ct=Oc(Qe,at.getProjection(),ae),Vt=ae.calculatePixelsToTileUnitsMatrix(ot),Lt=Ce&&at.hasTextData(),ei=at.hasIconTextFit()&&Lt&&at.hasIconData(),ui=at.elevationType==="road"?Me:ft,Di=at.getProjection().createInversionMatrix(ae,Qe.canonical),ur=u.shadowRenderer,sr=at.elevationType==="road"&&!!ur&&ur.enabled;let Li=[0,0,0];if(sr){const Br=u.style.directionalLight,wi=u.style.ambientLight;Br&&wi&&(Li=mo(u.style,Br,wi))}const Xr=Br=>{ae.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||u.terrain)&&(Br.push("DEPTH_D24"),Br.push("DEPTH_OCCLUSION"))},Ur=()=>{const Br=_e&&s.layout.get("symbol-placement")!=="point",wi=[];Xr(wi);const kr=Br||ei,Hi=s.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&Oe&&wi.push("PITCH_WITH_MAP_TERRAIN"),Rt&&(wi.push("PROJECTION_GLOBE_VIEW"),kr&&wi.push("PROJECTED_POS_ON_VIEWPORT")),Hi>0&&wi.push("ICON_TRANSITION"),at.icon.zOffsetVertexBuffer&&wi.push("Z_OFFSET"),$===0&&Q===0&&re===0&&oe===1||wi.push("COLOR_ADJUSTMENT"),at.sdfIcons&&wi.push("RENDER_SDF"),sr&&wi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Lr=at.icon.programConfigurations.get(s.id),Qi=u.getOrCreateProgram("symbol",{config:Lr,defines:wi}),Nr=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],Rn=at.iconSizeData,Ar=n.bH(Rn,ae.zoom),zn=Oe||ae.pitch!==0,on=vl(Ct,ot.tileID.canonical,Oe,_e,ae,at.getProjection(),Vt),Nn=Xd(Ct,ot.tileID.canonical,Oe,_e,ae,at.getProjection(),Vt),so=u.translatePosMatrix(Nn,ot,b,C,!0),Uo=u.translatePosMatrix(Ct,ot,b,C),Ts=kr?Yc:on,Hs=_e&&!Oe&&!Br;let vo=st;!tt&&!ae.mercatorFromTransition||_e||(vo=Jc(ae));const xo=Rt?vo:st,oo=s.getColorAdjustmentMatrix($,Q,re,oe),Wl=Ah(Rn.kind,Ar,Hs,Oe,u,Uo,Ts,so,fe,!1,Nr,[0,0],!0,Qe,Ut,Fe,Di,xo,at.getProjection(),Li,oo,Hi),Qa=ot.imageAtlasTexture?ot.imageAtlasTexture:null,Zh=s.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear,Xh=at.sdfIcons||u.options.rotating||u.options.zooming||Zh||zn?he.LINEAR:he.NEAREST,Kh=at.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,pu=u.terrain&&Oe&&Br?n.bi(n.bz(),on):Yc;if(Br&&at.icon){const zr=ae.elevation,Zl=zr?zr.getAtTileOffsetFunc(Qe,ae.center.lat,ae.worldSize,at.getProjection()):null,Jf=Qu(Ct,ot.tileID.canonical,Oe,_e,ae,at.getProjection(),Vt);Yd(at,Ct,u,!1,Jf,Nn,Oe,V,Zl,Qe)}return{program:Qi,buffers:at.icon,uniformValues:Wl,atlasTexture:Qa,atlasTextureIcon:null,atlasInterpolation:Xh,atlasInterpolationIcon:null,isSDF:at.sdfIcons,hasHalo:Kh,depthMode:ui,tile:ot,renderWithShadows:sr,labelPlaneMatrixInv:pu}},gi=()=>{const Br=ge&&s.layout.get("symbol-placement")!=="point",wi=[],kr=Br||Ce||ei;u.terrainRenderModeElevated()&&Re&&wi.push("PITCH_WITH_MAP_TERRAIN"),Rt&&(wi.push("PROJECTION_GLOBE_VIEW"),kr&&wi.push("PROJECTED_POS_ON_VIEWPORT")),at.text.zOffsetVertexBuffer&&wi.push("Z_OFFSET"),at.iconsInText&&wi.push("RENDER_TEXT_AND_SYMBOL"),wi.push("RENDER_SDF"),sr&&wi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xr(wi);const Hi=at.text.programConfigurations.get(s.id),Lr=u.getOrCreateProgram("symbol",{config:Hi,defines:wi});let Qi,Nr=[0,0],Rn=null;const Ar=at.textSizeData;at.iconsInText&&(Nr=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],Rn=ot.imageAtlasTexture?ot.imageAtlasTexture:null,Qi=Re||ae.pitch!==0||u.options.rotating||u.options.zooming||Ar.kind==="composite"||Ar.kind==="camera"?he.LINEAR:he.NEAREST);const zn=ot.glyphAtlasTexture?ot.glyphAtlasTexture.size:[0,0],on=s.layout.get("text-size-scale-range"),Nn=n.aD(u.scaleFactor,on[0],on[1]),so=n.bH(Ar,ae.zoom,Nn),Uo=vl(Ct,ot.tileID.canonical,Re,ge,ae,at.getProjection(),Vt),Ts=Xd(Ct,ot.tileID.canonical,Re,ge,ae,at.getProjection(),Vt),Hs=u.translatePosMatrix(Ts,ot,E,R,!0),vo=u.translatePosMatrix(Ct,ot,E,R),xo=kr?Yc:Uo,oo=ge&&!Re&&!Br;let Wl=st;!tt&&!ae.mercatorFromTransition||ge||(Wl=Jc(ae));const Qa=Ah(Ar.kind,so,oo,Re,u,vo,xo,Hs,fe,!0,zn,Nr,!0,Qe,Ut,Fe,Di,Rt?Wl:st,at.getProjection(),Li,null,null,Nn),Zh=ot.glyphAtlasTexture?ot.glyphAtlasTexture:null,Xh=he.LINEAR,Kh=s.paint.get("text-halo-width").constantOr(1)!==0,pu=u.terrain&&Re&&Br?n.bi(n.bz(),Uo):Yc;if(Br&&at.text){const zr=ae.elevation,Zl=zr?zr.getAtTileOffsetFunc(Qe,ae.center.lat,ae.worldSize,at.getProjection()):null,Jf=Qu(Ct,ot.tileID.canonical,Re,ge,ae,at.getProjection(),Vt);Yd(at,Ct,u,!0,Jf,Ts,Re,q,Zl,Qe)}return{program:Lr,buffers:at.text,uniformValues:Qa,atlasTexture:Zh,atlasTextureIcon:Rn,atlasInterpolation:Xh,atlasInterpolationIcon:Qi,isSDF:!0,hasHalo:Kh,depthMode:ui,tile:ot,renderWithShadows:sr,labelPlaneMatrixInv:pu}},Vi=at.icon.segments.get().length,Zi=at.text.segments.get().length,hr=Vi&&!v.onlyText?Ur():null,un=Zi&&!v.onlyIcons?gi():null,Qr=s.paint.get("icon-opacity").constantOr(1),ln=s.paint.get("text-opacity").constantOr(1);if(Je&&at.canOverlap){Xe=!0;const Br=Qr&&!v.onlyText?at.icon.segments.get():[],wi=ln&&!v.onlyIcons?at.text.segments.get():[];for(const kr of Br)Ve.push({segments:new n.bd([kr]),sortKey:kr.sortKey,state:hr});for(const kr of wi)Ve.push({segments:new n.bd([kr]),sortKey:kr.sortKey,state:un})}else v.onlyText||Ve.push({segments:Qr?at.icon.segments:new n.bd([]),sortKey:0,state:hr}),v.onlyIcons||Ve.push({segments:ln?at.text.segments:new n.bd([]),sortKey:0,state:un})}Xe&&Ve.sort((Qe,ot)=>Qe.sortKey-ot.sortKey);for(const Qe of Ve){const ot=Qe.state;if(ot)if(u.terrain?u.terrain.setupElevationDraw(ot.tile,ot.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ot.labelPlaneMatrixInv}):u.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,ot.program),ue.activeTexture.set(he.TEXTURE0),ot.atlasTexture&&ot.atlasTexture.bind(ot.atlasInterpolation,he.CLAMP_TO_EDGE,!0),ot.atlasTextureIcon&&(ue.activeTexture.set(he.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,he.CLAMP_TO_EDGE,!0)),ot.renderWithShadows&&u.shadowRenderer.setupShadows(ot.tile.tileID.toUnwrapped(),ot.program,"vector-tile",ot.tile.tileID.overscaledZ),u.uploadCommonLightUniforms(u.context,ot.program),ot.hasHalo){const at=ot.uniformValues;at.u_is_halo=1,Pf(ot.buffers,Qe.segments,s,u,ot.program,ot.depthMode,p,_,at,2),at.u_is_halo=0}else{if(ot.isSDF){const at=ot.uniformValues;ot.hasHalo&&(at.u_is_halo=1,Pf(ot.buffers,Qe.segments,s,u,ot.program,ot.depthMode,p,_,at,1)),at.u_is_halo=0}Pf(ot.buffers,Qe.segments,s,u,ot.program,ot.depthMode,p,_,ot.uniformValues,1)}}}function Pf(u,t,s,h,p,_,v,b,E,C){const R=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];p.draw(h,h.context.gl.TRIANGLES,_,v,b,li.disabled,E,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),R,C)}function Ol(u,t){const s=1<<u.canonical.z,h=(t.x*s-u.canonical.x-u.wrap*s)*n.aj,p=(t.y*s-u.canonical.y)*n.aj,_=n.dS(t.z,t.y);return n.cS(h,p,_)}function Qc(u,t,s,h,p){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const _=u.context.gl,v=new Dt(u.context.gl.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D),b=new Dt(u.context.gl.GREATER,Dt.ReadWrite,u.depthRangeFor3D),E=function(O){const j=n.cJ(O.pitch);let V=.01;return O.isOrthographic&&(V=n.ai(1e-4,V,n.cO(j>=ra?1:j/ra))),2*V}(u.transform),C=u.transform.getFreeCameraOptions().position,R="elevatedStructuresDepthReconstruct",k=u.getOrCreateProgram(R,{defines:["DEPTH_RECONSTRUCTION"]}),D=u.getOrCreateProgram(R);for(const O of h){const j=t.getTile(O),V=j.getBucket(s);if(!V)continue;const q=V.elevatedStructures;if(!q)continue;const $=V.elevationBufferData.heightRange,Q=Ol(O.toUnwrapped(),C),re=u.translatePosMatrix(O.projMatrix,j,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let oe,fe,ue,he;if(p==="initialize"){if(!$||$.min>=1||q.depthSegments.segments[0].primitiveLength===0)continue;oe=Kc(re,Q,E,1,0),fe=v,ue=q.depthSegments,he=k}else if(p==="reset"){if(!$||$.min>=0||q.maskSegments.segments[0].primitiveLength===0)continue;oe=Kc(re,Q,0,0,1),fe=b,ue=q.maskSegments,he=k}else if(p==="geometry"){if(q.depthSegments.segments[0].primitiveLength===0)continue;oe=Kc(re,Q,E,1,0),fe=v,ue=q.depthSegments,he=D}he.draw(u,_.TRIANGLES,fe,ai.disabled,Ci.disabled,li.disabled,oe,s.id,q.vertexBuffer,q.indexBuffer,ue,s.paint,u.transform.zoom)}}function It(u,t,s){const{painter:h,sourceCache:p,layer:_,coords:v,colorMode:b,elevationType:E,terrainEnabled:C,pass:R}=u,k=h.context.gl,D=_.paint.get("fill-pattern"),O=_.paint.get("fill-pattern-cross-fade"),j=D.constantOr(null);let V=E;E!=="road"||t&&!C||(V="none");const q=V==="road",$=u.painter.shadowRenderer,Q=q&&!!$&&$.enabled,re=new Dt(h.context.gl.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D);let oe=[0,0,0];if(Q){const he=h.style.directionalLight,ae=h.style.ambientLight;he&&ae&&(oe=mo(h.style,he,ae))}const fe=D&&D.constantOr(1),ue=(he,ae)=>{let _e,ge,Oe,Re,Je;ae?(_e=fe&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Oe=k.LINES):(_e=fe?"fillPattern":"fill",Oe=k.TRIANGLES);for(const Xe of v){const ft=p.getTile(Xe);if(fe&&!ft.patternsLoaded())continue;const Me=ft.getBucket(_);if(!Me)continue;const Fe=t?Me.elevationBufferData:Me.bufferData;if(Fe.isEmpty())continue;h.prepareDrawTile();const Ce=Fe.programConfigurations.get(_.id),tt=h.isTileAffectedByFog(Xe),Ve=[],st=[];q&&(Ve.push("ELEVATED_ROADS"),st.push(Fe.elevatedLayoutVertexBuffer)),Q&&Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fe&&(h.context.activeTexture.set(k.TEXTURE0),ft.imageAtlasTexture&&ft.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ce.updatePaintBuffers());let Qe=!1;if(j&&ft.imageAtlas){const Ct=ft.imageAtlas,Vt=n.dN.from(j),Lt=Vt.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),ei=Vt.getSecondary(),ui=Ct.patternPositions.get(Lt),Di=ei?Ct.patternPositions.get(ei.scaleSelf(n.q.devicePixelRatio).toString()):null;Qe=!!ui&&!!Di,ui&&Ce.setConstantPatternPositions(ui,Di)}O>0&&(Qe||Ce.getPatternTransitionVertexBuffer("fill-pattern"))&&Ve.push("FILL_PATTERN_TRANSITION");const ot=h.getOrCreateProgram(_e,{config:Ce,overrideFog:tt,defines:Ve}),at=h.translatePosMatrix(Xe.projMatrix,ft,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));Q&&$.setupShadows(ft.tileID.toUnwrapped(),ot,"vector-tile",ft.tileID.overscaledZ);const Rt=_.paint.get("fill-emissive-strength");if(ae){Re=Fe.lineIndexBuffer,Je=Fe.lineSegments;const Ct=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ge=_e==="fillOutlinePattern"&&fe?jy(at,Rt,h,ft,Ct,oe,O):Vy(at,Rt,Ct,oe)}else Re=Fe.indexBuffer,Je=Fe.triangleSegments,ge=fe?Wm(at,Rt,h,ft,oe,O):qm(at,Rt,oe);h.uploadCommonUniforms(h.context,ot,Xe.toUnwrapped());let Ut=he;(E==="road"&&!C||E==="offset")&&(Ut=re),ot.draw(h,Oe,Ut,s||h.stencilModeForClipping(Xe),b,li.disabled,ge,_.id,Fe.layoutVertexBuffer,Re,Je,_.paint,h.transform.zoom,Ce,st)}};h.renderPass===R&&ue(h.depthModeForSublayer(1,h.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly),!1),V==="none"&&h.renderPass==="translucent"&&_.paint.get("fill-antialias")&&ue(h.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly),!0)}function eu(u,t,s,h,p,_,v,b){s.resetLayerRenderingStats(u);const E=u.context,C=E.gl,R=u.transform,k=s.paint.get("fill-extrusion-pattern"),D=s.paint.get("fill-extrusion-pattern-cross-fade"),O=k.constantOr(null),j=k.constantOr(1),V=s.paint.get("fill-extrusion-opacity"),q=u.style.enable3dLights(),$=s.paint.get(q&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Q=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],re=s.layout.get("fill-extrusion-edge-radius"),oe=re>0&&!s.paint.get("fill-extrusion-rounded-roof"),fe=oe?0:re,ue=R.projection.name==="globe"?n.dT():0,he=R.projection.name==="globe",ae=he?n.ah(R.zoom):0,_e=[n.ay(R.center.lng),n.aH(R.center.lat)],ge=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Oe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(ge?null:s.lut).toArray01().slice(0,3),Re=s.paint.get("fill-extrusion-flood-light-intensity"),Je=s.paint.get("fill-extrusion-vertical-scale"),Xe=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ft=s.paint.get("fill-extrusion-height-alignment"),Me=s.paint.get("fill-extrusion-base-alignment"),Fe=Oa(u,s.paint.get("fill-extrusion-cutoff-fade-range")),Ce=[];let tt;he&&Ce.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&Ce.push("FAUX_AO"),oe&&Ce.push("ZERO_ROOF_RADIUS"),b&&Ce.push("HAS_CENTROID"),Re>0&&Ce.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Xe&&Ce.push("RENDER_WALL_MODE");const Ve=u.renderPass==="shadow",st=u.shadowRenderer,Qe=Ve&&!!st,ot=Ve?li.disabled:li.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let at=[0,0,0];if(st){const Ct=u.style.directionalLight,Vt=u.style.ambientLight;Ct&&Vt&&(at=mo(u.style,Ct,Vt)),Ve||(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),st.useNormalOffset&&Ce.push("NORMAL_OFFSET")),tt=Ce.concat(["SHADOWS_SINGLE_CASCADE"])}const Rt=Qe?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",Ut=s.getLayerRenderingStats();for(const Ct of h){const Vt=t.getTile(Ct),Lt=Vt.getBucket(s);if(!Lt||Lt.projection.name!==R.projection.name)continue;let ei=!1;st&&(ei=st.getMaxCascadeForTile(Ct.toUnwrapped())===0);const ui=u.isTileAffectedByFog(Ct),Di=Lt.programConfigurations.get(s.id);let ur=!1;if(O&&Vt.imageAtlas){const Zi=Vt.imageAtlas,hr=n.dN.from(O),un=hr.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),Qr=hr.getSecondary(),ln=Zi.patternPositions.get(un),Br=Qr?Zi.patternPositions.get(Qr.scaleSelf(n.q.devicePixelRatio).toString()):null;ur=!!ln&&!!Br,ln&&Di.setConstantPatternPositions(ln,Br)}D>0&&(ur||Di.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ce.push("FILL_EXTRUSION_PATTERN_TRANSITION");const sr=u.getOrCreateProgram(Rt,{config:Di,defines:ei?tt:Ce,overrideFog:ui});if(u.terrain&&u.terrain.setupElevationDraw(Vt,sr,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const Zi=sr.attributes.a_centroid_pos;Zi!==void 0&&C.vertexAttrib2f(Zi,0,0)}!Ve&&st&&st.setupShadows(Vt.tileID.toUnwrapped(),sr,"vector-tile",Vt.tileID.overscaledZ),j&&(u.context.activeTexture.set(C.TEXTURE0),Vt.imageAtlasTexture&&Vt.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Di.updatePaintBuffers());const Li=s.paint.get("fill-extrusion-vertical-gradient"),Xr=1/Lt.tileToMeter;let Ur;if(Ve&&st){if(Hy(Vt.tileID,Lt,u))continue;const Zi=st.calculateShadowPassMatrixFromTile(Vt.tileID.toUnwrapped());Ur=Ny(Zi,fe,Xr,Je,ft,Me)}else{const Zi=u.translatePosMatrix(Ct.expandedProjMatrix,Vt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),hr=R.projection.createInversionMatrix(R,Ct.canonical);Ur=j?Uy(Zi,u,Li,V,Q,fe,Xr,Ct,Vt,ue,ft,Me,ae,_e,hr,Oe,Je,D):Ua(Zi,u,Li,V,Q,fe,Xr,Ct,ue,ft,Me,ae,_e,hr,Oe,Je,Re,at)}u.uploadCommonUniforms(E,sr,Ct.toUnwrapped(),null,Fe);let gi=Lt.segments;if(R.projection.name==="mercator"&&!Ve&&(gi=Lt.getVisibleSegments(Vt.tileID,u.terrain,u.transform.getFrustum(0)),!gi.get().length))continue;if(Ut)if(Ve)for(const Zi of gi.get())Ut.numRenderedVerticesInShadowPass+=Zi.primitiveLength;else for(const Zi of gi.get())Ut.numRenderedVerticesInTransparentPass+=Zi.primitiveLength;const Vi=[];(u.terrain||b)&&Vi.push(Lt.centroidVertexBuffer),he&&Vi.push(Lt.layoutVertexExtBuffer),Xe&&Vi.push(Lt.wallVertexBuffer),sr.draw(u,E.gl.TRIANGLES,p,_,v,ot,Ur,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,gi,s.paint,u.transform.zoom,Di,Vi)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Ga(u,t,s,h,p,_,v,b,E,C,R,k,D,O,j,V,q,$,Q){const re=u.context,oe=re.gl,fe=u.transform,ue=u.transform.zoom,he=[],ae=Oa(u,s.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(he.push("CLEAR_SUBPASS"),Q&&(he.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(oe.TEXTURE0),Q.bind(oe.LINEAR,oe.CLAMP_TO_EDGE))):C==="sdf"&&he.push("SDF_SUBPASS"),q&&he.push("HAS_CENTROID"),ae.shouldRenderCutoff&&he.push("RENDER_CUTOFF");const _e=s.layout.get("fill-extrusion-edge-radius"),ge=(Oe,Re,Je,Xe,ft)=>{const Me=Re.programConfigurations.get(s.id),Fe=u.isTileAffectedByFog(Oe),Ce=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:Me,defines:he,overrideFog:Fe}),tt=((st,Qe,ot,at,Rt,Ut,Ct,Vt,Lt,ei,ui)=>({u_matrix:Qe,u_opacity:ot,u_ao_pass:at?1:0,u_meter_to_tile:Rt,u_ao:Ut,u_flood_light_intensity:Ct,u_flood_light_color:Vt,u_attenuation:Lt,u_edge_radius:ei,u_fb:0,u_fb_size:ui,u_dynamic_offset:1}))(0,Xe,R,E,ft,[k,D*ft],O,j,V,ue>=17?0:_e*ft,Q?Q.size[0]:0),Ve=[];q&&Ve.push(Re.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(re,Ce,Oe.toUnwrapped(),null,ae),Ce.draw(u,re.gl.TRIANGLES,p,_,v,b,tt,s.id,Re.vertexBuffer,Re.indexBuffer,Je,s.paint,ue,Me,Ve)};for(const Oe of h){const Re=t.getTile(Oe),Je=Re.getBucket(s);if(!Je||Je.projection.name!==fe.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Xe=Je.groundEffect,ft=1/Je.tileToMeter;{const Me=u.translatePosMatrix(Oe.projMatrix,Re,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Fe=Xe.getDefaultSegment();ge(Oe,Xe,Fe,Me,ft)}if($)for(let Me=0;Me<4;Me++){const Fe=n.dU[Me](Oe),Ce=t.getTile(Fe);if(!Ce)continue;const tt=Ce.getBucket(s);if(!tt||tt.projection.name!==fe.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;const Ve=tt.groundEffect;let st,Qe;Me===0?(st=[-n.aj,0,0],Qe=1):Me===1?(st=[n.aj,0,0],Qe=0):Me===2?(st=[0,-n.aj,0],Qe=3):(st=[0,n.aj,0],Qe=2);const ot=Ve.regionSegments[Qe];if(!ot)continue;const at=new Float32Array(16);n.bo(at,Oe.projMatrix,st),ge(Oe,Ve,ot,u.translatePosMatrix(at,Re,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ft)}}}function la(u,t,s,h,p,_,v){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const b=_?_.findDEMTileFor(s):null;if(!(b&&b.dem||v))return;_&&b&&b.dem&&h.selfDEMTileTimestamp!==b.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=b.dem._timestamp);const E=$=>new n.P(Math.ceil(($+n.dX)*n.dY),0),C=$=>{const Q=t.getSource().minzoom,re=fe=>{const ue=t.getTileByID(fe);if(ue&&ue.hasData())return ue.getBucket(p)},oe=[0,-1,1];for(const fe of oe){if($.overscaledZ+fe<Q)continue;const ue=re($.calculateScaledKey($.overscaledZ+fe));if(ue)return ue}},R=[0,0,0],k=($,Q)=>(R[0]=Math.min($.min.y,Q.min.y),R[1]=Math.max($.max.y,Q.max.y),R[2]=n.aj-Q.min.x>$.max.x?Q.min.x-n.aj:$.max.x,R),D=($,Q)=>(R[0]=Math.min($.min.x,Q.min.x),R[1]=Math.max($.max.x,Q.max.x),R[2]=n.aj-Q.min.y>$.max.y?Q.min.y-n.aj:$.max.y,R),O=[($,Q)=>k($,Q),($,Q)=>k(Q,$),($,Q)=>D($,Q),($,Q)=>D(Q,$)],j=($,Q,re,oe,fe,ue,he)=>{if(!_)return 0;const ae=[[ue?re:$,ue?$:re,0],[ue?re:Q,ue?Q:re,0]],_e=he<0?n.aj+he:he,ge=[ue?_e:($+Q)/2,ue?($+Q)/2:_e,0];return re===0&&he<0||re!==0&&he>0?_.getForTilePoints(fe,[ge],!0,oe):ae.push(ge),_.getForTilePoints(s,ae,!0,b),Math.max(ae[0][2],ae[1][2],ge[2])/_.exaggeration()};for(let $=0;$<4;$++){const Q=h.borderFeatureIndices[$];if(Q.length===0)continue;const re=n.dU[$](s),oe=C(re);if(!(oe&&oe instanceof n.dV))continue;const fe=_?_.findDEMTileFor(re):null;if(!(fe&&fe.dem||v)||(_&&fe&&fe.dem&&h.borderDEMTileTimestamp[$]!==fe.dem._timestamp&&(h.borderDoneWithNeighborZ[$]=-1,h.borderDEMTileTimestamp[$]=fe.dem._timestamp),h.borderDoneWithNeighborZ[$]===oe.canonical.z))continue;oe.centroidVertexArray.length===0&&oe.createCentroidsBuffer();const ue=($<2?1:5)-$,he=oe.borderDoneWithNeighborZ[ue]!==h.canonical.z,ae=oe.borderFeatureIndices[ue];let _e=0;if(h.canonical.z!==oe.canonical.z){for(const ge of Q)h.showCentroid(h.featuresOnBorder[ge]);if(he)for(const ge of ae)oe.showCentroid(oe.featuresOnBorder[ge]);h.borderDoneWithNeighborZ[$]=oe.canonical.z,oe.borderDoneWithNeighborZ[ue]=h.canonical.z}for(const ge of Q){const Oe=h.featuresOnBorder[ge],Re=h.centroidData[Oe.centroidDataIndex],Je=Oe.borders[$];let Xe;for(;_e<ae.length;){Xe=oe.featuresOnBorder[ae[_e]];const ft=Xe.borders[ue];if(ft[1]>Je[0]+3||ft[0]>Je[0]-3)break;oe.showCentroid(Xe),_e++}if(Xe&&_e<ae.length){const ft=_e;let Me=0;for(;!(Xe.borders[ue][0]>Je[1]-3)&&(Me++,++_e!==ae.length);)Xe=oe.featuresOnBorder[ae[_e]];Xe=oe.featuresOnBorder[ae[ft]];let Fe=!1;if(Me>=1){const Ve=Xe.borders[ue];Math.abs(Je[0]-Ve[0])<3&&Math.abs(Je[1]-Ve[1])<3&&(Me=1,Fe=!0,_e=ft+1)}else if(Me===0){h.showCentroid(Oe);continue}const Ce=oe.centroidData[Xe.centroidDataIndex];v&&Fe&&(((V=Re).flags|(q=Ce).flags)&n.dW?(V.flags|=n.dW,q.flags|=n.dW):(V.flags&=~n.dW,q.flags&=~n.dW));const tt=Oe.intersectsCount()>1||Xe.intersectsCount()>1;if(Me>1)_e=ft,Re.centroidXY=Ce.centroidXY=new n.P(0,0);else if(fe&&fe.dem&&!tt){const Ve=O[$](Re,Ce),st=$%2?n.aj-1:0,Qe=j(Ve[0],Math.min(n.aj-1,Ve[1]),st,fe,re,$<2,Ve[2]);Re.centroidXY=Ce.centroidXY=E(Qe)}else tt?Re.centroidXY=Ce.centroidXY=new n.P(0,0):(Re.centroidXY=h.encodeBorderCentroid(Oe),Ce.centroidXY=oe.encodeBorderCentroid(Xe));h.writeCentroidToBuffer(Re),oe.writeCentroidToBuffer(Ce)}else h.showCentroid(Oe)}h.borderDoneWithNeighborZ[$]=oe.canonical.z,oe.borderDoneWithNeighborZ[ue]=h.canonical.z}var V,q;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const ca=[1,0,0],Qt=[0,1,0],Mf=[0,0,1];function Hy(u,t,s){const h=s.transform,p=s.shadowRenderer;if(!p)return!0;const _=u.toUnwrapped(),v=h.tileSize*p._cascades[s.currentShadowCascade].scale;let b=t.maxHeight;if(h.elevation){const V=h.elevation.getMinMaxForTile(u);V&&(b+=V.max)}const E=[...p.shadowDirection];E[2]=-E[2];const C=p.computeSimplifiedTileShadowVolume(_,b,v,E);if(!C)return!1;const R=[ca,Qt,Mf,E,[E[0],0,E[2]],[0,E[1],E[2]]],k=h.projection.name==="globe",D=h.scaleZoom(v),O=n.cn.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,D,!k),j=p.getCurrentCascadeFrustum();return O.intersectsPrecise(C.vertices,C.planes,R)===0||j.intersectsPrecise(C.vertices,C.planes,R)===0}function t_(u){return[u[0]*n.dZ,u[1]*n.dZ,u[2]*n.dZ,0]}function tu(u,t,s,h,p,_,v,b,E){const C=h.getSource(),R=s.globeSharedBuffers;if(!R)return;let k,D,O;if(t&&(k=h.getTile(t)),C instanceof n.aP?(D=C.texture,O=n.ds(0,0,s.transform)):k&&t&&(D=k.texture,O=n.ds(t.canonical.z,t.canonical.x,s.transform)),!D||!O)return;u||(O=n.cE(n.bz(),O,[1,-1,1]));const j=s.context,V=j.gl,q=p.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,$=s.colorModeForDrapableLayerRenderPass(_),Q=v.defines;Q.push("GLOBE_POLES");const re=new Dt(V.LEQUAL,Dt.ReadWrite,s.depthRangeFor3D),oe=Float32Array.from(s.transform.expandedFarZProjMatrix),fe=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),j.activeTexture.set(V.TEXTURE0),D.bind(q,V.CLAMP_TO_EDGE),j.activeTexture.set(V.TEXTURE1),D.bind(q,V.CLAMP_TO_EDGE),"useMipmap"in D&&j.extTextureFilterAnisotropic&&s.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const[ue,he,ae,_e]=t?R.getPoleBuffers(t.canonical.z,!1):R.getPoleBuffers(0,!0),ge=p.paint.get("raster-elevation");let Oe;u?(Oe=ue,s.renderDefaultNorthPole=ge!==0):(Oe=he,s.renderDefaultSouthPole=ge!==0);const Re=t_(v.mix),Je=((ft,Me,Fe,Ce,tt,Ve,st,Qe,ot,at,Rt,Ut,Ct)=>aa(ft,Me,Fe,new Float32Array(16),new Float32Array(9),[0,0],Ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ve,[0,0],Qe,2,at,Rt,Ut,1,0,Ct))(oe,fe,O,n.ah(s.transform.zoom),0,p,0,ge,0,Re,v.offset,v.range,_),Xe=s.getOrCreateProgram("raster",{defines:Q});s.uploadCommonUniforms(j,Xe,null),Xe.draw(s,V.TRIANGLES,re,E,$,b,Je,p.id,Oe,ae,_e)}function i_(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,p=.2*u.height,_=t+p;return[t,s,(_-p-t)/h,(_-t)/h]}function qy(u,t,s,h){if(u)return t instanceof Ia&&u instanceof Dc?t.getTextureDescriptor(u,s,!0):{texture:u.texture,mix:t_(h.mix),offset:h.offset,buffer:0,tileSize:1}}var r_=n.d_([{name:"a_index",type:"Int16",components:1}]);class Wy{constructor(t,s,h,p){const _={width:h[0],height:h[1],data:null},v=t.gl;this.targetColorTexture=new n.T(t,_,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,_,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,p),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,p=s.width*s.height;this.particleTexture0=new n.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const _=new n.d$;_.reserve(p);for(let v=0;v<p;v++)_.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(_,r_.members,!0),this.particleSegment=n.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Zy(u,t,s){if(!u)return null;const h=t.getTextureDescriptor(u,s,!0);if(!h)return null;let{texture:p,mix:_,offset:v,tileSize:b,buffer:E,format:C}=h;if(!p||!C)return null;let R=!1;return C==="uint32"&&(R=!0,_[3]=0,_=Sf(n.e0,_,[0,s.paint.get("raster-particle-max-speed")]),v=Sh(n.e0,v,[0,s.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[E/(b+2*E),b/(b+2*E)],tileSize:b,scalarData:R,scale:_,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function Rf(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,p=.2*u.height,_=t+p;return[t,s,(_-p-t)/h,(_-t)/h]}const Df=new n.am(1,0,0,1),kf=new n.am(0,1,0,1),Lf=new n.am(0,0,1,1),ws=new n.am(1,0,1,1),ua=new n.am(0,1,1,1);function Ha(u,t,s,h,p,_,v){const b=u.context,E=u.transform,C=b.gl,R=E.projection.name==="globe",k=R?["PROJECTION_GLOBE_VIEW"]:[];let D=n.bw(s.projMatrix);if(R&&n.ah(E.zoom)>0){const Re=n.bg(s.canonical,E),Je=n.e1(Re);D=n.az(new Float32Array(16),E.globeMatrix,Je),n.az(D,E.projMatrix,D)}const O=n.bz();O[12]+=2*p/(n.q.devicePixelRatio*E.width),O[13]+=2*_/(n.q.devicePixelRatio*E.height),n.az(D,O,D);const j=u.getOrCreateProgram("debug",{defines:k}),V=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(V,j);const q=Dt.disabled,$=ai.disabled,Q=u.colorModeForRenderPass(),re="$debug";b.activeTexture.set(C.TEXTURE0),u.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R?V._makeGlobeTileDebugBuffers(u.context,E):V._makeDebugTileBoundsBuffers(u.context,E.projection);const oe=V._tileDebugBuffer||u.debugBuffer,fe=V._tileDebugIndexBuffer||u.debugIndexBuffer,ue=V._tileDebugSegments||u.debugSegments;if(j.draw(u,C.LINE_STRIP,q,$,Q,li.disabled,Va(D,h),re,oe,fe,ue,null,null,null,[V._globeTileDebugBorderBuffer]),v){const Re=V.latestRawTileData,Je=Math.floor((Re&&Re.byteLength||0)/1024);let Xe=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Xe+=` => ${s.overscaledZ}`),Xe+=` ${V.state}`,Xe+=` ${Je}kb`,function(ft,Me){ft.initDebugOverlayCanvas();const Fe=ft.debugOverlayCanvas,Ce=ft.context.gl,tt=ft.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,Fe.width,Fe.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(Me,5,5),tt.strokeText(Me,5,5),ft.debugOverlayTexture.update(Fe),ft.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(u,Xe)}const he=t.getTile(s).tileSize,ae=512/Math.min(he,512)*(s.overscaledZ/E.zoom)*.5,_e=V._tileDebugTextBuffer||u.debugBuffer,ge=V._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Oe=V._tileDebugTextSegments||u.debugSegments;j.draw(u,C.TRIANGLES,q,$,Ci.alphaBlended,li.disabled,Va(D,n.am.transparent,ae),re,_e,ge,Oe,null,null,null,[V._globeTileDebugTextBuffer])}function Dh(u,t,s,h){Fl(u,0,t+s/2,u.transform.width,s,h)}function kh(u,t,s,h){Fl(u,t-s/2,0,s,u.transform.height,h)}function Fl(u,t,s,h,p,_){const v=u.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*n.q.devicePixelRatio,s*n.q.devicePixelRatio,h*n.q.devicePixelRatio,p*n.q.devicePixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}const n_=n.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$s}=n_;function cr(u,t,s,h){u.emplaceBack(t,s,h)}class iu{constructor(t){this.vertexArray=new n.e2,this.indices=new n.a_,cr(this.vertexArray,-1,-1,1),cr(this.vertexArray,1,-1,1),cr(this.vertexArray,-1,1,1),cr(this.vertexArray,1,1,1),cr(this.vertexArray,-1,-1,-1),cr(this.vertexArray,1,-1,-1),cr(this.vertexArray,-1,1,-1),cr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$s),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bd.simpleSegment(0,0,36,12)}}function ha(u,t,s,h,p,_){const v=u.context.gl,b=t.paint.get("sky-atmosphere-color"),E=t.paint.get("sky-atmosphere-halo-color"),C=t.paint.get("sky-atmosphere-sun-intensity"),R=((k,D,O,j,V)=>({u_matrix_3f:k,u_sun_direction:D,u_sun_intensity:O,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(n.e4(n.dx(),h),p,C,b,E);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(u,v.TRIANGLES,Dt.disabled,ai.disabled,Ci.unblended,li.frontCW,R,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const s_=n.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class o_{constructor(t){const s=new n.e5;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new n.a_;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,s_.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=n.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const a_=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xy{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Bl{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ci([1,ss,1,ss],n.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ci([1,0,1,0],n.am.transparent,[!1,!1,!1,!0]),this.params=new Xy,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new o_(s);const h=this.params.sizeRange,p=this.params.intensityRange,_=function(R){const k=n.ea(30),D=[];for(let O=0;O<R;++O){const j=2*Math.PI*k(),V=Math.acos(1-2*k())-.5*Math.PI;D.push(n.cS(Math.cos(V)*Math.cos(j),Math.cos(V)*Math.sin(j),Math.sin(V)))}return D}(this.params.starsCount),v=n.ea(300),b=new n.e6,E=new n.a_;let C=0;for(let R=0;R<_.length;++R){const k=n.b$([],_[R],200),D=Math.max(0,1+.01*h*(1*v()-.5)),O=Math.max(0,1+.01*p*(1*v()-.5));b.emplaceBack(k[0],k[1],k[2],-1,-1,D,O),b.emplaceBack(k[0],k[1],k[2],1,-1,D,O),b.emplaceBack(k[0],k[1],k[2],1,1,D,O),b.emplaceBack(k[0],k[1],k[2],-1,1,D,O),E.emplaceBack(C+0,C+1,C+2),E.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=s.createVertexBuffer(b,a_.members),this.starsIdx=s.createIndexBuffer(E),this.starsSegments=n.bd.simpleSegment(0,0,b.length,E.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,p=h.gl,_=t.transform,v=new Dt(p.LEQUAL,Dt.ReadOnly,[0,1]),b=n.ah(_.zoom),E=t.style.getLut(s.scope),C=s.properties.get("color-use-theme")==="none",R=s.properties.get("color").toRenderColor(C?null:E).toArray01(),k=s.properties.get("high-color-use-theme")==="none",D=s.properties.get("high-color").toRenderColor(k?null:E).toArray01(),O=s.properties.get("space-color-use-theme")==="none",j=s.properties.get("space-color").toRenderColor(O?null:E).toArray01PremultipliedAlpha(),V=5e-4,q=n.e7(s.properties.get("horizon-blend"),0,1,V,.25),$=n.dl(t,h,_)&&q===V?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,Q=t.frameCounter/1e3%1,re=n.ae(_.globeCenterInViewSpace),oe=Math.sqrt(Math.pow(re,2)-Math.pow($,2)),fe=Math.acos(oe/re),ue=he=>{const ae=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&ae.push("ALPHA_PASS");const _e=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),ge=((Re,Je,Xe,ft,Me,Fe,Ce,tt,Ve,st,Qe,ot)=>({u_frustum_tl:Re,u_frustum_tr:Je,u_frustum_br:Xe,u_frustum_bl:ft,u_horizon:Me,u_transition:Fe,u_fadeout_range:Ce,u_color:tt,u_high_color:Ve,u_space_color:st,u_temporal_offset:Qe,u_horizon_angle:ot}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,b,q,R,D,j,Q,fe);t.uploadCommonUniforms(h,_e);const Oe=this.atmosphereBuffer;Oe&&_e.draw(t,p.TRIANGLES,v,ai.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,li.backCW,ge,he?"atmosphere_glow_alpha":"atmosphere_glow",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)};ue(!1),ue(!0)}drawStars(t,s){const h=n.aD(s.properties.get("star-intensity"),0,1);if(h===0)return;const p=t.context,_=p.gl,v=t.transform,b=t.getOrCreateProgram("stars"),E=n.bY([]);n.b_(E,E,-v._pitch),n.bZ(E,E,-v.angle),n.b_(E,E,n.al(v._center.lat)),n.e8(E,E,-n.al(v._center.lng));const C=n.c3(new Float32Array(16),E),R=n.az([],v.starsProjMatrix,C),k=n.e4([],C),D=n.e9([],k),O=[0,1,0];n.dz(O,O,D),n.b$(O,O,this.params.sizeMultiplier);const j=[1,0,0];n.dz(j,j,D),n.b$(j,j,this.params.sizeMultiplier);const V=(q=O,$=j,Q=h,{u_matrix:Float32Array.from(R),u_up:q,u_right:$,u_intensity_multiplier:Q});var q,$,Q;t.uploadCommonUniforms(p,b),this.starsVx&&this.starsIdx&&b.draw(t,_.TRIANGLES,Dt.disabled,ai.disabled,this.colorModeAlphaBlendedWriteRGB,li.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function qa(u,t){const s=[...u],h=t.cameraWorldSizeForFog/t.worldSize,p=n.bx([]);return n.cE(p,p,[h,h,1]),n.az(s,p,s),n.az(s,t.worldToFogMatrix,s),s}function pt(u,t,s,h,p){const _=s.material,v=h.context,{baseColorTexture:b,metallicRoughnessTexture:E}=_.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:R,emissionTexture:k}=_;function D(j,V,q){if(j&&(u.push(V),v.activeTexture.set(v.gl.TEXTURE0+q),j.gfxTexture)){const{minFilter:$,magFilter:Q,wrapS:re,wrapT:oe}=j.sampler;j.gfxTexture.bindExtraParam($,Q,re,oe)}}D(b,"HAS_TEXTURE_u_baseColorTexture",os.BaseColor),D(E,"HAS_TEXTURE_u_metallicRoughnessTexture",os.MetallicRoughness),D(C,"HAS_TEXTURE_u_normalTexture",os.Normal),D(R,"HAS_TEXTURE_u_occlusionTexture",os.Occlusion),D(k,"HAS_TEXTURE_u_emissionTexture",os.Emission),p&&(p.texture||(p.texture=new n.ed(h.context,p.image,[p.image.height,p.image.height,p.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+os.LUT),p.texture&&p.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(u.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||u.push("DIFFUSE_SHADED");const O=h.shadowRenderer;O&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&u.push("NORMAL_OFFSET"))}function At(u,t,s,h,p,_){const v=s.paint.get("model-opacity").constantOr(1),b=t.context,E=new Dt(t.context.gl.LEQUAL,Dt.ReadWrite,t.depthRangeFor3D),C=t.transform,R=u.mesh,k=R.material,D=k.pbrMetallicRoughness,O=t.style.fog;let j;j=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:n.az([],h.zScaleMatrix,u.nodeModelMatrix),n.az(j,h.negCameraPosMatrix,j);const V=n.bi([],j);n.ee(V,V);const q=s.paint.get("model-color-use-theme").constantOr("default")==="none",$=s.paint.get("model-emissive-strength").constantOr(0),Q=ja(new Float32Array(u.worldViewProjection),new Float32Array(j),new Float32Array(V),null,t,v,D.baseColorFactor.toRenderColor(null),k.emissiveFactor,D.metallicFactor,D.roughnessFactor,k,$,s),re={defines:[]},oe=[],fe=t.shadowRenderer;fe&&(fe.useNormalOffset=!1),pt(re.defines,oe,R,t,q?null:s.lut);let ue=null;if(O){const _e=qa(u.nodeModelMatrix,t.transform);if(ue=new Float32Array(_e),C.projection.name!=="globe"){const ge=R.aabb.min,Oe=R.aabb.max,[Re,Je]=O.getOpacityForBounds(_e,ge[0],ge[1],Oe[0],Oe[1]);re.overrideFog=Re>=Et||Je>=Et}}const he=Oa(t,s.paint.get("model-cutoff-fade-range"));he.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");const ae=t.getOrCreateProgram("model",re);t.uploadCommonUniforms(b,ae,null,ue,he),t.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(u.nodeModelMatrix,ae),ae.draw(t,b.gl.TRIANGLES,E,p,_,R.material.doubleSided?li.disabled:li.backCCW,Q,s.id,R.vertexBuffer,R.indexBuffer,R.segments,s.paint,t.transform.zoom,void 0,oe)}function Wa(u,t,s,h,p,_,v){let b;b=u.projection.name==="globe"?n.ef(s,u):[...s],n.az(b,b,t.matrix);const E=n.az([],h,b);if(t.meshes)for(const C of t.meshes){if(C.material.alphaMode!=="BLEND"){v.push({mesh:C,depth:0,modelIndex:p,worldViewProjection:E,nodeModelMatrix:b});continue}const R=n.ad([],C.centroid,E);!u.isOrthographic&&R[2]<=0||_.push({mesh:C,depth:R[2],modelIndex:p,worldViewProjection:E,nodeModelMatrix:b})}if(t.children)for(const C of t.children)Wa(u,C,s,h,p,_,v)}function Jr(u,t,s,h){const p=s.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),v=p.getShadowPassColorMode(),b=p.calculateShadowPassMatrixFromMatrix(t),E=e_(b);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,_,ai.disabled,v,li.backCCW,E,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,s.transform.zoom,void 0,void 0)}function De(u,t,s){const h=t.updateZoomBasedPaintProperties(),p=function(_,v,b){let E,C,R,k=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&k>0){const D=_.terrain,O=D.findDEMTileFor(b);O&&O.dem?E=n.el.create(D,b,O):k=0}if(k===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),k===v.validForExaggeration&&(k===0||E&&E._demTile&&E._demTile.tileID===v.validForDEMTile.id&&E._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const D in v.instancesPerModel){const O=v.instancesPerModel[D];for(let j=0;j<O.instancedDataArray.length;++j){const V=(E?k*E.getElevationAt(0|O.instancedDataArray.float32[16*j],0|O.instancedDataArray.float32[16*j+1],!0,!0):0)+O.instancesEvaluatedElevation[j];O.instancedDataArray.float32[16*j+6]=V,C=C?Math.min(v.terrainElevationMin,V):V,R=R?Math.max(v.terrainElevationMax,V):V}}return v.terrainElevationMin=C||0,v.terrainElevationMax=R||0,v.validForExaggeration=k,v.validForDEMTile=E&&E._demTile?{id:E._demTile.tileID,timestamp:E._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,s);(h||p)&&(t.uploaded=!1,t.upload(u.context))}const to={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cV([0,0,0],[n.aj,n.aj,0])};function Lh(u,t){const s=1<<u.canonical.z,h=t.getFreeCameraOptions().position,p=t.elevation,_=u.canonical.x/s,v=(u.canonical.x+1)/s,b=u.canonical.y/s,E=(u.canonical.y+1)/s;let C=t._centerAltitude;if(p){const O=p.getMinMaxForTile(u);O&&O.max>C&&(C=O.max)}const R=n.aD(h.x,_,v)-h.x,k=n.aD(h.y,b,E)-h.y,D=n.c6(C,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(R*R+k*k+D*D))}function zh(u,t,s,h,p,_,v){const b=u.context,E=u.renderPass==="shadow",C=u.shadowRenderer,R=E&&C?C.getShadowPassDepthMode():new Dt(b.gl.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D),k=u.isTileAffectedByFog(_);if(s.meshes)for(const D of s.meshes){const O=["MODEL_POSITION_ON_GPU"],j=[];let V,q,$;h.instancedDataArray.length>20&&O.push("INSTANCED_ARRAYS");const Q=Oa(u,t.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),E&&C)V=u.getOrCreateProgram("modelDepth",{defines:O}),q=e_(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(s.matrix)),$=C.getShadowPassColorMode();else{pt(O,j,D,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),V=u.getOrCreateProgram("model",{defines:O,overrideFog:k});const oe=D.material,fe=oe.pbrMetallicRoughness,ue=t.paint.get("model-opacity").constantOr(1),he=t.paint.get("model-emissive-strength").constantOr(0);q=ja(_.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,u,ue,fe.baseColorFactor.toRenderColor(null),oe.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,oe,he,t,p),C&&(v.shadowUniformsInitialized?V.setShadowUniformValues(b,C.getShadowUniformValues()):(C.setupShadows(_.toUnwrapped(),V,"model-tile",_.overscaledZ),v.shadowUniformsInitialized=!0)),$=Q.shouldRenderCutoff||ue<1||oe.alphaMode!=="OPAQUE"?Ci.alphaBlended:Ci.unblended}u.uploadCommonUniforms(b,V,_.toUnwrapped(),null,Q);const re=D.material.doubleSided?li.disabled:li.backCCW;if(h.instancedDataArray.length>20)j.push(h.instancedDataBuffer),V.draw(u,b.gl.TRIANGLES,R,ai.disabled,$,re,q,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,u.transform.zoom,void 0,j,h.instancedDataArray.length);else{const oe=E?"u_instance":"u_normal_matrix";for(let fe=0;fe<h.instancedDataArray.length;++fe)q[oe]=new Float32Array(h.instancedDataArray.arrayBuffer,64*fe,16),V.draw(u,b.gl.TRIANGLES,R,ai.disabled,$,re,q,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,u.transform.zoom,void 0,j)}}if(s.children)for(const D of s.children)zh(u,t,D,h,p,_,v)}const zf=[1,-1,1];function l_(u,t,s,h){if(!s.modelManager)return!0;const p=s.modelManager;if(!s.shadowRenderer)return!0;const _=s.shadowRenderer,v=t.aabb;let b=!0,E=u.maxHeight;if(E===0){let R=0;for(const k in u.instancesPerModel){const D=p.getModel(k,h);D?R=Math.max(R,Math.max(Math.max(D.aabb.max[0],D.aabb.max[1]),D.aabb.max[2])):b=!1}E=u.maxScale*R*1.41+u.maxVerticalOffset,b&&(u.maxHeight=E)}v.max[2]=E,v.min[2]+=u.terrainElevationMin,v.max[2]+=u.terrainElevationMax,n.ad(v.min,v.min,t.tileMatrix),n.ad(v.max,v.max,t.tileMatrix);const C=v.intersects(_.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=C===2),C===0}function c_(u,t){const s=u.uniformValues.u_cutoff_params[0],h=u.uniformValues.u_cutoff_params[1],p=u.uniformValues.u_cutoff_params[2],_=u.uniformValues.u_cutoff_params[3];return h===s||_===p?1:n.aD(((t-s)/(h-s)-p)/(_-p),0,1)}function Nl(u,t,s,h){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();n.az(p,p,u);const _=n.ei(s.min[0],s.min[1],s.min[2],1);let v=n.aA(n.ej(),_,p),b=v,E=v;_[1]=s.max[1],v=n.aA(n.ej(),_,p),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E,_[0]=s.max[0],v=n.aA(n.ej(),_,p),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E,_[1]=s.min[1],v=n.aA(n.ej(),_,p),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E;const C=n.aD(h[0],0,1),R=100*t.pixelsPerMeter*n.aD(h[1],0,1),k=n.aD(h[2],0,1),D=n.ek(n.ej(),b,E,C),O=Math.tan(.5*t.fovX),j=-D[2]*O;if(R===0)return D[1]<-Math.abs(j)?k:1;const V=(-Math.abs(j)-D[1])/R,q=(Q,re,oe)=>(1-oe)*Q+oe*re,$=n.aD(q(1,k,V),k,1);return q(1,$,n.aD((t.pitch-20)/20,0,1))}class Ky{}class Yy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const k=this._storage.get(s.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const p=h.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),v=new ArrayBuffer(_),b=new Int16Array(v);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const E=new n.en;for(let k=0;k<_/2;k+=3){const D=b[k],O=b[k+1],j=b[k+2];E.emplaceBack(D,O),E.emplaceBack(O,j),E.emplaceBack(j,D)}const C=h.bindVertexArrayOES.current,R=new Ky;return R.buf=new Oo(h,E),R.lastUsedFrameIdx=t,this._storage.set(s.id,R),h.bindVertexArrayOES.set(C),R.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class u_{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Oh=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Of{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ff{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const h_=n.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Fh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new n.eo,b=new n.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,h_.members),this.vignetteIdx=t.context.createIndexBuffer(b)}const p=n.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const v={u_vignetteShape:(_={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Dt.disabled,ai.disabled,Ci.alphaBlended,li.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,p)}var _}}class ru{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,p=h.toAltitude(),_=h.toLngLat(),v=n.al(_.lng),b=n.al(_.lat),E=t.pixelsPerMeter/s,C=v*n.eq,R=n.eq*Math.log(Math.tan(Math.PI/4+b/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const k=-this._offsetYPrev+R,D=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+C)*E,this._accumulatedOffsetY+=k*E,this._accumulatedElevation+=D*E,this._offsetXPrev=C,this._offsetYPrev=R,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Za(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function Bf(u){const t=n.ea(1323123451230),s=[];for(let h=0;h<u;++h){const p=2*t()-1,_=2*t()-1,v=2*t()-1;s.push(n.cS(p,_,v))}return s}function da(u,t,s,h,p){const _=n.aD((p-s)/(h-s),0,1);return(1-_)*u+_*t}class ls{constructor(t){this._movement=new ru,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Fh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const p=h.starsProjMatrix,_=n.bY([]);n.b_(_,_,n.al(90)-h._pitch),n.bZ(_,_,-h.angle);const v=n.c3(new Float32Array(16),_),b=n.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),E=n.ee([],b),C=n.az([],E,v),R=Date.now()/1e3;return this._accumulatedTimeFromStart+=(R-this._prevTime)*s,this._prevTime=R,{projectionMatrix:p,modelviewMatrix:C}}}class Jy extends ls{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ff(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Bf(this.particlesCount),p=new n.er,_=new n.a_;let v=0;const b=n.ea(1323123451230);for(let E=0;E<h.length;++E){const C=h[E],R=[2*b()-1,b(),b(),b()];p.emplaceBack(C[0],C[1],C[2],-1,-1,...R),p.emplaceBack(C[0],C[1],C[2],1,-1,...R),p.emplaceBack(C[0],C[1],C[2],1,1,...R),p.emplaceBack(C[0],C[1],C[2],-1,1,...R),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(p,Oh.members),this.particlesIdx=s.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const p=da(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let v=[-_.direction.x,_.direction.y,-100];n.au(v,v);const b=structuredClone(this._vignetteParams);b.strength*=p,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,b.strength=1,b.color=structuredClone(t.style.rain.state.vignetteColor));const E=this.updateOnRender(t,_.timeFactor),C=t.context,R=C.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(C,{width:t.width,height:t.height,data:null},R.RGBA8)),_.distortionStrength>0&&(C.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexSubImage2D(R.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const D=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(C,D),C.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const O=[_.color.r,_.color.g,_.color.b,_.color.a],j=(V,q)=>{const $=Za(this._movement.getPosition(),V),Q=_.dropletSizeX,re=_.dropletSizeX*_.dropletSizeYScale,oe=t.width/2,fe=t.height/2,ue=da(0,_.screenThinning.start,0,1,_.screenThinning.intensity),he=da(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),ae=da(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),_e=(ge={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:V,rainDropletSize:[Q,re],distortionStrength:_.distortionStrength,rainDirection:v,color:O,screenSize:[k.width,k.height],thinningCenterPos:[oe,fe],thinningShape:[ue,he,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:ae,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:q?0:1},{u_modelview:Float32Array.from(ge.modelview),u_projection:Float32Array.from(ge.projection),u_time:ge.time,u_cam_pos:ge.camPos,u_texScreen:0,u_velocityConeAperture:ge.velocityConeAperture,u_velocity:ge.velocity,u_boxSize:ge.boxSize,u_rainDropletSize:ge.rainDropletSize,u_distortionStrength:ge.distortionStrength,u_rainDirection:ge.rainDirection,u_color:ge.color,u_screenSize:ge.screenSize,u_thinningCenterPos:ge.thinningCenterPos,u_thinningShape:ge.thinningShape,u_thinningAffectedRatio:ge.thinningAffectedRatio,u_thinningParticleOffset:ge.thinningParticleOffset,u_shapeDirectionalPower:ge.shapeDirectionalPower,u_shapeNormalPower:ge.shapeNormalPower,u_mode:ge.mode});var ge;const Oe=Math.round(_.intensity*this.particlesCount),Re=n.bd.simpleSegment(0,0,4*Oe,2*Oe);D.draw(t,R.TRIANGLES,Dt.disabled,ai.disabled,Ci.alphaBlended,li.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,Re)};_.distortionStrength>0&&j(_.boxSize,!0),j(_.boxSize,!1),this._vignette.draw(t,b)}}const nu=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Fr extends ls{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ff(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Bf(this.particlesCount),p=new n.es,_=new n.a_;let v=0;const b=n.ea(1323123451230);for(let E=0;E<h.length;++E){const C=h[E],R=b(),k=b(),D=b(),O=[E/h.length,R,k,D],j=[b(),b()];p.emplaceBack(C[0],C[1],C[2],-1,-1,...O,...j),p.emplaceBack(C[0],C[1],C[2],1,-1,...O,...j),p.emplaceBack(C[0],C[1],C[2],1,1,...O,...j),p.emplaceBack(C[0],C[1],C[2],-1,1,...O,...j),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(p,nu.members),this.particlesIdx=s.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];n.au(h,h);const p=structuredClone(this._vignetteParams),_=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(_.revealStart>v)return;const b=da(0,1,_.revealStart,_.revealStart+_.revealRange,v);p.strength*=b,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const E=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const C=t.context,R=C.gl,k=t.transform,D=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(C,D),((O,j,V)=>{const q=Za(this._movement.getPosition(),O),$=k.width/2,Q=k.height/2,re=da(0,V.screenThinning.start,0,1,V.screenThinning.intensity),oe=da(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),fe=da(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),ue=(he={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:O,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[$,Q],thinningShape:[re,oe,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:fe,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:h},{u_modelview:Float32Array.from(he.modelview),u_projection:Float32Array.from(he.projection),u_time:he.time,u_cam_pos:he.camPos,u_velocityConeAperture:he.velocityConeAperture,u_velocity:he.velocity,u_horizontalOscillationRadius:he.horizontalOscillationRadius,u_horizontalOscillationRate:he.horizontalOscillationRate,u_boxSize:he.boxSize,u_billboardSize:he.billboardSize,u_simpleShapeParameters:he.simpleShapeParameters,u_screenSize:he.screenSize,u_thinningCenterPos:he.thinningCenterPos,u_thinningShape:he.thinningShape,u_thinningAffectedRatio:he.thinningAffectedRatio,u_thinningParticleOffset:he.thinningParticleOffset,u_particleColor:he.color,u_direction:he.direction});var he;const ae=Math.round(V.intensity*this.particlesCount),_e=n.bd.simpleSegment(0,0,4*ae,2*ae);this.particlesVx&&this.particlesIdx&&D.draw(t,R.TRIANGLES,Dt.disabled,ai.disabled,Ci.alphaBlended,li.disabled,ue,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(s.boxSize,0,s),this._vignette.draw(t,p)}}const Ki={symbol:function(u,t,s,h,p){if(u.renderPass!=="translucent")return;const _=ai.disabled,v=u.colorModeForRenderPass(),b=s.layout.get("text-variable-anchor"),E=s.layout.get("text-size-scale-range"),C=n.aD(u.scaleFactor,E[0],E[1]);b&&function(D,O,j,V,q,$,Q,re){const oe=O.transform,fe=q==="map",ue=$==="map";for(const he of D){const ae=V.getTile(he),_e=ae.getBucket(j);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const ge=n.bH(_e.textSizeData,oe.zoom,re),Oe=Oc(he,_e.getProjection(),oe),Re=oe.calculatePixelsToTileUnitsMatrix(ae),Je=vl(Oe,ae.tileID.canonical,ue,fe,oe,_e.getProjection(),Re),Xe=_e.hasIconTextFit()&&_e.hasIconData();ge&&Cf(_e,fe,ue,Q,oe,Je,he,Math.pow(2,oe.zoom-ae.tileID.overscaledZ),ge,Xe)}}(h,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p,C);const R=s.paint.get("icon-opacity").constantOr(1)!==0,k=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||k)?Rh(u,t,s,h,_,v):(R&&Rh(u,t,s,h,_,v,{onlyIcons:!0}),k&&Rh(u,t,s,h,_,v,{onlyText:!0})),t.map.showCollisionBoxes&&(zl(u,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),zl(u,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,h){if(u.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0,E=s.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const C=u.context,R=C.gl,k=u.transform,D=u.depthModeForSublayer(0,Dt.ReadOnly),O=ai.disabled,j=u.colorModeForDrapableLayerRenderPass(E),V=k.projection.name==="globe",q=[n.ay(k.center.lng),n.aH(k.center.lat)],$=[];for(let re=0;re<h.length;re++){const oe=h[re],fe=t.getTile(oe),ue=fe.getBucket(s);if(!ue||ue.projection.name!==k.projection.name)continue;const he=ue.programConfigurations.get(s.id),ae=n.dK(s),_e=u.isTileAffectedByFog(oe);V&&ae.push("PROJECTION_GLOBE_VIEW"),ae.push("DEPTH_D24"),u.terrain&&k.depthOcclusionForSymbolsAndCircles&&ae.push("DEPTH_OCCLUSION");const ge=u.getOrCreateProgram("circle",{config:he,defines:ae,overrideFog:_e}),Oe=ue.layoutVertexBuffer,Re=ue.globeExtVertexBuffer,Je=ue.indexBuffer,Xe=k.projection.createInversionMatrix(k,oe.canonical),ft={programConfiguration:he,program:ge,layoutVertexBuffer:Oe,globeExtVertexBuffer:Re,indexBuffer:Je,uniformValues:n.dL(u,oe,fe,Xe,q,s),tile:fe};if(b){const Me=ue.segments.get();for(const Fe of Me)$.push({segments:new n.bd([Fe]),sortKey:Fe.sortKey,state:ft})}else $.push({segments:ue.segments,sortKey:0,state:ft})}b&&$.sort((re,oe)=>re.sortKey-oe.sortKey);const Q={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const re of $){const{programConfiguration:oe,program:fe,layoutVertexBuffer:ue,globeExtVertexBuffer:he,indexBuffer:ae,uniformValues:_e,tile:ge}=re.state,Oe=re.segments;u.terrain&&u.terrain.setupElevationDraw(ge,fe,Q),u.uploadCommonUniforms(C,fe,ge.tileID.toUnwrapped()),fe.draw(u,R.TRIANGLES,D,O,j,li.disabled,_e,s.id,ue,ae,Oe,s.paint,k.zoom,oe,[he])}},heatmap:function(u,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const p=u.context,_=p.gl,v=ai.disabled,b=new Ci([_.ONE,_.ONE,_.ONE,_.ONE],n.am.transparent,[!0,!0,!0,!0]);(function(O,j,V,q){const $=O.gl,Q=j.width*q,re=j.height*q;O.activeTexture.set($.TEXTURE1),O.viewport.set([0,0,Q,re]);let oe=V.heatmapFbo;if(!oe||oe&&(oe.width!==Q||oe.height!==re)){oe&&oe.destroy();const fe=$.createTexture();$.bindTexture($.TEXTURE_2D,fe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),oe=V.heatmapFbo=O.createFramebuffer(Q,re,!0,null),function(ue,he,ae,_e,ge,Oe){const Re=ue.gl;Re.texImage2D(Re.TEXTURE_2D,0,ue.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,ge,Oe,0,Re.RGBA,ue.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),_e.colorAttachment.set(ae)}(O,0,fe,oe,Q,re)}else $.bindTexture($.TEXTURE_2D,oe.colorAttachment.get()),O.bindFramebuffer.set(oe.framebuffer)})(p,u,s,u.transform.projection.name==="globe"?.5:.25),p.clear({color:n.am.transparent});const E=u.transform,C=E.projection.name==="globe",R=C?["PROJECTION_GLOBE_VIEW"]:[],k=C?li.frontCCW:li.disabled,D=[n.ay(E.center.lng),n.aH(E.center.lat)];for(let O=0;O<h.length;O++){const j=h[O];if(t.hasRenderableParent(j))continue;const V=t.getTile(j),q=V.getBucket(s);if(!q||q.projection.name!==E.projection.name)continue;const $=u.isTileAffectedByFog(j),Q=q.programConfigurations.get(s.id),re=u.getOrCreateProgram("heatmap",{config:Q,defines:R,overrideFog:$}),{zoom:oe}=u.transform;u.terrain&&u.terrain.setupElevationDraw(V,re),u.uploadCommonUniforms(p,re,j.toUnwrapped());const fe=E.projection.createInversionMatrix(E,j.canonical);re.draw(u,_.TRIANGLES,Dt.disabled,v,b,k,Km(u,j,V,fe,D,oe,s.paint.get("heatmap-intensity")),s.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,s.paint,u.transform.zoom,Q,C?[q.globeExtVertexBuffer]:null)}p.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(p,_){const v=p.context,b=v.gl,E=_.heatmapFbo;if(!E)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E.colorAttachment.get()),v.activeTexture.set(b.TEXTURE1);let C=_.colorRampTexture;C||(C=_.colorRampTexture=new n.T(v,_.colorRamp,b.RGBA8)),C.bind(b.LINEAR,b.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,b.TRIANGLES,Dt.disabled,ai.disabled,p.colorModeForRenderPass(),li.disabled,((R,k,D,O)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(u,s))},line:function(u,t,s,h){if(u.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const v=s.paint.get("line-emissive-strength"),b=s.paint.get("line-occlusion-opacity"),E=s.layout.get("line-elevation-reference"),C=s.layout.get("line-width-unit")==="meters",R=E==="sea",k=!(!u.terrain||!u.terrain.enabled),D=u.context,O=D.gl;if(s.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const j=s.layout.get("line-cross-slope"),V=j!==void 0,q=j<1,$=u.colorModeForDrapableLayerRenderPass(v),Q=u.terrain&&u.terrain.renderingToTexture,re=Q?1:n.q.devicePixelRatio,oe=s.paint.get("line-dasharray"),fe=oe.constantOr(1),ue=s.layout.get("line-cap"),he=oe.constantOr(null),ae=ue.constantOr(null),_e=s.paint.get("line-pattern"),ge=_e.constantOr(1),Oe=s.paint.get("line-pattern-cross-fade"),Re=_e.constantOr(null),Je=s.paint.get("line-opacity").constantOr(1);let Xe=!ge&&Je!==1||u.depthOcclusion&&b>0&&b<1;const ft=s.paint.get("line-gradient"),Me=ge?"linePattern":"line",Fe=n.dM(s);let Ce;if(Q&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),b!==0&&u.depthOcclusion){const Qe=s.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?Ce=Qe.value:n.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Fe.push("VARIABLE_LINE_WIDTH");const tt=(Qe,ot,at,Rt,Ut,Ct)=>{for(const Vt of Qe){const Lt=t.getTile(Vt);if(ge&&!Lt.patternsLoaded())continue;const ei=Lt.getBucket(s);if(!ei||ei.elevationType!=="none"&&!Ut||ei.elevationType==="none"&&Ut)continue;u.prepareDrawTile();const ui=[...ot],Di=u.shadowRenderer,ur=ei.elevationType==="road"&&!!Di&&Di.enabled;let sr=[0,0,0];if(ur){const wi=u.style.directionalLight,kr=u.style.ambientLight;wi&&kr&&(sr=mo(u.style,wi,kr)),ui.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Li=ei.programConfigurations.get(s.id);let Xr=!1;if(Re&&Lt.imageAtlas){const wi=n.dN.from(Re),kr=wi.getPrimary().scaleSelf(re).toString(),Hi=Lt.imageAtlas.patternPositions.get(kr),Lr=wi.getSecondary(),Qi=Lr?Lt.imageAtlas.patternPositions.get(Lr.scaleSelf(re).toString()):null;Xr=!!Hi&&!!Qi,Hi&&Li.setConstantPatternPositions(Hi,Qi)}Oe>0&&(Xr||Li.getPatternTransitionVertexBuffer("line-pattern"))&&ui.push("LINE_PATTERN_TRANSITION");const Ur=u.isTileAffectedByFog(Vt),gi=u.getOrCreateProgram(Me,{config:Li,defines:ui,overrideFog:Ur,overrideRtt:!Ut&&void 0});if(!ge&&he&&ae&&Lt.lineAtlas){const wi=Lt.lineAtlas.getDash(he,ae);wi&&Li.setConstantPatternPositions(wi)}ur&&Di.setupShadows(Lt.tileID.toUnwrapped(),gi,"vector-tile",Lt.tileID.overscaledZ);let[Vi,Zi]=s.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&Vi!==Zi&&(Vi===0&&(Vi-=1),Zi===1&&(Zi+=1));const hr=Q?Vt.projMatrix:null,un=C?1/ei.tileToMeter/n.aw(Lt,1,u.transform.zoom):1,Qr=C?1/ei.tileToMeter/n.aw(Lt,1,Math.floor(u.transform.zoom)):1,ln=ge?n.dO(u,Lt,s,hr,re,un,Qr,[Vi,Zi],sr,Oe):n.dP(u,Lt,s,hr,ei.lineClipsArray.length,re,un,Qr,[Vi,Zi],sr);if(ft){const wi=ei.gradients[s.id];let kr=wi.texture;if(s.gradientVersion!==wi.version){let Hi=256;if(s.stepInterpolant){const Lr=t.getSource().maxzoom,Qi=Vt.canonical.z===Lr?Math.ceil(1<<u.transform.maxZoom-Vt.canonical.z):1;Hi=n.aD(n.dQ(ei.maxLineLength/n.aj*1024*Qi),256,D.maxTextureSize)}wi.gradient=n.dR({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Hi,image:wi.gradient||void 0,clips:ei.lineClipsArray}),wi.texture?wi.texture.update(wi.gradient):wi.texture=new n.T(D,wi.gradient,O.RGBA8),wi.version=s.gradientVersion,kr=wi.texture}D.activeTexture.set(O.TEXTURE1),kr.bind(s.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}fe&&(D.activeTexture.set(O.TEXTURE0),Lt.lineAtlasTexture&&Lt.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),Li.updatePaintBuffers()),ge&&(D.activeTexture.set(O.TEXTURE0),Lt.imageAtlasTexture&&Lt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Li.updatePaintBuffers()),Ut&&!R&&u.terrain.setupElevationDraw(Lt,gi),u.uploadCommonUniforms(D,gi,Vt.toUnwrapped());const Br=wi=>{Ce!=null&&(Ce.value=Je*b),gi.draw(u,O.TRIANGLES,at,wi,$,li.disabled,ln,s.id,ei.layoutVertexBuffer,ei.indexBuffer,ei.segments,s.paint,u.transform.zoom,Li,[ei.layoutVertexBuffer2,ei.patternVertexBuffer,ei.zOffsetVertexBuffer]),Ce!=null&&(Ce.value=Je)};if(Xe&&!Ut){const wi=u.stencilModeForClipping(Vt).ref;wi===0&&Q&&D.clear({stencil:0});const kr={func:O.EQUAL,mask:255};ln.u_alpha_discard_threshold=.8,Br(new ai(kr,wi,255,O.KEEP,O.KEEP,O.INVERT)),ln.u_alpha_discard_threshold=0,Br(new ai(kr,wi,255,O.KEEP,O.KEEP,O.KEEP))}else ln.u_alpha_discard_threshold=Xe&&Ut&&Ct?.8:0,Br(Ut?Rt:u.stencilModeForClipping(Vt))}};let Ve=u.depthModeForSublayer(0,Dt.ReadOnly);const st=new Dt(u.depthOcclusion?O.GREATER:O.LEQUAL,Dt.ReadOnly,u.depthRangeFor3D);if(s.hasNonElevatedBuckets){const Qe=!Q&&u.terrain;b!==0&&Qe?n.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):Qe?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):tt(h,Fe,Ve,ai.disabled,!1,!0)}if(s.hasElevatedBuckets){E==="hd-road-markup"?k||(Ve=st,Fe.push("ELEVATED_ROADS")):(Fe.push("ELEVATED"),Ve=st,V&&Fe.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),R&&Fe.push("ELEVATION_REFERENCE_SEA"));const Qe=Xe?u.stencilModeFor3D():ai.disabled;u.forceTerrainMode=!0,tt(h,Fe,Ve,Qe,!0,!0),Xe&&tt(h,Fe,Ve,Qe,!0,!1),u.forceTerrainMode=!1}Xe&&(u.resetStencilClippingMasks(),Q&&D.clear({stencil:0})),b===0||u.depthOcclusion||Q||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,s,h){const p=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=s.paint.get("fill-emissive-strength"),b=u.colorModeForDrapableLayerRenderPass(v),E=s.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!E.constantOr(1)&&p.constantOr(n.am.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let R="none";s.layout.get("fill-elevation-reference")!=="none"?R="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(R="offset");const k=!(!u.terrain||!u.terrain.enabled),D={painter:u,sourceCache:t,layer:s,coords:h,colorMode:b,elevationType:R,terrainEnabled:k,pass:C};if(u.renderPass!=="shadow")if(R!=="offset"){if(It(D,!1),R==="road"){const O=!k&&u.renderPass==="translucent";O&&Qc(u,t,s,h,"geometry"),It(D,!0,ai.disabled),O&&function(j){const{painter:V,sourceCache:q,layer:$,coords:Q,colorMode:re}=j,oe=V.context.gl,fe=j.painter.shadowRenderer,ue=!!fe&&fe.enabled,he=new Dt(V.context.gl.LEQUAL,Dt.ReadOnly,V.depthRangeFor3D);let ae=[0,0,0];if(ue){const _e=V.style.directionalLight,ge=V.style.ambientLight;_e&&ge&&(ae=mo(V.style,_e,ge))}for(const _e of Q){const ge=q.getTile(_e),Oe=ge.getBucket($);if(!Oe)continue;const Re=Oe.elevatedStructures;if(!Re||!Re.renderableSegments||Re.renderableSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const Je=Oe.bufferData.programConfigurations.get($.id),Xe=V.isTileAffectedByFog(_e),ft=[];ue&&ft.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Me=V.getOrCreateProgram("elevatedStructures",{config:Je,overrideFog:Xe,defines:ft}),Fe=V.translatePosMatrix(_e.projMatrix,ge,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));ue&&fe.setupShadows(ge.tileID.toUnwrapped(),Me,"vector-tile",ge.tileID.overscaledZ);const Ce=Tf(Fe,ae);V.uploadCommonUniforms(V.context,Me,_e.toUnwrapped()),Me.draw(V,oe.TRIANGLES,he,ai.disabled,re,li.backCCW,Ce,$.id,Re.vertexBuffer,Re.indexBuffer,Re.renderableSegments,$.paint,V.transform.zoom,Je,[Re.vertexBufferNormal])}}(D)}}else It(D,!1,u.stencilModeFor3D());else u.shadowRenderer&&R==="road"&&!k&&function(O){const{painter:j,sourceCache:V,layer:q,coords:$}=O,Q=j.context.gl,re=O.painter.shadowRenderer;for(const oe of $){const fe=V.getTile(oe),ue=fe.getBucket(q);if(!ue)continue;const he=ue.elevatedStructures;if(!he||!he.shadowCasterSegments||he.shadowCasterSegments.segments[0].primitiveLength===0)continue;j.prepareDrawTile();const ae=ue.bufferData.programConfigurations.get(q.id),_e=j.isTileAffectedByFog(oe),ge=j.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:_e}),Oe=re.calculateShadowPassMatrixFromTile(fe.tileID.toUnwrapped());j.uploadCommonUniforms(j.context,ge,oe.toUnwrapped());const Re={u_matrix:Oe,u_depth_bias:.001};ge.draw(j,Q.TRIANGLES,re.getShadowPassDepthMode(),ai.disabled,re.getShadowPassColorMode(),li.disabled,Re,q.id,he.vertexBuffer,he.indexBuffer,he.shadowCasterSegments,q.paint,j.transform.zoom,ae)}}(D)},"fill-extrusion":function(u,t,s,h){const p=s.paint.get("fill-extrusion-opacity"),_=u.context,v=_.gl,b=u.terrain,E=b&&b.renderingToTexture;if(p===0)return;const C=u.conflationActive&&u.style.isLayerClipped(s,t.getSource()),R=u.style.order.indexOf(s.fqid);if(C&&function(k,D,O,j,V){for(const q of j){const $=D.getTile(q).getBucket(O);$&&($.updateReplacement(q,k.replacementSource,V),$.uploadCentroid(k.context))}}(u,t,s,h,R),b||C)for(const k of h){const D=t.getTile(k).getBucket(s);D&&la(u.context,t,k,D,s,b,C)}if(u.renderPass==="shadow"&&u.shadowRenderer){const k=u.shadowRenderer;if(b&&p<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ab)return;const D=k.getShadowPassDepthMode(),O=k.getShadowPassColorMode();eu(u,t,s,h,D,ai.disabled,O,C)}else if(u.renderPass==="translucent"){const k=!s.paint.get("fill-extrusion-pattern").constantOr(1),D=s.paint.get("fill-extrusion-color").constantOr(n.am.white);if(!E&&D.a!==0){const O=new Dt(u.context.gl.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D);p===1&&k?eu(u,t,s,h,O,ai.disabled,Ci.unblended,C):(eu(u,t,s,h,O,ai.disabled,Ci.disabled,C),eu(u,t,s,h,O,u.stencilModeFor3D(),u.colorModeForRenderPass(),C),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&k&&(!b&&u.transform.projection.name!=="globe"||E)){const O=s.paint.get("fill-extrusion-opacity"),j=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),V=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=s.paint.get("fill-extrusion-flood-light-intensity"),$=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Q=s.paint.get("fill-extrusion-flood-light-color").toRenderColor($?null:s.lut).toArray01().slice(0,3),re=j>0&&V>0,oe=q>0,fe=(he,ae,_e)=>(1-_e)*he+_e*ae,ue=he=>{const ae=u.depthModeForSublayer(1,Dt.ReadOnly,v.LEQUAL,!0),_e=s.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=fe(.1,3,_e),Oe=u._showOverdrawInspector;if(!Oe){const Re=new ai({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Je=new Ci([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0],v.MIN);Ga(u,t,s,h,ae,Re,Je,li.disabled,he,"sdf",O,j,V,q,Q,ge,C,!1)}{const Re=Oe?ai.disabled:new ai({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Je=Oe?u.colorModeForRenderPass():new Ci([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],n.am.transparent,[!0,!0,!0,!0]);Ga(u,t,s,h,ae,Re,Je,li.disabled,he,"color",O,j,V,q,Q,ge,C,!1)}};if(E){const he=(ae,_e,ge)=>{const Oe=u.depthModeForSublayer(1,Dt.ReadOnly,v.LEQUAL,!1),Re=s.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=fe(.1,3,Re);{const Xe=new Ci([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0]);Ga(u,t,s,h,Oe,ai.disabled,Xe,li.disabled,ae,"clear",O,j,V,q,Q,Je,C,_e)}{const Xe=new ai({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),ft=new Ci([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0],v.MIN);Ga(u,t,s,h,Oe,Xe,ft,li.disabled,ae,"sdf",O,j,V,q,Q,Je,C,_e)}{const Xe=ae?v.ZERO:v.ONE_MINUS_DST_ALPHA,ft=new ai({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Me=new Ci([Xe,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],n.am.transparent,[!0,!0,!0,!0]);Ga(u,t,s,h,Oe,ft,Me,li.disabled,ae,"color",O,j,V,q,Q,Je,C,_e)}{const Xe=new Ci([v.ONE,v.ONE,v.ONE,ae?v.ZERO:v.ONE],n.am.transparent,[!1,!1,!1,!0],ae?v.FUNC_ADD:v.MAX);Ga(u,t,s,h,Oe,ai.disabled,Xe,li.disabled,ae,"clear",O,j,V,q,Q,Je,C,_e,ge)}};if(re||oe){let ae;if(u.prepareDrawTile(),b){const _e=b.drapeBufferSize[0],ge=b.drapeBufferSize[1];ae=b.framebufferCopyTexture,ae&&(!ae||ae.size[0]===_e&&ae.size[1]===ge)||(ae&&ae.destroy(),ae=b.framebufferCopyTexture=new n.T(_,new n.r({width:_e,height:ge}),v.RGBA8)),ae.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,_e,ge)}re&&he(!0,!1,ae),oe&&he(!1,!0,ae)}}else re&&ue(!0),oe&&ue(!1),(re||oe)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const p=u.context,_=u.terrain&&u.terrain.renderingToTexture,[v,b]=u.renderPass!=="translucent"||_?[{},h]:u.stencilConfigForOverlap(h);for(const E of b){const C=t.getTile(E);if(C.needsHillshadePrepare&&u.renderPass==="offscreen")cf(u,C,s);else if(u.renderPass==="translucent"){const R=u.depthModeForSublayer(0,Dt.ReadOnly),k=s.paint.get("hillshade-emissive-strength"),D=u.colorModeForDrapableLayerRenderPass(k),O=_&&u.terrain?u.terrain.stencilModeForRTTOverlap(E):v[E.overscaledZ];zm(u,E,C,s,R,O,D)}}p.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,s,h,p,_){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const v=u.transform.projection.name==="globe",b=s.paint.get("raster-elevation")!==0,E=b&&v;if(u.renderElevatedRasterBackface&&!E)return;const C=u.context,R=C.gl,k=t.getSource(),D=function(ue,he,ae,_e){const ge=he.paint.get("raster-color"),Oe=ue.type==="raster-array",Re=[],Je=he.paint.get("raster-resampling"),Xe=he.paint.get("raster-color-mix");let ft=he.paint.get("raster-color-range");const Me=[Xe[0],Xe[1],Xe[2],0],Fe=Xe[3];let Ce=Je==="nearest"?_e.NEAREST:_e.LINEAR;if(Oe&&(Re.push("RASTER_ARRAY"),ge||Re.push("RASTER_COLOR"),Je==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),Ce=_e.NEAREST,!ft&&ue.rasterLayers)){const tt=ue.rasterLayers.find(({id:Ve})=>Ve===he.sourceLayer);tt&&tt.fields&&tt.fields.range&&(ft=tt.fields.range)}if(ft=ft||[0,1],ge){Re.push("RASTER_COLOR"),ae.activeTexture.set(_e.TEXTURE2),he.updateColorRamp(ft);let tt=he.colorRampTexture;tt||(tt=he.colorRampTexture=new n.T(ae,he.colorRamp,_e.RGBA8)),tt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:Me,range:ft,offset:Fe,defines:Re,resampling:Ce}}(k,s,C,R);if(k instanceof n.aP&&!h.length&&!v)return;const O=s.paint.get("raster-emissive-strength"),j=u.colorModeForDrapableLayerRenderPass(O),V=u.terrain&&u.terrain.renderingToTexture,q=!u.options.moving,$=s.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(k instanceof n.aP&&!h.length&&(k.onNorthPole||k.onSouthPole)){const ue=b?u.stencilModeFor3D():ai.disabled;return void tu(!!k.onNorthPole,null,u,t,s,O,D,li.disabled,ue)}if(!h.length)return;const[Q,re]=k instanceof n.aP||V?[{},h]:u.stencilConfigForOverlap(h),oe=re[re.length-1].overscaledZ;E&&D.defines.push("PROJECTION_GLOBE_VIEW"),b&&D.defines.push("RENDER_CUTOFF");const fe=(ue,he,ae)=>{for(const _e of ue){const ge=_e.toUnwrapped(),Oe=t.getTile(_e);if(V&&(!Oe||!Oe.hasData()))continue;C.activeTexture.set(R.TEXTURE0);const Re=qy(Oe,k,s,D);if(!Re||!Re.texture)continue;const{texture:Je,mix:Xe,offset:ft,tileSize:Me,buffer:Fe}=Re;let Ce,tt;V?(Ce=Dt.disabled,tt=_e.projMatrix):b?(Ce=new Dt(R.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D),tt=v?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(ge,q)):(Ce=u.depthModeForSublayer(_e.overscaledZ-oe,s.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,R.LESS),tt=u.transform.calculateProjMatrix(ge,q));const Ve=u.terrain&&V?u.terrain.stencilModeForRTTOverlap(_e):Q[_e.overscaledZ],st=_?0:s.paint.get("raster-fade-duration");Oe.registerFadeDuration(st);const Qe=t.findLoadedParent(_e,0),ot=Wc(Oe,Qe,t,u.transform,st);let at,Rt;u.terrain&&u.terrain.prepareDrawTile(),C.activeTexture.set(R.TEXTURE0),Je.bind($,R.CLAMP_TO_EDGE),C.activeTexture.set(R.TEXTURE1),Qe?(Qe.texture&&Qe.texture.bind($,R.CLAMP_TO_EDGE),at=Math.pow(2,Qe.tileID.overscaledZ-Oe.tileID.overscaledZ),Rt=[Oe.tileID.canonical.x*at%1,Oe.tileID.canonical.y*at%1]):Je.bind($,R.CLAMP_TO_EDGE),"useMipmap"in Je&&C.extTextureFilterAnisotropic&&u.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Ut=u.transform;let Ct;const Vt=b?i_(Ut):[0,0,0,0];let Lt,ei,ui,Di,ur,sr=0;if(E&&k instanceof n.aP&&k.coordinates.length>3)Lt=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0)))),ei=Float32Array.from(Ut.globeMatrix),ui=Float32Array.from(n.dm(Ut)),Di=[n.ay(Ut.center.lng),n.aH(Ut.center.lat)],Ct=k.elevatedGlobePerspectiveTransform,ur=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(E){const gi=n.dn(_e.canonical);sr=n.dp(gi.getCenter().lat),Lt=Float32Array.from(n.bh(n.dr(_e.canonical))),ei=Float32Array.from(Ut.globeMatrix),ui=Float32Array.from(n.dm(Ut)),Di=[n.ay(Ut.center.lng),n.aH(Ut.center.lat)],Ct=[0,0],ur=Float32Array.from(n.dq(_e.canonical,gi,sr,Ut.worldSize/Ut._pixelsPerMercatorPixel))}else Ct=k instanceof n.aP?k.perspectiveTransform:[0,0],Lt=new Float32Array(16),ei=new Float32Array(9),ui=new Float32Array(16),Di=[0,0],ur=new Float32Array(9);const Li=aa(tt,Lt,ei,ui,ur,Rt||[0,0],n.ah(u.transform.zoom),Di,Vt,at||1,ot,s,Ct,b?s.paint.get("raster-elevation"):0,2,Xe,ft,D.range,Me,Fe,O),Xr=u.isTileAffectedByFog(_e),Ur=u.getOrCreateProgram("raster",{defines:D.defines,overrideFog:Xr});if(u.uploadCommonUniforms(C,Ur,ge),k instanceof n.aP){const gi=k.elevatedGlobeVertexBuffer,Vi=k.elevatedGlobeIndexBuffer;if(V||!v)k.boundsBuffer&&k.boundsSegments&&Ur.draw(u,R.TRIANGLES,Ce,ai.disabled,j,li.disabled,Li,s.id,k.boundsBuffer,u.quadTriangleIndexBuffer,k.boundsSegments);else if(gi&&Vi){const Zi=Ut.zoom<=n.cL?k.elevatedGlobeSegments:k.getSegmentsForLongitude(Ut.center.lng);Zi&&Ur.draw(u,R.TRIANGLES,Ce,ai.disabled,j,he,Li,s.id,gi,Vi,Zi)}}else if(E){Ce=new Dt(R.LEQUAL,Dt.ReadOnly,u.depthRangeFor3D);const gi=u.globeSharedBuffers;if(gi){const[Vi,Zi,hr]=gi.getGridBuffers(sr,!1);Ur.draw(u,R.TRIANGLES,Ce,ae||Ve,u.colorModeForRenderPass(),he,Li,s.id,Vi,Zi,hr)}}else{const{tileBoundsBuffer:gi,tileBoundsIndexBuffer:Vi,tileBoundsSegments:Zi}=u.getTileBoundsBuffers(Oe);Ur.draw(u,R.TRIANGLES,Ce,Ve,j,li.disabled,Li,s.id,gi,Vi,Zi)}}if(!(k instanceof n.aP)&&E)for(const _e of ue){const ge=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&tu(!0,_e,u,t,s,O,D,he,ae||ai.disabled),ge&&tu(!1,_e,u,t,s,O,D,he===li.frontCW?li.backCW:li.frontCW,ae||ai.disabled)}};E?fe(re,u.renderElevatedRasterBackface?li.backCW:li.frontCW,u.stencilModeFor3D()):fe(re,li.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,s,h,p,_){u.renderPass==="offscreen"&&function(v,b,E,C){if(!C.length)return;const R=v.context,k=R.gl,D=b.getSource();if(!(D instanceof Ia))return;const O=Math.ceil(Math.sqrt(E.paint.get("raster-particle-count")));let j=E.particlePositionRGBAImage;if(!j||j.width!==O){const re=function(oe){const fe=oe*oe,ue=new Uint8Array(4*fe),he=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},ae=1/1.1;for(let _e=0;_e<fe;_e++){const ge=ae*(he(2*_e+0)+ks),Oe=ae*(he(2*_e+1)+ks),Re=255*ge%1,Je=255*Oe%1,Xe=Re,ft=Oe-Je/255,Me=Je;ue[4*_e+0]=255*(ge-Re/255),ue[4*_e+1]=255*Xe,ue[4*_e+2]=255*ft,ue[4*_e+3]=255*Me}return ue}(O);j=E.particlePositionRGBAImage=new n.r({width:O,height:O},re)}let V=E.particleFramebuffer;V?V.width!==O&&(V.destroy(),V=E.particleFramebuffer=R.createFramebuffer(O,O,!0,null)):V=E.particleFramebuffer=R.createFramebuffer(O,O,!0,null);const q=[];for(const re of C){const oe=b.getTile(re);if(!(oe instanceof Dc))continue;const fe=Zy(oe,D,E);if(!fe)continue;const ue=[oe.tileSize,oe.tileSize];let he=E.tileFramebuffer;he||(he=E.tileFramebuffer=R.createFramebuffer(ue[0],ue[1],!0,null));let ae=oe.rasterParticleState;ae||(ae=oe.rasterParticleState=new Wy(R,re,ue,j));const _e=ae.update(E.lastInvalidatedAt);ae.particleTextureDimension!==O&&ae.updateParticleTexture(re,j);const ge=ae.targetColorTexture;ae.targetColorTexture=ae.backgroundColorTexture,ae.backgroundColorTexture=ge;const Oe=ae.particleTexture0;ae.particleTexture0=ae.particleTexture1,ae.particleTexture1=Oe,q.push([re,fe,ae,_e])}if(q.length===0)return;const $=n.q.now(),Q=E.previousDrawTimestamp?.001*($-E.previousDrawTimestamp):.0167;if(E.previousDrawTimestamp=$,E.hasColorMap()){R.activeTexture.set(k.TEXTURE0+2);let re=E.colorRampTexture;re||(re=E.colorRampTexture=new n.T(R,E.colorRamp,k.RGBA8)),re.bind(k.LINEAR,k.CLAMP_TO_EDGE)}R.bindFramebuffer.set(E.tileFramebuffer.framebuffer),function(re,oe,fe){const ue=re.context,he=ue.gl,ae=oe.tileFramebuffer;ue.activeTexture.set(he.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(Oe=oe.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},ge=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(const Re of fe){const[,,Je,Xe]=Re;ae.colorAttachment.set(Je.targetColorTexture.texture),ue.viewport.set([0,0,ae.width,ae.height]),ue.clear({color:n.am.transparent}),Xe&&(Je.backgroundColorTexture.bind(he.NEAREST,he.CLAMP_TO_EDGE),ge.draw(re,he.TRIANGLES,Dt.disabled,ai.disabled,Ci.alphaBlended,li.disabled,_e,oe.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(v,E,q),function(re,oe,fe,ue){const he=re.context,ae=he.gl,_e=fe.tileFramebuffer,ge=re.transform.projection.name==="globe",Oe=fe.paint.get("raster-particle-max-speed");for(const Re of ue){const[Je,Xe,ft]=Re;he.activeTexture.set(ae.TEXTURE0+0),Xe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),_e.colorAttachment.set(ft.targetColorTexture.texture);const Me=re.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});he.activeTexture.set(ae.TEXTURE0+1);const Fe=Xe.scalarData?[]:[0,1,2,3].map(Ve=>n.dU[Ve](Je));Fe.push(Je);const Ce=Je.canonical.x,tt=Je.canonical.y;for(const Ve of Fe){const st=oe.getTile(ge?Ve.wrapped():Ve);if(!st)continue;const Qe=st.rasterParticleState;if(!Qe)continue;const ot=Ve.canonical.x+(1<<Ve.canonical.z)*(Ve.wrap-Je.wrap),at=Ve.canonical.y;Qe.particleTexture0.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const Rt=Eh(1,Qe.particleTexture0.size[0],[ot-Ce,at-tt],0,Xe.texture.size,2,Oe,Xe.textureOffset,Xe.scale,Xe.offset);Me.draw(re,ae.POINTS,Dt.disabled,ai.disabled,Ci.alphaBlended,li.disabled,Rt,fe.id,Qe.particleIndexBuffer,void 0,Qe.particleSegment)}}}(v,b,E,q),R.bindFramebuffer.set(E.particleFramebuffer.framebuffer),function(re,oe,fe,ue){const he=re.context,ae=he.gl,_e=oe.paint.get("raster-particle-max-speed"),ge=ue*oe.paint.get("raster-particle-speed-factor")*.15,Oe=function(Je){return Math.pow(Je,6)}(.01+1*oe.paint.get("raster-particle-reset-rate-factor")),Re=oe.particleFramebuffer;he.viewport.set([0,0,Re.width,Re.height]);for(const Je of fe){const[,Xe,ft]=Je;he.activeTexture.set(ae.TEXTURE0+0),Xe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),he.activeTexture.set(ae.TEXTURE0+1);const Me=ft.particleTexture0;Me.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const Fe=Jm(1,Me.size[0],0,Xe.texture.size,_e,ge,Oe,Xe.textureOffset,Xe.scale,Xe.offset);Re.colorAttachment.set(ft.particleTexture1.texture),he.clear({color:n.am.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(re,ae.TRIANGLES,Dt.disabled,ai.disabled,Ci.unblended,li.disabled,Fe,oe.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(v,E,q,Q)}(u,t,s,h),u.renderPass==="translucent"&&(function(v,b,E,C,R){const k=v.context,D=k.gl,O=b.getSource().tileSize,j=5*(1-n.af(n.cx,n.cx+1,v.transform.zoom))*O+E.paint.get("raster-particle-elevation"),V=!v.options.moving,q=v.transform.projection.name==="globe";if(!C.length)return;const[$,Q]=v.stencilConfigForOverlap(C),re=[];q&&re.push("PROJECTION_GLOBE_VIEW");const oe=v.stencilModeFor3D();for(const fe of Q){const ue=fe.toUnwrapped(),he=b.getTile(fe);if(!he.rasterParticleState)continue;const ae=he.rasterParticleState,_e=100;he.registerFadeDuration(_e);const ge=b.findLoadedParent(fe,0),Oe=Wc(he,ge,b,v.transform,_e);let Re,Je;v.terrain&&v.terrain.prepareDrawTile(),k.activeTexture.set(D.TEXTURE0),ae.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),k.activeTexture.set(D.TEXTURE1),ge&&ge.rasterParticleState?(ge.rasterParticleState.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Re=Math.pow(2,ge.tileID.overscaledZ-he.tileID.overscaledZ),Je=[he.tileID.canonical.x*Re%1,he.tileID.canonical.y*Re%1]):ae.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Xe=q?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(ue,V),ft=v.transform,Me=Rf(ft),Fe=n.dn(fe.canonical),Ce=n.dp(Fe.getCenter().lat);let tt,Ve,st,Qe,ot;q?(tt=Float32Array.from(n.bh(n.dr(fe.canonical))),Ve=Float32Array.from(ft.globeMatrix),st=Float32Array.from(n.dm(ft)),Qe=[n.ay(ft.center.lng),n.aH(ft.center.lat)],ot=Float32Array.from(n.dq(fe.canonical,Fe,Ce,ft.worldSize/ft._pixelsPerMercatorPixel))):(tt=new Float32Array(16),Ve=new Float32Array(9),st=new Float32Array(16),Qe=[0,0],ot=new Float32Array(9));const at=Ef(Xe,tt,Ve,st,ot,Je||[0,0],n.ah(v.transform.zoom),Qe,Me,Re||1,Oe,j),Rt=v.isTileAffectedByFog(fe),Ut=v.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:Rt});if(v.uploadCommonUniforms(k,Ut,ue),q){const Ct=new Dt(D.LEQUAL,Dt.ReadOnly,v.depthRangeFor3D),Vt=0,Lt=v.globeSharedBuffers;if(Lt){const[ei,ui,Di]=Lt.getGridBuffers(Ce,Vt!==0);Ut.draw(v,D.TRIANGLES,Ct,oe,Ci.alphaBlended,v.renderElevatedRasterBackface?li.frontCCW:li.backCCW,at,E.id,ei,ui,Di)}}else{const Ct=v.depthModeForSublayer(0,Dt.ReadOnly),Vt=$[fe.overscaledZ],{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:ei,tileBoundsSegments:ui}=v.getTileBoundsBuffers(he);Ut.draw(v,D.TRIANGLES,Ct,Vt,Ci.alphaBlended,li.disabled,at,E.id,Lt,ei,ui)}}v.resetStencilClippingMasks()}(u,t,s,h),u.style.map.triggerRepaint())},background:function(u,t,s,h){const p=s.paint.get("background-color"),_=s.paint.get("background-color-use-theme").constantOr("default")==="none",v=s.paint.get("background-opacity"),b=s.paint.get("background-emissive-strength"),E=s.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const C=u.context,R=C.gl,k=u.transform,D=k.tileSize,O=s.paint.get("background-pattern");let j;if(O!==void 0&&(O===null||(j=u.imageManager.getPattern(n.I.from(O.toString()),s.scope,u.style.getLut(s.scope)),!j)))return;const V=!O&&p.a===1&&v===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==V)return;const q=ai.disabled,$=u.depthModeForSublayer(0,V==="opaque"?Dt.ReadWrite:Dt.ReadOnly),Q=u.colorModeForDrapableLayerRenderPass(b),re=O?"backgroundPattern":"background";let oe,fe=h;if(fe||(oe=u.getBackgroundTiles(),fe=Object.values(oe).map(ue=>ue.tileID)),O&&(C.activeTexture.set(R.TEXTURE0),u.imageManager.bind(u.context,s.scope)),E){const ue=u.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0}),he=new Float32Array(n.bx([])),ae=new n.aM(0,0,0,0,0),_e=O?Qm(he,b,v,u,0,s.scope,j,E,{tileID:ae,tileSize:D}):Ih(he,b,v,p.toRenderColor(_?null:s.lut));ue.draw(u,R.TRIANGLES,$,q,Q,li.disabled,_e,s.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const ue of fe){const he=u.isTileAffectedByFog(ue),ae=u.getOrCreateProgram(re,{overrideFog:he}),_e=ue.toUnwrapped(),ge=h?ue.projMatrix:u.transform.calculateProjMatrix(_e);u.prepareDrawTile();const Oe=t?t.getTile(ue):oe?oe[ue.key]:new ko(ue,D,k.zoom,u),Re=O?Qm(ge,b,v,u,0,s.scope,j,E,{tileID:ue,tileSize:D}):Ih(ge,b,v,p.toRenderColor(_?null:s.lut));u.uploadCommonUniforms(C,ae,_e);const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:Xe,tileBoundsSegments:ft}=u.getTileBoundsBuffers(Oe);ae.draw(u,R.TRIANGLES,$,q,Q,li.disabled,Re,s.id,Je,Xe,ft)}},sky:function(u,t,s){const h=u._atmosphere?n.ah(u.transform.zoom):1,p=s.paint.get("sky-opacity")*h;if(p===0)return;const _=u.context,v=s.paint.get("sky-type"),b=new Dt(_.gl.LEQUAL,Dt.ReadOnly,[0,1]),E=u.frameCounter/1e3%1;v==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(C,R,k,D){const O=C.context,j=O.gl;let V=R.skyboxFbo;if(!V){V=R.skyboxFbo=O.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new iu(O),R.skyboxTexture=O.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,R.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let re=0;re<6;++re)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}O.bindFramebuffer.set(V.framebuffer),O.viewport.set([0,0,32,32]);const q=R.getCenter(C,!0),$=C.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);n.bx(Q),n.e3(Q,Q,.5*-Math.PI),ha(C,R,$,Q,q,0),n.bx(Q),n.e3(Q,Q,.5*Math.PI),ha(C,R,$,Q,q,1),n.bx(Q),n.cG(Q,Q,.5*-Math.PI),ha(C,R,$,Q,q,2),n.bx(Q),n.cG(Q,Q,.5*Math.PI),ha(C,R,$,Q,q,3),n.bx(Q),ha(C,R,$,Q,q,4),n.bx(Q),n.e3(Q,Q,Math.PI),ha(C,R,$,Q,q,5),O.viewport.set([0,0,C.width,C.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(C,R,k,D,O){const j=C.context,V=j.gl,q=C.transform,$=C.getOrCreateProgram("skybox");j.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,R.skyboxTexture);const Q=((re,oe,fe,ue,he)=>({u_matrix:re,u_sun_direction:oe,u_cubemap:0,u_opacity:ue,u_temporal_offset:he}))(q.skyboxMatrix,R.getCenter(C,!1),0,D,O);C.uploadCommonUniforms(j,$),$.draw(C,V.TRIANGLES,k,ai.disabled,C.colorModeForRenderPass(),li.backCW,Q,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,s,b,p,E):v==="gradient"&&u.renderPass==="sky"&&function(C,R,k,D,O){const j=C.context,V=j.gl,q=C.transform,$=C.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new iu(j)),j.activeTexture.set(V.TEXTURE0);let Q=R.colorRampTexture;Q||(Q=R.colorRampTexture=new n.T(j,R.colorRamp,V.RGBA8)),Q.bind(V.LINEAR,V.CLAMP_TO_EDGE);const re=((oe,fe,ue,he,ae)=>({u_matrix:oe,u_color_ramp:0,u_center_direction:fe,u_radius:n.al(ue),u_opacity:he,u_temporal_offset:ae}))(q.skyboxMatrix,R.getCenter(C,!1),R.paint.get("sky-gradient-radius"),D,O);C.uploadCommonUniforms(j,$),$.draw(C,V.TRIANGLES,k,ai.disabled,C.colorModeForRenderPass(),li.backCW,re,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,s,b,p,E)},debug:function(u,t,s,h,p,_){for(let v=0;v<s.length;v++)if(p){const C=new n.am(h.r*.8,h.g*.8,h.b*.8,1);Ha(u,t,s[v],h,-1,-1,_),Ha(u,t,s[v],h,-1,1,_),Ha(u,t,s[v],h,1,1,_),Ha(u,t,s[v],h,1,-1,_),Ha(u,t,s[v],C,0,0,_)}else Ha(u,t,s[v],h,0,0,_)},custom:function(u,t,s,h){const p=u.context,_=s.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&s.isDraped(t)){if(u.renderPass==="offscreen"){const v=_.prerender;if(v){if(u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;v.call(_,p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ah(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else v.call(_,p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const b=_.renderToTile;if(b){const E=h[0].canonical,C={x:E.x+h[0].wrap*(_.wrapTileId?0:1<<E.z),y:E.y,z:E.z};p.setDepthMode(Dt.disabled),p.setStencilMode(ai.disabled),p.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),b.call(_,p.gl,C),p.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),p.setStencilMode(ai.disabled);const v=_.renderingMode==="3d"?new Dt(u.context.gl.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Dt.ReadOnly);if(p.setDepthMode(v),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;_.render(p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ah(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else _.render(p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState(),p.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,s,h){if(u.renderPass==="opaque")return;const p=s.paint.get("model-opacity").constantOr(1);if(p===0)return;const _=s.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!_||u.terrain&&p<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof n.ab))return;const v=u.shadowRenderer,b=s.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,b||(v.enabled=!1));const E=()=>{v&&(v.useNormalOffset=!0,b||(v.enabled=!0))},C=t.getSource();if(u.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function($,Q,re,oe,fe){const ue=$.transform;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ue.projection.name} projection is not yet implemented`);const he=ue.getFreeCameraOptions().position;if(!$.modelManager)return;const ae=$.modelManager;re.modelManager=ae;const _e=$.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ge=re._unevaluatedLayout._values["model-id"],Oe=Object.assign({},re.layout.get("model-id").parameters),Re=$.style.order.indexOf(re.fqid);for(const Je of oe){const Xe=Q.getTile(Je).getBucket(re);if(!Xe||Xe.projection.name!==ue.projection.name)continue;const ft=Xe.getModelUris();ft&&!Xe.modelsRequested&&(ae.addModelsFromBucket(ft,fe),Xe.modelsRequested=!0);const Me=Lh(Je,ue);Oe.zoom=Me;const Fe=ge.possiblyEvaluate(Oe);if(De($,Xe,Je),to.shadowUniformsInitialized=!1,to.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(Je.toUnwrapped())===0,$.renderPass==="shadow"&&_e){if($.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const Ve=ue.calculatePosMatrix(Je.toUnwrapped(),ue.worldSize);if(to.tileMatrix.set(Ve),to.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Ve)),to.aabb.min.fill(0),to.aabb.max[0]=to.aabb.max[1]=n.aj,to.aabb.max[2]=0,l_(Xe,to,$,re.scope))continue}const Ce=1<<Je.canonical.z,tt=[((he.x-Je.wrap)*Ce-Je.canonical.x)*n.aj,(he.y*Ce-Je.canonical.y)*n.aj,he.z*Ce*n.aj];$.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&$.style.isLayerClipped(re,Q.getSource())&&Xe.updateReplacement(Je,$.replacementSource,Re,fe)&&(Xe.uploaded=!1,Xe.upload($.context));for(let Ve in Xe.instancesPerModel){const st=Xe.instancesPerModel[Ve];st.features.length>0&&(Ve=Fe.evaluate(st.features[0].feature,{}));const Qe=ae.getModel(Ve,fe);if(Qe||ae.hasURLBeenRequested(Ve)||Xe.modelUris.includes(Ve)||(Xe.modelUris.push(Ve),Xe.modelsRequested=!1),Qe&&Qe.uploaded)for(const ot of Qe.nodes)zh($,re,ot,st,tt,Je,to)}}}(u,t,s,h,C.type==="vector"?s.scope:""),void E();if(!C.loaded())return;if(C.type==="batched-model")return function($,Q,re,oe){re.resetLayerRenderingStats($);const fe=$.context,ue=$.transform,he=$.style.fog,ae=$.shadowRenderer;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ue.projection.name} projection is not yet implemented`);const _e=$.transform.getFreeCameraOptions().position,ge=n.b$([],[_e.x,_e.y,_e.z],$.transform.worldSize),Oe=n.eb([],ge),Re=n.bx([]),Je=n.ec(ue.center.lat,ue.zoom),Xe=n.bn([],[1,1,1/Je]);n.bo(Re,Re,Oe);const ft=re.paint.get("model-opacity").constantOr(1),Me=new Dt(fe.gl.LEQUAL,Dt.ReadWrite,$.depthRangeFor3D),Fe=new Dt(fe.gl.LEQUAL,Dt.ReadOnly,$.depthRangeFor3D),Ce=new n.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),tt=$.renderPass==="shadow",Ve=tt&&ae?ae.getCurrentCascadeFrustum():ue.getFrustum(ue.scaleZoom(ue.worldSize)),st=re.paint.get("model-front-cutoff"),Qe=st[2]<1,ot=Oa($,re.paint.get("model-cutoff-fade-range")),at=re.getLayerRenderingStats();(function(Rt,Ut,Ct,Vt){const Lt=Rt.terrain?Rt.terrain.exaggeration():0,ei=Rt.transform.zoom;for(const ui of Vt){const Di=Ut.getTile(ui).getBucket(Ct);Di&&(Di.setFilter(Ct.filter),Rt.conflationActive&&Di.updateReplacement(ui,Rt.replacementSource),Di.evaluateScale(Rt,Ct),Rt.terrain&&Lt>0&&Di.elevationUpdate(Rt.terrain,Lt,ui,Ct.source),Di.needsReEvaluation(Rt,ei,Ct)&&Di.evaluate(Ct))}})($,Q,re,oe),function(){let Rt,Ut,Ct;Qe?(Rt=oe.length-1,Ut=-1,Ct=-1):(Rt=0,Ut=oe.length,Ct=1);const Vt=new Float64Array(16),Lt=n.eg(),ei=new n.P(0,0);for(let ui=Rt;ui!==Ut;ui+=Ct){const Di=oe[ui],ur=Q.getTile(Di).getBucket(re);if(!ur||!ur.uploaded)continue;let sr=!1;ae&&(sr=ae.getMaxCascadeForTile(Di.toUnwrapped())===0);const Li=ue.calculatePosMatrix(Di.toUnwrapped(),ue.worldSize),Xr=ur.modelTraits;!tt&&Qe&&(n.bi(Vt,Li),n.ad(Lt,ge,Vt),ei.x=Lt[0],ei.y=Lt[1]);const Ur=[];ur.setFilter(re.filter);for(const gi of ur.getNodesInfo()){if(gi.hiddenByReplacement||!gi.node.meshes)continue;const Vi=gi.node;let Zi=0;$.terrain&&Vi.elevation&&(Zi=Vi.elevation*$.terrain.exaggeration());const hr=(()=>{const Nr=gi.aabb;return Ce.min=[...Nr.min],Ce.max=[...Nr.max],Ce.min[2]+=Zi,Ce.max[2]+=Zi,n.ad(Ce.min,Ce.min,Li),n.ad(Ce.max,Ce.max,Li),Ce})(),un=gi.evaluatedScale;if(un[0]<=1&&un[1]<=1&&un[2]<=1&&hr.intersects(Ve)===0)continue;if(!tt&&Qe){const Nr=.16666666666666666;gi.cameraCollisionOpacity=ge[0]>hr.min[0]&&ge[0]<hr.max[0]&&ge[1]>hr.min[1]&&ge[1]<hr.max[1]&&ge[2]*Je<hr.max[2]&&Vi.footprint&&n.bS(ei,Vi.footprint)?Math.max(gi.cameraCollisionOpacity-Nr,0):Math.min(1,gi.cameraCollisionOpacity+Nr)}const Qr=[...Li],ln=Vi.anchor?Vi.anchor[0]:0,Br=Vi.anchor?Vi.anchor[1]:0;n.bo(Qr,Qr,[ln*(un[0]-1),Br*(un[1]-1),Zi]),n.ci(un,n.eh)||n.cE(Qr,Qr,un);const wi=n.az([],Qr,Vi.matrix),kr=n.az([],ue.expandedFarZProjMatrix,wi),Hi=n.az([],ue.expandedFarZProjMatrix,Qr),Lr=n.aA([],[ln,Br,Zi,1],kr)[2];Vi.hidden=!1;let Qi=ft;tt||(Qe&&(Qi*=gi.cameraCollisionOpacity,Qi*=Nl(Qr,ue,gi.aabb,st)),Qi*=c_(ot,Lr)),Qi!==0?Ur.push({nodeInfo:gi,depth:Lr,opacity:Qi,wvpForNode:kr,wvpForTile:Hi,nodeModelMatrix:wi,tileModelMatrix:Qr}):Vi.hidden=!0}tt||Ur.sort((gi,Vi)=>!Qe||gi.opacity===1&&Vi.opacity===1?gi.depth<Vi.depth?-1:1:gi.opacity===1?-1:Vi.opacity===1?1:gi.depth>Vi.depth?-1:1);for(const gi of Ur){const Vi=gi.nodeInfo,Zi=Vi.node;let hr=n.az([],Xe,gi.tileModelMatrix);n.az(hr,Re,hr);const un=n.bi([],hr);n.ee(un,un),n.cE(un,un,zf),hr=n.az(hr,hr,Zi.matrix);const Qr=$.renderPass==="light-beam",ln=re.paint.get("model-color-use-theme").constantOr("default")==="none",Br=Xr&n.em.HasMapboxMeshFeatures,wi=Br?0:Vi.evaluatedRMEA[0][2];for(let kr=0;kr<Zi.meshes.length;++kr){const Hi=Zi.meshes[kr],Lr=kr===Zi.lightMeshIndex;let Qi=gi.wvpForNode;if(Lr){if(!Qr&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}Qi=gi.wvpForTile}else if(Qr)continue;const Nr={defines:[]},Rn=[];if(!tt&&ae&&(ae.useNormalOffset=!!Hi.normalBuffer),pt(Nr.defines,Rn,Hi,$,ln?null:re.lut),Br||Nr.defines.push("DIFFUSE_SHADED"),sr&&Nr.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(tt?at.numRenderedVerticesInShadowPass+=Hi.vertexArray.length:at.numRenderedVerticesInTransparentPass+=Hi.vertexArray.length),tt){Jr(Hi,gi.nodeModelMatrix,$,re);continue}let Ar=null;if(he){const Ts=qa(gi.nodeModelMatrix,$.transform);if(Ar=new Float32Array(Ts),ue.projection.name!=="globe"){const Hs=Hi.aabb.min,vo=Hi.aabb.max,[xo,oo]=he.getOpacityForBounds(Ts,Hs[0],Hs[1],vo[0],vo[1]);Nr.overrideFog=xo>=Et||oo>=Et}}const zn=Hi.material;let on;zn.occlusionTexture&&zn.occlusionTexture.offsetScale&&(on=zn.occlusionTexture.offsetScale,Nr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Nn=$.getOrCreateProgram("model",Nr);!tt&&ae&&ae.setupShadowsFromMatrix(gi.tileModelMatrix,Nn,ae.useNormalOffset),$.uploadCommonUniforms(fe,Nn,null,Ar);const so=zn.pbrMetallicRoughness;so.metallicFactor=.9,so.roughnessFactor=.5;const Uo=ja(new Float32Array(Qi),new Float32Array(hr),new Float32Array(un),new Float32Array(Zi.matrix),$,gi.opacity,so.baseColorFactor.toRenderColor(null),zn.emissiveFactor,so.metallicFactor,so.roughnessFactor,zn,wi,re,[0,0,0],on);!Lr&&(Vi.hasTranslucentParts||gi.opacity<1)&&Nn.draw($,fe.gl.TRIANGLES,Me,ai.disabled,Ci.disabled,li.backCCW,Uo,re.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,re.paint,$.transform.zoom,void 0,Rn),Nn.draw($,fe.gl.TRIANGLES,Lr?Fe:Me,ai.disabled,Lr||gi.opacity<1||Vi.hasTranslucentParts?Ci.alphaBlended:Ci.unblended,li.backCCW,Uo,re.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,re.paint,$.transform.zoom,void 0,Rn)}}}}()}(u,t,s,h),void E();if(C.type!=="model")return;const R=C.getModels(),k=[],D=u.transform.getFreeCameraOptions().position,O=n.b$([],[D.x,D.y,D.z],u.transform.worldSize);n.eb(O,O);const j=[],V=[];let q=0;for(const $ of R){const Q=s.paint.get("model-rotation").constantOr(null),re=s.paint.get("model-scale").constantOr(null),oe=s.paint.get("model-translation").constantOr(null);$.computeModelMatrix(u,Q,re,oe,!0,!0,!1);const fe=n.bx([]),ue=n.ec($.position.lat,u.transform.zoom),he=n.bn([],[1,1,1/ue]);n.bo(fe,fe,O),k.push({zScaleMatrix:he,negCameraPosMatrix:fe});for(const ae of $.nodes)Wa(u.transform,ae,$.matrix,u.transform.expandedFarZProjMatrix,q,j,V);q++}if(j.sort(($,Q)=>Q.depth-$.depth),u.renderPass!=="shadow"){if(p===1)for(const $ of V)At($,u,s,k[$.modelIndex],ai.disabled,u.colorModeForRenderPass());else{for(const $ of V)At($,u,s,k[$.modelIndex],ai.disabled,Ci.disabled);for(const $ of V)At($,u,s,k[$.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const $ of j)At($,u,s,k[$.modelIndex],ai.disabled,u.colorModeForRenderPass());E()}else{for(const $ of V)Jr($.mesh,$.nodeModelMatrix,u,s);for(const $ of j)Jr($.mesh,$.nodeModelMatrix,u,s);E()}}},Nf={line:function(u,t,s){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const p of h){const _=t.getTile(p).getBucket(u);if(_&&(_.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?u.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const p=h.getModels();for(const _ of p)_.upload(s.context)},raster:function(u,t,s){const h=t.getSource();if(!(h instanceof Ia&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-array-band")||h.getInitialBand(p);if(_==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(p,_)&&h.prepareTile(b,p,_)},"raster-particle":function(u,t,s){const h=t.getSource();if(!(h instanceof Ia&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-particle-array-band")||h.getInitialBand(p);if(_==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(p,_)&&h.prepareTile(b,p,_)}},Fo={fill:Qc};class Bh{constructor(t,s,h,p,_){this.context=new Ll(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const E of v)this._debugParams.enabledLayers[E]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const E of v)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.occlusionParams=new u_(_),this.setup(),this.numSublayers=is.maxUnderzooming+is.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Iy(this),this._wireframeDebugCache=new Yy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const b=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,b,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bh(this,t));const p=this._terrain;this.transform.elevation=h?p:null,p.update(t,this.transform,s),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,p]=s.getFovAdjustedRange(this.transform._fov);if(h>p)return void(this.transform.fogCullDistSq=null);const _=h+.78*(p-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new bh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*n.q.devicePixelRatio,this.height=s*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new n.ba;s.emplaceBack(0,0),s.emplaceBack(n.aj,0),s.emplaceBack(0,n.aj),s.emplaceBack(n.aj,n.aj),this.tileExtentBuffer=t.createVertexBuffer(s,n.bc.members),this.tileExtentSegments=n.bd.simpleSegment(0,0,4,2);const h=new n.ba;h.emplaceBack(0,0),h.emplaceBack(n.aj,0),h.emplaceBack(0,n.aj),h.emplaceBack(n.aj,n.aj),this.debugBuffer=t.createVertexBuffer(h,n.bc.members),this.debugSegments=n.bd.simpleSegment(0,0,4,5);const p=new n.ba;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,n.bc.members),this.viewportSegments=n.bd.simpleSegment(0,0,4,2);const _=new n.aZ;_.emplaceBack(0,0,0,0),_.emplaceBack(n.aj,0,n.aj,0),_.emplaceBack(0,n.aj,0,n.aj),_.emplaceBack(n.aj,n.aj,n.aj,n.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(_,n.bf.members),this.mercatorBoundsSegments=n.bd.simpleSegment(0,0,4,2);const v=new n.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const b=new n.bb;for(const C of[0,1,3,2,0])b.emplaceBack(C);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bz();const E=this.context.gl;this.stencilClearMode=new ai({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Dt.disabled,this.stencilClearMode,Ci.disabled,li.disabled,ms(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const E of h)if(this._tileClippingMaskIDs[E.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=s.id;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Ci.disabled),p.setDepthMode(Dt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of h){const E=s.getTile(b),C=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:k,tileBoundsSegments:D}=this.getTileBoundsBuffers(E);v.draw(this,_.TRIANGLES,Dt.disabled,new ai({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),Ci.disabled,li.disabled,ms(b.projMatrix),"$clipping",R,k,D)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new ai({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new ai({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+p]=new ai({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[v,h]}return[{[p]:ai.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ci([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ci.unblended:Ci.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ci([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new n.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,p=!1){if(this.depthOcclusion)return new Dt(this.context.gl.GREATER,Dt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Dt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(h||this.context.gl.LEQUAL,s,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new Ph(this.context,s,h,!1,"texture"),this.depthTexture=new n.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=n.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const p=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(_).filter(Me=>{const Fe=p[Me];return!(Fe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Fe.type]});let b=v(),E=!1,C=!1;for(const Me of b){const Fe=p[Me];Fe.type==="circle"&&(E=!0),Fe.type==="symbol"&&(Fe.hasInitialOcclusionOpacityProperties?C=!0:E=!0)}let R=b.map(Me=>p[Me]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let D=0,O=!1;for(const Me in k){const Fe=k[Me];Fe.used&&(Fe.prepare(this.context),Fe.getSource().usedInConflation&&++D)}let j=!1;for(const Me of R)Me.isHidden(this.transform.zoom)||(Me.type==="clip"&&(j=!0),this.prepareLayer(Me));const V={},q={},$={},Q={},re={};for(const Me in k){const Fe=k[Me];V[Me]=Fe.getVisibleCoordinates(),q[Me]=V[Me].slice().reverse(),$[Me]=Fe.getVisibleCoordinates(!0).reverse(),Q[Me]=Fe.getShadowCasterCoordinates(),re[Me]=Fe.sortCoordinatesByDistance(V[Me])}const oe=Me=>{const Fe=this.style.getLayerSourceCache(Me);return Fe&&Fe.used?Fe.getSource():null};if(D||j||this._clippingActiveLastFrame){const Me=[],Fe=[];let Ce=0;for(const tt of R)this.isSourceForClippingOrConflation(tt,oe(tt))&&(Me.push(tt),Fe.push(Ce)),Ce++;if(Me&&(j||Me.length>1)||this._clippingActiveLastFrame){j=!1;const tt=[];for(let Ve=0;Ve<Me.length;Ve++){const st=Me[Ve],Qe=Fe[Ve],ot=this.style.getLayerSourceCache(st);if(!ot||!ot.used||!ot.getSource().usedInConflation&&st.type!=="clip")continue;let at=n.ev,Rt=n.bQ.None;const Ut=[];let Ct=!0;if(st.type==="clip"){at=Qe;for(const Vt of st.layout.get("clip-layer-types"))Rt|=Vt==="model"?n.bQ.Model:Vt==="symbol"?n.bQ.Symbol:n.bQ.FillExtrusion;for(const Vt of st.layout.get("clip-layer-scope"))Ut.push(Vt);st.isHidden(this.transform.zoom)?Ct=!1:j=!0}Ct&&tt.push({layer:st.fqid,cache:ot,order:at,clipMask:Rt,clipScope:Ut})}this.replacementSource.setSources(tt),O=!0}}this._clippingActiveLastFrame=j,O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Me=0;Me<R.length;Me++){const Fe=R[Me],Ce=Fe.cutoffRange();if(this.longestCutoffRange=Math.max(Ce,this.longestCutoffRange),Ce>0){const tt=oe(Fe);tt&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom)),Fe.minzoom&&(this.minCutoffZoom=Math.max(Fe.minzoom,this.minCutoffZoom))}Fe.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Me),this._lastOcclusionLayer=Me)}const fe=this.style&&this.style.fog;fe?(this._fogVisible=fe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=fe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding($),this.opaquePassCutoff=0,b=v(),R=b.map(Me=>p[Me]));const ue=this._shadowRenderer;if(ue){ue.updateShadowParameters(this.transform,this.style.directionalLight);for(const Me in k)for(const Fe of V[Me]){let Ce={min:0,max:0};this.terrain&&(Ce=this.terrain.getMinMaxForTile(Fe)||Ce),ue.addShadowReceiver(Fe.toUnwrapped(),Ce.min,Ce.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Bl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(he&&!this._snow&&(this._snow=new Fr(this)),!he&&this._snow&&(this._snow.destroy(),delete this._snow),ae&&!this._rain&&(this._rain=new Jy(this)),!ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!yr.has(this.context.gl))return;this.renderPass="offscreen";for(const Me of R){const Fe=t.getLayerSourceCache(Me);if(!Me.hasOffscreenPass()||Me.isHidden(this.transform.zoom))continue;const Ce=Fe?q[Fe.id]:void 0;(Me.type==="custom"||Me.type==="raster"||Me.type==="raster-particle"||Me.isSky()||Ce&&Ce.length)&&this.renderLayer(this,Fe,Me,Ce)}this.depthRangeFor3D=[0,1-(R.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(s.showOverdrawInspector)return n.am.black;const Me=this.style.fog;if(Me&&this.transform.projection.supportsFog){const Fe=this.style.getLut(Me.scope);if(!_e){const Ce=Me.properties.get("color-use-theme")==="none",tt=Me.properties.get("color").toRenderColor(Ce?null:Fe).toArray01();return new n.am(...tt)}if(_e){const Ce=Me.properties.get("space-color-use-theme")==="none",tt=Me.properties.get("space-color").toRenderColor(Ce?null:Fe).toArray01();return new n.am(...tt)}}return n.am.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const Me=R[this.currentLayer],Fe=t.getLayerSourceCache(Me);if(Me.isSky())continue;const Ce=Fe?(Me.is3D(_)?re:q)[Fe.id]:void 0;this._renderTileClippingMasks(Me,Fe,Ce),this.renderLayer(this,Fe,Me,Ce)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const Me=R[this.currentLayer],Fe=t.getLayerSourceCache(Me);Me.isSky()&&this.renderLayer(this,Fe,Me,Fe?q[Fe.id]:void 0)}function Oe(Me,Fe){let Ce;return Fe&&(Ce=(Me.type==="symbol"?$:Me.is3D(_)?re:q)[Fe.id]),Ce}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){const Me=R[this.currentLayer];if(Me.type==="raster"||Me.type==="raster-particle"){const Fe=t.getLayerSourceCache(Me);this.renderLayer(this,Fe,Me,Oe(Me,Fe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Re=0;ue&&(Re=ue.getShadowCastingLayerCount());let Je=!1,Xe=-1;for(let Me=0;Me<b.length;++Me){const Fe=R[Me];Fe.isHidden(this.transform.zoom)||Fe.is3D(_)&&(Xe=Me)}C&&Xe===-1&&(E=!0);let ft=!1;for(;this.currentLayer<b.length;){const Me=R[this.currentLayer],Fe=t.getLayerSourceCache(Me);if(Me.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Me)){if(Me.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ft&&Me.is3D(_)&&!_){const Ce=this.currentLayer,tt=Ve=>{for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const st=R[this.currentLayer];if(Fo[st.type]){const Qe=this.style.getLayerSourceCache(st);Fo[st.type](this,Qe,st,Oe(st,Qe),Ve)}}};tt("initialize"),tt("reset"),this.currentLayer=Ce,ft=!0}if(E&&!Je&&this.terrain&&!this.transform.isOrthographic&&(Je=!0,this.blitDepth()),C&&Xe!==-1&&this.currentLayer===Xe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Me,Fe,Fe?V[Fe.id]:void 0),this.renderLayer(this,Fe,Me,Oe(Me,Fe)),!this.terrain&&ue&&Re>0&&Me.hasShadowPass()&&--Re==0&&(ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ce=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ce;this.currentLayer++){const tt=R[this.currentLayer];if(!tt.hasLightBeamPass())continue;const Ve=t.getLayerSourceCache(tt);this.renderLayer(this,Ve,tt,Ve?q[Ve.id]:void 0)}this.currentLayer=Ce,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ce=this.currentLayer;this.depthOcclusion=!0;for(const tt of this.layersWithOcclusionOpacity){this.currentLayer=tt;const Ve=R[this.currentLayer],st=t.getLayerSourceCache(Ve),Qe=st?q[st.id]:void 0;this.terrain||this._renderTileClippingMasks(Ve,st,st?V[st.id]:void 0),this.renderLayer(this,st,Ve,Qe)}this.depthOcclusion=!1,this.currentLayer=Ce,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Me=null;R.forEach(Fe=>{const Ce=t.getLayerSourceCache(Fe);Ce&&!Fe.isHidden(this.transform.zoom)&&Ce.getVisibleCoordinates().length&&(!Me||Me.getSource().maxzoom<Ce.getSource().maxzoom)&&(Me=Ce)}),Me&&this.options.showTileBoundaries&&Ki.debug(this,Me,Me.getVisibleCoordinates(),n.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ki.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Me){const Fe=Me.transform.padding;Dh(Me,Me.transform.height-(Fe.top||0),3,Df),Dh(Me,Fe.bottom||0,3,kf),kh(Me,Fe.left||0,3,Lf),kh(Me,Me.transform.width-(Fe.right||0),3,ws);const Ce=Me.transform.centerPoint;(function(tt,Ve,st,Qe){Fl(tt,Ve-1,st-10,2,20,Qe),Fl(tt,Ve-10,st-1,20,2,Qe)})(Me,Ce.x,Me.transform.height-Ce.y,ua)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if(Nf[t.type]&&(h||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);Nf[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,s,h,p){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||p&&p.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Ki[h.type](t,s,h,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),p.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const p=t[h],_=this.context.extTimerQuery,v=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),s[h]=v}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const p of t)h+=s.getQueryParameter(p,s.QUERY_RESULT)/1e6,s.deleteQuery(p);return h}translatePosMatrix(t,s,h,p,_){if(!h[0]&&!h[1])return t;const v=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){const C=Math.sin(v),R=Math.cos(v);h=[h[0]*R-h[1]*C,h[0]*C+h[1]*R]}const b=[_?h[0]:n.aw(s,h[0],this.transform.zoom),_?h[1]:n.aw(s,h[1],this.transform.zoom),0],E=new Float32Array(16);return n.bo(E,t,b),E}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const p=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||s!==void 0&&!s||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],p=s&&s.config,_=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),v=Th.cacheKey(Ba[t],t,_,p);return this.cache[v]||(this.cache[v]=new Th(this.context,t,Ba[t],p,$y[t],_)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,p=this.style.ambientLight;if(h&&p){const _=((v,b,E)=>{const C=v.properties.get("direction"),R=v.properties.get("color-use-theme")==="none",k=v.properties.get("color").toRenderColor(R?null:E.getLut(v.scope)).toArray01(),D=v.properties.get("intensity"),O=b.properties.get("color-use-theme")==="none",j=b.properties.get("color").toRenderColor(O?null:E.getLut(b.scope)).toArray01(),V=b.properties.get("intensity"),q=[C.x,C.y,C.z],$=n.dw(j,V),Q=n.dw(k,D);return{u_lighting_ambient_color:$,u_lighting_directional_dir:q,u_lighting_directional_color:Q,u_ground_radiance:bf(q,Q,$)}})(h,p,this.style);s.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,s,h,p,_){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),E=((C,R,k,D,O,j,V,q,$,Q,re,oe)=>{const fe=C.transform,ue=R.properties.get("color-use-theme")==="none",he=R.properties.get("color").toRenderColor(ue?null:C.style.getLut(R.scope)).toArray01();he[3]=D;const ae=C.frameCounter/1e3%1,[_e,ge]=R.properties.get("vertical-range");return{u_fog_matrix:k?fe.calculateFogTileMatrix(k):oe||C.identityMat,u_fog_range:R.getFovAdjustedRange(fe._fov),u_fog_color:he,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,ge),ge],u_fog_temporal_offset:ae,u_frustum_tl:O,u_frustum_tr:j,u_frustum_br:V,u_frustum_bl:q,u_globe_pos:$,u_globe_radius:Q,u_viewport:re,u_globe_transition:n.ah(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,v,h,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],p);s.setFogUniformValues(t,E)}_&&s.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const p of h)s[p.key]=t[p.key]||new ko(p,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=Et||s[1]>=Et}setupDepthForOcclusion(t,s,h){const p=this.context,_=p.gl,v=!!h;var b;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((b=this.depthRangeFor3D)[1]-b[0]),-1-2*b[0]/(b[1]-b[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),v||s.setTerrainUniformValues(p,h)}}function Xa(u,t){let s=!1,h=null;const p=()=>{h=null,s&&(u(),h=setTimeout(p,t),s=!1)};return()=>(s=!0,h||p(),h)}class Ul{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xa(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Nh(t);if(this._hashName){const h=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(v=>{const b=v.split("=")[0];return b===h?(p=!0,`${b}=${s}`):v}).filter(v=>v);return p||_.push(`${h}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(Number(h)))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Nh(u,t){const s=u.getCenter(),h=Math.round(100*u.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),v=Math.round(s.lng*_)/_,b=Math.round(s.lat*_)/_,E=u.getBearing(),C=u.getPitch();let R=t?`/${v}/${b}/${h}`:`${h}/${b}/${v}`;return(E||C)&&(R+="/"+Math.round(10*E)/10),C&&(R+=`/${Math.round(C)}`),R}const Vl={linearity:.3,easing:n.ew(0,0,.3,1)},Uf=n.l({deceleration:2500,maxSpeed:1400},Vl),Vf=n.l({deceleration:20,maxSpeed:1400},Vl),_o=n.l({deceleration:1e3,maxSpeed:360},Vl),Bo=n.l({deceleration:1e3,maxSpeed:90},Vl);class Uh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=n.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const _=jl(s.pan.mag(),h,n.l({},Uf,t||{}));p.offset=s.pan.mult(_.amount/s.pan.mag()),p.center=this._map.transform.center,Ka(p,_)}if(s.zoom){const _=jl(s.zoom,h,Vf);p.zoom=this._map.transform.zoom+_.amount,Ka(p,_)}if(s.bearing){const _=jl(s.bearing,h,_o);p.bearing=this._map.transform.bearing+n.aD(_.amount,-179,179),Ka(p,_)}if(s.pitch){const _=jl(s.pitch,h,Bo);p.pitch=this._map.transform.pitch+_.amount,Ka(p,_)}if(p.zoom||p.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Ka(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function jl(u,t,s){const{maxSpeed:h,linearity:p,deceleration:_}=s,v=n.aD(u*p/(t/1e3),-h,h),b=Math.abs(v)/(_*p);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class _s extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,p={}){const _=hi(s.getCanvasContainer(),h),v=s.unproject(_);super(t,n.l({point:_,lngLat:v,originalEvent:h},p)),this._defaultPrevented=!1,this.target=s}}class go extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const p=t==="touchend"?h.changedTouches:h.touches,_=Wt(s.getCanvasContainer(),p),v=_.map(E=>s.unproject(E)),b=_.reduce((E,C,R,k)=>E.add(C.div(k.length)),new n.P(0,0));super(t,{points:_,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:h}),this._defaultPrevented=!1}}class jf extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class fa{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new jf(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new _s(t.type,this._map,t))}mouseup(t){this._map.fire(new _s(t.type,this._map,t))}preclick(t){const s=n.l({},t);s.type="preclick",this._map.fire(new _s(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new _s(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new _s(t.type,this._map,t))}mouseover(t){this._map.fire(new _s(t.type,this._map,t))}mouseout(t){this._map.fire(new _s(t.type,this._map,t))}touchstart(t){return this._firePreventable(new go(t.type,this._map,t))}touchmove(t){this._map.fire(new go(t.type,this._map,t))}touchend(t){this._map.fire(new go(t.type,this._map,t))}touchcancel(t){this._map.fire(new go(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $f{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new _s(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new _s(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ke(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(h)||!this._box&&h.dist(p)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=pe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(p.x,h.x),b=Math.max(p.x,h.x),E=Math.min(p.y,h.y),C=Math.max(p.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${E}px)`,this._box.style.width=b-v+"px",this._box.style.height=C-E+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,p=s;if(h&&t.button===0){if(this.reset(),kt(),h.x!==p.x||h.y!==p.y)return this._map.fire(new n.A("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ke(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new n.A(t,{originalEvent:s}))}}function su(u,t){const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=t[h];return s}class Gf{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new n.P(0,0);for(const v of p)_._add(v);return _.div(p.length)}(s),this.touches=su(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const p=su(h,s);for(const _ in this.touches){const v=p[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Mn{constructor(t){this.singleTap=new Gf(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const p=this.singleTap.touchend(t,s,h);if(p){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Hf{constructor(){this._zoomIn=new Mn({numTouches:1,numTaps:2}),this._zoomOut=new Mn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const p=this._zoomIn.touchend(t,s,h),_=this._zoomOut.touchend(t,s,h);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qf={0:1,2:2},pa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ou{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=Zt(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(p,_){const v=qf[_];return p.buttons===void 0||(p.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&Zt(t)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wf extends ou{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class jh extends ou{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?pa[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Ya extends ou{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?pa[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Zf{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),n.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!n.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const p=su(h,s),_=new n.P(0,0),v=new n.P(0,0);let b=0;for(const C in p){const R=p[C],k=this._touches[C];k&&(_._add(R),v._add(R.sub(k)),b++,p[C]=R)}if(this._touches=p,b<this._minTouches||!v.mag())return;const E=v.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class au{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,v]=p,b=$l(h,s,_),E=$l(h,s,v);if(!b||!E)return;const C=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],C,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,v=$l(h,s,p),b=$l(h,s,_);v&&b||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $l(u,t,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return t[h]}function lu(u,t){return Math.log(u/t)/Math.LN2}class Xf extends au{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lu(this._distance,h),pinchAround:s}}}function $h(u,t){return 180*u.angleWith(t)/Math.PI}class d_ extends au{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$h(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const p=$h(t,h);return Math.abs(p)<s}}function Gh(u){return Math.abs(u.y)>Math.abs(u.x)}class f_ extends au{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Gh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),v=t[1].sub(p[1]);return this._map._cooperativeGestures&&!n.ex()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,v,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=s.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return Gh(t)&&Gh(s)&&v}}const p_={panStep:100,bearingStep:15,pitchStep:10};class m_{constructor(){const t=p_;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,p=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:b=>{const E=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:__,zoom:s?Math.round(E)+s*(t.shiftKey?2:1):E,bearing:b.getBearing()+h*this._bearingStep,pitch:b.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function __(u){return u*(2-u)}const Kf=4.000244140625,g_=1/450;class y_{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=g_,n.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=n.q.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Kf==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=hi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Kf?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&R!==0&&(R=1/R);const k=s(),D=Math.pow(2,k),O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*R))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),p=this._startZoom,_=this._easing;let v,b=!1;if(this._type==="wheel"&&p&&_){const C=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),R=_(C);v=n.ai(p,h,R),C<1?this._frameId||(this._frameId=!0):b=!0}else v=h,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let E=v-s();return E*this._lastDelta<0&&(E=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:E,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=n.ey;if(this._prevEase){const h=this._prevEase,p=(n.q.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=n.ew(v,b,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class v_{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class x_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class b_{constructor(){this._tap=new Mn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=s[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class w_{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qy{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ev{constructor(t,s,h,p){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $r=u=>u.zoom||u.drag||u.pitch||u.rotate;class T_ extends n.A{}class tv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=n.at([],s,t);this.radius=n.ae(h[2]<0?n.eA([],h,this.constants):[h[0],h[1],0])}projectRay(t){n.eA(t,t,this.constants),n.au(t,t),n.eB(t,t,this.constants);const s=n.b$([],t,this.radius);if(s[2]>0){const h=n.b$([],[0,0,1],n.bE(s,[0,0,1])),p=n.b$([],n.au([],[s[0],s[1],0]),this.radius),_=n.cU([],s,n.b$([],n.at([],n.cU([],p,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Gl(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class iv{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uh(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new tv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),n.aV(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,v]of this._listeners){const b=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,b,v)}}destroy(){for(const[t,s,h]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,p,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new fa(s,t));const p=s.boxZoom=new Vh(s,t);this._add("boxZoom",p);const _=new Hf,v=new x_;s.doubleClickZoom=new v_(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const b=new b_;this._add("tapDragZoom",b);const E=s.touchPitch=new f_(s);this._add("touchPitch",E);const C=new jh(t),R=new Ya(t);s.dragRotate=new Qy(t,C,R),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const k=new Wf(t),D=new Zf(s,t);s.dragPan=new w_(h,k,D),this._add("mousePan",k),this._add("touchPan",D,["touchZoom","touchRotate"]);const O=new d_,j=new Xf;s.touchZoomRotate=new ev(h,j,O,b),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $f(s));const V=s.scrollZoom=new y_(s,this);this._add("scrollZoom",V,["mousePan"]);const q=s.keyboard=new m_;this._add("keyboard",q);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[$]&&s[$].enable(t[$])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$r(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const p in t)if(p!==h&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",p=h?void 0:t,_={needsRenderFrame:!1},v={},b={},E=t.touches?this._getMapTouches(t.touches):void 0,C=E?Wt(this._el,E):h?void 0:hi(this._el,t);for(const{handlerName:D,handler:O,allowed:j}of this._handlers){if(!O.isEnabled())continue;let V;this._blockedByActive(b,j,D)?O.reset():O[s||t.type]&&(V=O[s||t.type](t,C,E),this.mergeHandlerResult(_,v,V,D,p),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||O.isActive())&&(b[D]=O)}const R={};for(const D in this._previousActiveHandlers)b[D]||(R[D]=p);this._previousActiveHandlers=b,(Object.keys(R).length||Gl(_))&&(this._changes.push([_,v,R]),this._triggerRenderFrame()),(Object.keys(b).length||Gl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=_;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,s,h,p,_){if(!h)return;n.l(t,h);const v={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=v),h.panDelta!==void 0&&(s.drag=v),h.pitchDelta!==void 0&&(s.pitch=v),h.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},h={};for(const[p,_,v]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),n.l(s,_),n.l(h,v);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const p=this._map,_=p.transform,v=Q=>[Q.x,Q.y,Q.z];if((Q=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Gl(t)){const Q=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),Q!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!Gl(t))return void this._fireEvents(s,h,!0);let{panDelta:b,zoomDelta:E,bearingDelta:C,pitchDelta:R,around:k,aroundCoord:D,pinchAround:O}=t;_._isCameraConstrained&&(E>0&&(E=0),_._isCameraConstrained=!1),O!==void 0&&(k=O),(E||(Q=>s[Q]&&!this._eventsInProgress[Q])("drag"))&&k&&(this._dragOrigin=v(_.pointCoordinate3D(k)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),k=k||p.transform.centerPoint,C&&(_.bearing+=C),R&&(_.pitch+=R),_._updateCameraState();const j=[0,0,0];if(b)if(_.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k).dir),re=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k.sub(b)).dir);j[0]=re[0]-Q[0],j[1]=re[1]-Q[1]}else{const Q=_.pointCoordinate(k);if(_.projection.name==="globe"){b=b.rotate(-_.angle);const re=_._pixelsPerMercatorPixel/_.worldSize;j[0]=-b.x*n.ez(n.aY(Q.y))*re,j[1]=-b.y*n.ez(_.center.lat)*re}else{const re=_.pointCoordinate(k.sub(b));Q&&re&&(j[0]=re.x-Q.x,j[1]=re.y-Q.y)}}const V=_.zoom,q=[0,0,0];if(E){const Q=v(D||_.pointCoordinate3D(k)),re={dir:n.au([],n.at([],Q,_._camera.position))};if(re.dir[2]<0){const oe=_.zoomDeltaToMovement(Q,E);n.b$(q,re.dir,oe)}}const $=n.cU(j,j,q);_._translateCameraConstrained($),E&&Math.abs(_.zoom-V)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const p=$r(this._eventsInProgress),_=$r(t),v={};for(const R in t){const{originalEvent:k}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=k),this._eventsInProgress[R]=t[R]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:k}=t[R];this._fireEvent(R,k)}const b={};let E;for(const R in this._eventsInProgress){const{handlerName:k,originalEvent:D}=this._eventsInProgress[R];this._handlersById[k].isActive()||(delete this._eventsInProgress[R],E=s[k]||D,b[`${R}end`]=E)}for(const R in b)this._fireEvent(R,b[R]);const C=$r(this._eventsInProgress);if(h&&(p||_)&&!C){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;R?(k(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:E})):(this._map.fire(new n.A("moveend",{originalEvent:E})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new n.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new T_("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class S_ extends n.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,n.aV(["_renderFrameCallback"],this)}getCenter(){return new n.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},s),h)}panTo(t,s,h){return this.easeTo(n.l({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(n.l({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(n.l({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,n.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=n.aG.convert(t);const h=s&&s.bearing||0,p=s&&s.pitch||0,_=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,_,v,h,p,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?n.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},s,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],p=s.max[1]-s.min[1];return h/p>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,p,_,v){const b=t.clone(),E=this._extendCameraOptions(v);b.bearing=p,b.pitch=_;const C=n.cd.convert(s),R=n.cd.convert(h),k=.5*(C.lat+R.lat),D=.5*(C.lng+R.lng),O=n.eC(k,D),j=n.au([],O),V=n.au([],n.bG([],j,[0,1,0])),q=n.bG([],V,j),$=[V[0],V[1],V[2],0,q[0],q[1],q[2],0,j[0],j[1],j[2],0,0,0,0,1],Q=[O,n.eC(C.lat,C.lng),n.eC(R.lat,C.lng),n.eC(R.lat,R.lng),n.eC(C.lat,R.lng),n.eC(k,C.lng),n.eC(k,R.lng),n.eC(C.lat,D),n.eC(R.lat,D)];let re=n.cV.fromPoints(Q.map(Ve=>[n.bE(V,Ve),n.bE(q,Ve),n.bE(j,Ve)]));const oe=n.ad([],re.center,$);n.eD(oe)===0&&n.eE(oe,0,0,1),n.au(oe,oe),n.b$(oe,oe,n.aE),b.center=n.eF(oe);const fe=b.getWorldToCameraMatrix(),ue=n.bi(new Float64Array(16),fe);re=n.cV.applyTransform(re,n.az([],fe,$));const he=this._extendAABB(re,b,E,p);if(!he)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=he,n.ad(oe,oe,fe);const ae=.5*(re.max[2]-re.min[2]),_e=this._minimumAABBFrustumDistance(b,re),ge=n.b$([],[0,0,1],ae),Oe=n.cU(ge,oe,ge),Re=_e+(b.pitch===0?0:n.bD(oe,Oe)),Je=b.globeCenterInViewSpace,Xe=n.at([],oe,[Je[0],Je[1],Je[2]]);n.au(Xe,Xe),n.b$(Xe,Xe,Re);const ft=n.cU([],oe,Xe);n.ad(ft,ft,ue);const Me=n.eq/n.aE,Fe=n.ae(ft),Ce=n.c6(Math.max(Fe*Me-n.eq,Number.EPSILON),0),tt=Math.min(b.zoomFromMercatorZAdjusted(Ce),E.maxZoom);return tt>.5*(n.cL+n.cx)?(b.setProjection({name:"mercator"}),b.zoom=tt,this._cameraForBounds(b,s,h,p,_,v)):{center:b.center,zoom:tt,bearing:p,pitch:_}}_extendAABB(t,s,h,p){const _=.5*((h.padding.left||0)+(h.padding.right||0)),v=.5*((h.padding.top||0)+(h.padding.bottom||0)),b=v,E=_,C=_,R=v,k=s.width-(E+C),D=s.height-(b+R),O=n.at([],t.max,t.min),j=Math.min(k/O[0],D/O[1]),V=Math.min(s.scaleZoom(s.scale*j),h.maxZoom);if(isNaN(V))return null;const q=s.scale/s.zoomScale(V),$=new n.cV([t.min[0]-E*q,t.min[1]-R*q,t.min[2]],[t.max[0]+C*q,t.max[1]+b*q,t.max[2]]),Q=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new n.P(h.offset.x,h.offset.y):n.P.convert(h.offset)).rotate(-n.al(p));return $.center[0]-=Q.x*q,$.center[1]+=Q.y*q,$}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=n.l({},{exaggerated:!0},s),h.getAtPoint(n.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,p,_,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,p,_,v);const b=t.clone(),E=this._extendCameraOptions(v);b.bearing=p,b.pitch=_;const C=n.cd.convert(s),R=n.cd.convert(h),k=new n.cd(C.lng,R.lat),D=new n.cd(R.lng,C.lat),O=b.project(C),j=b.project(R),V=this.queryTerrainElevation(C),q=this.queryTerrainElevation(R),$=this.queryTerrainElevation(k),Q=this.queryTerrainElevation(D),re=[[O.x,O.y,Math.min(V||0,q||0,$||0,Q||0)],[j.x,j.y,Math.max(V||0,q||0,$||0,Q||0)]];let oe=n.cV.fromPoints(re);const fe=b.getWorldToCameraMatrix(),ue=n.bi(new Float64Array(16),fe);oe=n.cV.applyTransform(oe,fe);const he=this._extendAABB(oe,b,E,p);if(!he)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=he;const ae=.5*n.at([],oe.max,oe.min)[2],_e=this._minimumAABBFrustumDistance(b,oe),ge=[0,0,1,0];n.aA(ge,ge,fe),n.eG(ge,ge);const Oe=n.b$([],ge,_e+ae),Re=n.cU([],oe.center,Oe);n.ad(oe.center,oe.center,ue),n.ad(Re,Re,ue);const Je=b.unproject(new n.P(oe.center[0],oe.center[1])),Xe=n.eH(b.projection,Je),ft=Math.pow(2,Xe),Me=Math.min(b._zoomFromMercatorZ(Re[2]*b.pixelsPerMeter*ft/b.worldSize),E.maxZoom);return b.mercatorFromTransition&&Me<.5*(n.cL+n.cx)?(b.setProjection({name:"globe"}),b.zoom=Me,this._cameraForBounds(b,s,h,p,_,v)):{center:Je,zoom:Me,bearing:p,pitch:_}}fitBounds(t,s,h){const p=this.cameraForBounds(t,s);return this._fitInternal(p,s,h)}fitScreenCoordinates(t,s,h,p,_){const v=n.P.convert(t),b=n.P.convert(s),E=new n.P(Math.min(v.x,b.x),Math.min(v.y,b.y)),C=new n.P(Math.max(v.x,b.x),Math.max(v.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,b))return this;const R=this.transform.pointLocation3D(E),k=this.transform.pointLocation3D(C),D=this.transform.pointLocation3D(new n.P(E.x,C.y)),O=this.transform.pointLocation3D(new n.P(C.x,E.y)),j=[Math.min(R.lng,k.lng,D.lng,O.lng),Math.min(R.lat,k.lat,D.lat,O.lat)],V=[Math.max(R.lng,k.lng,D.lng,O.lng),Math.max(R.lat,k.lat,D.lat,O.lat)],q=p&&p.pitch?p.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,j,V,h,q,p);return this._fitInternal($,p,_)}_fitInternal(t,s,h){return t?(s=n.l(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,v=!1;"zoom"in t&&h.zoom!==+t.zoom&&(p=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=n.cd.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(_=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(v=!0,h.pitch=+t.pitch);const b=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(b))if(t.retainPadding===!1){const E=h.clone();E.padding=b,h.setLocationAtPoint(h.center,E.centerPoint)}else h.padding=b;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new n.A("movestart",s)).fire(new n.A("move",s)),p&&this.fire(new n.A("zoomstart",s)).fire(new n.A("zoom",s)).fire(new n.A("zoomend",s)),_&&this.fire(new n.A("rotatestart",s)).fire(new n.A("rotate",s)).fire(new n.A("rotateend",s)),v&&this.fire(new n.A("pitchstart",s)).fire(new n.A("pitch",s)).fire(new n.A("pitchend",s)),this.fire(new n.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Hl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return n.w(Hl),this;this.stop();const p=h.zoom,_=h.pitch,v=h.bearing;h.setFreeCameraOptions(t);const b=p!==h.zoom,E=_!==h.pitch,C=v!==h.bearing;return this.fire(new n.A("movestart",s)).fire(new n.A("move",s)),b&&this.fire(new n.A("zoomstart",s)).fire(new n.A("zoom",s)).fire(new n.A("zoomend",s)),C&&this.fire(new n.A("rotatestart",s)).fire(new n.A("rotate",s)).fire(new n.A("rotateend",s)),E&&this.fire(new n.A("pitchstart",s)).fire(new n.A("pitch",s)).fire(new n.A("pitchend",s)),this.fire(new n.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in t?+t.zoom:p,C="bearing"in t?this._normalizeBearing(t.bearing,_):_,R="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),D=n.P.convert(t.offset);let O,j,V;if(h.projection.name==="globe"){const ge=n.ac.fromLngLat(h.center),Oe=D.rotate(-h.angle);ge.x+=Oe.x/h.worldSize,ge.y+=Oe.y/h.worldSize;const Re=ge.toLngLat(),Je=n.cd.convert(t.center||Re);this._normalizeCenter(Je),O=h.centerPoint.add(Oe),j=new n.P(ge.x,ge.y).mult(h.worldSize),V=new n.P(n.ay(Je.lng),n.aH(Je.lat)).mult(h.worldSize).sub(j)}else{O=h.centerPoint.add(D);const ge=h.pointLocation(O),Oe=n.cd.convert(t.center||ge);this._normalizeCenter(Oe),j=h.project(ge),V=h.project(Oe).sub(j)}const q=h.zoomScale(E-p);let $,Q;t.around&&($=n.cd.convert(t.around),Q=h.locationPoint($));const re=this._zooming||E!==p,oe=this._rotating||_!==C,fe=this._pitching||R!==v,ue=!h.isPaddingEqual(k),he=t.retainPadding===!1?h.clone():h,ae=ge=>Oe=>{if(re&&(ge.zoom=n.ai(p,E,Oe)),oe&&(ge.bearing=n.ai(_,C,Oe)),fe&&(ge.pitch=n.ai(v,R,Oe)),ue&&(he.interpolatePadding(b,k,Oe),O=he.centerPoint.add(D)),$)ge.setLocationAtPoint($,Q);else{const Re=ge.zoomScale(ge.zoom-p),Je=E>p?Math.min(2,q):Math.max(.5,q),Xe=Math.pow(Je,1-Oe),ft=ge.unproject(j.add(V.mult(Oe*Xe)).mult(Re));ge.setLocationAtPoint(ge.renderWorldCopies?ft.wrap():ft,O)}return t.preloadOnly||this._fireMoveEvents(s),ge};if(t.preloadOnly){const ge=this._emulate(ae,t.duration,h);return this._preloadTiles(ge),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=oe,this._pitching=fe,this._padding=ue,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,_e),this._ease(ae(h),ge=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,ge)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new n.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new n.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new n.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new n.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.A("move",t)),this._zooming&&this.fire(new n.A("zoom",t)),this._rotating&&this.fire(new n.A("rotate",t)),this._pitching&&this.fire(new n.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new n.A("zoomend",t)),p&&this.fire(new n.A("rotateend",t)),_&&this.fire(new n.A("pitchend",t)),this.fire(new n.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ve=n.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ve,s)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.ey},t);const h=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in t?n.aD(+t.zoom,h.minZoom,h.maxZoom):p,C="bearing"in t?this._normalizeBearing(t.bearing,_):_,R="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),D=h.zoomScale(E-p),O=n.P.convert(t.offset);let j=h.centerPoint.add(O);const V=h.pointLocation(j),q=n.cd.convert(t.center||V);this._normalizeCenter(q);const $=h.project(V),Q=h.project(q).sub($);let re=t.curve;const oe=Math.max(h.width,h.height),fe=oe/D,ue=Q.mag();if("minZoom"in t){const Ve=n.aD(Math.min(t.minZoom,p,E),h.minZoom,h.maxZoom),st=oe/h.zoomScale(Ve-p);re=Math.sqrt(st/ue*2)}const he=re*re;function ae(Ve){const st=(fe*fe-oe*oe+(Ve?-1:1)*he*he*ue*ue)/(2*(Ve?fe:oe)*he*ue);return Math.log(Math.sqrt(st*st+1)-st)}function _e(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function ge(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Oe=ae(0);let Re=function(Ve){return ge(Oe)/ge(Oe+re*Ve)},Je=function(Ve){return oe*((ge(Oe)*(_e(st=Oe+re*Ve)/ge(st))-_e(Oe))/he)/ue;var st},Xe=(ae(1)-Oe)/re;if(Math.abs(ue)<1e-6||!isFinite(Xe)){if(Math.abs(oe-fe)<1e-6)return this.easeTo(t,s);const Ve=fe<oe?-1:1;Xe=Math.abs(Math.log(fe/oe))/re,Je=function(){return 0},Re=function(st){return Math.exp(Ve*re*st)}}t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ft=_!==C,Me=R!==v,Fe=!h.isPaddingEqual(k),Ce=t.retainPadding===!1?h.clone():h,tt=Ve=>st=>{const Qe=st*Xe,ot=1/Re(Qe);Ve.zoom=st===1?E:p+Ve.scaleZoom(ot),ft&&(Ve.bearing=n.ai(_,C,st)),Me&&(Ve.pitch=n.ai(v,R,st)),Fe&&(Ce.interpolatePadding(b,k,st),j=Ce.centerPoint.add(O));const at=st===1?q:Ve.unproject($.add(Q.mult(Je(Qe))).mult(ot));return Ve.setLocationAtPoint(Ve.renderWorldCopies?at.wrap():at,j),Ve._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ve};if(t.preloadOnly){const Ve=this._emulate(tt,t.duration,h);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=ft,this._pitching=Me,this._padding=Fe,this._prepareEase(s,!1),this._ease(tt(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=n.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=n.bX(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const p=Math.ceil(15*s/1e3),_=[],v=t(h.clone());for(let b=0;b<=p;b++){const E=v(b/p);_.push(E.clone())}return _}_preloadTiles(t,s){}}class Hh{constructor(t={}){this.options=t,n.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=pe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const p=pe("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",h),this._innerContainer=pe("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const h=s.reduce((p,_,v)=>(_.value&&(p+=`${_.key}=${_.value}${v<s.length-1?"&":""}`),p),"?");t.href=`${n.e.FEEDBACK_URL}/${h}#${Nh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style._mergedSourceCaches;for(const p in s){const _=s[p];if(_.used){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((p,_)=>p.length-_.length),t=t.filter((p,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cu{constructor(){n.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=pe("div","mapboxgl-ctrl");const s=pe("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class yo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const p of h)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class qh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=n.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const an={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class io extends n.A{constructor(t,s,h,p){const{point:_,lngLat:v,originalEvent:b,target:E}=t;super(t.type,{point:_,lngLat:v,originalEvent:b,target:E}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=p}}class uu{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let p=s.type;h&&this.filters.set(t,n.b3(h)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const _=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):_.size===0&&this.map.on(p,this.handleType),_.size===0&&this.interactionsByType.set(p,_),_.set(t,s),this.typeById.set(t,p)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[p,_]of s)_.target&&h.push({targetId:p,target:_.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[p,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||h.set(_.id,_);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!s;s=s||this.queryTargets(t.point,h);const _=t.type==="mouseenter";let v=!1;const b=new Set;for(const E of s){for(const[C,R]of h){if(!R.target)continue;const k=E.variants?E.variants[C]:null;if(k){for(const D of k){if(Pc(D,E,b,C))continue;const O=new n.df(E,D),j=Zu(D,E,C);p&&(O.state=this.map.getFeatureState(O));const V=_?this.prevHoveredFeatures.get(j):null,q=new io(t,C,R,O),$=V?V.stop:R.handler(q);if(_&&this.hoveredFeatures.set(j,{feature:E,stop:$}),$!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[E,C]of h){const{handler:R,target:k}=C;if(!k&&R(new io(t,E,C,null))!==!1)break}}}function Wh(u,t){if(Array.isArray(u)&&Array.isArray(t)){const s=new Set(u),h=new Set(t);return s.size===h.size&&u.every(p=>h.has(p))}return n.bv(u,t)}const E_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},rv={showCompass:!0,showZoom:!0,visualizePitch:!1};class hu{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new jh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Ya({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ke()}move(t,s){const h=this.map,p=this.mouseRotate.mousemoveWindow(t,s),_=p&&p.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,s),b=v&&v.pitchDelta;b&&h.setPitch(h.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ke(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),hi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,hi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Wt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Wt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function A_(u,t,s){if(u=new n.cd(u.lng,u.lat),t){const h=new n.cd(u.lng-360,u.lat),p=new n.cd(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),v=s.locationPoint3D(u).distSqr(t),b=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<v&&(b||Math.abs(h.lng-s.center.lng)<_)?u=h:s.locationPoint3D(p).distSqr(t)<v&&(b||Math.abs(p.lng-s.center.lng)<_)&&(u=p)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint3D(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const Yf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Gs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class du extends n.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=n.l({element:t},s)),n.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:p="#3FB1CE",scale:_=1,draggable:v=!1,clickTolerance:b=0,rotation:E=Gs.rotation,rotationAlignment:C=Gs.rotationAlignment,pitchAlignment:R=Gs.pitchAlignment,occludedOpacity:k=Gs.occludedOpacity,altitude:D=Gs.altitude}=t||{};this._anchor=h,this._color=p,this._scale=_,this._draggable=v,this._clickTolerance=b,this._rotation=E,this._rotationAlignment=C,this._pitchAlignment=R,this._occludedOpacity=k,this._altitude=D,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});const O=this._element.classList;for(const V in Yf)O.remove(`mapboxgl-marker-anchor-${V}`);O.add(`mapboxgl-marker-anchor-${this._anchor}`);const j=t&&t.className?t.className.trim().split(/\s+/):[];O.add(...j),this._popup=null}_createDefaultMarker(){const t=pe("div"),s=qe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=qe("radialGradient",{id:"shadowGradient"},qe("defs",{},s));qe("stop",{offset:"10%","stop-opacity":.4},h),qe("stop",{offset:"100%","stop-opacity":.05},h),qe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return qe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),qe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),qe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Gs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(h)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let p;t._showingGlobe()&&n.eK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Yf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const E=s.getPitch();return E?`rotateX(${E}deg)`:""}const p=n.cJ(n.eL(s.transform,this._lngLat)),_=t.sub(n.eM(s.transform)),v=Math.abs(_.x)+Math.abs(_.y);if(v===0)return"";const b=p/v;return`rotateX(${-_.y*b}deg) rotateY(${_.x*b}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const p=this.getRotationAlignment();if(p==="map")if(s._showingGlobe()){const _=s.project(new n.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=s.project(new n.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);h=n.cJ(Math.atan2(v.y,v.x))-90}else h=-s.getBearing();else if(p==="horizon"){const _=n.af(4,6,s.getZoom()),v=n.eM(s.transform);v.y+=_*s.transform.height;const b=t.sub(v),E=n.cJ(Math.atan2(b.y,b.x));h=(E>90?E-270:E+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=A_(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,p=this._positionDelta;if(h&&p){if(!this._isDragging){const _=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.A("dragstart"))),this.fire(new n.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Gs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Gs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Gs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Gs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const fu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ql={maxWidth:100,unit:"metric"},No={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},no=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ma(u=new n.P(0,0),t="bottom"){if(typeof u=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new n.P(0,u);case"top-left":return new n.P(s,s);case"top-right":return new n.P(-s,s);case"bottom":return new n.P(0,-u);case"bottom-left":return new n.P(s,-s);case"bottom-right":return new n.P(-s,-s);case"left":return new n.P(u,0);case"right":return new n.P(-u,0)}return new n.P(0,0)}return u instanceof n.P||Array.isArray(u)?n.P.convert(u):n.P.convert(u[t]||[0,0])}return{version:F,supported:Te.supported,setRTLTextPlugin:n.eN,getRTLTextPluginStatus:n.eO,Map:class extends S_{constructor(u){N.mark(W.create);const t=u;if((u=n.l({},E_,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.eI(window)&&(u.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new za(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new yo,this._domRenderTaskQueue=new yo,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.a$(),this._locale=n.l({},an,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new vi(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const s=document.getElementById(u.container);if(!s)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=s}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,n.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Of),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new iv(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||n.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new Rm(this),u.hash&&(this._hash=new Ul(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const s=u.bounds;s&&(this.resize(),this.fitBounds(s,n.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Hh({customAttribution:u.customAttribution})),this._logoControl=new cu,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new n.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new n.A(`${s.dataType}dataloading`,s))}),this._interactions=new uu(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.A("movestart",u)).fire(new n.A("move",u)),this.fire(new n.A("resize",u)),t&&this.fire(new n.A("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.aG.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let s;t==="globe"&&u.zoom>=n.cx?(u.setMercatorFromTransition(),s=!0):t==="mercator"&&u.zoom<n.cx&&(u.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=n.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(n.cd.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(n.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,s){const h=p=>{let _=[];if(Array.isArray(t)){const v=t.filter(b=>this.getLayer(b));_=v.length?this.queryRenderedFeatures(p,{layers:v}):[]}else _=this.queryRenderedFeatures(p,{target:t});return _};if(u==="mouseenter"||u==="mouseover"){let p=!1;return{listener:s,targets:t,delegates:{mousemove:v=>{const b=h(v.point);b.length?p||(p=!0,s.call(this,new _s(u,this,v.originalEvent,{features:b}))):p=!1},mouseout:()=>{p=!1}}}}if(u==="mouseleave"||u==="mouseout"){let p=!1;return{listener:s,targets:t,delegates:{mousemove:b=>{h(b.point).length?p=!0:p&&(p=!1,s.call(this,new _s(u,this,b.originalEvent)))},mouseout:b=>{p&&(p=!1,s.call(this,new _s(u,this,b.originalEvent)))}}}}{const p=_=>{const v=h(_.point);v.length&&(_.features=v,s.call(this,_),delete _.features)};return{listener:s,targets:t,delegates:{[u]:p}}}}on(u,t,s){if(typeof t=="function"||s===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(u,t,s){if(typeof t=="function"||s===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(u,t,s){if(typeof t=="function"||s===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[u]:void 0;return h&&(p=>{for(let _=0;_<p.length;_++){const v=p[_];if(v.listener===s&&Wh(v.targets,t)){for(const b in v.delegates)this.off(b,v.delegates[b]);return p.splice(_,1),this}}})(h),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof n.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(u,void 0,this.transform),v=this.style.queryRenderedFeatureset(u,void 0,this.transform);return _.concat(v)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let p=[];return h&&(p=p.concat(this.style.queryRenderedFeatures(u,t,this.transform))),s&&(p=p.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),p}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(s,h)=>{if(s){const p=typeof s=="string"?s:s instanceof Error?s.message:s.error;n.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else h&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const s=n.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new Vs(this,s).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new n.z(new Error("IDs can't be empty."))),!1):!n.d9(u)||(this.fire(new n.z(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:s=1,sdf:h=!1,stretchX:p,stretchY:_,content:v}={}){this._lazyInitEmptyStyle();const b=n.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:E,height:C,data:R}=n.q.getImageData(t);this.style.addImage(b,{data:new n.r({width:E,height:C},R),pixelRatio:s,stretchX:p,stretchY:_,content:v,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:C}=t,R=t;this.style.addImage(b,{data:new n.r({width:E,height:C},new Uint8Array(R.data)),pixelRatio:s,stretchX:p,stretchY:_,content:v,sdf:h,usvg:!1,version:0,userImage:R}),R.onAdd&&R.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const s=n.I.from(u),h=this.style.getImage(s);if(!h)return void this.fire(new n.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:_,height:v,data:b}=p;if(_===void 0||v===void 0)return void this.fire(new n.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||v!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new n.z(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const E=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let C=!1;h.usvg?(h.data=new n.r({width:_,height:v},new Uint8Array(b)),h.usvg=!1,h.icon=void 0,C=!0):h.data.replace(b,E),this.style.updateImage(s,h,C)}hasImage(u){return u?!!this.style&&!!this.style.getImage(n.I.from(u)):(this.fire(new n.z(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(n.I.from(u))}loadImage(u,t){n.o(this._requestManager.transformRequest(u,n.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?n.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new n.z(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(s=>this.fire(new n.z(new Error("Failed to add import",s)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,s){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,s),this._update(!0)):this}setFilter(u,t,s={}){return this._isValidId(u)?(this.style.setFilter(u,t,s),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,s,h),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,s,h),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,s){return this.style.setConfigProperty(u,t,s),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.cd.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,p,_=this._container;for(;_&&(!h||!p);){const v=window.getComputedStyle(_).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(p=s[3])),_=_.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=pe("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=pe("div","mapboxgl-canvas-container",u);this._canvas=pe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=pe("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{h[p]=pe("div",`mapboxgl-ctrl-${p}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=n.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=n.l({},Te.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Sr(t,!0),this.painter=new Bh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.z(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.A("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.A("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new n.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=n.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,R=this.transform.pitch,k=n.q.now(),D=new n.aa(C,{now:k,fadeDuration:_,pitch:R,transition:this.style.transition});this.style.update(D)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(h);const b=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),b&&(this._placementDirty=b.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(W.load),this.fire(new n.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const C=n.q.now()-h;p.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const R=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new n.A("gpu-timing-frame",{cpuTime:C,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(C);this.fire(new n.A("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(C);this.fire(new n.A("gpu-timing-deferred-render",{gpuTime:R}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const C=this.idle();if(C&&(v=this._updateAverageElevation(h,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new n.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new n.A("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,N.mark(W.fullLoad),this._performanceMetricsCollection&&fi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const s=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=u;const v=Math.abs(p-_);if(v>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(_),s(_);this._averageElevation.easeTo(_,u,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),s(_)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){Ei(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===di||u.status===401)){const t=this.painter.context.gl;Sr(t,!1),this._logoControl instanceof cu&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ys(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&tr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function p(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(p(u),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(u,t,s){let h=s[1]-s[0];const p=u.length/4;for(let _=0;_<t.length;_++){const v=t[_];let b=0;for(let E=0;E<v.length;E+=4)v[E]===u[E]&&v[E+1]===u[E+1]&&v[E+2]===u[E+2]&&v[E+3]===u[E+3]&&(b+=1);h+=(s[_+2]-s[_+1])*(1-b/p)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),yr.delete(this.painter.context.gl),$t.remove(),Rs.remove(),this._removed=!0,this.fire(new n.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return n.bt(t,(s,h)=>s._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){n.eJ(u,t)}get version(){return F}},NavigationControl:class{constructor(u={}){this.options=n.l({},rv,u),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),pe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),pe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=pe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),s=t===u.getMaxZoom(),h=t===u.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hu(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const s=pe("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends n.E{constructor(u={}){super();const t=navigator.geolocation;this.options=n.l({geolocation:t},fu,u),n.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,u(s)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.A("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("geolocate",u)),this._finish()}}_updateCamera(u){const t=new n.cd(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),p=n.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),p,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new n.cd(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=n.c6(1,u._center.lat)*u.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=pe("button","mapboxgl-ctrl-geolocate",this._container),pe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pe("div","mapboxgl-user-location"),this._dotElement.appendChild(pe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(pe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new du({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=pe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new du({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.A("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hh,ScaleControl:class{constructor(u={}){this.options=n.l({},ql,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-u/2,p=t.unproject([h,s]),_=t.unproject([h+u,s]),v=p.distanceTo(_);if(this.options.unit==="imperial"){const b=3.2808*v;b>5280?this._setScale(u,b/5280,"mile"):this._setScale(u,b,"foot")}else this.options.unit==="nautical"?this._setScale(u,v/1852,"nautical-mile"):v>=1e3?this._setScale(u,v/1e3,"kilometer"):this._setScale(u,v,"meter")}_setScale(u,t,s){this._map._requestDomTask(()=>{const h=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const C=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*C)/C}(b),v*b}(t),p=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${No[s]}`,this._container.style.width=u*p+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:n.w("Full screen control 'container' must be a DOM element.")),n.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=pe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);pe("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(u){super(),this.options=n.l(Object.create(ro),u),this._altitude=this.options.altitude,n.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.A("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.cd.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=pe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const s=this._closeButton=pe("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const p=s.offsetWidth,_=s.offsetHeight,v=h.x<p/2,b=h.x>t.transform.width-p/2;if(h.y+u<_)return v?"top-left":b?"top-right":"top";if(h.y>t.transform.height-_){if(v)return"bottom-left";if(b)return"bottom-right"}return v?"left":b?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=pe("div","mapboxgl-popup",t.getContainer()),this._tip=pe("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=A_(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const p=this._pos=this._trackPointer&&u instanceof n.P?u:t.project(this._lngLat,this._altitude),_=ma(this.options.offset),v=this._anchor=this._getAnchor(_.y),b=ma(this.options.offset,v),E=p.add(b).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Yf[v]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=n.eK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(no);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:du,Style:Vs,LngLat:n.cd,LngLatBounds:n.aG,Point:n.P,MercatorCoordinate:n.ac,FreeCameraOptions:sh,Evented:n.E,config:n.e,prewarm:n.eP,clearPrewarmedResources:n.eQ,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(u){n.e.ACCESS_TOKEN=u},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(u){n.e.API_URL=u},get workerCount(){return n.eR.workerCount},set workerCount(u){n.eR.workerCount=u},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.eS(u)},get workerUrl(){return n.eT.workerUrl},set workerUrl(u){n.eT.workerUrl=u},get workerClass(){return n.eT.workerClass},set workerClass(u){n.eT.workerClass=u},get workerParams(){return n.eT.workerParams},set workerParams(u){n.eT.workerParams=u},get dracoUrl(){return n.eU()},set dracoUrl(u){n.eV(u)},get meshoptUrl(){return n.eW()},set meshoptUrl(u){n.eX(u)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var M=T;return M})}(jg)),jg.exports}var nN=rN();const sN=wI(nN),oN=Yo(()=>{const a=jd();sN.accessToken=a.public.mapboxToken}),aN=[iO,aO,PF,ZB,XB,KB,YB,QB,eN,tN,oN],HI=(a="RouteProvider")=>Sc({name:a,props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(c){const m=c.renderKey,y=c.route,T={};for(const S in c.route)Object.defineProperty(T,S,{get:()=>m===c.renderKey?c.route[S]:y[S],enumerable:!0});return Bu(xm,cl(T)),()=>Ps(c.vnode,{ref:c.vnodeRef})}}),lN=HI(),n2=new WeakMap,cN=Sc({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(a,{attrs:c,slots:m,expose:y}){const T=qn(),S=Aa(),M=Ms(xm,null);let n;y({pageRef:S});const F=Ms(JA,null);let W;const N=T.deferHydration();if(T.isHydrating){const le=T.hooks.hookOnce("app:error",N);Co().beforeEach(le)}a.pageKey&&Pd(()=>a.pageKey,(le,de)=>{le!==de&&T.callHook("page:loading:start")});let Y=!1;{const le=Co().beforeResolve(()=>{Y=!1});ym(()=>{le()})}return()=>Ps(vI,{name:a.name,route:a.route,...c},{default:le=>{const de=hN(M,le.route,le.Component),Te=M&&M.matched.length===le.route.matched.length;if(!le.Component){if(W&&!Te)return W;N();return}if(W&&F&&!F.isCurrent(le.route))return W;if(de&&M&&(!F||F!=null&&F.isCurrent(M)))return Te?W:null;const pe=Ix(le,a.pageKey),qe=dN(M,le.route,le.Component);!T.isHydrating&&n===pe&&!qe&&ju(()=>{Y=!0,T.callHook("page:loading:end")}),n=pe;const $e=!!(a.transition??le.route.meta.pageTransition??KS),ze=$e&&uN([a.transition,le.route.meta.pageTransition,KS,{onBeforeLeave(){T._runningTransition=!0},onAfterLeave(){delete T._runningTransition,T.callHook("page:transition:finish",le.Component)}}]),be=a.keepalive??le.route.meta.keepalive??HL;return W=xI($e&&ze,mF(be,Ps(eb,{suspensible:!0,onPending:()=>T.callHook("page:start",le.Component),onResolve:()=>{ju(()=>T.callHook("page:finish",le.Component).then(()=>{if(!Y&&!qe)return Y=!0,T.callHook("page:loading:end")}).finally(N))}},{default:()=>{const ke={key:pe||void 0,vnode:m.default?fN(m.default,le):le.Component,route:le.route,renderKey:pe||void 0,trackRootNodes:$e,vnodeRef:S};if(!be)return Ps(lN,ke);const Ke=le.Component.type,St=Ke;let kt=n2.get(St);return kt||(kt=HI(Ke.name||Ke.__name),n2.set(St,kt)),Ps(kt,ke)}}))).default(),W}})}});function uN(a){const c=a.filter(Boolean).map(m=>({...m,onAfterLeave:m.onAfterLeave?ub(m.onAfterLeave):void 0}));return KA(...c)}function hN(a,c,m){if(!a)return!1;const y=c.matched.findIndex(T=>{var S;return((S=T.components)==null?void 0:S.default)===(m==null?void 0:m.type)});return!y||y===-1?!1:c.matched.slice(0,y).some((T,S)=>{var M,n,F;return((M=T.components)==null?void 0:M.default)!==((F=(n=a.matched[S])==null?void 0:n.components)==null?void 0:F.default)})||m&&Ix({route:c,Component:m})!==Ix({route:a,Component:m})}function dN(a,c,m){return a?c.matched.findIndex(T=>{var S;return((S=T.components)==null?void 0:S.default)===(m==null?void 0:m.type)})<c.matched.length-1:!1}function fN(a,c){const m=a(c);return m.length===1?Ps(m[0]):Ps(Cs,void 0,m)}const pN=Sc({name:"LayoutLoader",inheritAttrs:!1,props:{name:String,layoutProps:Object},setup(a,c){return()=>Ps(_c[a.name],a.layoutProps,c.slots)}}),mN={name:{type:[String,Boolean,Object],default:null},fallback:{type:[String,Object],default:null}},_N=Sc({name:"NuxtLayout",inheritAttrs:!1,props:mN,setup(a,c){const m=qn(),y=Ms(xm),T=y===sb()?uF():y,S=Eo(()=>{let F=wn(a.name)??T.meta.layout??"default";return F&&!(F in _c)&&a.fallback&&(F=wn(a.fallback)),F}),M=Aa();c.expose({layoutRef:M});const n=m.deferHydration();if(m.isHydrating){const F=m.hooks.hookOnce("app:error",n);Co().beforeEach(F)}return()=>{const F=S.value&&S.value in _c,W=T.meta.layoutTransition??GL;return xI(F&&W,{default:()=>Ps(eb,{suspensible:!0,onResolve:()=>{ju(n)}},{default:()=>Ps(gN,{layoutProps:IA(c.attrs,{ref:M}),key:S.value||void 0,name:S.value,shouldProvide:!a.name,hasTransition:!!W},c.slots)})}).default()}}}),gN=Sc({name:"NuxtLayoutProvider",inheritAttrs:!1,props:{name:{type:[String,Boolean]},layoutProps:{type:Object},hasTransition:{type:Boolean},shouldProvide:{type:Boolean}},setup(a,c){const m=a.name;return a.shouldProvide&&Bu(JA,{isCurrent:y=>m===(y.meta.layout??"default")}),()=>{var y,T;return!m||typeof m=="string"&&!(m in _c)?(T=(y=c.slots).default)==null?void 0:T.call(y):Ps(pN,{key:m,layoutProps:a.layoutProps,name:m},c.slots)}}}),yN=(a,c)=>{const m=a.__vccOpts||a;for(const[y,T]of c)m[y]=T;return m},vN={};function xN(a,c){const m=cN,y=_N;return So(),Sa(y,null,{default:Zx(()=>[kn(m)]),_:1})}const bN=yN(vN,[["render",xN]]),wN={__name:"nuxt-error-page",props:{error:Object},setup(a){const m=a.error;m.stack&&m.stack.split(`
`).splice(1).map(Y=>({text:Y.replace("webpack:/","").replace(".vue",".js").trim(),internal:Y.includes("node_modules")&&!Y.includes(".cache")||Y.includes("internal")||Y.includes("new Promise")})).map(Y=>`<span class="stack${Y.internal?" internal":""}">${Y.text}</span>`).join(`
`);const y=Number(m.statusCode||500),T=y===404,S=m.statusMessage??(T?"Page Not Found":"Internal Server Error"),M=m.message||m.toString(),n=void 0,N=T?nx(()=>Fs(()=>import("./DyvCn2DQ.js"),__vite__mapDeps([17,15,18,19]),import.meta.url)):nx(()=>Fs(()=>import("./DIo9Vbrw.js"),__vite__mapDeps([20,18,21]),import.meta.url));return(Y,le)=>(So(),Sa(wn(N),mR(EA({statusCode:wn(y),statusMessage:wn(S),description:wn(M),stack:wn(n)})),null,16))}},TN={key:0},s2={__name:"nuxt-root",setup(a){const c=()=>null,m=qn(),y=m.deferHydration();if(m.isHydrating){const F=m.hooks.hookOnce("app:error",y);Co().beforeEach(F)}const T=!1;Bu(xm,sb()),m.hooks.callHookWith(F=>F.map(W=>W()),"vue:setup");const S=xy(),M=!1;K2((F,W,N)=>{if(m.hooks.callHook("vue:error",F,W,N).catch(Y=>console.error("[nuxt] Error in `vue:error` hook",Y)),eI(F)&&(F.fatal||F.unhandled))return m.runWithContext(()=>Du(F)),!1});const n=!1;return(F,W)=>(So(),Sa(eb,{onResolve:wn(y)},{default:Zx(()=>[wn(M)?(So(),YD("div",TN)):wn(S)?(So(),Sa(wn(wN),{key:1,error:wn(S)},null,8,["error"])):wn(n)?(So(),Sa(wn(c),{key:2,context:wn(n)},null,8,["context"])):wn(T)?(So(),Sa(gD(wn(T)),{key:3})):(So(),Sa(wn(bN),{key:4}))]),_:1},8,["onResolve"]))}};let o2;{let a;o2=async function(){var M,n;if(a)return a;const y=!!(((M=window.__NUXT__)==null?void 0:M.serverRendered)??((n=document.getElementById("__NUXT_DATA__"))==null?void 0:n.dataset.ssr)==="true")?Nk(s2):Bk(s2),T=KL({vueApp:y});async function S(F){var W;await T.callHook("app:error",F),(W=T.payload).error||(W.error=Vu(F))}y.config.errorHandler=S,T.hook("app:suspense:resolve",()=>{y.config.errorHandler===S&&(y.config.errorHandler=void 0)});try{await QL(T,aN)}catch(F){S(F)}try{await T.hooks.callHook("app:created",y),await T.hooks.callHook("app:beforeMount",y),y.mount(WL),await T.hooks.callHook("app:mounted",y),await ju()}catch(F){S(F)}return y},a=o2().catch(c=>{throw console.error("Error while mounting app:",c),c})}export{cz as $,X2 as A,RN as B,kN as C,FN as D,ON as E,Cs as F,LN as G,Sa as H,Bu as I,Co as J,zN as K,wn as L,Hn as M,sb as N,ju as O,Tc as P,PN as Q,Sc as R,qn as S,_b as T,i2 as U,ym as V,WN as W,Ps as X,IN as Y,OA as Z,yN as _,SA as a,Gu as a0,rb as a1,NN as a2,hL as a3,hm as a4,BN as a5,FD as a6,wI as a7,kn as b,YD as c,AA as d,ez as e,rI as f,MN as g,Yx as h,Ms as i,CN as j,AN as k,Fs as l,WB as m,fy as n,So as o,VN as p,Eo as q,Aa as r,Pd as s,xR as t,UN as u,DN as v,Zx as w,Kx as x,jd as y,sN as z};
